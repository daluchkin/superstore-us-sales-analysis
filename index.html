<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Superstore Sales Analysis (EDA)</title>

<script src="index_files/header-attrs-2.23/header-attrs.js"></script>
<script src="index_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="index_files/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="index_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="index_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="index_files/navigation-1.1/tabsets.js"></script>
<script src="index_files/navigation-1.1/codefolding.js"></script>
<script src="index_files/navigation-1.1/sourceembed.js"></script>
<script src="index_files/kePrint-0.0.1/kePrint.js"></script>
<link href="index_files/lightable-0.0.1/lightable.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>



<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>


<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>




</head>

<body>


<div class="container-fluid main-container">




<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Superstore Sales Analysis (EDA)</h1>

</div>

<div id="TOC">
<ul>
<li><a href="#introduction" id="toc-introduction">Introduction</a></li>
<li><a href="#objectives" id="toc-objectives">Objectives</a></li>
<li><a href="#dataset" id="toc-dataset">Dataset</a></li>
<li><a href="#metadata" id="toc-metadata">Metadata</a></li>
<li><a href="#preparation" id="toc-preparation">Preparation</a></li>
<li><a href="#data-loading" id="toc-data-loading">Data Loading</a></li>
<li><a href="#data-cleansing" id="toc-data-cleansing">Data Cleansing</a>
<ul>
<li><a href="#missing-data" id="toc-missing-data">Missing Data</a></li>
<li><a href="#duplicated-data" id="toc-duplicated-data">Duplicated
Data</a></li>
</ul></li>
<li><a href="#data-transformation" id="toc-data-transformation">Data
Transformation</a></li>
<li><a href="#descriptive-statistics"
id="toc-descriptive-statistics">Descriptive Statistics</a>
<ul>
<li><a href="#categorycal-variabels-factors"
id="toc-categorycal-variabels-factors">Categorycal Variabels
(Factors)</a></li>
<li><a href="#date-type-variabels" id="toc-date-type-variabels">Date
Type Variabels</a>
<ul>
<li><a href="#order-date" id="toc-order-date">Order Date</a></li>
<li><a href="#ship-date" id="toc-ship-date">Ship Date</a></li>
</ul></li>
<li><a href="#numeric-type-variabels"
id="toc-numeric-type-variabels">Numeric Type Variabels</a>
<ul>
<li><a href="#sales-variable" id="toc-sales-variable">Sales
variable</a></li>
<li><a href="#profit-variable" id="toc-profit-variable">Profit
variable</a></li>
<li><a href="#discount-variable" id="toc-discount-variable">Discount
variable</a></li>
<li><a href="#quantity-variable" id="toc-quantity-variable">Quantity
variable</a></li>
</ul></li>
</ul></li>
<li><a href="#exploratory-data-analysis"
id="toc-exploratory-data-analysis">Exploratory Data Analysis</a>
<ul>
<li><a href="#general-metrics" id="toc-general-metrics">General
Metrics</a>
<ul>
<li><a href="#code-formatting" id="toc-code-formatting">Code
Formatting</a></li>
<li><a href="#metrics" id="toc-metrics">Metrics</a></li>
</ul></li>
<li><a href="#what-is-total-gross-revenue-and-yoy-growth-rate-of-its"
id="toc-what-is-total-gross-revenue-and-yoy-growth-rate-of-its">What is
total gross revenue and YoY growth rate of its?</a></li>
<li><a href="#what-is-total-profit-and-yoy-growth-rate-of-its"
id="toc-what-is-total-profit-and-yoy-growth-rate-of-its">What is total
profit and YoY growth rate of its?</a></li>
<li><a href="#which-are-sales-and-average-price-quarterly"
id="toc-which-are-sales-and-average-price-quarterly">Which are Sales and
average Price quarterly?</a></li>
<li><a href="#what-is-average-order-value-by-month"
id="toc-what-is-average-order-value-by-month">What is average order
value by month?</a></li>
<li><a href="#what-is-average-order-value-by-week"
id="toc-what-is-average-order-value-by-week">What is average order value
by week?</a></li>
<li><a href="#what-is-average-order-value-by-date"
id="toc-what-is-average-order-value-by-date">What is average order value
by date?</a></li>
<li><a href="#what-is-average-order-value-by-day-of-week"
id="toc-what-is-average-order-value-by-day-of-week">What is average
order value by day of week?</a></li>
<li><a href="#which-category-are-best-selling-and-most-profitable"
id="toc-which-category-are-best-selling-and-most-profitable">Which
Category are best selling and most profitable?</a></li>
<li><a href="#what-is-yoy-sales-and-profit-growth-by-category"
id="toc-what-is-yoy-sales-and-profit-growth-by-category">What is YoY
Sales and Profit Growth by Category?</a></li>
<li><a href="#general-metrics-calculation"
id="toc-general-metrics-calculation">General metrics calculation</a>
<ul>
<li><a href="#revenue-ref" id="toc-revenue-ref">What is the gross sales
revenue?</a></li>
<li><a href="#profit-ref" id="toc-profit-ref">What is the total
profit?</a></li>
<li><a href="#orders-ref" id="toc-orders-ref">What are total and loss
orders and YoY Growth of its?</a></li>
</ul></li>
<li><a
href="#which-sub-category-are-best-selling-and-most-profitablelossable"
id="toc-which-sub-category-are-best-selling-and-most-profitablelossable">Which
Sub-Category are best selling and most profitable/lossable?</a></li>
<li><a href="#what-is-yoy-sales-and-profit-growth-by-sub-category"
id="toc-what-is-yoy-sales-and-profit-growth-by-sub-category">What is YoY
Sales and Profit Growth by Sub-Category?</a>
<ul>
<li><a href="#yoy-sales-growth" id="toc-yoy-sales-growth">YoY Sales
Growth</a></li>
<li><a href="#yoy-profit-growth" id="toc-yoy-profit-growth">YoY Profit
Growth</a></li>
</ul></li>
<li><a
href="#which-sub-categories-do-customers-prefer-to-buy-together-at-the-same-time"
id="toc-which-sub-categories-do-customers-prefer-to-buy-together-at-the-same-time">Which
sub-categories do customers prefer to buy together at the same
time?</a></li>
<li><a href="#basket-ref" id="toc-basket-ref">What is average basket
size and value?</a></li>
<li><a
href="#what-are-yoy-basket-value-growth-and-basket-size-by-customer-segment"
id="toc-what-are-yoy-basket-value-growth-and-basket-size-by-customer-segment">What
are YoY basket value Growth and basket size by Customer
Segment?</a></li>
<li><a href="#customers-ref" id="toc-customers-ref">What are number of
total and new customers and YoY growth of its?</a></li>
<li><a href="#what-is-customer-lifetime-value-ctv"
id="toc-what-is-customer-lifetime-value-ctv">What is Customer Lifetime
Value (CTV)?</a></li>
<li><a href="#what-are-top-profitable-products"
id="toc-what-are-top-profitable-products">What are top profitable
products?</a></li>
<li><a href="#who-are-the-top-profitable-customers"
id="toc-who-are-the-top-profitable-customers">Who are the top profitable
customers?</a></li>
<li><a href="#what-is-percentage-of-revenue-from-new-business"
id="toc-what-is-percentage-of-revenue-from-new-business">What is
percentage of Revenue from new business?</a></li>
<li><a
href="#which-cityregionstate-is-the-best-selling-and-most-profitable"
id="toc-which-cityregionstate-is-the-best-selling-and-most-profitable">Which
city/region/state is the best selling and most profitable?</a>
<ul>
<li><a href="#region" id="toc-region">Region</a>
<ul>
<li><a href="#what-are-yoy-sales-and-profit-growth-by-region"
id="toc-what-are-yoy-sales-and-profit-growth-by-region">What are YoY
Sales and Profit growth by Region?</a></li>
<li><a href="#yoy-sales-growth-1" id="toc-yoy-sales-growth-1">YoY Sales
Growth</a></li>
<li><a href="#yoy-profit-growth-1" id="toc-yoy-profit-growth-1">YoY
Profit Growth</a></li>
<li><a href="#yoy-losses-orders-growth"
id="toc-yoy-losses-orders-growth">YoY Losses Orders Growth</a></li>
</ul></li>
<li><a href="#city" id="toc-city">City</a>
<ul>
<li><a href="#what-are-top-profitable-cities"
id="toc-what-are-top-profitable-cities">What are top profitable
Cities?</a></li>
<li><a href="#what-are-bottom-profitable-cities"
id="toc-what-are-bottom-profitable-cities">What are bottom profitable
Cities?</a></li>
</ul></li>
<li><a href="#state" id="toc-state">State</a>
<ul>
<li><a href="#what-are-top-profitable-states"
id="toc-what-are-top-profitable-states">What are top profitable
States?</a></li>
<li><a href="#what-are-bottom-profitable-states"
id="toc-what-are-bottom-profitable-states">What are bottom profitable
States?</a></li>
</ul></li>
</ul></li>
<li><a href="#which-is-the-preferred-ship-mode"
id="toc-which-is-the-preferred-ship-mode">Which is the preferred ship
mode?</a></li>
<li><a href="#customer-segment" id="toc-customer-segment">Customer
Segment</a>
<ul>
<li><a href="#what-are-sizes-of-customer-segments"
id="toc-what-are-sizes-of-customer-segments">What are sizes of Customer
Segments?</a></li>
<li><a href="#losses" id="toc-losses">Losses</a></li>
<li><a href="#what-are-yoy-growth-sales-and-profit-by-customer-segment"
id="toc-what-are-yoy-growth-sales-and-profit-by-customer-segment">What
are YoY Growth Sales and Profit by Customer Segment?</a></li>
</ul></li>
<li><a href="#correlation" id="toc-correlation">Correlation</a>
<ul>
<li><a href="#how-sales-affect-profit"
id="toc-how-sales-affect-profit">How Sales affect Profit?</a></li>
<li><a href="#how-discount-affects-sales-and-profit"
id="toc-how-discount-affects-sales-and-profit">How discount affects
sales and profit?</a></li>
</ul></li>
</ul></li>
</ul>
</div>

<style type="text/css">
.grid-container {
  display: grid;
  gap: 15px;
  grid-template-columns: auto auto auto;
}

.grid-item {
  border: 1px solid lightgray;
  padding: 15px;
  text-align: left;
  vertical-align: top;
}

.grid-container--fit {
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
}

.parent {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    grid-template-rows: 40px repeat(2, 1fr);
    grid-column-gap: 0px;
    grid-row-gap: 15px;
}

.div_0 { grid-area: 1 / 1 / 2 / 5; text-align: right;}
.div_top_left { grid-area: 2 / 1 / 3 / 3; }
.div_top_right { grid-area: 2 / 3 / 3 / 5; text-align: right;}
.div_bottom_left { grid-area: 3 / 1 / 4 / 3; }
.div_bottom_right { grid-area: 3 / 3 / 4 / 5; text-align: right;}

</style>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>The dataset contains sales, profit, shipping and geographical
information, categories and sub-categories of sold products.</p>
</div>
<div id="objectives" class="section level1">
<h1>Objectives</h1>
<ol style="list-style-type: decimal">
<li><p>Understand the data, structure and data types.</p></li>
<li><p>Clean data.</p></li>
<li><p>Transform data for analysis.</p></li>
<li><p>Answer the following questions:</p>
<ul>
<li>General Metrics:
<ul>
<li>What is the gross sales revenue?</li>
<li>What is the total profit?</li>
<li>What is average basket size and value?</li>
<li>What is Customer Lifetime Value (CTV)?</li>
<li>What are number of total and new customers?</li>
<li>What are total and loss orders?</li>
</ul></li>
<li>Sales &amp; Profit:
<ul>
<li>What is total gross revenue and YoY growth rate of its?</li>
<li>What is total profit and YoY growth rate of its?</li>
<li>Which are Sales and average Price quarterly by segment?</li>
<li>What is average order value by month?</li>
<li>What is average order value by week?</li>
<li>What is average order value by date?</li>
<li>What is average order value by day of week?</li>
</ul></li>
<li>Category:
<ul>
<li>Which Category are best selling and most profitable?</li>
<li>What is YoY Sales and Profit Growth by Category?</li>
</ul></li>
<li>Orders:
<ul>
<li>What are total and loss orders and YoY Growth of its?</li>
</ul></li>
<li>Sub-Category:
<ul>
<li>Which Sub-Category are best selling and most
profitable/lossable?</li>
<li>What is YoY Sales and Profit Growth by Sub-Category?</li>
<li>Which sub-categories do customers prefer to buy together at the same
time?</li>
</ul></li>
<li>Basket:
<ul>
<li>What is average basket size and value?</li>
<li>What are YoY basket value Growth and basket size by Customer
Segment?</li>
</ul></li>
<li>Customer Lifetime Value:
<ul>
<li>What is Customer Lifetime Value (CTV)?</li>
<li>What is YoY CTV Growth?</li>
</ul></li>
<li>Customer:
<ul>
<li>What are number of total and new customers?</li>
<li>What are YoY total and new customers growth?</li>
<li>Who are the top profitable customers?</li>
<li>What is percentage of Revenue from new business?</li>
</ul></li>
<li>Product:
<ul>
<li>What are top profitable products?</li>
</ul></li>
<li>Region/State/City:
<ul>
<li>Which city/region/state is the best selling and most
profitable?</li>
<li>What are YoY Sales and Profit growth by Region?</li>
<li>What is YoY loss Orders Growth by Region?</li>
<li>What are top/bottom profitable Cities?</li>
<li>What are top/bottom profitable States?</li>
</ul></li>
<li>Ship Mode:
<ul>
<li>Which is the preferred ship mode?</li>
</ul></li>
<li>Customer Segment:
<ul>
<li>What are sizes of Customer Segments?</li>
<li>What are YoY Growth Sales and Profit by Customer Segment?</li>
</ul></li>
<li>Correlation:
<ul>
<li>How Sales affect Profit?</li>
<li>How discount affects sales and profit?</li>
</ul></li>
</ul></li>
</ol>
</div>
<div id="dataset" class="section level1">
<h1>Dataset</h1>
<p>Dataset is located in Kaggle and named as <a
href="https://www.kaggle.com/datasets/vivek468/superstore-dataset-final">Superstore
Dataset</a>.</p>
</div>
<div id="metadata" class="section level1">
<h1>Metadata</h1>
<table>
<thead>
<tr class="header">
<th align="left">Variable name</th>
<th align="left">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Row ID</td>
<td align="left">Unique ID for each row.</td>
</tr>
<tr class="even">
<td align="left">Order ID</td>
<td align="left">Unique Order ID for each Customer.</td>
</tr>
<tr class="odd">
<td align="left">Order Date</td>
<td align="left">Order Date of the product.</td>
</tr>
<tr class="even">
<td align="left">Ship Date</td>
<td align="left">Shipping Date of the Product.</td>
</tr>
<tr class="odd">
<td align="left">Ship Mode</td>
<td align="left">Shipping Mode specified by the Customer.</td>
</tr>
<tr class="even">
<td align="left">Customer ID</td>
<td align="left">Unique ID to identify each Customer.</td>
</tr>
<tr class="odd">
<td align="left">Customer Name</td>
<td align="left">Name of the Customer.</td>
</tr>
<tr class="even">
<td align="left">Segment</td>
<td align="left">The segment where the Customer belongs.</td>
</tr>
<tr class="odd">
<td align="left">City</td>
<td align="left">City of residence of of the Customer.</td>
</tr>
<tr class="even">
<td align="left">State</td>
<td align="left">State of residence of the Customer.</td>
</tr>
<tr class="odd">
<td align="left">Country</td>
<td align="left">Country of residence of the Customer.</td>
</tr>
<tr class="even">
<td align="left">Postal Code</td>
<td align="left">Postal Code of every Customer.</td>
</tr>
<tr class="odd">
<td align="left">Region</td>
<td align="left">Region where the Customer belong.</td>
</tr>
<tr class="even">
<td align="left">Product ID</td>
<td align="left">Unique ID of the Product.</td>
</tr>
<tr class="odd">
<td align="left">Category</td>
<td align="left">Category of the product ordered.</td>
</tr>
<tr class="even">
<td align="left">Sub-Category</td>
<td align="left">Sub-Category of the product ordered.</td>
</tr>
<tr class="odd">
<td align="left">Product Name</td>
<td align="left">Name of the Product</td>
</tr>
<tr class="even">
<td align="left">Sales</td>
<td align="left">Sales of the Product.</td>
</tr>
<tr class="odd">
<td align="left">Quantity</td>
<td align="left">Quantity of the Product.</td>
</tr>
<tr class="even">
<td align="left">Discount</td>
<td align="left">Discount provided.</td>
</tr>
<tr class="odd">
<td align="left">Profit</td>
<td align="left">Profit/Loss incurred.</td>
</tr>
</tbody>
</table>
</div>
<div id="preparation" class="section level1">
<h1>Preparation</h1>
<p>All the required libraries have to be installed.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># loading required libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># setup plots theme</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="fu">theme_set</span>(<span class="fu">theme_light</span>())</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">theme_update</span>(<span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>), </span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a>             <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a>             <span class="at">panel.grid.major =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;darkgray&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>),</span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a>             <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>             <span class="at">panel.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>             <span class="at">panel.border=</span> <span class="fu">element_rect</span>(<span class="at">color=</span><span class="st">&quot;darkgray&quot;</span>),</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>             <span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="st">&quot;lines&quot;</span>))</span></code></pre></div>
</div>
<div id="data-loading" class="section level1">
<h1>Data Loading</h1>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="co"># Loading data</span></span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>Orders <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">&quot;./data/Sample - Superstore.csv&quot;</span>)</span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co"># KAGGLE</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#Orders &lt;- read_csv(&quot;/kaggle/input/superstore-dataset-final/Sample - Superstore.csv&quot;)</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" tabindex="-1"></a><span class="co"># Column names</span></span>
<span id="cb3-8"><a href="#cb3-8" tabindex="-1"></a><span class="fu">colnames</span>(Orders)</span></code></pre></div>
<pre><code>##  [1] &quot;Row ID&quot;        &quot;Order ID&quot;      &quot;Order Date&quot;    &quot;Ship Date&quot;    
##  [5] &quot;Ship Mode&quot;     &quot;Customer ID&quot;   &quot;Customer Name&quot; &quot;Segment&quot;      
##  [9] &quot;Country&quot;       &quot;City&quot;          &quot;State&quot;         &quot;Postal Code&quot;  
## [13] &quot;Region&quot;        &quot;Product ID&quot;    &quot;Category&quot;      &quot;Sub-Category&quot; 
## [17] &quot;Product Name&quot;  &quot;Sales&quot;         &quot;Quantity&quot;      &quot;Discount&quot;     
## [21] &quot;Profit&quot;</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># Dimention</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="fu">size_sum</span>(Orders)</span></code></pre></div>
<pre><code>## [1] &quot;[9,994 × 21]&quot;</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Structure =&gt; This code will appear error on Kaggle!</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a><span class="fu">glimpse</span>(Orders)</span></code></pre></div>
<pre><code>## Rows: 9,994
## Columns: 21
## $ `Row ID`        &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,…
## $ `Order ID`      &lt;chr&gt; &quot;CA-2016-152156&quot;, &quot;CA-2016-152156&quot;, &quot;CA-2016-138688&quot;, …
## $ `Order Date`    &lt;chr&gt; &quot;11/8/2016&quot;, &quot;11/8/2016&quot;, &quot;6/12/2016&quot;, &quot;10/11/2015&quot;, &quot;…
## $ `Ship Date`     &lt;chr&gt; &quot;11/11/2016&quot;, &quot;11/11/2016&quot;, &quot;6/16/2016&quot;, &quot;10/18/2015&quot;,…
## $ `Ship Mode`     &lt;chr&gt; &quot;Second Class&quot;, &quot;Second Class&quot;, &quot;Second Class&quot;, &quot;Stand…
## $ `Customer ID`   &lt;chr&gt; &quot;CG-12520&quot;, &quot;CG-12520&quot;, &quot;DV-13045&quot;, &quot;SO-20335&quot;, &quot;SO-20…
## $ `Customer Name` &lt;chr&gt; &quot;Claire Gute&quot;, &quot;Claire Gute&quot;, &quot;Darrin Van Huff&quot;, &quot;Sean…
## $ Segment         &lt;chr&gt; &quot;Consumer&quot;, &quot;Consumer&quot;, &quot;Corporate&quot;, &quot;Consumer&quot;, &quot;Cons…
## $ Country         &lt;chr&gt; &quot;United States&quot;, &quot;United States&quot;, &quot;United States&quot;, &quot;Un…
## $ City            &lt;chr&gt; &quot;Henderson&quot;, &quot;Henderson&quot;, &quot;Los Angeles&quot;, &quot;Fort Lauderd…
## $ State           &lt;chr&gt; &quot;Kentucky&quot;, &quot;Kentucky&quot;, &quot;California&quot;, &quot;Florida&quot;, &quot;Flor…
## $ `Postal Code`   &lt;chr&gt; &quot;42420&quot;, &quot;42420&quot;, &quot;90036&quot;, &quot;33311&quot;, &quot;33311&quot;, &quot;90032&quot;, …
## $ Region          &lt;chr&gt; &quot;South&quot;, &quot;South&quot;, &quot;West&quot;, &quot;South&quot;, &quot;South&quot;, &quot;West&quot;, &quot;W…
## $ `Product ID`    &lt;chr&gt; &quot;FUR-BO-10001798&quot;, &quot;FUR-CH-10000454&quot;, &quot;OFF-LA-10000240…
## $ Category        &lt;chr&gt; &quot;Furniture&quot;, &quot;Furniture&quot;, &quot;Office Supplies&quot;, &quot;Furnitur…
## $ `Sub-Category`  &lt;chr&gt; &quot;Bookcases&quot;, &quot;Chairs&quot;, &quot;Labels&quot;, &quot;Tables&quot;, &quot;Storage&quot;, …
## $ `Product Name`  &lt;chr&gt; &quot;Bush Somerset Collection Bookcase&quot;, &quot;Hon Deluxe Fabri…
## $ Sales           &lt;dbl&gt; 261.9600, 731.9400, 14.6200, 957.5775, 22.3680, 48.860…
## $ Quantity        &lt;dbl&gt; 2, 3, 2, 5, 2, 7, 4, 6, 3, 5, 9, 4, 3, 3, 5, 3, 6, 2, …
## $ Discount        &lt;dbl&gt; 0.00, 0.00, 0.00, 0.45, 0.20, 0.00, 0.00, 0.20, 0.20, …
## $ Profit          &lt;dbl&gt; 41.9136, 219.5820, 6.8714, -383.0310, 2.5164, 14.1694,…</code></pre>
<p>Check character columns whether all columns have an valid UTF-8
encoding which could affect R functions proceeding.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># get all columns that have an invalid UTF-8 encoding</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>invalid_cols <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="fu">select_if</span>(is.character) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="sc">~</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">validUTF8</span>(.))) <span class="sc">%&gt;%</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>  <span class="fu">select_if</span>(<span class="sc">~</span>. <span class="sc">&gt;</span> <span class="dv">0</span>); invalid_cols</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   `Customer Name` `Product Name`
##             &lt;int&gt;          &lt;int&gt;
## 1              89            278</code></pre>
<p><strong>Product Name</strong> and <strong>Customer Name</strong> have
invalid UTF-8 encoding that would affect negatively on plotting the
variables and output some R functions on Kaggle.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Customer Name</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>invalid_customer_name <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">validUTF8</span>(<span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="fu">distinct</span>(); invalid_customer_name</span></code></pre></div>
<pre><code>## # A tibble: 6 × 1
##   `Customer Name`       
##   &lt;chr&gt;                 
## 1 &quot;Roy Franz\xf6sisch&quot;  
## 2 &quot;Resi P\xf6lking&quot;     
## 3 &quot;Peter B\xfchler&quot;     
## 4 &quot;Barry Franz\xf6sisch&quot;
## 5 &quot;Anna H\xe4berlin&quot;    
## 6 &quot;Neil Franz\xf6sisch&quot;</code></pre>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>invalid_customer_name <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ascii =</span> stringi<span class="sc">::</span><span class="fu">stri_trans_general</span>(<span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span>, <span class="st">&quot;Latin-ASCII&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 6 × 2
##   `Customer Name`        ascii            
##   &lt;chr&gt;                  &lt;chr&gt;            
## 1 &quot;Roy Franz\xf6sisch&quot;   Roy Franz�sisch  
## 2 &quot;Resi P\xf6lking&quot;      Resi P�lking     
## 3 &quot;Peter B\xfchler&quot;      Peter B�hler     
## 4 &quot;Barry Franz\xf6sisch&quot; Barry Franz�sisch
## 5 &quot;Anna H\xe4berlin&quot;     Anna H�berlin    
## 6 &quot;Neil Franz\xf6sisch&quot;  Neil Franz�sisch</code></pre>
<p>All strings in R could be only in three encodings - UTF-8 , Latin1
and native. Let’s try <strong>latin1</strong>.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="fu">Encoding</span>(invalid_customer_name<span class="sc">$</span><span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span>) <span class="ot">&lt;-</span> <span class="st">&quot;latin1&quot;</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>invalid_customer_name<span class="sc">$</span><span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span></span></code></pre></div>
<pre><code>## [1] &quot;Roy Französisch&quot;   &quot;Resi Pölking&quot;      &quot;Peter Bühler&quot;     
## [4] &quot;Barry Französisch&quot; &quot;Anna Häberlin&quot;     &quot;Neil Französisch&quot;</code></pre>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># apply this approach to the whole Customer Name column</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="fu">Encoding</span>(Orders<span class="sc">$</span><span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span>) <span class="ot">&lt;-</span> <span class="st">&quot;latin1&quot;</span></span></code></pre></div>
<p>Check <strong>Product Name</strong>.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># Product Name</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>invalid_product_name <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Product Name</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">validUTF8</span>(<span class="st">`</span><span class="at">Product Name</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  <span class="fu">distinct</span>(); invalid_product_name</span></code></pre></div>
<pre><code>## # A tibble: 59 × 1
##    `Product Name`                                                               
##    &lt;chr&gt;                                                                        
##  1 &quot;Konftel 250 Conference\xa0phone\xa0- Charcoal black&quot;                        
##  2 &quot;Imation\xa08GB Mini TravelDrive USB 2.0\xa0Flash Drive&quot;                     
##  3 &quot;Imation\xa08gb Micro Traveldrive Usb 2.0\xa0Flash Drive&quot;                    
##  4 &quot;Logitech\xa0LS21 Speaker System - PC Multimedia - 2.1-CH - Wired&quot;           
##  5 &quot;Logitech\xa0Gaming G510s - Keyboard&quot;                                        
##  6 &quot;Plantronics Cordless\xa0Phone Headset\xa0with In-line Volume - M214C&quot;       
##  7 &quot;Jabra BIZ 2300 Duo QD Duo Corded\xa0Headset&quot;                                
##  8 &quot;Adams Phone Message Book, Professional, 400 Message Capacity, 5 3/6\x94 x 1…
##  9 &quot;Imation\xa0Secure+ Hardware Encrypted USB 2.0\xa0Flash Drive; 16GB&quot;         
## 10 &quot;Logitech\xa0P710e Mobile Speakerphone&quot;                                      
## # ℹ 49 more rows</code></pre>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="fu">type_convert</span>(Orders <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Product Name</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">validUTF8</span>(<span class="st">`</span><span class="at">Product Name</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  <span class="fu">distinct</span>(), <span class="at">locale =</span> readr<span class="sc">::</span><span class="fu">locale</span>(<span class="at">encoding =</span> <span class="st">&quot;latin1&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Product Name</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">iconv</span>(<span class="st">`</span><span class="at">Product Name</span><span class="st">`</span>,<span class="st">&quot;utf-8&quot;</span>, <span class="st">&quot;latin1&quot;</span>, <span class="at">sub=</span><span class="st">&quot; &quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 59 × 1
##    `Product Name`                                                            
##    &lt;chr&gt;                                                                     
##  1 Konftel 250 Conference phone - Charcoal black                             
##  2 Imation 8GB Mini TravelDrive USB 2.0 Flash Drive                          
##  3 Imation 8gb Micro Traveldrive Usb 2.0 Flash Drive                         
##  4 Logitech LS21 Speaker System - PC Multimedia - 2.1-CH - Wired             
##  5 Logitech Gaming G510s - Keyboard                                          
##  6 Plantronics Cordless Phone Headset with In-line Volume - M214C            
##  7 Jabra BIZ 2300 Duo QD Duo Corded Headset                                  
##  8 Adams Phone Message Book, Professional, 400 Message Capacity, 5 3/6” x 11”
##  9 Imation Secure+ Hardware Encrypted USB 2.0 Flash Drive; 16GB              
## 10 Logitech P710e Mobile Speakerphone                                        
## # ℹ 49 more rows</code></pre>
<p>Change encoding for the whole <strong>Product Name</strong>
column.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">Encoding</span>(Orders<span class="sc">$</span><span class="st">`</span><span class="at">Product Name</span><span class="st">`</span>) <span class="ot">&lt;-</span> <span class="st">&quot;latin1&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="co"># Structure</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">glimpse</span>(Orders)</span></code></pre></div>
<pre><code>## Rows: 9,994
## Columns: 21
## $ `Row ID`        &lt;dbl&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16,…
## $ `Order ID`      &lt;chr&gt; &quot;CA-2016-152156&quot;, &quot;CA-2016-152156&quot;, &quot;CA-2016-138688&quot;, …
## $ `Order Date`    &lt;chr&gt; &quot;11/8/2016&quot;, &quot;11/8/2016&quot;, &quot;6/12/2016&quot;, &quot;10/11/2015&quot;, &quot;…
## $ `Ship Date`     &lt;chr&gt; &quot;11/11/2016&quot;, &quot;11/11/2016&quot;, &quot;6/16/2016&quot;, &quot;10/18/2015&quot;,…
## $ `Ship Mode`     &lt;chr&gt; &quot;Second Class&quot;, &quot;Second Class&quot;, &quot;Second Class&quot;, &quot;Stand…
## $ `Customer ID`   &lt;chr&gt; &quot;CG-12520&quot;, &quot;CG-12520&quot;, &quot;DV-13045&quot;, &quot;SO-20335&quot;, &quot;SO-20…
## $ `Customer Name` &lt;chr&gt; &quot;Claire Gute&quot;, &quot;Claire Gute&quot;, &quot;Darrin Van Huff&quot;, &quot;Sean…
## $ Segment         &lt;chr&gt; &quot;Consumer&quot;, &quot;Consumer&quot;, &quot;Corporate&quot;, &quot;Consumer&quot;, &quot;Cons…
## $ Country         &lt;chr&gt; &quot;United States&quot;, &quot;United States&quot;, &quot;United States&quot;, &quot;Un…
## $ City            &lt;chr&gt; &quot;Henderson&quot;, &quot;Henderson&quot;, &quot;Los Angeles&quot;, &quot;Fort Lauderd…
## $ State           &lt;chr&gt; &quot;Kentucky&quot;, &quot;Kentucky&quot;, &quot;California&quot;, &quot;Florida&quot;, &quot;Flor…
## $ `Postal Code`   &lt;chr&gt; &quot;42420&quot;, &quot;42420&quot;, &quot;90036&quot;, &quot;33311&quot;, &quot;33311&quot;, &quot;90032&quot;, …
## $ Region          &lt;chr&gt; &quot;South&quot;, &quot;South&quot;, &quot;West&quot;, &quot;South&quot;, &quot;South&quot;, &quot;West&quot;, &quot;W…
## $ `Product ID`    &lt;chr&gt; &quot;FUR-BO-10001798&quot;, &quot;FUR-CH-10000454&quot;, &quot;OFF-LA-10000240…
## $ Category        &lt;chr&gt; &quot;Furniture&quot;, &quot;Furniture&quot;, &quot;Office Supplies&quot;, &quot;Furnitur…
## $ `Sub-Category`  &lt;chr&gt; &quot;Bookcases&quot;, &quot;Chairs&quot;, &quot;Labels&quot;, &quot;Tables&quot;, &quot;Storage&quot;, …
## $ `Product Name`  &lt;chr&gt; &quot;Bush Somerset Collection Bookcase&quot;, &quot;Hon Deluxe Fabri…
## $ Sales           &lt;dbl&gt; 261.9600, 731.9400, 14.6200, 957.5775, 22.3680, 48.860…
## $ Quantity        &lt;dbl&gt; 2, 3, 2, 5, 2, 7, 4, 6, 3, 5, 9, 4, 3, 3, 5, 3, 6, 2, …
## $ Discount        &lt;dbl&gt; 0.00, 0.00, 0.00, 0.45, 0.20, 0.00, 0.00, 0.20, 0.20, …
## $ Profit          &lt;dbl&gt; 41.9136, 219.5820, 6.8714, -383.0310, 2.5164, 14.1694,…</code></pre>
</div>
<div id="data-cleansing" class="section level1">
<h1>Data Cleansing</h1>
<div id="missing-data" class="section level2">
<h2>Missing Data</h2>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># missing values</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>missing_values <span class="ot">&lt;-</span> <span class="fu">lapply</span>(Orders, <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x) <span class="sc">|</span> x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;NA&quot;</span>)))</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a>missing_values[missing_values <span class="sc">&gt;</span> <span class="dv">0</span>]</span></code></pre></div>
<pre><code>## named list()</code></pre>
<p>There are no NA data in the table.</p>
</div>
<div id="duplicated-data" class="section level2">
<h2>Duplicated Data</h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a><span class="co"># Duplicate data</span></span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>  <span class="fu">group_by_all</span>() <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 0 × 21
## # ℹ 21 variables: Row ID &lt;dbl&gt;, Order ID &lt;chr&gt;, Order Date &lt;chr&gt;,
## #   Ship Date &lt;chr&gt;, Ship Mode &lt;chr&gt;, Customer ID &lt;chr&gt;, Customer Name &lt;chr&gt;,
## #   Segment &lt;chr&gt;, Country &lt;chr&gt;, City &lt;chr&gt;, State &lt;chr&gt;, Postal Code &lt;chr&gt;,
## #   Region &lt;chr&gt;, Product ID &lt;chr&gt;, Category &lt;chr&gt;, Sub-Category &lt;chr&gt;,
## #   Product Name &lt;chr&gt;, Sales &lt;dbl&gt;, Quantity &lt;dbl&gt;, Discount &lt;dbl&gt;,
## #   Profit &lt;dbl&gt;</code></pre>
<p>There are NO duplicates, but…</p>
<p>A number of rows is <strong>9994</strong>. Let’s remove useless
variable <strong>Row ID</strong> and check duplicates again.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="co"># Number of full duplicates</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="fu">sum</span>(Orders <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Row ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">duplicated</span>())</span></code></pre></div>
<pre><code>## [1] 1</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="co"># All duplicates</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Row ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a>  <span class="fu">group_by_all</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">n</span>() <span class="sc">&gt;</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 × 20
##   `Order ID`  `Order Date` `Ship Date` `Ship Mode` `Customer ID` `Customer Name`
##   &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt;          
## 1 US-2014-15… 4/23/2014    4/27/2014   Standard C… LB-16795      Laurel Beltran 
## 2 US-2014-15… 4/23/2014    4/27/2014   Standard C… LB-16795      Laurel Beltran 
## # ℹ 14 more variables: Segment &lt;chr&gt;, Country &lt;chr&gt;, City &lt;chr&gt;, State &lt;chr&gt;,
## #   `Postal Code` &lt;chr&gt;, Region &lt;chr&gt;, `Product ID` &lt;chr&gt;, Category &lt;chr&gt;,
## #   `Sub-Category` &lt;chr&gt;, `Product Name` &lt;chr&gt;, Sales &lt;dbl&gt;, Quantity &lt;dbl&gt;,
## #   Discount &lt;dbl&gt;, Profit &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a><span class="co"># keep unique rows only</span></span>
<span id="cb33-2"><a href="#cb33-2" tabindex="-1"></a>Orders <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Row ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb33-3"><a href="#cb33-3" tabindex="-1"></a></span>
<span id="cb33-4"><a href="#cb33-4" tabindex="-1"></a><span class="co"># check structure and dimension</span></span>
<span id="cb33-5"><a href="#cb33-5" tabindex="-1"></a><span class="fu">glimpse</span>(Orders)</span></code></pre></div>
<pre><code>## Rows: 9,993
## Columns: 20
## $ `Order ID`      &lt;chr&gt; &quot;CA-2016-152156&quot;, &quot;CA-2016-152156&quot;, &quot;CA-2016-138688&quot;, …
## $ `Order Date`    &lt;chr&gt; &quot;11/8/2016&quot;, &quot;11/8/2016&quot;, &quot;6/12/2016&quot;, &quot;10/11/2015&quot;, &quot;…
## $ `Ship Date`     &lt;chr&gt; &quot;11/11/2016&quot;, &quot;11/11/2016&quot;, &quot;6/16/2016&quot;, &quot;10/18/2015&quot;,…
## $ `Ship Mode`     &lt;chr&gt; &quot;Second Class&quot;, &quot;Second Class&quot;, &quot;Second Class&quot;, &quot;Stand…
## $ `Customer ID`   &lt;chr&gt; &quot;CG-12520&quot;, &quot;CG-12520&quot;, &quot;DV-13045&quot;, &quot;SO-20335&quot;, &quot;SO-20…
## $ `Customer Name` &lt;chr&gt; &quot;Claire Gute&quot;, &quot;Claire Gute&quot;, &quot;Darrin Van Huff&quot;, &quot;Sean…
## $ Segment         &lt;chr&gt; &quot;Consumer&quot;, &quot;Consumer&quot;, &quot;Corporate&quot;, &quot;Consumer&quot;, &quot;Cons…
## $ Country         &lt;chr&gt; &quot;United States&quot;, &quot;United States&quot;, &quot;United States&quot;, &quot;Un…
## $ City            &lt;chr&gt; &quot;Henderson&quot;, &quot;Henderson&quot;, &quot;Los Angeles&quot;, &quot;Fort Lauderd…
## $ State           &lt;chr&gt; &quot;Kentucky&quot;, &quot;Kentucky&quot;, &quot;California&quot;, &quot;Florida&quot;, &quot;Flor…
## $ `Postal Code`   &lt;chr&gt; &quot;42420&quot;, &quot;42420&quot;, &quot;90036&quot;, &quot;33311&quot;, &quot;33311&quot;, &quot;90032&quot;, …
## $ Region          &lt;chr&gt; &quot;South&quot;, &quot;South&quot;, &quot;West&quot;, &quot;South&quot;, &quot;South&quot;, &quot;West&quot;, &quot;W…
## $ `Product ID`    &lt;chr&gt; &quot;FUR-BO-10001798&quot;, &quot;FUR-CH-10000454&quot;, &quot;OFF-LA-10000240…
## $ Category        &lt;chr&gt; &quot;Furniture&quot;, &quot;Furniture&quot;, &quot;Office Supplies&quot;, &quot;Furnitur…
## $ `Sub-Category`  &lt;chr&gt; &quot;Bookcases&quot;, &quot;Chairs&quot;, &quot;Labels&quot;, &quot;Tables&quot;, &quot;Storage&quot;, …
## $ `Product Name`  &lt;chr&gt; &quot;Bush Somerset Collection Bookcase&quot;, &quot;Hon Deluxe Fabri…
## $ Sales           &lt;dbl&gt; 261.9600, 731.9400, 14.6200, 957.5775, 22.3680, 48.860…
## $ Quantity        &lt;dbl&gt; 2, 3, 2, 5, 2, 7, 4, 6, 3, 5, 9, 4, 3, 3, 5, 3, 6, 2, …
## $ Discount        &lt;dbl&gt; 0.00, 0.00, 0.00, 0.45, 0.20, 0.00, 0.00, 0.20, 0.20, …
## $ Profit          &lt;dbl&gt; 41.9136, 219.5820, 6.8714, -383.0310, 2.5164, 14.1694,…</code></pre>
<p>Now it’s <strong>9993</strong>, so one duplicate was removed.</p>
</div>
</div>
<div id="data-transformation" class="section level1">
<h1>Data Transformation</h1>
<p>Let’s look at the all character variables and their unique
values.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># Number of unique values in each column</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>uni_count <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">sapply</span>(Orders <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.character), </span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>                                  <span class="cf">function</span>(x) <span class="fu">length</span>(<span class="fu">unique</span>(x)), <span class="at">simplify =</span> T))</span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>uni_count <span class="ot">&lt;-</span> <span class="fu">rownames_to_column</span>(uni_count, <span class="at">var=</span><span class="st">&quot;s&quot;</span>)</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a><span class="fu">colnames</span>(uni_count) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Variable Name&quot;</span>, <span class="st">&quot;# of Unique Values&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="co"># Print variables</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">knit_print</span>(uni_count)</span></code></pre></div>
<pre><code>##    Variable Name # of Unique Values
## 1       Order ID               5009
## 2     Order Date               1237
## 3      Ship Date               1334
## 4      Ship Mode                  4
## 5    Customer ID                793
## 6  Customer Name                793
## 7        Segment                  3
## 8        Country                  1
## 9           City                531
## 10         State                 49
## 11   Postal Code                631
## 12        Region                  4
## 13    Product ID               1862
## 14      Category                  3
## 15  Sub-Category                 17
## 16  Product Name               1850</code></pre>
<p>These variables <strong>Ship Mode</strong>, <strong>Segment</strong>,
<strong>Country</strong>, <strong>City</strong>, <strong>State</strong>,
<strong>Region</strong>, <strong>Category</strong>,
<strong>Sub-Category</strong> have to be a <em>Factor</em> data type,
and <strong>Order Date</strong>, <strong>Ship Date</strong> as
<em>Date</em> data type.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" tabindex="-1"></a>factor_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Ship Mode&quot;</span>, <span class="st">&quot;Segment&quot;</span>, <span class="st">&quot;Country&quot;</span>, <span class="st">&quot;City&quot;</span>, </span>
<span id="cb38-2"><a href="#cb38-2" tabindex="-1"></a>                    <span class="st">&quot;State&quot;</span>, <span class="st">&quot;Region&quot;</span>, <span class="st">&quot;Category&quot;</span>, <span class="st">&quot;Sub-Category&quot;</span>)</span>
<span id="cb38-3"><a href="#cb38-3" tabindex="-1"></a>date_columns <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;Order Date&quot;</span>, <span class="st">&quot;Ship Date&quot;</span>)</span>
<span id="cb38-4"><a href="#cb38-4" tabindex="-1"></a></span>
<span id="cb38-5"><a href="#cb38-5" tabindex="-1"></a><span class="co"># make factors and format date variables.</span></span>
<span id="cb38-6"><a href="#cb38-6" tabindex="-1"></a>Orders <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb38-7"><a href="#cb38-7" tabindex="-1"></a>  <span class="fu">mutate_at</span>(factor_columns, as.factor) <span class="sc">%&gt;%</span></span>
<span id="cb38-8"><a href="#cb38-8" tabindex="-1"></a>  <span class="fu">mutate_at</span>(date_columns, <span class="sc">~</span><span class="fu">as.Date</span>(., <span class="at">format=</span><span class="st">&quot;%m/%d/%Y&quot;</span>))</span>
<span id="cb38-9"><a href="#cb38-9" tabindex="-1"></a></span>
<span id="cb38-10"><a href="#cb38-10" tabindex="-1"></a><span class="co"># make Quantity as Integer</span></span>
<span id="cb38-11"><a href="#cb38-11" tabindex="-1"></a>Orders <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb38-12"><a href="#cb38-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Quantity =</span> <span class="fu">as.integer</span>(Quantity))</span>
<span id="cb38-13"><a href="#cb38-13" tabindex="-1"></a></span>
<span id="cb38-14"><a href="#cb38-14" tabindex="-1"></a><span class="co"># check structure</span></span>
<span id="cb38-15"><a href="#cb38-15" tabindex="-1"></a><span class="fu">glimpse</span>(Orders)</span></code></pre></div>
<pre><code>## Rows: 9,993
## Columns: 20
## $ `Order ID`      &lt;chr&gt; &quot;CA-2016-152156&quot;, &quot;CA-2016-152156&quot;, &quot;CA-2016-138688&quot;, …
## $ `Order Date`    &lt;date&gt; 2016-11-08, 2016-11-08, 2016-06-12, 2015-10-11, 2015-…
## $ `Ship Date`     &lt;date&gt; 2016-11-11, 2016-11-11, 2016-06-16, 2015-10-18, 2015-…
## $ `Ship Mode`     &lt;fct&gt; Second Class, Second Class, Second Class, Standard Cla…
## $ `Customer ID`   &lt;chr&gt; &quot;CG-12520&quot;, &quot;CG-12520&quot;, &quot;DV-13045&quot;, &quot;SO-20335&quot;, &quot;SO-20…
## $ `Customer Name` &lt;chr&gt; &quot;Claire Gute&quot;, &quot;Claire Gute&quot;, &quot;Darrin Van Huff&quot;, &quot;Sean…
## $ Segment         &lt;fct&gt; Consumer, Consumer, Corporate, Consumer, Consumer, Con…
## $ Country         &lt;fct&gt; United States, United States, United States, United St…
## $ City            &lt;fct&gt; Henderson, Henderson, Los Angeles, Fort Lauderdale, Fo…
## $ State           &lt;fct&gt; Kentucky, Kentucky, California, Florida, Florida, Cali…
## $ `Postal Code`   &lt;chr&gt; &quot;42420&quot;, &quot;42420&quot;, &quot;90036&quot;, &quot;33311&quot;, &quot;33311&quot;, &quot;90032&quot;, …
## $ Region          &lt;fct&gt; South, South, West, South, South, West, West, West, We…
## $ `Product ID`    &lt;chr&gt; &quot;FUR-BO-10001798&quot;, &quot;FUR-CH-10000454&quot;, &quot;OFF-LA-10000240…
## $ Category        &lt;fct&gt; Furniture, Furniture, Office Supplies, Furniture, Offi…
## $ `Sub-Category`  &lt;fct&gt; Bookcases, Chairs, Labels, Tables, Storage, Furnishing…
## $ `Product Name`  &lt;chr&gt; &quot;Bush Somerset Collection Bookcase&quot;, &quot;Hon Deluxe Fabri…
## $ Sales           &lt;dbl&gt; 261.9600, 731.9400, 14.6200, 957.5775, 22.3680, 48.860…
## $ Quantity        &lt;int&gt; 2, 3, 2, 5, 2, 7, 4, 6, 3, 5, 9, 4, 3, 3, 5, 3, 6, 2, …
## $ Discount        &lt;dbl&gt; 0.00, 0.00, 0.00, 0.45, 0.20, 0.00, 0.00, 0.20, 0.20, …
## $ Profit          &lt;dbl&gt; 41.9136, 219.5820, 6.8714, -383.0310, 2.5164, 14.1694,…</code></pre>
<p>Double check the missing values.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>missing_values <span class="ot">&lt;-</span> <span class="fu">lapply</span>(Orders, </span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>                         <span class="cf">function</span>(x) <span class="fu">sum</span>(<span class="fu">is.na</span>(x) <span class="sc">|</span> x <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;NA&quot;</span>)))</span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>missing_values[missing_values <span class="sc">&gt;</span> <span class="dv">0</span>]</span></code></pre></div>
<pre><code>## named list()</code></pre>
<p>There are still NO missing values.</p>
</div>
<div id="descriptive-statistics" class="section level1">
<h1>Descriptive Statistics</h1>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" tabindex="-1"></a><span class="co"># summary data variables</span></span>
<span id="cb42-2"><a href="#cb42-2" tabindex="-1"></a><span class="fu">summary</span>(Orders)</span></code></pre></div>
<pre><code>##    Order ID           Order Date           Ship Date         
##  Length:9993        Min.   :2014-01-03   Min.   :2014-01-07  
##  Class :character   1st Qu.:2015-05-23   1st Qu.:2015-05-27  
##  Mode  :character   Median :2016-06-26   Median :2016-06-29  
##                     Mean   :2016-04-30   Mean   :2016-05-04  
##                     3rd Qu.:2017-05-14   3rd Qu.:2017-05-18  
##                     Max.   :2017-12-30   Max.   :2018-01-05  
##                                                              
##           Ship Mode    Customer ID        Customer Name             Segment    
##  First Class   :1538   Length:9993        Length:9993        Consumer   :5191  
##  Same Day      : 543   Class :character   Class :character   Corporate  :3020  
##  Second Class  :1945   Mode  :character   Mode  :character   Home Office:1782  
##  Standard Class:5967                                                           
##                                                                                
##                                                                                
##                                                                                
##           Country                City               State     
##  United States:9993   New York City: 915   California  :2001  
##                       Los Angeles  : 747   New York    :1128  
##                       Philadelphia : 537   Texas       : 985  
##                       San Francisco: 510   Pennsylvania: 587  
##                       Seattle      : 428   Washington  : 506  
##                       Houston      : 377   Illinois    : 492  
##                       (Other)      :6479   (Other)     :4294  
##  Postal Code            Region      Product ID                   Category   
##  Length:9993        Central:2323   Length:9993        Furniture      :2120  
##  Class :character   East   :2847   Class :character   Office Supplies:6026  
##  Mode  :character   South  :1620   Mode  :character   Technology     :1847  
##                     West   :3203                                            
##                                                                             
##                                                                             
##                                                                             
##       Sub-Category  Product Name           Sales              Quantity    
##  Binders    :1523   Length:9993        Min.   :    0.444   Min.   : 1.00  
##  Paper      :1370   Class :character   1st Qu.:   17.280   1st Qu.: 2.00  
##  Furnishings: 957   Mode  :character   Median :   54.480   Median : 3.00  
##  Phones     : 889                      Mean   :  229.853   Mean   : 3.79  
##  Storage    : 846                      3rd Qu.:  209.940   3rd Qu.: 5.00  
##  Art        : 796                      Max.   :22638.480   Max.   :14.00  
##  (Other)    :3612                                                         
##     Discount          Profit         
##  Min.   :0.0000   Min.   :-6599.978  
##  1st Qu.:0.0000   1st Qu.:    1.731  
##  Median :0.2000   Median :    8.671  
##  Mean   :0.1562   Mean   :   28.661  
##  3rd Qu.:0.2000   3rd Qu.:   29.364  
##  Max.   :0.8000   Max.   : 8399.976  
## </code></pre>
<p>Let’s learn variables closer.</p>
<div id="categorycal-variabels-factors" class="section level2">
<h2>Categorycal Variabels (Factors)</h2>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" tabindex="-1"></a><span class="co"># re-order levels</span></span>
<span id="cb44-2"><a href="#cb44-2" tabindex="-1"></a>reorder_size <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb44-3"><a href="#cb44-3" tabindex="-1"></a>        <span class="fu">factor</span>(x, <span class="at">levels =</span> <span class="fu">names</span>(<span class="fu">sort</span>(<span class="fu">table</span>(x), <span class="at">decreasing =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb44-4"><a href="#cb44-4" tabindex="-1"></a>}</span>
<span id="cb44-5"><a href="#cb44-5" tabindex="-1"></a></span>
<span id="cb44-6"><a href="#cb44-6" tabindex="-1"></a>reorder_value <span class="ot">&lt;-</span> <span class="cf">function</span>(x, value, decreasing) {</span>
<span id="cb44-7"><a href="#cb44-7" tabindex="-1"></a>  a <span class="ot">&lt;-</span> <span class="fu">array</span>(value)</span>
<span id="cb44-8"><a href="#cb44-8" tabindex="-1"></a>  <span class="fu">names</span>(a) <span class="ot">&lt;-</span> x</span>
<span id="cb44-9"><a href="#cb44-9" tabindex="-1"></a>  <span class="cf">if</span>(decreasing){</span>
<span id="cb44-10"><a href="#cb44-10" tabindex="-1"></a>    <span class="fu">factor</span>(x, <span class="at">levels =</span> <span class="fu">names</span>(<span class="fu">sort</span>(a, <span class="at">decreasing =</span> <span class="cn">TRUE</span>)))</span>
<span id="cb44-11"><a href="#cb44-11" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb44-12"><a href="#cb44-12" tabindex="-1"></a>    <span class="fu">factor</span>(x, <span class="at">levels =</span> <span class="fu">names</span>(<span class="fu">sort</span>(a)))</span>
<span id="cb44-13"><a href="#cb44-13" tabindex="-1"></a>  }</span>
<span id="cb44-14"><a href="#cb44-14" tabindex="-1"></a>}</span>
<span id="cb44-15"><a href="#cb44-15" tabindex="-1"></a></span>
<span id="cb44-16"><a href="#cb44-16" tabindex="-1"></a>all_factors <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb44-17"><a href="#cb44-17" tabindex="-1"></a>  <span class="fu">select_if</span>(is.factor) <span class="sc">%&gt;%</span></span>
<span id="cb44-18"><a href="#cb44-18" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>City) <span class="co"># except City as it has a lot of </span></span>
<span id="cb44-19"><a href="#cb44-19" tabindex="-1"></a>                <span class="co"># levels of factor and it would be </span></span>
<span id="cb44-20"><a href="#cb44-20" tabindex="-1"></a>                <span class="co"># hard to analyse it</span></span>
<span id="cb44-21"><a href="#cb44-21" tabindex="-1"></a></span>
<span id="cb44-22"><a href="#cb44-22" tabindex="-1"></a><span class="cf">for</span>(fct <span class="cf">in</span> <span class="fu">colnames</span>(all_factors)){</span>
<span id="cb44-23"><a href="#cb44-23" tabindex="-1"></a>  <span class="fu">print</span>(all_factors <span class="sc">%&gt;%</span></span>
<span id="cb44-24"><a href="#cb44-24" tabindex="-1"></a>          <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder_size</span>(<span class="fu">get</span>(fct)))) <span class="sc">+</span></span>
<span id="cb44-25"><a href="#cb44-25" tabindex="-1"></a>          <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> (..count..)<span class="sc">/</span><span class="fu">sum</span>(..count..)), </span>
<span id="cb44-26"><a href="#cb44-26" tabindex="-1"></a>                   <span class="at">fill=</span><span class="st">&quot;#4BA15D&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb44-27"><a href="#cb44-27" tabindex="-1"></a>          <span class="fu">xlab</span>(fct) <span class="sc">+</span></span>
<span id="cb44-28"><a href="#cb44-28" tabindex="-1"></a>          <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent, </span>
<span id="cb44-29"><a href="#cb44-29" tabindex="-1"></a>                             <span class="at">name =</span> <span class="st">&quot;Proportion&quot;</span>) <span class="sc">+</span></span>
<span id="cb44-30"><a href="#cb44-30" tabindex="-1"></a>          <span class="fu">labs</span>(<span class="at">title=</span><span class="fu">paste0</span>(<span class="st">&quot;Proportion of &quot;</span>, fct, <span class="st">&quot; variable&quot;</span>)) <span class="sc">+</span></span>
<span id="cb44-31"><a href="#cb44-31" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(</span>
<span id="cb44-32"><a href="#cb44-32" tabindex="-1"></a>            <span class="at">angle =</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(<span class="fu">unique</span>(all_factors[, fct])) <span class="sc">&gt;</span> <span class="dv">4</span>, <span class="dv">45</span>, <span class="dv">0</span>), </span>
<span id="cb44-33"><a href="#cb44-33" tabindex="-1"></a>            <span class="at">hjust =</span> <span class="fu">ifelse</span>(<span class="fu">nrow</span>(<span class="fu">unique</span>(all_factors[, fct])) <span class="sc">&gt;</span> <span class="dv">4</span>, <span class="dv">1</span>, <span class="fl">0.5</span>))) <span class="sc">+</span></span>
<span id="cb44-34"><a href="#cb44-34" tabindex="-1"></a>          <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="st">&quot;lines&quot;</span>)) )</span>
<span id="cb44-35"><a href="#cb44-35" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="index_files/figure-html/categorycal-descriptive-1.png" width="50%" /><img src="index_files/figure-html/categorycal-descriptive-2.png" width="50%" /><img src="index_files/figure-html/categorycal-descriptive-3.png" width="50%" /><img src="index_files/figure-html/categorycal-descriptive-4.png" width="50%" /><img src="index_files/figure-html/categorycal-descriptive-5.png" width="50%" /><img src="index_files/figure-html/categorycal-descriptive-6.png" width="50%" /><img src="index_files/figure-html/categorycal-descriptive-7.png" width="50%" /></p>
<p>As <strong>City</strong> variable has hundreds levels, let’s improve
readability of <strong>City</strong> descriptive statistics and group
cities with proportion less that 1% of the total as <em>Other</em>.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb45-2"><a href="#cb45-2" tabindex="-1"></a>  <span class="fu">select</span>(City) <span class="sc">%&gt;%</span></span>
<span id="cb45-3"><a href="#cb45-3" tabindex="-1"></a>  <span class="fu">group_by</span>(City) <span class="sc">%&gt;%</span></span>
<span id="cb45-4"><a href="#cb45-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prop =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb45-5"><a href="#cb45-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb45-6"><a href="#cb45-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Group =</span> <span class="fu">ifelse</span>(prop <span class="sc">/</span> <span class="fu">n</span>() <span class="sc">&lt;</span> <span class="fl">0.01</span>, <span class="st">&quot;Other&quot;</span>, <span class="fu">as.character</span>(City)),</span>
<span id="cb45-7"><a href="#cb45-7" tabindex="-1"></a>         <span class="at">Group =</span> <span class="fu">as.factor</span>(Group)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-8"><a href="#cb45-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder_size</span>(Group), <span class="at">fill=</span><span class="fu">ifelse</span>(Group <span class="sc">==</span> <span class="st">&quot;Other&quot;</span>, <span class="st">&quot;Other&quot;</span>, <span class="st">&quot;City&quot;</span>))) <span class="sc">+</span></span>
<span id="cb45-9"><a href="#cb45-9" tabindex="-1"></a>                      <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> (..count..)<span class="sc">/</span><span class="fu">sum</span>(..count..)), <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb45-10"><a href="#cb45-10" tabindex="-1"></a>                      <span class="fu">xlab</span>(<span class="st">&quot;City&quot;</span>) <span class="sc">+</span></span>
<span id="cb45-11"><a href="#cb45-11" tabindex="-1"></a>                      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">name =</span> <span class="st">&quot;Proportion&quot;</span>) <span class="sc">+</span></span>
<span id="cb45-12"><a href="#cb45-12" tabindex="-1"></a>                      <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">&quot;&quot;</span>, <span class="at">values =</span> <span class="fu">c</span>(<span class="at">Other=</span><span class="st">&quot;#ECECEC&quot;</span>, <span class="st">&quot;City&quot;</span><span class="ot">=</span><span class="st">&quot;#4BA15D&quot;</span>)) <span class="sc">+</span></span>
<span id="cb45-13"><a href="#cb45-13" tabindex="-1"></a>                      <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb45-14"><a href="#cb45-14" tabindex="-1"></a>                                <span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb45-15"><a href="#cb45-15" tabindex="-1"></a>                      <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Proportion of City variable&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/city-summary-1.png" width="100%" /></p>
</div>
<div id="date-type-variabels" class="section level2">
<h2>Date Type Variabels</h2>
<p>Let’s decompose date variables on date parts and analyse them.</p>
<div id="order-date" class="section level3">
<h3>Order Date</h3>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" tabindex="-1"></a>all_date <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" tabindex="-1"></a>  <span class="fu">select_if</span>(is.Date)</span>
<span id="cb46-3"><a href="#cb46-3" tabindex="-1"></a></span>
<span id="cb46-4"><a href="#cb46-4" tabindex="-1"></a><span class="fu">summary</span>(all_date)</span></code></pre></div>
<pre><code>##    Order Date           Ship Date         
##  Min.   :2014-01-03   Min.   :2014-01-07  
##  1st Qu.:2015-05-23   1st Qu.:2015-05-27  
##  Median :2016-06-26   Median :2016-06-29  
##  Mean   :2016-04-30   Mean   :2016-05-04  
##  3rd Qu.:2017-05-14   3rd Qu.:2017-05-18  
##  Max.   :2017-12-30   Max.   :2018-01-05</code></pre>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" tabindex="-1"></a>order_date_parts <span class="ot">&lt;-</span> all_date <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Years</span><span class="st">`</span><span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)), </span>
<span id="cb48-3"><a href="#cb48-3" tabindex="-1"></a>         <span class="st">`</span><span class="at">Months</span><span class="st">`</span><span class="ot">=</span> <span class="fu">as.factor</span>(month.name[<span class="fu">month</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)]),</span>
<span id="cb48-4"><a href="#cb48-4" tabindex="-1"></a>         <span class="st">`</span><span class="at">Weeks</span><span class="st">`</span><span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">week</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)),</span>
<span id="cb48-5"><a href="#cb48-5" tabindex="-1"></a>         <span class="st">`</span><span class="at">Weekdays</span><span class="st">`</span><span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">weekdays</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)),</span>
<span id="cb48-6"><a href="#cb48-6" tabindex="-1"></a>         <span class="st">`</span><span class="at">Days</span><span class="st">`</span><span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">day</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb48-7"><a href="#cb48-7" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;Order Date&quot;</span>, <span class="st">&quot;Ship Date&quot;</span>))</span>
<span id="cb48-8"><a href="#cb48-8" tabindex="-1"></a></span>
<span id="cb48-9"><a href="#cb48-9" tabindex="-1"></a><span class="co"># Order Date</span></span>
<span id="cb48-10"><a href="#cb48-10" tabindex="-1"></a><span class="cf">for</span>(part <span class="cf">in</span> <span class="fu">colnames</span>(order_date_parts)){</span>
<span id="cb48-11"><a href="#cb48-11" tabindex="-1"></a>  <span class="fu">print</span>(order_date_parts <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder_size</span>(<span class="fu">get</span>(part)))) <span class="sc">+</span></span>
<span id="cb48-12"><a href="#cb48-12" tabindex="-1"></a>                      <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> (..count..)<span class="sc">/</span><span class="fu">sum</span>(..count..)), <span class="at">fill=</span><span class="st">&quot;#4BA15D&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb48-13"><a href="#cb48-13" tabindex="-1"></a>                      <span class="fu">xlab</span>(part) <span class="sc">+</span></span>
<span id="cb48-14"><a href="#cb48-14" tabindex="-1"></a>                      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">name =</span> <span class="st">&quot;Proportion&quot;</span>) <span class="sc">+</span></span>
<span id="cb48-15"><a href="#cb48-15" tabindex="-1"></a>                            <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb48-16"><a href="#cb48-16" tabindex="-1"></a>                                <span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span> </span>
<span id="cb48-17"><a href="#cb48-17" tabindex="-1"></a>       <span class="fu">labs</span>(<span class="at">title=</span><span class="fu">paste0</span>(<span class="st">&quot;Proportion of &quot;</span>, part,<span class="st">&quot; in Order Date variable&quot;</span>)) <span class="sc">+</span></span>
<span id="cb48-18"><a href="#cb48-18" tabindex="-1"></a>       <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="st">&quot;lines&quot;</span>)) )</span>
<span id="cb48-19"><a href="#cb48-19" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="index_files/figure-html/order-date-summary-1.png" width="50%" /><img src="index_files/figure-html/order-date-summary-2.png" width="50%" /><img src="index_files/figure-html/order-date-summary-3.png" width="50%" /><img src="index_files/figure-html/order-date-summary-4.png" width="50%" /><img src="index_files/figure-html/order-date-summary-5.png" width="50%" /></p>
</div>
<div id="ship-date" class="section level3">
<h3>Ship Date</h3>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" tabindex="-1"></a>ship_date_parts <span class="ot">&lt;-</span> all_date <span class="sc">%&gt;%</span></span>
<span id="cb49-2"><a href="#cb49-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Years</span><span class="st">`</span><span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">year</span>(<span class="st">`</span><span class="at">Ship Date</span><span class="st">`</span>)), </span>
<span id="cb49-3"><a href="#cb49-3" tabindex="-1"></a>         <span class="st">`</span><span class="at">Months</span><span class="st">`</span><span class="ot">=</span> <span class="fu">as.factor</span>(month.name[<span class="fu">month</span>(<span class="st">`</span><span class="at">Ship Date</span><span class="st">`</span>)]),</span>
<span id="cb49-4"><a href="#cb49-4" tabindex="-1"></a>         <span class="st">`</span><span class="at">Weeks</span><span class="st">`</span><span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">week</span>(<span class="st">`</span><span class="at">Ship Date</span><span class="st">`</span>)),</span>
<span id="cb49-5"><a href="#cb49-5" tabindex="-1"></a>         <span class="st">`</span><span class="at">Weekdays</span><span class="st">`</span><span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">weekdays</span>(<span class="st">`</span><span class="at">Ship Date</span><span class="st">`</span>)),</span>
<span id="cb49-6"><a href="#cb49-6" tabindex="-1"></a>         <span class="st">`</span><span class="at">Days</span><span class="st">`</span><span class="ot">=</span> <span class="fu">as.factor</span>(<span class="fu">day</span>(<span class="st">`</span><span class="at">Ship Date</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb49-7"><a href="#cb49-7" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="st">&quot;Order Date&quot;</span>, <span class="st">&quot;Ship Date&quot;</span>))</span>
<span id="cb49-8"><a href="#cb49-8" tabindex="-1"></a></span>
<span id="cb49-9"><a href="#cb49-9" tabindex="-1"></a><span class="co"># Order Date</span></span>
<span id="cb49-10"><a href="#cb49-10" tabindex="-1"></a><span class="cf">for</span>(part <span class="cf">in</span> <span class="fu">colnames</span>(ship_date_parts)){</span>
<span id="cb49-11"><a href="#cb49-11" tabindex="-1"></a>  <span class="fu">print</span>(ship_date_parts <span class="sc">%&gt;%</span> <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder_size</span>(<span class="fu">get</span>(part)))) <span class="sc">+</span></span>
<span id="cb49-12"><a href="#cb49-12" tabindex="-1"></a>                      <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> (..count..)<span class="sc">/</span><span class="fu">sum</span>(..count..)), <span class="at">fill=</span><span class="st">&quot;#4BA15D&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb49-13"><a href="#cb49-13" tabindex="-1"></a>                      <span class="fu">xlab</span>(part) <span class="sc">+</span></span>
<span id="cb49-14"><a href="#cb49-14" tabindex="-1"></a>                      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">name =</span> <span class="st">&quot;Proportion&quot;</span>) <span class="sc">+</span></span>
<span id="cb49-15"><a href="#cb49-15" tabindex="-1"></a>                            <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb49-16"><a href="#cb49-16" tabindex="-1"></a>                                <span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span> </span>
<span id="cb49-17"><a href="#cb49-17" tabindex="-1"></a>       <span class="fu">labs</span>(<span class="at">title=</span><span class="fu">paste0</span>(<span class="st">&quot;Proportion of &quot;</span>, part,<span class="st">&quot; in Ship Date variable&quot;</span>)) <span class="sc">+</span></span>
<span id="cb49-18"><a href="#cb49-18" tabindex="-1"></a>       <span class="fu">theme</span>(<span class="at">plot.margin =</span> <span class="fu">unit</span>(<span class="fu">c</span>(.<span class="dv">5</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="st">&quot;lines&quot;</span>)) )</span>
<span id="cb49-19"><a href="#cb49-19" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="index_files/figure-html/ship-date-summary-1.png" width="50%" /><img src="index_files/figure-html/ship-date-summary-2.png" width="50%" /><img src="index_files/figure-html/ship-date-summary-3.png" width="50%" /><img src="index_files/figure-html/ship-date-summary-4.png" width="50%" /><img src="index_files/figure-html/ship-date-summary-5.png" width="50%" /></p>
</div>
</div>
<div id="numeric-type-variabels" class="section level2">
<h2>Numeric Type Variabels</h2>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" tabindex="-1"></a>all_numeric <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" tabindex="-1"></a>  <span class="fu">select_if</span>(is.numeric)</span>
<span id="cb50-3"><a href="#cb50-3" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" tabindex="-1"></a><span class="fu">summary</span>(all_numeric)</span></code></pre></div>
<pre><code>##      Sales              Quantity        Discount          Profit         
##  Min.   :    0.444   Min.   : 1.00   Min.   :0.0000   Min.   :-6599.978  
##  1st Qu.:   17.280   1st Qu.: 2.00   1st Qu.:0.0000   1st Qu.:    1.731  
##  Median :   54.480   Median : 3.00   Median :0.2000   Median :    8.671  
##  Mean   :  229.853   Mean   : 3.79   Mean   :0.1562   Mean   :   28.661  
##  3rd Qu.:  209.940   3rd Qu.: 5.00   3rd Qu.:0.2000   3rd Qu.:   29.364  
##  Max.   :22638.480   Max.   :14.00   Max.   :0.8000   Max.   : 8399.976</code></pre>
<div id="sales-variable" class="section level3">
<h3>Sales variable</h3>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" tabindex="-1"></a>Mode <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb52-2"><a href="#cb52-2" tabindex="-1"></a> a <span class="ot">&lt;-</span> <span class="fu">table</span>(x)</span>
<span id="cb52-3"><a href="#cb52-3" tabindex="-1"></a> <span class="fu">as.numeric</span>(<span class="fu">names</span>(a)[a <span class="sc">==</span> <span class="fu">max</span>(a)])</span>
<span id="cb52-4"><a href="#cb52-4" tabindex="-1"></a>}</span>
<span id="cb52-5"><a href="#cb52-5" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb52-7"><a href="#cb52-7" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sales)) <span class="sc">+</span></span>
<span id="cb52-8"><a href="#cb52-8" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span>..density..), <span class="at">colour=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>, <span class="at">bins =</span> <span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb52-9"><a href="#cb52-9" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill=</span><span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb52-10"><a href="#cb52-10" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(Orders<span class="sc">$</span>Sales), <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="at">colour=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-11"><a href="#cb52-11" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(Orders<span class="sc">$</span>Sales), <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="at">colour=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-12"><a href="#cb52-12" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>, <span class="at">xmin=</span><span class="fl">7e3</span>, <span class="at">xmax=</span><span class="fl">13e3</span>, <span class="at">ymin=</span><span class="fl">4e-3</span>, <span class="at">ymax=</span><span class="fl">5.5e-3</span>,  <span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-13"><a href="#cb52-13" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">10e3</span>, <span class="at">y=</span><span class="fl">5e-3</span>, <span class="at">label=</span><span class="fu">paste</span>(<span class="st">&quot;mean =&quot;</span>, scales<span class="sc">::</span><span class="fu">dollar</span>(<span class="fu">mean</span>(Orders<span class="sc">$</span>Sales), <span class="at">accuracy =</span> <span class="fl">0.01</span>)), <span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-14"><a href="#cb52-14" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">10e3</span>, <span class="at">y=</span><span class="fl">4.5e-3</span>, <span class="at">label=</span><span class="fu">paste</span>(<span class="st">&quot;median =&quot;</span>, scales<span class="sc">::</span><span class="fu">dollar</span>(<span class="fu">median</span>(Orders<span class="sc">$</span>Sales), <span class="at">accuracy =</span> <span class="fl">0.01</span>)), <span class="at">color=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span> </span>
<span id="cb52-15"><a href="#cb52-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Distibution of Sales variable&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/sales-var-1.png" width="100%" /></p>
</div>
<div id="profit-variable" class="section level3">
<h3>Profit variable</h3>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb53-2"><a href="#cb53-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Profit)) <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span>..density..), <span class="at">colour=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>, <span class="at">bins =</span> <span class="dv">100</span>)<span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" tabindex="-1"></a>  <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;darkblue&quot;</span>, <span class="at">fill=</span><span class="st">&quot;lightblue&quot;</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">mean</span>(Orders<span class="sc">$</span>Profit), <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="at">colour=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">median</span>(Orders<span class="sc">$</span>Profit), <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="at">colour=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;rect&quot;</span>, <span class="at">xmin=</span><span class="fl">3e3</span>, <span class="at">xmax=</span><span class="fl">7e3</span>, <span class="at">ymin=</span><span class="fl">4e-2</span>, <span class="at">ymax=</span><span class="fl">5.5e-2</span>,  <span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-8"><a href="#cb53-8" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">5e3</span>, <span class="at">y=</span><span class="fl">5e-2</span>, <span class="at">label=</span><span class="fu">paste</span>(<span class="st">&quot;mean =&quot;</span>, scales<span class="sc">::</span><span class="fu">dollar</span>(<span class="fu">mean</span>(Orders<span class="sc">$</span>Profit), <span class="at">accuracy =</span> <span class="fl">0.01</span>)), <span class="at">color=</span><span class="st">&quot;red&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x=</span><span class="fl">5e3</span>, <span class="at">y=</span><span class="fl">4.5e-2</span>, <span class="at">label=</span><span class="fu">paste</span>(<span class="st">&quot;median =&quot;</span>, scales<span class="sc">::</span><span class="fu">dollar</span>(<span class="fu">median</span>(Orders<span class="sc">$</span>Profit), <span class="at">accuracy =</span> <span class="fl">0.01</span>)), <span class="at">color=</span><span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-10"><a href="#cb53-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Distibution of Profit variable&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/profit-var-1.png" width="100%" /></p>
<p>The <strong>Sales</strong> and <strong>Profit</strong> variables has
right skewed distributions.</p>
</div>
<div id="discount-variable" class="section level3">
<h3>Discount variable</h3>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" tabindex="-1"></a><span class="co"># Discount</span></span>
<span id="cb54-2"><a href="#cb54-2" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4" tabindex="-1"></a><span class="fu">mutate</span>(<span class="at">Discount=</span>scales<span class="sc">::</span><span class="fu">percent</span>(Discount)) <span class="sc">%&gt;%</span></span>
<span id="cb54-5"><a href="#cb54-5" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Discount)) <span class="sc">+</span></span>
<span id="cb54-6"><a href="#cb54-6" tabindex="-1"></a>                      <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> (..count..)<span class="sc">/</span><span class="fu">sum</span>(..count..)), <span class="at">fill=</span><span class="st">&quot;#4BA15D&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb54-7"><a href="#cb54-7" tabindex="-1"></a>                      <span class="fu">xlab</span>(<span class="st">&quot;Discount&quot;</span>) <span class="sc">+</span></span>
<span id="cb54-8"><a href="#cb54-8" tabindex="-1"></a>                      <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">name =</span> <span class="st">&quot;Proportion&quot;</span>) <span class="sc">+</span></span>
<span id="cb54-9"><a href="#cb54-9" tabindex="-1"></a>                            <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb54-10"><a href="#cb54-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Proportion of Discount variable&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/discount-var-1.png" width="100%" /></p>
</div>
<div id="quantity-variable" class="section level3">
<h3>Quantity variable</h3>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" tabindex="-1"></a><span class="co"># Quantity</span></span>
<span id="cb55-2"><a href="#cb55-2" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Quantity =</span> <span class="fu">as.factor</span>(Quantity)) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Quantity)) <span class="sc">+</span></span>
<span id="cb55-5"><a href="#cb55-5" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">y =</span> (..count..)<span class="sc">/</span><span class="fu">sum</span>(..count..)), <span class="at">fill=</span><span class="st">&quot;#4BA15D&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb55-6"><a href="#cb55-6" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Quantity&quot;</span>) <span class="sc">+</span></span>
<span id="cb55-7"><a href="#cb55-7" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent, <span class="at">name =</span> <span class="st">&quot;Proportion&quot;</span>) <span class="sc">+</span></span>
<span id="cb55-8"><a href="#cb55-8" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span></span>
<span id="cb55-9"><a href="#cb55-9" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Proportion of Quantity variable&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/quantity-var-1.png" width="100%" /></p>
</div>
</div>
</div>
<div id="exploratory-data-analysis" class="section level1">
<h1>Exploratory Data Analysis</h1>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" tabindex="-1"></a>years <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span> </span>
<span id="cb56-2"><a href="#cb56-2" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="#cb56-3" tabindex="-1"></a>          <span class="fu">select</span>(Year) <span class="sc">%&gt;%</span> </span>
<span id="cb56-4"><a href="#cb56-4" tabindex="-1"></a>          <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb56-5"><a href="#cb56-5" tabindex="-1"></a>          <span class="fu">arrange</span>(Year)</span>
<span id="cb56-6"><a href="#cb56-6" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" tabindex="-1"></a><span class="co"># latest year in the dataset</span></span>
<span id="cb56-8"><a href="#cb56-8" tabindex="-1"></a>latest_year <span class="ot">&lt;-</span> <span class="fu">max</span>(years)</span></code></pre></div>
<div id="general-metrics" class="section level2 tabset">
<h2 class="tabset">General Metrics</h2>
<p>Questions we are trying to answer:</p>
<ul>
<li>What is the gross sales revenue?</li>
<li>What is the total profit?</li>
<li>What is the total number of customers?</li>
<li>What is number of new customers?</li>
<li>What is average basket size and value?</li>
<li>What is Customer Lifetime Value (CLV)?</li>
</ul>
<p>Let’s find out general metrics for latest year. It’s
<strong>2017</strong> year in this dataset and build mini-dashboard.</p>
<blockquote>
<p><strong><em>NOTE:</em></strong> Click on <strong>ººº</strong> of the
metric to go to the code of the calculation of its.</p>
</blockquote>
<div id="code-formatting" class="section level3">
<h3>Code Formatting</h3>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" tabindex="-1"></a>colorize_label <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb57-2"><a href="#cb57-2" tabindex="-1"></a>  <span class="fu">sprintf</span>(<span class="st">&quot;&lt;div&gt;&lt;span style=&#39;color: darkgray; font-size: 11px;&#39;&gt;%s&lt;/span&gt;&lt;/div&gt;&quot;</span>, x)</span>
<span id="cb57-3"><a href="#cb57-3" tabindex="-1"></a>}</span>
<span id="cb57-4"><a href="#cb57-4" tabindex="-1"></a>dollar <span class="ot">&lt;-</span> <span class="cf">function</span>(x, accuracy) {</span>
<span id="cb57-5"><a href="#cb57-5" tabindex="-1"></a>    value <span class="ot">&lt;-</span> scales<span class="sc">::</span><span class="fu">dollar</span>(x, <span class="at">accuracy =</span> accuracy);</span>
<span id="cb57-6"><a href="#cb57-6" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">&quot;&lt;div&gt;&lt;span style=&#39;color: black; font-size: 28px;&#39;&gt;%s&lt;/span&gt;&lt;/div&gt;&quot;</span>, value)</span>
<span id="cb57-7"><a href="#cb57-7" tabindex="-1"></a>}</span>
<span id="cb57-8"><a href="#cb57-8" tabindex="-1"></a>number <span class="ot">&lt;-</span> <span class="cf">function</span>(x, accuracy) {</span>
<span id="cb57-9"><a href="#cb57-9" tabindex="-1"></a>    value <span class="ot">&lt;-</span> scales<span class="sc">::</span><span class="fu">number</span>(x, <span class="at">accuracy =</span> accuracy);</span>
<span id="cb57-10"><a href="#cb57-10" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">&quot;&lt;div&gt;&lt;span style=&#39;color: black; font-size: 28px;&#39;&gt;%s&lt;/span&gt;&lt;/div&gt;&quot;</span>, value)</span>
<span id="cb57-11"><a href="#cb57-11" tabindex="-1"></a>}</span>
<span id="cb57-12"><a href="#cb57-12" tabindex="-1"></a>colorize_percent <span class="ot">&lt;-</span> <span class="cf">function</span>(x, accuracy) {</span>
<span id="cb57-13"><a href="#cb57-13" tabindex="-1"></a>  value <span class="ot">&lt;-</span> scales<span class="sc">::</span><span class="fu">percent</span>(x, <span class="at">accuracy =</span> accuracy); </span>
<span id="cb57-14"><a href="#cb57-14" tabindex="-1"></a>  <span class="cf">if</span>(x <span class="sc">&lt;</span> <span class="dv">0</span>){</span>
<span id="cb57-15"><a href="#cb57-15" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">&#39;&lt;div&gt;&lt;span&gt;&lt;svg style=&quot;vertical-align: middle;&quot; width=&quot;30px&quot; height=&quot;30px&quot; viewBox=&quot;0 0 20 20&quot; fill=&quot;none&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;</span></span>
<span id="cb57-16"><a href="#cb57-16" tabindex="-1"></a><span class="st">&lt;path d=&quot;M8.72798 15.795L3.72798 7.795C3.10356 6.79593 3.82183 5.5 4.99998 5.5L15 5.5C16.1781 5.5 16.8964 6.79593 16.272 7.795L11.272 15.795C10.6845 16.735 9.31549 16.735 8.72798 15.795Z&quot; fill=&quot;red&quot;/&gt;</span></span>
<span id="cb57-17"><a href="#cb57-17" tabindex="-1"></a><span class="st">&lt;/svg&gt;&lt;/span&gt;&lt;span style=&quot;vertical-align: middle; color: red; font-size: 24px;&quot;&gt;%s&lt;/span&gt;&lt;/div&gt;&#39;</span>, value)</span>
<span id="cb57-18"><a href="#cb57-18" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb57-19"><a href="#cb57-19" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">&#39;&lt;div&gt;&lt;span&gt;&lt;svg style=&quot;vertical-align: middle;&quot; width=&quot;30px&quot; height=&quot;30px&quot; viewBox=&quot;0 0 20 20&quot; fill=&quot;none&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;&gt;</span></span>
<span id="cb57-20"><a href="#cb57-20" tabindex="-1"></a><span class="st">&lt;path d=&quot;M11.272 5.205L16.272 13.205C16.8964 14.2041 16.1782 15.5 15 15.5H5.00002C3.82186 15.5 3.1036 14.2041 3.72802 13.205L8.72802 5.205C9.31552 4.265 10.6845 4.265 11.272 5.205Z&quot; fill=&quot;green&quot;/&gt;&lt;/svg&gt;&lt;/span&gt;&lt;span style=&quot;vertical-align: middle; color: green; font-size: 24px;&quot;&gt;%s&lt;/span&gt;&lt;/div&gt;&#39;</span>, value)</span>
<span id="cb57-21"><a href="#cb57-21" tabindex="-1"></a>  }</span>
<span id="cb57-22"><a href="#cb57-22" tabindex="-1"></a>}</span>
<span id="cb57-23"><a href="#cb57-23" tabindex="-1"></a></span>
<span id="cb57-24"><a href="#cb57-24" tabindex="-1"></a>ref_label <span class="ot">&lt;-</span> <span class="cf">function</span>(label){</span>
<span id="cb57-25"><a href="#cb57-25" tabindex="-1"></a>    <span class="fu">sprintf</span>(<span class="st">&#39;&lt;div&gt;&lt;span&gt;&lt;a href=&quot;#%s&quot; style=&quot;font-size: 16px;text-decoration: none; margin:0; padding:0; vertical-align: middle;&quot; target=&quot;_self&quot; rel=&quot; noreferrer nofollow&quot;&gt;ººº&lt;/a&gt;&lt;/span&gt;&lt;/div&gt;&#39;</span>, label)</span>
<span id="cb57-26"><a href="#cb57-26" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="metrics" class="section level3 active">
<h3 class="active">Metrics</h3>
<div id="grid_container" class="grid-container grid-container--fit">
<div id="revenue" class="grid-item parent">
<div class="div_0">
<div>
<span><a href="#revenue-ref" style="font-size: 16px;text-decoration: none; margin:0; padding:0; vertical-align: middle;" target="_self" rel=" noreferrer nofollow">ººº</a></span>
</div>
</div>
<div class="div_top_left">
<div>
<span style="color: darkgray; font-size: 11px;">GROSS REVENUE</span>
</div>
<div>
<span style="color: black; font-size: 28px;">$733,215.3</span>
</div>
</div>
<div class="div_bottom_left">
<div>
<span style="color: darkgray; font-size: 11px;">YoY GROWTH</span>
</div>
<div>
<span><svg style="vertical-align: middle;" width="30px" height="30px" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M11.272 5.205L16.272 13.205C16.8964 14.2041 16.1782 15.5 15 15.5H5.00002C3.82186 15.5 3.1036 14.2041 3.72802 13.205L8.72802 5.205C9.31552 4.265 10.6845 4.265 11.272 5.205Z" fill="green"/></svg></span><span
style="vertical-align: middle; color: green; font-size: 24px;">20.4%</span>
</div>
</div>
</div>
<div id="profit" class="grid-item parent">
<div class="div_0">
<div>
<span><a href="#profit-ref" style="font-size: 16px;text-decoration: none; margin:0; padding:0; vertical-align: middle;" target="_self" rel=" noreferrer nofollow">ººº</a></span>
</div>
</div>
<div class="div_top_left">
<div>
<span style="color: darkgray; font-size: 11px;">PROFIT</span>
</div>
<div>
<span style="color: black; font-size: 28px;">$93,439.3</span>
</div>
</div>
<div class="div_bottom_left">
<div>
<span style="color: darkgray; font-size: 11px;">YoY GROWTH</span>
</div>
<div>
<span><svg style="vertical-align: middle;" width="30px" height="30px" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M11.272 5.205L16.272 13.205C16.8964 14.2041 16.1782 15.5 15 15.5H5.00002C3.82186 15.5 3.1036 14.2041 3.72802 13.205L8.72802 5.205C9.31552 4.265 10.6845 4.265 11.272 5.205Z" fill="green"/></svg></span><span
style="vertical-align: middle; color: green; font-size: 24px;">14.2%</span>
</div>
</div>
</div>
<div id="basket" class="grid-item parent">
<div class="div_0">
<div>
<span><a href="#basket-ref" style="font-size: 16px;text-decoration: none; margin:0; padding:0; vertical-align: middle;" target="_self" rel=" noreferrer nofollow">ººº</a></span>
</div>
</div>
<div class="div_top_left">
<div>
<span style="color: darkgray; font-size: 11px;">BASKET VALUE</span>
</div>
<div>
<span style="color: black; font-size: 28px;">$434.6</span>
</div>
</div>
<div class="div_bottom_left">
<div>
<span style="color: darkgray; font-size: 11px;">YoY GROWTH</span>
</div>
<div>
<span><svg style="vertical-align: middle;" width="30px" height="30px" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M11.272 5.205L16.272 13.205C16.8964 14.2041 16.1782 15.5 15 15.5H5.00002C3.82186 15.5 3.1036 14.2041 3.72802 13.205L8.72802 5.205C9.31552 4.265 10.6845 4.265 11.272 5.205Z" fill="green"/></svg></span><span
style="vertical-align: middle; color: green; font-size: 24px;">20.4%</span>
</div>
</div>
<div class="div_bottom_right">
<div>
<span style="color: darkgray; font-size: 11px;">BASKET SIZE</span>
</div>
<div>
<span style="color: black; font-size: 28px;">7</span>
</div>
</div>
</div>
<div id="clv" class="grid-item parent">
<div class="div_0">
<div>
<span><a href="#clv-ref" style="font-size: 16px;text-decoration: none; margin:0; padding:0; vertical-align: middle;" target="_self" rel=" noreferrer nofollow">ººº</a></span>
</div>
</div>
<div class="div_top_left">
<div>
<span style="color: darkgray; font-size: 11px;">CLV</span>
</div>
<div>
<span style="color: black; font-size: 28px;">$2,898.1</span>
</div>
</div>
<div class="div_bottom_left">
<div>
<span style="color: darkgray; font-size: 11px;">YoY GROWTH</span>
</div>
<div>
<span><svg style="vertical-align: middle;" width="30px" height="30px" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M11.272 5.205L16.272 13.205C16.8964 14.2041 16.1782 15.5 15 15.5H5.00002C3.82186 15.5 3.1036 14.2041 3.72802 13.205L8.72802 5.205C9.31552 4.265 10.6845 4.265 11.272 5.205Z" fill="green"/></svg></span><span
style="vertical-align: middle; color: green; font-size: 24px;">72.2%</span>
</div>
</div>
</div>
<div id="newcustomers1" class="grid-item parent">
<div class="div_0">
<div>
<span><a href="#customers-ref" style="font-size: 16px;text-decoration: none; margin:0; padding:0; vertical-align: middle;" target="_self" rel=" noreferrer nofollow">ººº</a></span>
</div>
</div>
<div class="div_top_left">
<div>
<span style="color: darkgray; font-size: 11px;">TOTAL CUSTOMERS</span>
</div>
<div>
<span style="color: black; font-size: 28px;">693</span>
</div>
</div>
<div class="div_top_right">
<div>
<span style="color: darkgray; font-size: 11px;">YoY GROWTH</span>
</div>
<div>
<span><svg style="vertical-align: middle;" width="30px" height="30px" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M11.272 5.205L16.272 13.205C16.8964 14.2041 16.1782 15.5 15 15.5H5.00002C3.82186 15.5 3.1036 14.2041 3.72802 13.205L8.72802 5.205C9.31552 4.265 10.6845 4.265 11.272 5.205Z" fill="green"/></svg></span><span
style="vertical-align: middle; color: green; font-size: 24px;">8.6%</span>
</div>
</div>
<div class="div_bottom_left">
<div>
<span style="color: darkgray; font-size: 11px;">NEW CUSTOMERS</span>
</div>
<div>
<span style="color: black; font-size: 28px;">11</span>
</div>
</div>
<div class="div_bottom_right">
<div>
<span style="color: darkgray; font-size: 11px;">YoY GROWTH</span>
</div>
<div>
<span><svg style="vertical-align: middle;" width="30px" height="30px" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M8.72798 15.795L3.72798 7.795C3.10356 6.79593 3.82183 5.5 4.99998 5.5L15 5.5C16.1781 5.5 16.8964 6.79593 16.272 7.795L11.272 15.795C10.6845 16.735 9.31549 16.735 8.72798 15.795Z" fill="red"/>
</svg></span><span
style="vertical-align: middle; color: red; font-size: 24px;">-78.4%</span>
</div>
</div>
</div>
<div id="lossesorders" class="grid-item parent">
<div class="div_0">
<div>
<span><a href="#orders-ref" style="font-size: 16px;text-decoration: none; margin:0; padding:0; vertical-align: middle;" target="_self" rel=" noreferrer nofollow">ººº</a></span>
</div>
</div>
<div class="div_top_left">
<div>
<span style="color: darkgray; font-size: 11px;">TOTAL ORDERS</span>
</div>
<div>
<span style="color: black; font-size: 28px;">1 687</span>
</div>
</div>
<div class="div_top_right">
<div>
<span style="color: darkgray; font-size: 11px;">YoY GROWTH</span>
</div>
<div>
<span><svg style="vertical-align: middle;" width="30px" height="30px" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M11.272 5.205L16.272 13.205C16.8964 14.2041 16.1782 15.5 15 15.5H5.00002C3.82186 15.5 3.1036 14.2041 3.72802 13.205L8.72802 5.205C9.31552 4.265 10.6845 4.265 11.272 5.205Z" fill="green"/></svg></span><span
style="vertical-align: middle; color: green; font-size: 24px;">28.3%</span>
</div>
</div>
<div class="div_bottom_left">
<div>
<span style="color: darkgray; font-size: 11px;">LOSS ORDERS</span>
</div>
<div>
<span style="color: black; font-size: 28px;">351</span>
</div>
</div>
<div class="div_bottom_right">
<div>
<span style="color: darkgray; font-size: 11px;">YoY GROWTH</span>
</div>
<div>
<span><svg style="vertical-align: middle;" width="30px" height="30px" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M11.272 5.205L16.272 13.205C16.8964 14.2041 16.1782 15.5 15 15.5H5.00002C3.82186 15.5 3.1036 14.2041 3.72802 13.205L8.72802 5.205C9.31552 4.265 10.6845 4.265 11.272 5.205Z" fill="green"/></svg></span><span
style="vertical-align: middle; color: green; font-size: 24px;">41.0%</span>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="what-is-total-gross-revenue-and-yoy-growth-rate-of-its"
class="section level2">
<h2>What is total gross revenue and YoY growth rate of its?</h2>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" tabindex="-1"></a><span class="co"># pivot table of gross sales and profit</span></span>
<span id="cb58-2"><a href="#cb58-2" tabindex="-1"></a>YoY_Sales <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb58-3"><a href="#cb58-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-4"><a href="#cb58-4" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb58-5"><a href="#cb58-5" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), </span>
<span id="cb58-6"><a href="#cb58-6" tabindex="-1"></a>            <span class="at">Profit =</span> <span class="fu">sum</span>(Profit)) <span class="sc">%&gt;%</span></span>
<span id="cb58-7"><a href="#cb58-7" tabindex="-1"></a>  <span class="fu">arrange</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb58-8"><a href="#cb58-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YoY_Growth_Sales =</span> (Sales <span class="sc">-</span> <span class="fu">lag</span>(Sales))<span class="sc">/</span><span class="fu">lag</span>(Sales),</span>
<span id="cb58-9"><a href="#cb58-9" tabindex="-1"></a>         <span class="at">YoY_Growth_Profit =</span> (Profit <span class="sc">-</span> <span class="fu">lag</span>(Profit))<span class="sc">/</span><span class="fu">abs</span>(<span class="fu">lag</span>(Profit)),</span>
<span id="cb58-10"><a href="#cb58-10" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">as.factor</span>(Year)) </span>
<span id="cb58-11"><a href="#cb58-11" tabindex="-1"></a></span>
<span id="cb58-12"><a href="#cb58-12" tabindex="-1"></a><span class="co"># total pivot viz</span></span>
<span id="cb58-13"><a href="#cb58-13" tabindex="-1"></a>YoY_Sales <span class="sc">%&gt;%</span></span>
<span id="cb58-14"><a href="#cb58-14" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">&quot;YoY_Growth_Sales&quot;</span>, <span class="st">&quot;YoY_Growth_Profit&quot;</span>), </span>
<span id="cb58-15"><a href="#cb58-15" tabindex="-1"></a>            <span class="sc">~</span><span class="fu">cell_spec</span>(scales<span class="sc">::</span><span class="fu">percent</span>(., <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="st">&quot;html&quot;</span>, <span class="at">color=</span><span class="fu">case_when</span>(. <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb58-16"><a href="#cb58-16" tabindex="-1"></a>                                                   . <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;green&quot;</span>,</span>
<span id="cb58-17"><a href="#cb58-17" tabindex="-1"></a>                                                   <span class="fu">is.na</span>(.) <span class="sc">~</span> <span class="st">&quot;lightgray&quot;</span>,</span>
<span id="cb58-18"><a href="#cb58-18" tabindex="-1"></a>                                                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;black&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb58-19"><a href="#cb58-19" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span>, <span class="st">&quot;Profit&quot;</span>), <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">dollar</span>(., <span class="at">accuracy =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-20"><a href="#cb58-20" tabindex="-1"></a>  <span class="fu">relocate</span>(YoY_Growth_Sales, <span class="at">.after =</span> Sales) <span class="sc">%&gt;%</span></span>
<span id="cb58-21"><a href="#cb58-21" tabindex="-1"></a><span class="fu">kbl</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Total&quot;</span>, <span class="st">&quot;YoY Growth&quot;</span>, <span class="st">&quot;Total&quot;</span>, <span class="st">&quot;YoY Growth&quot;</span>),</span>
<span id="cb58-22"><a href="#cb58-22" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Total sales and profit and YoY growth of its.&quot;</span>,</span>
<span id="cb58-23"><a href="#cb58-23" tabindex="-1"></a>    <span class="at">escape =</span> F,</span>
<span id="cb58-24"><a href="#cb58-24" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&quot;lrrrr&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb58-25"><a href="#cb58-25" tabindex="-1"></a><span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-26"><a href="#cb58-26" tabindex="-1"></a><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;bordered&quot;</span>), <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb58-27"><a href="#cb58-27" tabindex="-1"></a><span class="fu">add_header_above</span>(<span class="at">header =</span> <span class="fu">c</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;Sales&quot;</span> <span class="ot">=</span> <span class="dv">2</span>, <span class="st">&quot;Profit&quot;</span> <span class="ot">=</span> <span class="dv">2</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">border_left =</span> <span class="cn">TRUE</span>, <span class="at">border_right =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table class="table table-striped table-bordered" style="margin-left: auto; margin-right: auto;">
<caption>
Total sales and profit and YoY growth of its.
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; font-weight: bold; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Sales
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; font-weight: bold; " colspan="2">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Profit
</div>
</th>
</tr>
<tr>
<th style="text-align:left;text-align: center;">
Year
</th>
<th style="text-align:right;text-align: center;">
Total
</th>
<th style="text-align:right;text-align: center;">
YoY Growth
</th>
<th style="text-align:right;text-align: center;">
Total
</th>
<th style="text-align:right;text-align: center;">
YoY Growth
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2014
</td>
<td style="text-align:right;">
$483,966.13
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
$49,556.03
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
2015
</td>
<td style="text-align:right;">
$470,532.51
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-2.8%</span>
</td>
<td style="text-align:right;">
$61,618.60
</td>
<td style="text-align:right;">
<span style="     color: green !important;">24.3%</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
2016
</td>
<td style="text-align:right;">
$609,205.60
</td>
<td style="text-align:right;">
<span style="     color: green !important;">29.5%</span>
</td>
<td style="text-align:right;">
$81,795.17
</td>
<td style="text-align:right;">
<span style="     color: green !important;">32.7%</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
2017
</td>
<td style="text-align:right;">
$733,215.26
</td>
<td style="text-align:right;">
<span style="     color: green !important;">20.4%</span>
</td>
<td style="text-align:right;">
$93,439.27
</td>
<td style="text-align:right;">
<span style="     color: green !important;">14.2%</span>
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" tabindex="-1"></a><span class="co"># Scale for second axis</span></span>
<span id="cb59-2"><a href="#cb59-2" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="fu">max</span>(YoY_Sales<span class="sc">$</span>Sales)</span>
<span id="cb59-3"><a href="#cb59-3" tabindex="-1"></a></span>
<span id="cb59-4"><a href="#cb59-4" tabindex="-1"></a>YoY_Sales <span class="sc">%&gt;%</span></span>
<span id="cb59-5"><a href="#cb59-5" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb59-6"><a href="#cb59-6" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Sales, <span class="at">fill=</span><span class="st">&quot;Gross Revenue&quot;</span>), </span>
<span id="cb59-7"><a href="#cb59-7" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb59-8"><a href="#cb59-8" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color=</span><span class="st">&quot;darkgray&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-9"><a href="#cb59-9" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Sales <span class="sc">*</span> scale, <span class="at">group =</span> <span class="dv">1</span>, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb59-10"><a href="#cb59-10" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Sales <span class="sc">*</span> scale, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb59-11"><a href="#cb59-11" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Sales <span class="sc">*</span> scale, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), </span>
<span id="cb59-12"><a href="#cb59-12" tabindex="-1"></a>             <span class="at">shape=</span><span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb59-13"><a href="#cb59-13" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Sales <span class="sc">*</span> scale, </span>
<span id="cb59-14"><a href="#cb59-14" tabindex="-1"></a>                <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth_Sales, <span class="at">accuracy =</span> <span class="fl">0.1</span>)), </span>
<span id="cb59-15"><a href="#cb59-15" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-16"><a href="#cb59-16" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Sales, </span>
<span id="cb59-17"><a href="#cb59-17" tabindex="-1"></a>                <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Sales, <span class="at">accuracy =</span> <span class="fl">0.1</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot; K&quot;</span>)), </span>
<span id="cb59-18"><a href="#cb59-18" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.2</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-19"><a href="#cb59-19" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>.<span class="sc">/</span>scale, <span class="at">name =</span> <span class="st">&quot;YoY Growth&quot;</span>, </span>
<span id="cb59-20"><a href="#cb59-20" tabindex="-1"></a>                                         <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)), </span>
<span id="cb59-21"><a href="#cb59-21" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">&quot; K&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>),</span>
<span id="cb59-22"><a href="#cb59-22" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">30e3</span>, <span class="fl">820e3</span>)) <span class="sc">+</span></span>
<span id="cb59-23"><a href="#cb59-23" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Gross Revenue&quot;</span><span class="ot">=</span><span class="st">&quot;#ADD7A0&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb59-24"><a href="#cb59-24" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;YoY Growth&quot;</span><span class="ot">=</span><span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb59-25"><a href="#cb59-25" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total gross revenue &amp; year over year (YoY) growth rate&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Gross Revenue, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb59-26"><a href="#cb59-26" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>)),</span>
<span id="cb59-27"><a href="#cb59-27" tabindex="-1"></a>         <span class="at">linetype =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>))) <span class="sc">+</span></span>
<span id="cb59-28"><a href="#cb59-28" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb59-29"><a href="#cb59-29" tabindex="-1"></a>        <span class="at">legend.box=</span><span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb59-30"><a href="#cb59-30" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;white&quot;</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb59-31"><a href="#cb59-31" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb59-32"><a href="#cb59-32" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;bold&quot;</span>)) </span></code></pre></div>
<p><img src="index_files/figure-html/total-gross-revenue-plot-1.png" width="100%" /></p>
<p>Our observations are:</p>
<ul>
<li>Total revenue in 2017 is $733.2 K and the total amount of revenue
shows permanent YoY growth in absolute numbers except in 2015 that
showed small dropping.</li>
<li>2017 year shows dropping of YoY Sales growth rate on 9.1% vs
previous year, that showed more than 30% growth from negative position
in 2015.</li>
</ul>
</div>
<div id="what-is-total-profit-and-yoy-growth-rate-of-its"
class="section level2">
<h2>What is total profit and YoY growth rate of its?</h2>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" tabindex="-1"></a><span class="co"># scale for second axis</span></span>
<span id="cb60-2"><a href="#cb60-2" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="fu">max</span>(YoY_Sales<span class="sc">$</span>Profit)</span>
<span id="cb60-3"><a href="#cb60-3" tabindex="-1"></a>YoY_Sales <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="#cb60-4" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb60-5"><a href="#cb60-5" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Profit, <span class="at">fill=</span><span class="st">&quot;Total Profit&quot;</span>), </span>
<span id="cb60-6"><a href="#cb60-6" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb60-7"><a href="#cb60-7" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, </span>
<span id="cb60-8"><a href="#cb60-8" tabindex="-1"></a>                <span class="at">y =</span> YoY_Growth_Profit <span class="sc">*</span> scale, </span>
<span id="cb60-9"><a href="#cb60-9" tabindex="-1"></a>                <span class="at">group =</span> <span class="dv">1</span>, </span>
<span id="cb60-10"><a href="#cb60-10" tabindex="-1"></a>                <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb60-11"><a href="#cb60-11" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, </span>
<span id="cb60-12"><a href="#cb60-12" tabindex="-1"></a>                 <span class="at">y =</span> YoY_Growth_Profit <span class="sc">*</span> scale, </span>
<span id="cb60-13"><a href="#cb60-13" tabindex="-1"></a>                 <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb60-14"><a href="#cb60-14" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, </span>
<span id="cb60-15"><a href="#cb60-15" tabindex="-1"></a>                 <span class="at">y =</span> YoY_Growth_Profit <span class="sc">*</span> scale, </span>
<span id="cb60-16"><a href="#cb60-16" tabindex="-1"></a>                 <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), </span>
<span id="cb60-17"><a href="#cb60-17" tabindex="-1"></a>             <span class="at">shape=</span><span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb60-18"><a href="#cb60-18" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Profit <span class="sc">*</span> scale, </span>
<span id="cb60-19"><a href="#cb60-19" tabindex="-1"></a>                <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth_Profit, <span class="at">accuracy =</span> <span class="fl">0.1</span>)), </span>
<span id="cb60-20"><a href="#cb60-20" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-21"><a href="#cb60-21" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Profit, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Profit, <span class="at">accuracy =</span> <span class="fl">0.1</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot; K&quot;</span>)), </span>
<span id="cb60-22"><a href="#cb60-22" tabindex="-1"></a>             <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.2</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span> </span>
<span id="cb60-23"><a href="#cb60-23" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>.<span class="sc">/</span>scale, <span class="at">name =</span> <span class="st">&quot;YoY Growth&quot;</span>, </span>
<span id="cb60-24"><a href="#cb60-24" tabindex="-1"></a>                                         <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(),</span>
<span id="cb60-25"><a href="#cb60-25" tabindex="-1"></a>                                         <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)), </span>
<span id="cb60-26"><a href="#cb60-26" tabindex="-1"></a>                     <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">&quot; K&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>),</span>
<span id="cb60-27"><a href="#cb60-27" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">100e3</span>)) <span class="sc">+</span></span>
<span id="cb60-28"><a href="#cb60-28" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Total Profit&quot;</span><span class="ot">=</span><span class="st">&quot;#ADD7A0&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb60-29"><a href="#cb60-29" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;YoY Growth&quot;</span><span class="ot">=</span><span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb60-30"><a href="#cb60-30" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total profit &amp; year over year (YoY) growth rate&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Profit, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb60-31"><a href="#cb60-31" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>)),</span>
<span id="cb60-32"><a href="#cb60-32" tabindex="-1"></a>         <span class="at">linetype =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>))) <span class="sc">+</span></span>
<span id="cb60-33"><a href="#cb60-33" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb60-34"><a href="#cb60-34" tabindex="-1"></a>        <span class="at">legend.box=</span><span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb60-35"><a href="#cb60-35" tabindex="-1"></a>        <span class="at">legend.key =</span> <span class="fu">element_rect</span>(<span class="at">fill=</span><span class="st">&quot;white&quot;</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb60-36"><a href="#cb60-36" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb60-37"><a href="#cb60-37" tabindex="-1"></a>        <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">face=</span><span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<p><img src="index_files/figure-html/total-profit-plot-1.png" width="100%" /></p>
<p>Our observations are:</p>
<ul>
<li>The total amount of profit shows permanent YoY growth in absolute
numbers.</li>
<li>YoY Profit growth dropped on 18.5% in 2017 vs previous year.</li>
</ul>
</div>
<div id="which-are-sales-and-average-price-quarterly"
class="section level2">
<h2>Which are Sales and average Price quarterly?</h2>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" tabindex="-1"></a><span class="co"># sales and avg price quarterly</span></span>
<span id="cb61-2"><a href="#cb61-2" tabindex="-1"></a>sales_price <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb61-3"><a href="#cb61-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>), <span class="at">Quarter =</span> <span class="fu">quarter</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb61-4"><a href="#cb61-4" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, Quarter) <span class="sc">%&gt;%</span></span>
<span id="cb61-5"><a href="#cb61-5" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), <span class="at">Quantity =</span> <span class="fu">sum</span>(Quantity), <span class="at">Price =</span> Sales <span class="sc">/</span> Quantity, <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb61-6"><a href="#cb61-6" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb61-7"><a href="#cb61-7" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Quantity) <span class="sc">%&gt;%</span></span>
<span id="cb61-8"><a href="#cb61-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YQ =</span> <span class="fu">paste0</span>(<span class="st">&quot;Q&quot;</span>, Quarter, <span class="st">&quot;&#39;&quot;</span>, <span class="fu">substring</span>(<span class="fu">as.character</span>(Year),<span class="fu">nchar</span>(<span class="fu">as.character</span>(Year))<span class="sc">-</span><span class="dv">1</span>)), <span class="at">n =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb61-9"><a href="#cb61-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YQ =</span> <span class="fu">as.factor</span>(YQ)) <span class="sc">%&gt;%</span></span>
<span id="cb61-10"><a href="#cb61-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YQ =</span> <span class="fu">fct_reorder</span>(YQ, n))</span>
<span id="cb61-11"><a href="#cb61-11" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="fu">max</span>(sales_price<span class="sc">$</span>Sales) <span class="sc">/</span> <span class="fu">max</span>(sales_price<span class="sc">$</span>Price) </span>
<span id="cb61-13"><a href="#cb61-13" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" tabindex="-1"></a>sales_price <span class="sc">%&gt;%</span></span>
<span id="cb61-15"><a href="#cb61-15" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb61-16"><a href="#cb61-16" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> YQ, <span class="at">y =</span> Sales, <span class="at">fill =</span> <span class="st">&quot;Sales&quot;</span>), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb61-17"><a href="#cb61-17" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> YQ, <span class="at">y =</span> Price <span class="sc">*</span> scale, <span class="at">group =</span> <span class="dv">1</span>, <span class="at">color=</span><span class="st">&quot;Avg. Price&quot;</span>), <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb61-18"><a href="#cb61-18" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> YQ, <span class="at">y =</span> Price <span class="sc">*</span> scale, <span class="at">color=</span><span class="st">&quot;Avg. Price&quot;</span>), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">shape=</span><span class="dv">15</span>) <span class="sc">+</span></span>
<span id="cb61-19"><a href="#cb61-19" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> YQ, <span class="at">y =</span> Price <span class="sc">*</span> scale, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(<span class="fu">round</span>(Price, <span class="dv">1</span>)), <span class="at">vjust =</span> <span class="fu">ifelse</span>(<span class="fu">lag</span>(Price) <span class="sc">&gt;</span> Price <span class="sc">&amp;</span> <span class="fu">lead</span>(Price) <span class="sc">&gt;</span> Price, <span class="dv">2</span>, <span class="sc">-</span><span class="fl">1.5</span>)), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb61-20"><a href="#cb61-20" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>.<span class="sc">/</span>scale, <span class="at">name =</span> <span class="st">&quot;Average Price, $&quot;</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">300e3</span>)) <span class="sc">+</span></span>
<span id="cb61-21"><a href="#cb61-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Sales and Price quarterly for all the time&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Quarter&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb61-22"><a href="#cb61-22" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Avg. Price&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>))<span class="sc">+</span></span>
<span id="cb61-23"><a href="#cb61-23" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span> <span class="ot">=</span> <span class="st">&quot;#ADD7A0&quot;</span>))<span class="sc">+</span></span>
<span id="cb61-24"><a href="#cb61-24" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fl">4.5</span>), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb61-25"><a href="#cb61-25" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fl">8.5</span>), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb61-26"><a href="#cb61-26" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fl">12.5</span>), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb61-27"><a href="#cb61-27" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>)),</span>
<span id="cb61-28"><a href="#cb61-28" tabindex="-1"></a>         <span class="at">linetype =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>))) <span class="sc">+</span></span>
<span id="cb61-29"><a href="#cb61-29" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.key=</span><span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb61-30"><a href="#cb61-30" tabindex="-1"></a>          <span class="at">legend.box=</span><span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb61-31"><a href="#cb61-31" tabindex="-1"></a>          <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>)  </span></code></pre></div>
<p><img src="index_files/figure-html/sales-avg-price-plot-1.png" width="100%" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" tabindex="-1"></a>o <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>), <span class="at">Quarter =</span> <span class="fu">quarter</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="#cb62-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, Quarter, Segment) <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="#cb62-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), <span class="at">Quantity =</span> <span class="fu">sum</span>(Quantity), <span class="at">Price =</span> Sales <span class="sc">/</span> Quantity, <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-5"><a href="#cb62-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb62-6"><a href="#cb62-6" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>Quantity) <span class="sc">%&gt;%</span></span>
<span id="cb62-7"><a href="#cb62-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YQ =</span> <span class="fu">paste0</span>(<span class="st">&quot;Q&quot;</span>, Quarter, <span class="st">&quot;&#39;&quot;</span>, <span class="fu">substring</span>(<span class="fu">as.character</span>(Year),<span class="fu">nchar</span>(<span class="fu">as.character</span>(Year))<span class="sc">-</span><span class="dv">1</span>)), <span class="at">n =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb62-8"><a href="#cb62-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YQ =</span> <span class="fu">as.factor</span>(YQ)) <span class="sc">%&gt;%</span></span>
<span id="cb62-9"><a href="#cb62-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YQ =</span> <span class="fu">fct_reorder</span>(YQ, n))</span>
<span id="cb62-10"><a href="#cb62-10" tabindex="-1"></a></span>
<span id="cb62-11"><a href="#cb62-11" tabindex="-1"></a>o <span class="sc">%&gt;%</span></span>
<span id="cb62-12"><a href="#cb62-12" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb62-13"><a href="#cb62-13" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> YQ, <span class="at">y =</span> Sales, <span class="at">fill =</span> <span class="st">&quot;Sales&quot;</span>), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb62-14"><a href="#cb62-14" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> YQ, <span class="at">y =</span> Price <span class="sc">*</span> scale, <span class="at">group =</span> Segment, <span class="at">color=</span>Segment), <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb62-15"><a href="#cb62-15" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> YQ, <span class="at">y =</span> Price <span class="sc">*</span> scale, <span class="at">color=</span>Segment), <span class="at">size =</span> <span class="dv">1</span>, <span class="at">shape=</span><span class="dv">15</span>) <span class="sc">+</span>  </span>
<span id="cb62-16"><a href="#cb62-16" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> YQ, <span class="at">y =</span> Price <span class="sc">*</span> scale, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(<span class="fu">round</span>(Price, <span class="dv">1</span>)), <span class="at">vjust =</span> <span class="fu">ifelse</span>(<span class="fu">lag</span>(Price) <span class="sc">&gt;</span> Price <span class="sc">&amp;</span> <span class="fu">lead</span>(Price) <span class="sc">&gt;</span> Price, <span class="dv">2</span>, <span class="sc">-</span><span class="fl">1.5</span>)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb62-17"><a href="#cb62-17" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fl">4.5</span>), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-18"><a href="#cb62-18" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fl">8.5</span>), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-19"><a href="#cb62-19" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fl">12.5</span>), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-20"><a href="#cb62-20" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>.<span class="sc">/</span>scale, <span class="at">name =</span> <span class="st">&quot;Average Price, $&quot;</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">650e3</span>)) <span class="sc">+</span></span>
<span id="cb62-21"><a href="#cb62-21" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Sales and Price quarterly for all the time&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Quarter&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb62-22"><a href="#cb62-22" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span> <span class="ot">=</span> <span class="st">&quot;#ADD7A0&quot;</span>))<span class="sc">+</span></span>
<span id="cb62-23"><a href="#cb62-23" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>)),</span>
<span id="cb62-24"><a href="#cb62-24" tabindex="-1"></a>         <span class="at">linetype =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>))) <span class="sc">+</span></span>
<span id="cb62-25"><a href="#cb62-25" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.key=</span><span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb62-26"><a href="#cb62-26" tabindex="-1"></a>          <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb62-27"><a href="#cb62-27" tabindex="-1"></a>          <span class="at">legend.box=</span><span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb62-28"><a href="#cb62-28" tabindex="-1"></a>          <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>) </span></code></pre></div>
<p><img src="index_files/figure-html/sales-price-by-segment-1.png" width="100%" /></p>
</div>
<div id="what-is-average-order-value-by-month" class="section level2">
<h2>What is average order value by month?</h2>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb63-2"><a href="#cb63-2" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-3"><a href="#cb63-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), <span class="st">`</span><span class="at">Order Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">first</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>), <span class="at">Year =</span> <span class="fu">first</span>(<span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb63-4"><a href="#cb63-4" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb63-5"><a href="#cb63-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">month</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>), <span class="at">Year =</span> <span class="fu">as.factor</span>(Year)) <span class="sc">%&gt;%</span></span>
<span id="cb63-6"><a href="#cb63-6" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, Month) <span class="sc">%&gt;%</span></span>
<span id="cb63-7"><a href="#cb63-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Avg.Sales =</span> <span class="fu">mean</span>(Sales)) <span class="sc">%&gt;%</span></span>
<span id="cb63-8"><a href="#cb63-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Month Name</span><span class="st">`</span> <span class="ot">=</span> month.name[Month]) <span class="sc">%&gt;%</span></span>
<span id="cb63-9"><a href="#cb63-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Month Name</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">reorder_value</span>(<span class="st">`</span><span class="at">Month Name</span><span class="st">`</span>, Month, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb63-10"><a href="#cb63-10" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2016</span>, <span class="dv">2017</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb63-11"><a href="#cb63-11" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb63-12"><a href="#cb63-12" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Month Name</span><span class="st">`</span>, <span class="at">y =</span> Avg.Sales, <span class="at">color=</span>Year, <span class="at">group =</span> Year), <span class="at">show.legend =</span> <span class="cn">TRUE</span>, <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb63-13"><a href="#cb63-13" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Month Name</span><span class="st">`</span>, <span class="at">y =</span> <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2017</span>, Avg.Sales, <span class="cn">NA</span>), <span class="at">color=</span>Year), <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb63-14"><a href="#cb63-14" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Month Name</span><span class="st">`</span>, <span class="at">y =</span> <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2017</span>, Avg.Sales, <span class="cn">NA</span>), <span class="at">color=</span>Year), <span class="at">shape=</span><span class="dv">21</span>, <span class="at">size=</span><span class="dv">1</span>,  <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb63-15"><a href="#cb63-15" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Month Name</span><span class="st">`</span>, </span>
<span id="cb63-16"><a href="#cb63-16" tabindex="-1"></a>                <span class="at">y =</span> Avg.Sales, </span>
<span id="cb63-17"><a href="#cb63-17" tabindex="-1"></a>                <span class="at">label =</span> <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2017</span>, scales<span class="sc">::</span><span class="fu">dollar</span>(Avg.Sales, <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="cn">NA</span>), </span>
<span id="cb63-18"><a href="#cb63-18" tabindex="-1"></a>                <span class="at">group =</span> Year, </span>
<span id="cb63-19"><a href="#cb63-19" tabindex="-1"></a>                <span class="at">vjust =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(Avg.Sales)) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lead</span>(Avg.Sales)) <span class="sc">&amp;</span> Avg.Sales <span class="sc">&lt;</span> <span class="fu">lag</span>(Avg.Sales) <span class="sc">&amp;</span> Avg.Sales <span class="sc">&lt;</span> <span class="fu">lead</span>(Avg.Sales), <span class="dv">2</span>, <span class="sc">-</span><span class="fl">1.3</span>)), <span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb63-20"><a href="#cb63-20" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span> </span>
<span id="cb63-21"><a href="#cb63-21" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">850</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">850</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb63-22"><a href="#cb63-22" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;2016&quot;</span><span class="ot">=</span><span class="st">&quot;#ECECEC&quot;</span>, <span class="st">&quot;2017&quot;</span><span class="ot">=</span><span class="st">&quot;#4BA15D&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb63-23"><a href="#cb63-23" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Average Order Value by Month&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Month&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb63-24"><a href="#cb63-24" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" width="100%" /></p>
</div>
<div id="what-is-average-order-value-by-week" class="section level2">
<h2>What is average order value by week?</h2>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb64-2"><a href="#cb64-2" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb64-3"><a href="#cb64-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), <span class="st">`</span><span class="at">Order Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">first</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-4"><a href="#cb64-4" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb64-5"><a href="#cb64-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Week =</span> <span class="fu">week</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>), <span class="at">Week =</span> <span class="fu">as.factor</span>(Week), <span class="at">Year =</span> <span class="fu">as.factor</span>(<span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb64-6"><a href="#cb64-6" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, Week) <span class="sc">%&gt;%</span></span>
<span id="cb64-7"><a href="#cb64-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Avg.Sales =</span> <span class="fu">mean</span>(Sales)) <span class="sc">%&gt;%</span></span>
<span id="cb64-8"><a href="#cb64-8" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2016</span>, <span class="dv">2017</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb64-9"><a href="#cb64-9" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb64-10"><a href="#cb64-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Week, <span class="at">y =</span> Avg.Sales, <span class="at">color=</span>Year, <span class="at">group =</span> Year), <span class="at">show.legend =</span> <span class="cn">TRUE</span>, <span class="at">size=</span><span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb64-11"><a href="#cb64-11" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Week, <span class="at">y =</span> <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2017</span>, Avg.Sales, <span class="cn">NA</span>), <span class="at">color=</span>Year), <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb64-12"><a href="#cb64-12" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Week, <span class="at">y =</span> <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2017</span>, Avg.Sales, <span class="cn">NA</span>), <span class="at">color=</span>Year), <span class="at">shape=</span><span class="dv">21</span>, <span class="at">size=</span><span class="dv">1</span>,  <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb64-13"><a href="#cb64-13" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Week, </span>
<span id="cb64-14"><a href="#cb64-14" tabindex="-1"></a>                <span class="at">y =</span> Avg.Sales, </span>
<span id="cb64-15"><a href="#cb64-15" tabindex="-1"></a>                <span class="at">label =</span> <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2017</span>, scales<span class="sc">::</span><span class="fu">dollar</span>(Avg.Sales, <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="cn">NA</span>), </span>
<span id="cb64-16"><a href="#cb64-16" tabindex="-1"></a>                <span class="at">group =</span> Year, </span>
<span id="cb64-17"><a href="#cb64-17" tabindex="-1"></a>                <span class="at">vjust =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(Avg.Sales)) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lead</span>(Avg.Sales)) <span class="sc">&amp;</span> Avg.Sales <span class="sc">&lt;</span> <span class="fu">lag</span>(Avg.Sales) <span class="sc">&amp;</span> Avg.Sales <span class="sc">&lt;</span> <span class="fu">lead</span>(Avg.Sales), <span class="dv">2</span>, <span class="sc">-</span><span class="fl">1.3</span>)), <span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb64-18"><a href="#cb64-18" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">52</span>, <span class="dv">52</span><span class="sc">/</span><span class="dv">12</span>), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size=</span><span class="fl">0.25</span>, <span class="at">color=</span><span class="st">&quot;darkgray&quot;</span>) <span class="sc">+</span></span>
<span id="cb64-19"><a href="#cb64-19" tabindex="-1"></a>  <span class="fu">annotate</span>(<span class="st">&quot;text&quot;</span>, <span class="at">x =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">52</span>, <span class="dv">52</span><span class="sc">/</span><span class="dv">12</span>) <span class="sc">+</span> <span class="dv">2</span>, <span class="at">y =</span> <span class="dv">1</span>, <span class="at">label =</span> month.abb[<span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>], <span class="at">size=</span><span class="dv">2</span>, <span class="at">color=</span><span class="st">&quot;darkgray&quot;</span>) <span class="sc">+</span></span>
<span id="cb64-20"><a href="#cb64-20" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span> </span>
<span id="cb64-21"><a href="#cb64-21" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1500</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1500</span>, <span class="dv">200</span>)) <span class="sc">+</span></span>
<span id="cb64-22"><a href="#cb64-22" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;2016&quot;</span><span class="ot">=</span><span class="st">&quot;#ECECEC&quot;</span>, <span class="st">&quot;2017&quot;</span><span class="ot">=</span><span class="st">&quot;#4BA15D&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb64-23"><a href="#cb64-23" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Average Order Value by Week&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Week&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb64-24"><a href="#cb64-24" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-3-1.png" width="100%" /></p>
</div>
<div id="what-is-average-order-value-by-date" class="section level2">
<h2>What is average order value by date?</h2>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb65-2"><a href="#cb65-2" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb65-3"><a href="#cb65-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), <span class="st">`</span><span class="at">Order Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">first</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-4"><a href="#cb65-4" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb65-5"><a href="#cb65-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Day =</span> <span class="fu">day</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>), <span class="at">Day =</span> <span class="fu">as.factor</span>(Day), <span class="at">Year =</span> <span class="fu">as.factor</span>(<span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb65-6"><a href="#cb65-6" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, Day) <span class="sc">%&gt;%</span></span>
<span id="cb65-7"><a href="#cb65-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Avg.Sales =</span> <span class="fu">mean</span>(Sales)) <span class="sc">%&gt;%</span></span>
<span id="cb65-8"><a href="#cb65-8" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2016</span>, <span class="dv">2017</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb65-9"><a href="#cb65-9" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb65-10"><a href="#cb65-10" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Day, <span class="at">y =</span> Avg.Sales, <span class="at">color=</span>Year, <span class="at">group =</span> Year), <span class="at">show.legend =</span> <span class="cn">TRUE</span>, <span class="at">size=</span><span class="fl">0.75</span>) <span class="sc">+</span></span>
<span id="cb65-11"><a href="#cb65-11" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Day, <span class="at">y =</span> <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2017</span>, Avg.Sales, <span class="cn">NA</span>), <span class="at">color=</span>Year), <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb65-12"><a href="#cb65-12" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Day, <span class="at">y =</span> <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2017</span>, Avg.Sales, <span class="cn">NA</span>), <span class="at">color=</span>Year), <span class="at">shape=</span><span class="dv">21</span>, <span class="at">size=</span><span class="dv">1</span>,  <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb65-13"><a href="#cb65-13" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Day, </span>
<span id="cb65-14"><a href="#cb65-14" tabindex="-1"></a>                <span class="at">y =</span> Avg.Sales, </span>
<span id="cb65-15"><a href="#cb65-15" tabindex="-1"></a>                <span class="at">label =</span> <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2017</span>, scales<span class="sc">::</span><span class="fu">dollar</span>(Avg.Sales, <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="cn">NA</span>), </span>
<span id="cb65-16"><a href="#cb65-16" tabindex="-1"></a>                <span class="at">group =</span> Year, </span>
<span id="cb65-17"><a href="#cb65-17" tabindex="-1"></a>                <span class="at">vjust =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(Avg.Sales)) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lead</span>(Avg.Sales)) <span class="sc">&amp;</span> Avg.Sales <span class="sc">&lt;</span> <span class="fu">lag</span>(Avg.Sales) <span class="sc">&amp;</span> Avg.Sales <span class="sc">&lt;</span> <span class="fu">lead</span>(Avg.Sales), <span class="dv">2</span>, <span class="sc">-</span><span class="fl">1.3</span>)), <span class="at">color=</span><span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb65-18"><a href="#cb65-18" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1400</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1400</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb65-19"><a href="#cb65-19" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;2016&quot;</span><span class="ot">=</span><span class="st">&quot;#ECECEC&quot;</span>, <span class="st">&quot;2017&quot;</span><span class="ot">=</span><span class="st">&quot;#4BA15D&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb65-20"><a href="#cb65-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Average Order Value by Date&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Day&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb65-21"><a href="#cb65-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" width="100%" /></p>
</div>
<div id="what-is-average-order-value-by-day-of-week"
class="section level2">
<h2>What is average order value by day of week?</h2>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="#cb66-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), <span class="st">`</span><span class="at">Order Date</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">first</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="#cb66-4" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb66-5"><a href="#cb66-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Wday =</span> <span class="fu">wday</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>, <span class="at">week_start=</span><span class="dv">1</span>), </span>
<span id="cb66-6"><a href="#cb66-6" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-7"><a href="#cb66-7" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, Wday) <span class="sc">%&gt;%</span></span>
<span id="cb66-8"><a href="#cb66-8" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Avg.Sales =</span> <span class="fu">mean</span>(Sales)) <span class="sc">%&gt;%</span></span>
<span id="cb66-9"><a href="#cb66-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Weekday =</span> <span class="fu">c</span>(<span class="st">&quot;Monday&quot;</span>, <span class="st">&quot;Tuesday&quot;</span>, <span class="st">&quot;Wednesday&quot;</span>, <span class="st">&quot;Thursday&quot;</span>, <span class="st">&quot;Friday&quot;</span>,<span class="st">&quot;Saturday&quot;</span>, <span class="st">&quot;Sunday&quot;</span>)[Wday], <span class="at">Year =</span> <span class="fu">as.factor</span>(Year)) <span class="sc">%&gt;%</span></span>
<span id="cb66-10"><a href="#cb66-10" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Weekday =</span> <span class="fu">reorder_value</span>(Weekday, Wday, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-11"><a href="#cb66-11" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">2016</span>, <span class="dv">2017</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb66-12"><a href="#cb66-12" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb66-13"><a href="#cb66-13" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Weekday, <span class="at">y =</span> Avg.Sales, <span class="at">color=</span>Year, <span class="at">group =</span> Year), <span class="at">show.legend =</span> <span class="cn">TRUE</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb66-14"><a href="#cb66-14" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Weekday, <span class="at">y =</span> <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2017</span>, Avg.Sales, <span class="cn">NA</span>), <span class="at">color=</span>Year), <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb66-15"><a href="#cb66-15" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Weekday, <span class="at">y =</span> <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2017</span>, Avg.Sales, <span class="cn">NA</span>), <span class="at">color=</span>Year), <span class="at">shape=</span><span class="dv">21</span>, <span class="at">size=</span><span class="dv">1</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb66-16"><a href="#cb66-16" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Weekday, <span class="at">y =</span> Avg.Sales, <span class="at">label =</span> <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2017</span>, scales<span class="sc">::</span><span class="fu">dollar</span>(Avg.Sales, <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="cn">NA</span>), <span class="at">vjust =</span> <span class="fu">ifelse</span>(<span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lag</span>(Avg.Sales)) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(<span class="fu">lead</span>(Avg.Sales)) <span class="sc">&amp;</span> Avg.Sales <span class="sc">&lt;</span> <span class="fu">lag</span>(Avg.Sales) <span class="sc">&amp;</span> Avg.Sales <span class="sc">&lt;</span> <span class="fu">lead</span>(Avg.Sales), <span class="dv">2</span>, <span class="sc">-</span><span class="fl">1.3</span>)), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb66-17"><a href="#cb66-17" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span> </span>
<span id="cb66-18"><a href="#cb66-18" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">750</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">750</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb66-19"><a href="#cb66-19" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;2016&quot;</span><span class="ot">=</span><span class="st">&quot;#ECECEC&quot;</span>, <span class="st">&quot;2017&quot;</span><span class="ot">=</span><span class="st">&quot;#4BA15D&quot;</span>)) <span class="sc">+</span> </span>
<span id="cb66-20"><a href="#cb66-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Average Order Vakue by Weekday&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Weekday&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Average Sales, $&quot;</span>)<span class="sc">+</span></span>
<span id="cb66-21"><a href="#cb66-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" width="100%" /></p>
</div>
<div id="which-category-are-best-selling-and-most-profitable"
class="section level2">
<h2>Which Category are best selling and most profitable?</h2>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" tabindex="-1"></a><span class="co"># pivot table by category</span></span>
<span id="cb67-2"><a href="#cb67-2" tabindex="-1"></a>pivot1 <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb67-3"><a href="#cb67-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Category) <span class="sc">%&gt;%</span></span>
<span id="cb67-4"><a href="#cb67-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), <span class="at">Profit =</span> <span class="fu">sum</span>(Profit), <span class="at">Quantity =</span> <span class="fu">sum</span>(Quantity)) <span class="sc">%&gt;%</span></span>
<span id="cb67-5"><a href="#cb67-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb67-6"><a href="#cb67-6" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>Sales)</span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" tabindex="-1"></a><span class="co"># Total sales, profit and quantity for all the time</span></span>
<span id="cb68-2"><a href="#cb68-2" tabindex="-1"></a>pivot1 <span class="sc">%&gt;%</span></span>
<span id="cb68-3"><a href="#cb68-3" tabindex="-1"></a>  <span class="fu">rbind</span>(<span class="fu">data.frame</span>(<span class="at">Category =</span> <span class="st">&quot;Grand Total&quot;</span>, <span class="at">Sales =</span> <span class="fu">sum</span>(pivot1<span class="sc">$</span>Sales), <span class="at">Profit =</span> <span class="fu">sum</span>(pivot1<span class="sc">$</span>Profit), <span class="at">Quantity =</span> <span class="fu">sum</span>(pivot1<span class="sc">$</span>Quantity))) <span class="sc">%&gt;%</span></span>
<span id="cb68-4"><a href="#cb68-4" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">dollar</span>(., <span class="at">accuracy =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb68-5"><a href="#cb68-5" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Category&quot;</span>, <span class="st">&quot;Sales&quot;</span>, <span class="st">&quot;Profit&quot;</span>, <span class="st">&quot;Quantity&quot;</span>),</span>
<span id="cb68-6"><a href="#cb68-6" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Total Sales, Profit and Quantity by Category for all the time.&quot;</span>,</span>
<span id="cb68-7"><a href="#cb68-7" tabindex="-1"></a>    <span class="at">escape =</span> F,</span>
<span id="cb68-8"><a href="#cb68-8" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&quot;lrrr&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb68-9"><a href="#cb68-9" tabindex="-1"></a><span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-10"><a href="#cb68-10" tabindex="-1"></a><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;bordered&quot;</span>), <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb68-11"><a href="#cb68-11" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="fu">nrow</span>(pivot1) <span class="sc">+</span> <span class="dv">1</span>, <span class="at">bold =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table class="table table-striped table-bordered" style="margin-left: auto; margin-right: auto;">
<caption>
Total Sales, Profit and Quantity by Category for all the time.
</caption>
<thead>
<tr>
<th style="text-align:left;text-align: center;">
Category
</th>
<th style="text-align:right;text-align: center;">
Sales
</th>
<th style="text-align:right;text-align: center;">
Profit
</th>
<th style="text-align:right;text-align: center;">
Quantity
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Technology
</td>
<td style="text-align:right;">
$836,154.03
</td>
<td style="text-align:right;">
$145,454.95
</td>
<td style="text-align:right;">
6939
</td>
</tr>
<tr>
<td style="text-align:left;">
Furniture
</td>
<td style="text-align:right;">
$741,718.42
</td>
<td style="text-align:right;">
$18,463.33
</td>
<td style="text-align:right;">
8026
</td>
</tr>
<tr>
<td style="text-align:left;">
Office Supplies
</td>
<td style="text-align:right;">
$719,047.03
</td>
<td style="text-align:right;">
$122,490.80
</td>
<td style="text-align:right;">
22906
</td>
</tr>
<tr>
<td style="text-align:left;font-weight: bold;">
Grand Total
</td>
<td style="text-align:right;font-weight: bold;">
$2,296,919.49
</td>
<td style="text-align:right;font-weight: bold;">
$286,409.08
</td>
<td style="text-align:right;font-weight: bold;">
37871
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" tabindex="-1"></a><span class="co"># Total sales</span></span>
<span id="cb69-2"><a href="#cb69-2" tabindex="-1"></a>pivot1 <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="#cb69-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Category, <span class="at">y =</span> Sales, <span class="at">fill =</span> Category)) <span class="sc">+</span></span>
<span id="cb69-4"><a href="#cb69-4" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb69-5"><a href="#cb69-5" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Category, <span class="at">y =</span> Sales, <span class="at">label=</span>scales<span class="sc">::</span><span class="fu">dollar</span>(Sales, <span class="at">accuracy =</span> <span class="fl">0.1</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>,</span>
<span id="cb69-6"><a href="#cb69-6" tabindex="-1"></a>                                                              <span class="at">suffix=</span><span class="st">&quot;K&quot;</span>)), <span class="at">size=</span><span class="dv">4</span>, <span class="at">vjust=</span><span class="sc">-</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb69-7"><a href="#cb69-7" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>), </span>
<span id="cb69-8"><a href="#cb69-8" tabindex="-1"></a>                     <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">900e3</span>),</span>
<span id="cb69-9"><a href="#cb69-9" tabindex="-1"></a>                     <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">900e3</span>, <span class="fl">100e3</span>)) <span class="sc">+</span></span>
<span id="cb69-10"><a href="#cb69-10" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb69-11"><a href="#cb69-11" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total Sales&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Category&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sales, $&quot;</span>) </span>
<span id="cb69-12"><a href="#cb69-12" tabindex="-1"></a>  </span>
<span id="cb69-13"><a href="#cb69-13" tabindex="-1"></a><span class="co"># total profit</span></span>
<span id="cb69-14"><a href="#cb69-14" tabindex="-1"></a>pivot1 <span class="sc">%&gt;%</span></span>
<span id="cb69-15"><a href="#cb69-15" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Category, <span class="at">y =</span> Profit, <span class="at">fill =</span> Category)) <span class="sc">+</span></span>
<span id="cb69-16"><a href="#cb69-16" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb69-17"><a href="#cb69-17" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Category, <span class="at">y =</span> Profit, <span class="at">label=</span>scales<span class="sc">::</span><span class="fu">dollar</span>(Profit, <span class="at">accuracy =</span> <span class="fl">0.1</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>,</span>
<span id="cb69-18"><a href="#cb69-18" tabindex="-1"></a>                                                              <span class="at">suffix=</span><span class="st">&quot;K&quot;</span>)), <span class="at">size=</span><span class="dv">4</span>, <span class="at">vjust=</span><span class="sc">-</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb69-19"><a href="#cb69-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total Profit&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Category&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Profit, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb69-20"><a href="#cb69-20" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb69-21"><a href="#cb69-21" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>),</span>
<span id="cb69-22"><a href="#cb69-22" tabindex="-1"></a>                     <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">175e3</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">175e3</span>, <span class="fl">25e3</span>))</span>
<span id="cb69-23"><a href="#cb69-23" tabindex="-1"></a></span>
<span id="cb69-24"><a href="#cb69-24" tabindex="-1"></a><span class="co"># total quantity</span></span>
<span id="cb69-25"><a href="#cb69-25" tabindex="-1"></a>pivot1 <span class="sc">%&gt;%</span></span>
<span id="cb69-26"><a href="#cb69-26" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Category, <span class="at">y =</span> Quantity, <span class="at">fill =</span> Category)) <span class="sc">+</span></span>
<span id="cb69-27"><a href="#cb69-27" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb69-28"><a href="#cb69-28" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb69-29"><a href="#cb69-29" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total Quantity&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Category&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Quantity&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/grand-total-category-1.png" width="50%" /><img src="index_files/figure-html/grand-total-category-2.png" width="50%" /><img src="index_files/figure-html/grand-total-category-3.png" width="50%" /></p>
<p>Our observations are:</p>
<ul>
<li>The best selling category is <strong>Technology</strong>, but all
three category make similar amount of sales.</li>
<li>The most profitable category is <strong>Technology</strong> too. The
least profitable category is <strong>Furniture</strong>.</li>
<li><strong>Furniture</strong> makes similar quantity sold as
<strong>Technology</strong>, it is makes the least profit of all the
Categories.</li>
</ul>
<p>These plots appear total metrics. Let’s build a table with year over
year growth of sales and profit.</p>
</div>
<div id="what-is-yoy-sales-and-profit-growth-by-category"
class="section level2">
<h2>What is YoY Sales and Profit Growth by Category?</h2>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" tabindex="-1"></a><span class="fu">options</span>(<span class="at">dplyr.summarise.inform =</span> <span class="cn">FALSE</span>)</span>
<span id="cb70-2"><a href="#cb70-2" tabindex="-1"></a></span>
<span id="cb70-3"><a href="#cb70-3" tabindex="-1"></a>YoY <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb70-4"><a href="#cb70-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-5"><a href="#cb70-5" tabindex="-1"></a>  <span class="fu">group_by</span>(Category, Year) <span class="sc">%&gt;%</span></span>
<span id="cb70-6"><a href="#cb70-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">round</span>(<span class="fu">sum</span>(Sales), <span class="dv">2</span>), </span>
<span id="cb70-7"><a href="#cb70-7" tabindex="-1"></a>            <span class="at">Profit =</span> <span class="fu">round</span>(<span class="fu">sum</span>(Profit), <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb70-8"><a href="#cb70-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YoY_Growth_Sales =</span> (Sales <span class="sc">-</span> <span class="fu">lag</span>(Sales))<span class="sc">/</span><span class="fu">lag</span>(Sales),</span>
<span id="cb70-9"><a href="#cb70-9" tabindex="-1"></a>         <span class="at">YoY_Growth_Profit =</span> (Profit <span class="sc">-</span> <span class="fu">lag</span>(Profit))<span class="sc">/</span><span class="fu">abs</span>(<span class="fu">lag</span>(Profit))) </span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" tabindex="-1"></a>YoY_cat <span class="ot">&lt;-</span> YoY <span class="sc">%&gt;%</span></span>
<span id="cb71-2"><a href="#cb71-2" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span>, <span class="st">&quot;Profit&quot;</span>, <span class="st">&quot;YoY_Growth_Sales&quot;</span>, <span class="st">&quot;YoY_Growth_Profit&quot;</span>))</span>
<span id="cb71-3"><a href="#cb71-3" tabindex="-1"></a></span>
<span id="cb71-4"><a href="#cb71-4" tabindex="-1"></a>sales_profit_columns <span class="ot">&lt;-</span> YoY_cat <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span>, <span class="st">&quot;Profit&quot;</span>))) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb71-5"><a href="#cb71-5" tabindex="-1"></a>yoy_growth_columns <span class="ot">&lt;-</span> YoY_cat <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;YoY_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb71-6"><a href="#cb71-6" tabindex="-1"></a></span>
<span id="cb71-7"><a href="#cb71-7" tabindex="-1"></a><span class="co"># table viz</span></span>
<span id="cb71-8"><a href="#cb71-8" tabindex="-1"></a>YoY_cat <span class="sc">%&gt;%</span> </span>
<span id="cb71-9"><a href="#cb71-9" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(sales_profit_columns)) <span class="sc">%&gt;%</span></span>
<span id="cb71-10"><a href="#cb71-10" tabindex="-1"></a>  <span class="fu">mutate_at</span>(sales_profit_columns, <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">dollar</span>(., <span class="at">accuracy =</span> 1L)) <span class="sc">%&gt;%</span></span>
<span id="cb71-11"><a href="#cb71-11" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Category&quot;</span>, <span class="fu">as.character</span>(<span class="dv">2014</span><span class="sc">:</span><span class="dv">2017</span>), <span class="fu">as.character</span>(<span class="dv">2014</span><span class="sc">:</span><span class="dv">2017</span>)),</span>
<span id="cb71-12"><a href="#cb71-12" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;Sales and Profit by Category&quot;</span>, <span class="at">escape =</span> F, </span>
<span id="cb71-13"><a href="#cb71-13" tabindex="-1"></a>      <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&quot;l&quot;</span>, <span class="fu">rep</span>(<span class="st">&#39;r&#39;</span>,<span class="at">times=</span><span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb71-14"><a href="#cb71-14" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;bordered&quot;</span>), <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-15"><a href="#cb71-15" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb71-16"><a href="#cb71-16" tabindex="-1"></a>  <span class="fu">add_header_above</span>(<span class="at">header =</span> <span class="fu">c</span>(<span class="st">&quot; &quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;Sales&quot;</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">&quot;Profit&quot;</span> <span class="ot">=</span> <span class="dv">4</span>), </span>
<span id="cb71-17"><a href="#cb71-17" tabindex="-1"></a>                   <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">border_left =</span> <span class="cn">TRUE</span>, <span class="at">border_right =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table class="table table-striped table-bordered" style="margin-left: auto; margin-right: auto;">
<caption>
Sales and Profit by Category
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; font-weight: bold; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Sales
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; font-weight: bold; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Profit
</div>
</th>
</tr>
<tr>
<th style="text-align:left;text-align: center;">
Category
</th>
<th style="text-align:right;text-align: center;">
2014
</th>
<th style="text-align:right;text-align: center;">
2015
</th>
<th style="text-align:right;text-align: center;">
2016
</th>
<th style="text-align:right;text-align: center;">
2017
</th>
<th style="text-align:right;text-align: center;">
2014
</th>
<th style="text-align:right;text-align: center;">
2015
</th>
<th style="text-align:right;text-align: center;">
2016
</th>
<th style="text-align:right;text-align: center;">
2017
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Furniture
</td>
<td style="text-align:right;">
$156,911
</td>
<td style="text-align:right;">
$170,518
</td>
<td style="text-align:right;">
$198,901
</td>
<td style="text-align:right;">
$215,387
</td>
<td style="text-align:right;">
$5,470
</td>
<td style="text-align:right;">
$3,015
</td>
<td style="text-align:right;">
$6,960
</td>
<td style="text-align:right;">
$3,018
</td>
</tr>
<tr>
<td style="text-align:left;">
Office Supplies
</td>
<td style="text-align:right;">
$151,776
</td>
<td style="text-align:right;">
$137,233
</td>
<td style="text-align:right;">
$183,940
</td>
<td style="text-align:right;">
$246,097
</td>
<td style="text-align:right;">
$22,593
</td>
<td style="text-align:right;">
$25,100
</td>
<td style="text-align:right;">
$35,061
</td>
<td style="text-align:right;">
$39,737
</td>
</tr>
<tr>
<td style="text-align:left;">
Technology
</td>
<td style="text-align:right;">
$175,278
</td>
<td style="text-align:right;">
$162,781
</td>
<td style="text-align:right;">
$226,364
</td>
<td style="text-align:right;">
$271,731
</td>
<td style="text-align:right;">
$21,493
</td>
<td style="text-align:right;">
$33,504
</td>
<td style="text-align:right;">
$39,774
</td>
<td style="text-align:right;">
$50,684
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" tabindex="-1"></a>YoY_cat <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">all_of</span>(yoy_growth_columns)) <span class="sc">%&gt;%</span> </span>
<span id="cb72-2"><a href="#cb72-2" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span><span class="fu">cell_spec</span>(scales<span class="sc">::</span><span class="fu">percent</span>(., <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="st">&quot;html&quot;</span>, <span class="at">color=</span><span class="fu">case_when</span>(. <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb72-3"><a href="#cb72-3" tabindex="-1"></a>                                                   . <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;green&quot;</span>,</span>
<span id="cb72-4"><a href="#cb72-4" tabindex="-1"></a>                                                   <span class="fu">is.na</span>(.) <span class="sc">~</span> <span class="st">&quot;lightgray&quot;</span>,</span>
<span id="cb72-5"><a href="#cb72-5" tabindex="-1"></a>                                                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;black&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb72-6"><a href="#cb72-6" tabindex="-1"></a><span class="fu">kbl</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Customer Segment&quot;</span>, <span class="fu">as.character</span>(<span class="dv">2014</span><span class="sc">:</span><span class="dv">2017</span>), <span class="fu">as.character</span>(<span class="dv">2014</span><span class="sc">:</span><span class="dv">2017</span>)),</span>
<span id="cb72-7"><a href="#cb72-7" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Year over year Sales and Profit growth by Category&quot;</span>,</span>
<span id="cb72-8"><a href="#cb72-8" tabindex="-1"></a>    <span class="at">escape =</span> F,</span>
<span id="cb72-9"><a href="#cb72-9" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&quot;l&quot;</span>, <span class="fu">rep</span>(<span class="st">&#39;r&#39;</span>,<span class="at">times=</span><span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb72-10"><a href="#cb72-10" tabindex="-1"></a><span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-11"><a href="#cb72-11" tabindex="-1"></a><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;bordered&quot;</span>), <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb72-12"><a href="#cb72-12" tabindex="-1"></a><span class="fu">add_header_above</span>(<span class="at">header =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;YoY Sales Growth&quot;</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">&quot;YoY Profit Growth&quot;</span> <span class="ot">=</span> <span class="dv">4</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">border_left =</span> <span class="cn">TRUE</span>, <span class="at">border_right =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table class="table table-striped table-bordered" style="margin-left: auto; margin-right: auto;">
<caption>
Year over year Sales and Profit growth by Category
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; font-weight: bold; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
YoY Sales Growth
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; font-weight: bold; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
YoY Profit Growth
</div>
</th>
</tr>
<tr>
<th style="text-align:left;text-align: center;">
Customer Segment
</th>
<th style="text-align:right;text-align: center;">
2014
</th>
<th style="text-align:right;text-align: center;">
2015
</th>
<th style="text-align:right;text-align: center;">
2016
</th>
<th style="text-align:right;text-align: center;">
2017
</th>
<th style="text-align:right;text-align: center;">
2014
</th>
<th style="text-align:right;text-align: center;">
2015
</th>
<th style="text-align:right;text-align: center;">
2016
</th>
<th style="text-align:right;text-align: center;">
2017
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Furniture
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">8.7%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">16.6%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">8.3%</span>
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-44.9%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">130.8%</span>
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-56.6%</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Office Supplies
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-9.6%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">34.0%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">33.8%</span>
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">11.1%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">39.7%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">13.3%</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Technology
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-7.1%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">39.1%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">20.0%</span>
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">55.9%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">18.7%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">27.4%</span>
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="fu">max</span>(YoY<span class="sc">$</span>Sales)</span>
<span id="cb73-2"><a href="#cb73-2" tabindex="-1"></a></span>
<span id="cb73-3"><a href="#cb73-3" tabindex="-1"></a>YoY <span class="sc">%&gt;%</span></span>
<span id="cb73-4"><a href="#cb73-4" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb73-5"><a href="#cb73-5" tabindex="-1"></a>   <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>Sales, <span class="at">fill=</span><span class="st">&quot;Sales&quot;</span>)) <span class="sc">+</span></span>
<span id="cb73-6"><a href="#cb73-6" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Sales <span class="sc">*</span> scale, <span class="at">group =</span> Category, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb73-7"><a href="#cb73-7" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Sales <span class="sc">*</span> scale, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb73-8"><a href="#cb73-8" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Sales <span class="sc">*</span> scale, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">shape=</span><span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb73-9"><a href="#cb73-9" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Sales <span class="sc">*</span> scale, </span>
<span id="cb73-10"><a href="#cb73-10" tabindex="-1"></a>                  <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth_Sales, <span class="at">accuracy=</span>1L),</span>
<span id="cb73-11"><a href="#cb73-11" tabindex="-1"></a>                  <span class="at">vjust =</span> <span class="fu">ifelse</span>(YoY_Growth_Sales <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">2</span>, <span class="sc">-</span><span class="fl">1.5</span>)), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-12"><a href="#cb73-12" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;YoY Sales Growth by Category&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-13"><a href="#cb73-13" tabindex="-1"></a>   <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>.<span class="sc">/</span>scale, <span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)), </span>
<span id="cb73-14"><a href="#cb73-14" tabindex="-1"></a>                      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">number</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">300e3</span>, <span class="at">by=</span><span class="fl">50e3</span>), <span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">50e3</span>, <span class="fl">300e3</span>),</span>
<span id="cb73-15"><a href="#cb73-15" tabindex="-1"></a>                      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">300e3</span>, <span class="at">by=</span><span class="fl">50e3</span>)) <span class="sc">+</span></span>
<span id="cb73-16"><a href="#cb73-16" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span><span class="ot">=</span><span class="st">&quot;#ADD7A0&quot;</span>)) <span class="sc">+</span></span>
<span id="cb73-17"><a href="#cb73-17" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;YoY Growth&quot;</span><span class="ot">=</span><span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb73-18"><a href="#cb73-18" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Category) <span class="sc">+</span></span>
<span id="cb73-19"><a href="#cb73-19" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb73-20"><a href="#cb73-20" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb73-21"><a href="#cb73-21" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<p><img src="index_files/figure-html/yoy-sales-category-plot-1.png" width="100%" /></p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="fu">max</span>(YoY<span class="sc">$</span>Profit)</span>
<span id="cb74-2"><a href="#cb74-2" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" tabindex="-1"></a>YoY <span class="sc">%&gt;%</span></span>
<span id="cb74-4"><a href="#cb74-4" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb74-5"><a href="#cb74-5" tabindex="-1"></a>   <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>Profit, <span class="at">fill=</span><span class="st">&quot;Profit&quot;</span>)) <span class="sc">+</span></span>
<span id="cb74-6"><a href="#cb74-6" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Profit <span class="sc">*</span> scale, <span class="at">group =</span> Category, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb74-7"><a href="#cb74-7" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Profit <span class="sc">*</span> scale, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb74-8"><a href="#cb74-8" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Profit <span class="sc">*</span> scale, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">shape=</span><span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb74-9"><a href="#cb74-9" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Profit <span class="sc">*</span> scale, </span>
<span id="cb74-10"><a href="#cb74-10" tabindex="-1"></a>                  <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth_Profit, <span class="at">accuracy=</span>1L),</span>
<span id="cb74-11"><a href="#cb74-11" tabindex="-1"></a>                  <span class="at">vjust =</span> <span class="fu">ifelse</span>(YoY_Growth_Profit <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">2</span>, <span class="sc">-</span><span class="fl">1.5</span>)), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb74-12"><a href="#cb74-12" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;YoY Profit Growth by Category&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Profit, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb74-13"><a href="#cb74-13" tabindex="-1"></a>   <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>.<span class="sc">/</span>scale, <span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)), </span>
<span id="cb74-14"><a href="#cb74-14" tabindex="-1"></a>                      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">number</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">80e3</span>, <span class="at">by=</span><span class="fl">25e3</span>), <span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">40e3</span>, <span class="fl">80e3</span>),</span>
<span id="cb74-15"><a href="#cb74-15" tabindex="-1"></a>                      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">80e3</span>, <span class="at">by=</span><span class="fl">25e3</span>)) <span class="sc">+</span></span>
<span id="cb74-16"><a href="#cb74-16" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Profit&quot;</span><span class="ot">=</span><span class="st">&quot;#ADD7A0&quot;</span>)) <span class="sc">+</span></span>
<span id="cb74-17"><a href="#cb74-17" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;YoY Growth&quot;</span><span class="ot">=</span><span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb74-18"><a href="#cb74-18" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Category) <span class="sc">+</span></span>
<span id="cb74-19"><a href="#cb74-19" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb74-20"><a href="#cb74-20" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb74-21"><a href="#cb74-21" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<p><img src="index_files/figure-html/yoy-profit-category-plot-1.png" width="100%" /></p>
<p>Our observations are:</p>
<ul>
<li>Despite the <strong>Furniture</strong> category had permanent the
YoY Sales growth this category had not profit in <strong>2017</strong>
and losses are 57%.</li>
<li>Slowdown of the YoY Sales growth affected the YoY profit growth in
2017 for <strong>Office Supplies</strong> Category.</li>
<li>Dropping of the YoY Sales growth of <strong>Technology</strong>
category almost in two times in <strong>2017</strong> did not affect the
YoY profit growth in this category, and vice versa it showed the YoY
growth of profit on 8%.</li>
</ul>
</div>
<div id="general-metrics-calculation" class="section level2">
<h2>General metrics calculation</h2>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" tabindex="-1"></a><span class="co">#total metrics</span></span>
<span id="cb75-2"><a href="#cb75-2" tabindex="-1"></a>general_metrics <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb75-3"><a href="#cb75-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">factor</span>(<span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb75-4"><a href="#cb75-4" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb75-5"><a href="#cb75-5" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), </span>
<span id="cb75-6"><a href="#cb75-6" tabindex="-1"></a>            <span class="at">Profit =</span> <span class="fu">sum</span>(Profit)) <span class="sc">%&gt;%</span></span>
<span id="cb75-7"><a href="#cb75-7" tabindex="-1"></a>  <span class="fu">arrange</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb75-8"><a href="#cb75-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YoY_Growth_Sales =</span> (Sales <span class="sc">-</span> <span class="fu">lag</span>(Sales))<span class="sc">/</span><span class="fu">lag</span>(Sales),</span>
<span id="cb75-9"><a href="#cb75-9" tabindex="-1"></a>         <span class="at">YoY_Growth_Profit =</span> (Profit <span class="sc">-</span> <span class="fu">lag</span>(Profit))<span class="sc">/</span><span class="fu">abs</span>(<span class="fu">lag</span>(Profit)))</span></code></pre></div>
<div id="revenue-ref" class="section level3">
<h3>What is the gross sales revenue?</h3>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" tabindex="-1"></a><span class="co"># gross sales</span></span>
<span id="cb76-2"><a href="#cb76-2" tabindex="-1"></a>Gross_Sales <span class="ot">&lt;-</span> general_metrics[general_metrics<span class="sc">$</span>Year <span class="sc">==</span>  latest_year, <span class="st">&quot;Sales&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb76-3"><a href="#cb76-3" tabindex="-1"></a><span class="do">## YoY Growth Sales</span></span>
<span id="cb76-4"><a href="#cb76-4" tabindex="-1"></a>YoY_Growth_Sales <span class="ot">&lt;-</span> general_metrics[general_metrics<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;YoY_Growth_Sales&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb76-5"><a href="#cb76-5" tabindex="-1"></a></span>
<span id="cb76-6"><a href="#cb76-6" tabindex="-1"></a><span class="fu">paste</span>(latest_year, <span class="st">&quot;&gt; Gross Sales:&quot;</span>, scales<span class="sc">::</span><span class="fu">dollar</span>(Gross_Sales, <span class="at">accuracy =</span> <span class="fl">0.01</span>), <span class="st">&quot;, YoY Sales Growth:&quot;</span>, scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth_Sales, <span class="at">accuracy =</span> <span class="fl">0.1</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2017 &gt; Gross Sales: $733,215.26 , YoY Sales Growth: 20.4%&quot;</code></pre>
</div>
<div id="profit-ref" class="section level3">
<h3>What is the total profit?</h3>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" tabindex="-1"></a><span class="co"># profit</span></span>
<span id="cb78-2"><a href="#cb78-2" tabindex="-1"></a>profit <span class="ot">&lt;-</span> general_metrics[general_metrics<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;Profit&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb78-3"><a href="#cb78-3" tabindex="-1"></a><span class="co"># YoY Growth Profit</span></span>
<span id="cb78-4"><a href="#cb78-4" tabindex="-1"></a>YoY_Growth_Profit <span class="ot">&lt;-</span> general_metrics[general_metrics<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;YoY_Growth_Profit&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb78-5"><a href="#cb78-5" tabindex="-1"></a></span>
<span id="cb78-6"><a href="#cb78-6" tabindex="-1"></a><span class="fu">paste</span>(latest_year, <span class="st">&quot;&gt; Gross Profit:&quot;</span>, scales<span class="sc">::</span><span class="fu">dollar</span>(profit, <span class="at">accuracy =</span> <span class="fl">0.01</span>), <span class="st">&quot;, YoY Profit Growth:&quot;</span>, scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth_Profit, <span class="at">accuracy =</span> <span class="fl">0.1</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2017 &gt; Gross Profit: $93,439.27 , YoY Profit Growth: 14.2%&quot;</code></pre>
</div>
<div id="orders-ref" class="section level3">
<h3>What are total and loss orders and YoY Growth of its?</h3>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" tabindex="-1"></a><span class="co"># total losses orders</span></span>
<span id="cb80-2"><a href="#cb80-2" tabindex="-1"></a>total_losses_orders <span class="ot">&lt;-</span> (Orders <span class="sc">%&gt;%</span></span>
<span id="cb80-3"><a href="#cb80-3" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb80-4"><a href="#cb80-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Profit =</span> <span class="fu">sum</span>(Profit)) <span class="sc">%&gt;%</span></span>
<span id="cb80-5"><a href="#cb80-5" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">losses =</span> scales<span class="sc">::</span><span class="fu">percent</span>(<span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>[Profit <span class="sc">&lt;</span> <span class="dv">0</span>])<span class="sc">/</span><span class="fu">n</span>(), <span class="at">accuracy =</span> <span class="fl">0.1</span>)))<span class="sc">$</span>losses[[<span class="dv">1</span>]]</span>
<span id="cb80-6"><a href="#cb80-6" tabindex="-1"></a></span>
<span id="cb80-7"><a href="#cb80-7" tabindex="-1"></a><span class="fu">paste</span>(<span class="st">&quot;Total losses orders:&quot;</span>, total_losses_orders)</span></code></pre></div>
<pre><code>## [1] &quot;Total losses orders: 20.4%&quot;</code></pre>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" tabindex="-1"></a>loss <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb82-2"><a href="#cb82-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.factor</span>(<span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb82-3"><a href="#cb82-3" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb82-4"><a href="#cb82-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Profit =</span> <span class="fu">sum</span>(Profit), <span class="at">Year =</span> <span class="fu">first</span>(Year)) <span class="sc">%&gt;%</span></span>
<span id="cb82-5"><a href="#cb82-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb82-6"><a href="#cb82-6" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb82-7"><a href="#cb82-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">n_orders =</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>), <span class="at">n_losses =</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>[Profit <span class="sc">&lt;</span> <span class="dv">0</span>]), <span class="at">p_losses =</span> n_losses <span class="sc">/</span> n_orders) <span class="sc">%&gt;%</span></span>
<span id="cb82-8"><a href="#cb82-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YoY_orders=</span>(n_orders<span class="sc">-</span><span class="fu">lag</span>(n_orders))<span class="sc">/</span><span class="fu">lag</span>(n_orders), <span class="at">YoY_losses=</span>(n_losses<span class="sc">-</span><span class="fu">lag</span>(n_losses))<span class="sc">/</span><span class="fu">lag</span>(n_losses))</span></code></pre></div>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" tabindex="-1"></a>Total_Orders <span class="ot">&lt;-</span> loss[loss<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;n_orders&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb83-2"><a href="#cb83-2" tabindex="-1"></a>YoY_orders <span class="ot">&lt;-</span> loss[loss<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;YoY_orders&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb83-3"><a href="#cb83-3" tabindex="-1"></a>Losses_Orders <span class="ot">&lt;-</span> loss[loss<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;n_losses&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb83-4"><a href="#cb83-4" tabindex="-1"></a>YoY_losses <span class="ot">&lt;-</span> loss[loss<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;YoY_losses&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb83-5"><a href="#cb83-5" tabindex="-1"></a></span>
<span id="cb83-6"><a href="#cb83-6" tabindex="-1"></a><span class="fu">paste0</span>(latest_year, <span class="st">&quot; &gt; Total Orders: &quot;</span>,  Total_Orders, <span class="st">&quot; &gt; YoY Growth: &quot;</span>, </span>
<span id="cb83-7"><a href="#cb83-7" tabindex="-1"></a>       scales<span class="sc">::</span><span class="fu">percent</span>(YoY_orders, <span class="at">accuracy =</span> 1L), <span class="st">&quot;, Losable Orders: &quot;</span>, </span>
<span id="cb83-8"><a href="#cb83-8" tabindex="-1"></a>       Losses_Orders, <span class="st">&quot; &gt; YoY Growth: &quot;</span>, </span>
<span id="cb83-9"><a href="#cb83-9" tabindex="-1"></a>       scales<span class="sc">::</span><span class="fu">percent</span>(YoY_losses, <span class="at">accuracy =</span> 1L))</span></code></pre></div>
<pre><code>## [1] &quot;2017 &gt; Total Orders: 1687 &gt; YoY Growth: 28%, Losable Orders: 351 &gt; YoY Growth: 41%&quot;</code></pre>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" tabindex="-1"></a>scale1 <span class="ot">&lt;-</span> <span class="fu">max</span>(loss<span class="sc">$</span>n_orders)</span>
<span id="cb85-2"><a href="#cb85-2" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> loss <span class="sc">%&gt;%</span></span>
<span id="cb85-4"><a href="#cb85-4" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb85-5"><a href="#cb85-5" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>n_orders, <span class="at">fill =</span> <span class="st">&quot;# of Orders&quot;</span>), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-6"><a href="#cb85-6" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_orders<span class="sc">*</span>scale1, <span class="at">group=</span><span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb85-7"><a href="#cb85-7" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_orders<span class="sc">*</span>scale1, <span class="at">color =</span> <span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb85-8"><a href="#cb85-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_orders<span class="sc">*</span>scale1, <span class="at">color =</span> <span class="st">&quot;YoY Growth&quot;</span>), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span> </span>
<span id="cb85-9"><a href="#cb85-9" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_orders<span class="sc">*</span>scale1, <span class="at">label=</span>scales<span class="sc">::</span><span class="fu">percent</span>(YoY_orders, <span class="at">accuracy=</span>1L)), <span class="at">vjust=</span><span class="sc">-</span><span class="fl">1.5</span>)  <span class="sc">+</span></span>
<span id="cb85-10"><a href="#cb85-10" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>n_orders, <span class="at">label=</span>n_orders), <span class="at">vjust=</span><span class="sc">-</span><span class="dv">1</span>)  <span class="sc">+</span></span>
<span id="cb85-11"><a href="#cb85-11" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1900</span>, <span class="dv">200</span>), <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>.<span class="sc">/</span>scale1, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), <span class="at">name =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb85-12"><a href="#cb85-12" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1900</span>)) <span class="sc">+</span></span>
<span id="cb85-13"><a href="#cb85-13" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;# of Orders&quot;</span><span class="ot">=</span><span class="st">&quot;#ADD7A0&quot;</span>)) <span class="sc">+</span></span>
<span id="cb85-14"><a href="#cb85-14" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;YoY Growth&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb85-15"><a href="#cb85-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;YoY # of Orders growth&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Total # of Orders&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-16"><a href="#cb85-16" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb85-17"><a href="#cb85-17" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb85-18"><a href="#cb85-18" tabindex="-1"></a></span>
<span id="cb85-19"><a href="#cb85-19" tabindex="-1"></a>scale2 <span class="ot">&lt;-</span> <span class="fu">max</span>(loss<span class="sc">$</span>n_losses)</span>
<span id="cb85-20"><a href="#cb85-20" tabindex="-1"></a></span>
<span id="cb85-21"><a href="#cb85-21" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> loss <span class="sc">%&gt;%</span></span>
<span id="cb85-22"><a href="#cb85-22" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb85-23"><a href="#cb85-23" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>n_losses, <span class="at">fill =</span> <span class="st">&quot;# of loss Orders&quot;</span>), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span> </span>
<span id="cb85-24"><a href="#cb85-24" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_losses<span class="sc">*</span>scale2, <span class="at">group=</span><span class="dv">1</span>, <span class="at">color =</span> <span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb85-25"><a href="#cb85-25" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_losses<span class="sc">*</span>scale2, <span class="at">color =</span> <span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb85-26"><a href="#cb85-26" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_losses<span class="sc">*</span>scale2, <span class="at">color =</span> <span class="st">&quot;YoY Growth&quot;</span>), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span> </span>
<span id="cb85-27"><a href="#cb85-27" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>n_losses, <span class="at">label=</span>n_losses), <span class="at">vjust=</span><span class="sc">-</span><span class="dv">1</span>)  <span class="sc">+</span></span>
<span id="cb85-28"><a href="#cb85-28" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_losses<span class="sc">*</span>scale2, <span class="at">label=</span>scales<span class="sc">::</span><span class="fu">percent</span>(YoY_losses, <span class="at">accuracy=</span>1L)), <span class="at">vjust=</span><span class="sc">-</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb85-29"><a href="#cb85-29" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">400</span>, <span class="dv">50</span>), <span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>.<span class="sc">/</span>scale2, <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>), <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), <span class="at">name =</span> <span class="st">&quot;&quot;</span>),</span>
<span id="cb85-30"><a href="#cb85-30" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">400</span>)) <span class="sc">+</span></span>
<span id="cb85-31"><a href="#cb85-31" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;# of loss Orders&quot;</span><span class="ot">=</span><span class="st">&quot;#ADD7A0&quot;</span>)) <span class="sc">+</span></span>
<span id="cb85-32"><a href="#cb85-32" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;YoY Growth&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb85-33"><a href="#cb85-33" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;YoY # of loss Orders growth&quot;</span>, <span class="at">y =</span> <span class="st">&quot;# of loss Orders&quot;</span>) <span class="sc">+</span></span>
<span id="cb85-34"><a href="#cb85-34" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb85-35"><a href="#cb85-35" tabindex="-1"></a>        <span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb85-36"><a href="#cb85-36" tabindex="-1"></a>  </span>
<span id="cb85-37"><a href="#cb85-37" tabindex="-1"></a>plot1</span>
<span id="cb85-38"><a href="#cb85-38" tabindex="-1"></a>plot2</span></code></pre></div>
<p><img src="index_files/figure-html/loss-plot-1.png" width="50%" /><img src="index_files/figure-html/loss-plot-2.png" width="50%" /></p>
</div>
</div>
<div
id="which-sub-category-are-best-selling-and-most-profitablelossable"
class="section level2">
<h2>Which Sub-Category are best selling and most
profitable/lossable?</h2>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" tabindex="-1"></a>total_sales_profit <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb86-2"><a href="#cb86-2" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-3"><a href="#cb86-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), <span class="at">Profit =</span> <span class="fu">sum</span>(Profit), <span class="at">Quantity =</span> <span class="fu">sum</span>(Quantity)) <span class="sc">%&gt;%</span></span>
<span id="cb86-4"><a href="#cb86-4" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb86-5"><a href="#cb86-5" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>Sales)</span></code></pre></div>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" tabindex="-1"></a>total_sales_profit <span class="sc">%&gt;%</span></span>
<span id="cb87-2"><a href="#cb87-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder_value</span>(<span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>, Sales, <span class="cn">TRUE</span>), <span class="at">y =</span> Sales)) <span class="sc">+</span></span>
<span id="cb87-3"><a href="#cb87-3" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">fill=</span><span class="st">&quot;#ADD7A0&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb87-4"><a href="#cb87-4" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>, <span class="at">y =</span> Sales, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Sales, <span class="at">scale=</span><span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>, <span class="at">accuracy =</span> <span class="fl">0.1</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.2</span>, <span class="at">size =</span> <span class="fl">2.3</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb87-5"><a href="#cb87-5" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span> </span>
<span id="cb87-6"><a href="#cb87-6" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total Sales by Sub-Category for all the time&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Sub-Category&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb87-7"><a href="#cb87-7" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">350e3</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">350e3</span>, <span class="fl">50e3</span>))</span></code></pre></div>
<p><img src="index_files/figure-html/plot-subcategry-1.png" width="100%" /></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" tabindex="-1"></a>total_sales_profit <span class="sc">%&gt;%</span></span>
<span id="cb88-2"><a href="#cb88-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder_value</span>(<span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>, Profit, <span class="cn">TRUE</span>), <span class="at">y =</span> Profit)) <span class="sc">+</span></span>
<span id="cb88-3"><a href="#cb88-3" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">fill=</span><span class="fu">ifelse</span>(Profit <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="st">&quot;Profit&quot;</span>, <span class="st">&quot;Loss&quot;</span>)), <span class="at">show.legend =</span> <span class="cn">TRUE</span>) <span class="sc">+</span></span>
<span id="cb88-4"><a href="#cb88-4" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span> </span>
<span id="cb88-5"><a href="#cb88-5" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>, <span class="at">y =</span> Profit, </span>
<span id="cb88-6"><a href="#cb88-6" tabindex="-1"></a>                <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Profit, <span class="at">scale=</span><span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>, <span class="at">accuracy =</span> <span class="fl">0.1</span>), </span>
<span id="cb88-7"><a href="#cb88-7" tabindex="-1"></a>                <span class="at">vjust =</span> <span class="fu">ifelse</span>(Profit <span class="sc">&gt;=</span> <span class="dv">0</span>, <span class="sc">-</span><span class="fl">1.2</span>, <span class="fl">1.5</span>)), <span class="at">size =</span> <span class="fl">2.3</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb88-8"><a href="#cb88-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total Profit by Sub-Category for all the time&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Sub-Category&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Profit, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb88-9"><a href="#cb88-9" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Profit&quot;</span><span class="ot">=</span><span class="st">&quot;#ADD7A0&quot;</span>, <span class="st">&quot;Loss&quot;</span><span class="ot">=</span><span class="st">&quot;#EE9779&quot;</span>)) <span class="sc">+</span></span>
<span id="cb88-10"><a href="#cb88-10" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">20e3</span>, <span class="fl">60e3</span>)) <span class="sc">+</span></span>
<span id="cb88-11"><a href="#cb88-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/subcategory-profit-plot-1.png" width="100%" /></p>
</div>
<div id="what-is-yoy-sales-and-profit-growth-by-sub-category"
class="section level2">
<h2>What is YoY Sales and Profit Growth by Sub-Category?</h2>
<p>Arranging Profit by sub-categories we can see which the
sub-categories make losses. Let’s see on the year-over-year
sub-categories sales growth for the lastest year in the dataset
vs. before one.</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" tabindex="-1"></a>YoY_sub <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb89-2"><a href="#cb89-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb89-3"><a href="#cb89-3" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">%in%</span> <span class="fu">c</span>(latest_year<span class="dv">-1</span>, latest_year)) <span class="sc">%&gt;%</span></span>
<span id="cb89-4"><a href="#cb89-4" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>, Year) <span class="sc">%&gt;%</span></span>
<span id="cb89-5"><a href="#cb89-5" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">round</span>(<span class="fu">sum</span>(Sales), <span class="dv">2</span>), </span>
<span id="cb89-6"><a href="#cb89-6" tabindex="-1"></a>            <span class="at">Profit =</span> <span class="fu">round</span>(<span class="fu">sum</span>(Profit), <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb89-7"><a href="#cb89-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YoY_Growth_Sales =</span> (Sales <span class="sc">-</span> <span class="fu">lag</span>(Sales))<span class="sc">/</span><span class="fu">lag</span>(Sales),</span>
<span id="cb89-8"><a href="#cb89-8" tabindex="-1"></a>         <span class="at">YoY_Growth_Profit =</span> (Profit <span class="sc">-</span> <span class="fu">lag</span>(Profit))<span class="sc">/</span><span class="fu">abs</span>(<span class="fu">lag</span>(Profit))) </span></code></pre></div>
<div id="yoy-sales-growth" class="section level4">
<h4>YoY Sales Growth</h4>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" tabindex="-1"></a><span class="co"># sales plot</span></span>
<span id="cb90-2"><a href="#cb90-2" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="fu">max</span>(YoY_sub<span class="sc">$</span>Sales)</span>
<span id="cb90-3"><a href="#cb90-3" tabindex="-1"></a>YoY_sub <span class="sc">%&gt;%</span></span>
<span id="cb90-4"><a href="#cb90-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Sales =</span> <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2016</span>, <span class="sc">-</span>Sales, Sales)) <span class="sc">%&gt;%</span></span>
<span id="cb90-5"><a href="#cb90-5" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb90-6"><a href="#cb90-6" tabindex="-1"></a>   <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>, <span class="at">y=</span>Sales, <span class="at">fill=</span><span class="fu">ifelse</span>(Year<span class="sc">==</span><span class="dv">2016</span>, <span class="st">&quot;2016&quot;</span>, <span class="st">&quot;2017&quot;</span>))) <span class="sc">+</span></span>
<span id="cb90-7"><a href="#cb90-7" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>, <span class="at">y =</span> <span class="fu">ifelse</span>(Year<span class="sc">==</span><span class="dv">2016</span>, <span class="cn">NA</span>, YoY_Growth_Sales <span class="sc">*</span> scale),</span>
<span id="cb90-8"><a href="#cb90-8" tabindex="-1"></a>                   <span class="at">color=</span><span class="fu">ifelse</span>(YoY_Growth_Sales <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">&quot;Drop&quot;</span>, <span class="st">&quot;Growth&quot;</span>)), <span class="at">shape=</span><span class="dv">18</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb90-9"><a href="#cb90-9" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>, <span class="at">y =</span> <span class="fu">ifelse</span>(Year<span class="sc">==</span><span class="dv">2016</span>, <span class="cn">NA</span>, YoY_Growth_Sales <span class="sc">*</span> scale), <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth_Sales, <span class="at">accuracy =</span> <span class="fl">0.1</span>),</span>
<span id="cb90-10"><a href="#cb90-10" tabindex="-1"></a>                  <span class="at">vjust =</span> <span class="fu">ifelse</span>(YoY_Growth_Sales <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">2.5</span>)), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-11"><a href="#cb90-11" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;YoY Growth Sales by Sub-Category for 2017 vs. 2016&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Sub-Category&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb90-12"><a href="#cb90-12" tabindex="-1"></a>   <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>.<span class="sc">/</span>scale, <span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()), </span>
<span id="cb90-13"><a href="#cb90-13" tabindex="-1"></a>                      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">number</span>(<span class="fu">c</span>(<span class="fu">rev</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">100e3</span>, <span class="at">by=</span><span class="fl">20e3</span>)), <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">120e3</span>, <span class="at">by=</span><span class="fl">20e3</span>)[<span class="sc">-</span><span class="dv">1</span>]), <span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">100e3</span>, <span class="fl">120e3</span>),</span>
<span id="cb90-14"><a href="#cb90-14" tabindex="-1"></a>                      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">100e3</span>, <span class="fl">120e3</span>, <span class="at">by=</span><span class="fl">20e3</span>)) <span class="sc">+</span></span>
<span id="cb90-15"><a href="#cb90-15" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;Sales&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;2016&quot;</span><span class="ot">=</span><span class="st">&quot;#ececec&quot;</span>, <span class="st">&quot;2017&quot;</span><span class="ot">=</span><span class="st">&quot;#ADD7A0&quot;</span>)) <span class="sc">+</span></span>
<span id="cb90-16"><a href="#cb90-16" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Drop&quot;</span><span class="ot">=</span><span class="st">&quot;red&quot;</span>, <span class="st">&quot;Growth&quot;</span><span class="ot">=</span><span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb90-17"><a href="#cb90-17" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb90-18"><a href="#cb90-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/yoy-sales-growth-sub-1.png" width="100%" /></p>
</div>
<div id="yoy-profit-growth" class="section level4">
<h4>YoY Profit Growth</h4>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="fu">max</span>(YoY_sub<span class="sc">$</span>Profit)</span>
<span id="cb91-2"><a href="#cb91-2" tabindex="-1"></a>YoY_sub <span class="sc">%&gt;%</span></span>
<span id="cb91-3"><a href="#cb91-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Profit =</span> <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2016</span>, <span class="sc">-</span>Profit, Profit)) <span class="sc">%&gt;%</span></span>
<span id="cb91-4"><a href="#cb91-4" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb91-5"><a href="#cb91-5" tabindex="-1"></a>   <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>, <span class="at">y=</span>Profit, <span class="at">fill=</span><span class="fu">ifelse</span>(Year<span class="sc">==</span><span class="dv">2016</span>, <span class="st">&quot;2016&quot;</span>, <span class="st">&quot;2017&quot;</span>))) <span class="sc">+</span></span>
<span id="cb91-6"><a href="#cb91-6" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>, <span class="at">y =</span> <span class="fu">ifelse</span>(Year<span class="sc">==</span><span class="dv">2016</span>, <span class="cn">NA</span>, YoY_Growth_Profit <span class="sc">*</span> scale),</span>
<span id="cb91-7"><a href="#cb91-7" tabindex="-1"></a>                   <span class="at">color=</span><span class="fu">ifelse</span>(YoY_Growth_Profit <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="st">&quot;Drop&quot;</span>, <span class="st">&quot;Growth&quot;</span>)), <span class="at">shape =</span> <span class="dv">18</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> </span>
<span id="cb91-8"><a href="#cb91-8" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>, <span class="at">y =</span> <span class="fu">ifelse</span>(Year<span class="sc">==</span><span class="dv">2016</span>, <span class="cn">NA</span>, YoY_Growth_Profit <span class="sc">*</span> scale), <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth_Profit, <span class="at">accuracy =</span> <span class="fl">0.1</span>),</span>
<span id="cb91-9"><a href="#cb91-9" tabindex="-1"></a>                  <span class="at">vjust =</span> <span class="fu">ifelse</span>(YoY_Growth_Profit <span class="sc">&gt;</span> <span class="dv">0</span>, <span class="sc">-</span><span class="fl">1.5</span>, <span class="fl">2.5</span>)), <span class="at">size =</span> <span class="dv">2</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb91-10"><a href="#cb91-10" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;YoY Growth Profit by Sub-Category for 2017 vs. 2016&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Sub-Category&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Profit, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb91-11"><a href="#cb91-11" tabindex="-1"></a>   <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>.<span class="sc">/</span>scale, <span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), </span>
<span id="cb91-12"><a href="#cb91-12" tabindex="-1"></a>                                          <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="dv">4</span>, <span class="dv">1</span>, <span class="fl">0.5</span>)), </span>
<span id="cb91-13"><a href="#cb91-13" tabindex="-1"></a>                      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">number</span>(<span class="fu">c</span>(<span class="fu">rev</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">100e3</span>, <span class="at">by=</span><span class="fl">20e3</span>)), <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">40e3</span>, <span class="at">by=</span><span class="fl">20e3</span>)[<span class="sc">-</span><span class="dv">1</span>]), <span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">100e3</span>, <span class="fl">40e3</span>),</span>
<span id="cb91-14"><a href="#cb91-14" tabindex="-1"></a>                      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">100e3</span>, <span class="fl">40e3</span>, <span class="at">by=</span><span class="fl">20e3</span>)) <span class="sc">+</span></span>
<span id="cb91-15"><a href="#cb91-15" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;Profit&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;2016&quot;</span><span class="ot">=</span><span class="st">&quot;#ececec&quot;</span>, <span class="st">&quot;2017&quot;</span><span class="ot">=</span><span class="st">&quot;#ADD7A0&quot;</span>))  <span class="sc">+</span></span>
<span id="cb91-16"><a href="#cb91-16" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Drop&quot;</span><span class="ot">=</span><span class="st">&quot;red&quot;</span>, <span class="st">&quot;Growth&quot;</span><span class="ot">=</span><span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb91-17"><a href="#cb91-17" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb91-18"><a href="#cb91-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/yoy-profit-growth-sub-1.png" width="100%" /></p>
</div>
</div>
<div
id="which-sub-categories-do-customers-prefer-to-buy-together-at-the-same-time"
class="section level2">
<h2>Which sub-categories do customers prefer to buy together at the same
time?</h2>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" tabindex="-1"></a><span class="co"># Sorry, but this is low performance code :-(</span></span>
<span id="cb92-2"><a href="#cb92-2" tabindex="-1"></a><span class="co"># cross-selling analysis</span></span>
<span id="cb92-3"><a href="#cb92-3" tabindex="-1"></a>pair <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="st">&quot;one&quot;</span><span class="ot">=</span><span class="fu">levels</span>(Orders<span class="sc">$</span><span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>), <span class="st">&quot;two&quot;</span><span class="ot">=</span><span class="fu">levels</span>(Orders<span class="sc">$</span><span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>))</span>
<span id="cb92-4"><a href="#cb92-4" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" tabindex="-1"></a>pivot <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb92-6"><a href="#cb92-6" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;Sub-Category&quot;</span>, <span class="at">values_from =</span> Quantity) <span class="sc">%&gt;%</span></span>
<span id="cb92-7"><a href="#cb92-7" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;Order ID&quot;</span>, <span class="fu">levels</span>(Orders<span class="sc">$</span><span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb92-8"><a href="#cb92-8" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb92-9"><a href="#cb92-9" tabindex="-1"></a>  <span class="fu">summarize_all</span>(<span class="sc">~</span><span class="fu">sum</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb92-10"><a href="#cb92-10" tabindex="-1"></a></span>
<span id="cb92-11"><a href="#cb92-11" tabindex="-1"></a>count2 <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b){</span>
<span id="cb92-12"><a href="#cb92-12" tabindex="-1"></a>  <span class="cf">if</span>(a <span class="sc">==</span> b){</span>
<span id="cb92-13"><a href="#cb92-13" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb92-14"><a href="#cb92-14" tabindex="-1"></a>  }</span>
<span id="cb92-15"><a href="#cb92-15" tabindex="-1"></a>  <span class="fu">nrow</span>(pivot[pivot[,a] <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> pivot[,b] <span class="sc">&gt;</span> <span class="dv">0</span>,])<span class="sc">/</span><span class="fu">length</span>(<span class="fu">unique</span>(Orders<span class="sc">$</span><span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>))</span>
<span id="cb92-16"><a href="#cb92-16" tabindex="-1"></a>}</span>
<span id="cb92-17"><a href="#cb92-17" tabindex="-1"></a></span>
<span id="cb92-18"><a href="#cb92-18" tabindex="-1"></a>count2 <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(count2)</span>
<span id="cb92-19"><a href="#cb92-19" tabindex="-1"></a></span>
<span id="cb92-20"><a href="#cb92-20" tabindex="-1"></a>pair <span class="sc">%&gt;%</span></span>
<span id="cb92-21"><a href="#cb92-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">one=</span><span class="fu">as.character</span>(one), <span class="at">two=</span><span class="fu">as.character</span>(two)) <span class="sc">%&gt;%</span></span>
<span id="cb92-22"><a href="#cb92-22" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orders=</span><span class="fu">count2</span>(one, two)) <span class="sc">%&gt;%</span></span>
<span id="cb92-23"><a href="#cb92-23" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb92-24"><a href="#cb92-24" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">x=</span>one, <span class="at">y=</span>two, <span class="at">fill=</span>orders), ) <span class="sc">+</span></span>
<span id="cb92-25"><a href="#cb92-25" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">high =</span> <span class="st">&quot;#ADD7A0&quot;</span>,  <span class="at">low =</span> <span class="st">&quot;white&quot;</span>, <span class="at">na.value =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb92-26"><a href="#cb92-26" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb92-27"><a href="#cb92-27" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>one, <span class="at">y=</span>two, <span class="at">label=</span>scales<span class="sc">::</span><span class="fu">percent</span>(orders, <span class="at">accuracy =</span> <span class="fl">0.01</span>)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb92-28"><a href="#cb92-28" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Cross-selling sub-categories for all the time&quot;</span>, </span>
<span id="cb92-29"><a href="#cb92-29" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Sub-categories which customers prefered to buy together per one order/transaction.&quot;</span>,</span>
<span id="cb92-30"><a href="#cb92-30" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;Sub-Catgeory&quot;</span>, <span class="at">y=</span><span class="st">&quot;Sub-Catgeory&quot;</span>) <span class="sc">+</span></span>
<span id="cb92-31"><a href="#cb92-31" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/cross-selling-1.png" width="100%" /></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" tabindex="-1"></a><span class="co"># Sorry, but this is low performance code too :-(</span></span>
<span id="cb93-2"><a href="#cb93-2" tabindex="-1"></a><span class="co"># cross-selling analysis by segment</span></span>
<span id="cb93-3"><a href="#cb93-3" tabindex="-1"></a>pair_seg <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="st">&quot;one&quot;</span><span class="ot">=</span><span class="fu">levels</span>(Orders<span class="sc">$</span><span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>), <span class="st">&quot;two&quot;</span><span class="ot">=</span><span class="fu">levels</span>(Orders<span class="sc">$</span><span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>), </span>
<span id="cb93-4"><a href="#cb93-4" tabindex="-1"></a>                    <span class="st">&quot;segment&quot;</span><span class="ot">=</span><span class="fu">levels</span>(Orders<span class="sc">$</span>Segment))</span>
<span id="cb93-5"><a href="#cb93-5" tabindex="-1"></a></span>
<span id="cb93-6"><a href="#cb93-6" tabindex="-1"></a>pivot_seg <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb93-7"><a href="#cb93-7" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;Sub-Category&quot;</span>, <span class="at">values_from =</span> Quantity) <span class="sc">%&gt;%</span></span>
<span id="cb93-8"><a href="#cb93-8" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;Order ID&quot;</span>, Segment, <span class="fu">levels</span>(Orders<span class="sc">$</span><span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb93-9"><a href="#cb93-9" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>, Segment) <span class="sc">%&gt;%</span></span>
<span id="cb93-10"><a href="#cb93-10" tabindex="-1"></a>  <span class="fu">summarize_all</span>(<span class="sc">~</span><span class="fu">sum</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb93-11"><a href="#cb93-11" tabindex="-1"></a></span>
<span id="cb93-12"><a href="#cb93-12" tabindex="-1"></a>count2_seg <span class="ot">&lt;-</span> <span class="cf">function</span>(a, b, seg){</span>
<span id="cb93-13"><a href="#cb93-13" tabindex="-1"></a>  <span class="cf">if</span>(a <span class="sc">==</span> b){</span>
<span id="cb93-14"><a href="#cb93-14" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NA</span>)</span>
<span id="cb93-15"><a href="#cb93-15" tabindex="-1"></a>  }</span>
<span id="cb93-16"><a href="#cb93-16" tabindex="-1"></a>  <span class="fu">nrow</span>(pivot_seg[pivot_seg[,<span class="st">&quot;Segment&quot;</span>] <span class="sc">==</span> seg <span class="sc">&amp;</span> pivot_seg[,a] <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> pivot_seg[,b] <span class="sc">&gt;</span> <span class="dv">0</span>,])<span class="sc">/</span><span class="fu">length</span>(<span class="fu">unique</span>(Orders[Orders<span class="sc">$</span>Segment <span class="sc">==</span> seg,]<span class="sc">$</span><span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>))</span>
<span id="cb93-17"><a href="#cb93-17" tabindex="-1"></a>}</span>
<span id="cb93-18"><a href="#cb93-18" tabindex="-1"></a></span>
<span id="cb93-19"><a href="#cb93-19" tabindex="-1"></a>count2_seg <span class="ot">&lt;-</span> <span class="fu">Vectorize</span>(count2_seg)</span>
<span id="cb93-20"><a href="#cb93-20" tabindex="-1"></a></span>
<span id="cb93-21"><a href="#cb93-21" tabindex="-1"></a>pair_seg <span class="sc">%&gt;%</span></span>
<span id="cb93-22"><a href="#cb93-22" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">one=</span><span class="fu">as.character</span>(one), <span class="at">two=</span><span class="fu">as.character</span>(two), <span class="at">segment =</span> <span class="fu">as.character</span>(segment)) <span class="sc">%&gt;%</span></span>
<span id="cb93-23"><a href="#cb93-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">orders=</span><span class="fu">count2_seg</span>(one, two, segment)) <span class="sc">%&gt;%</span></span>
<span id="cb93-24"><a href="#cb93-24" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb93-25"><a href="#cb93-25" tabindex="-1"></a>  <span class="fu">geom_raster</span>(<span class="fu">aes</span>(<span class="at">x=</span>one, <span class="at">y=</span>two, <span class="at">fill=</span>orders), ) <span class="sc">+</span></span>
<span id="cb93-26"><a href="#cb93-26" tabindex="-1"></a>  <span class="fu">scale_fill_gradient</span>(<span class="at">high =</span> <span class="st">&quot;#ADD7A0&quot;</span>,  <span class="at">low =</span> <span class="st">&quot;white&quot;</span>, <span class="at">na.value =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb93-27"><a href="#cb93-27" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb93-28"><a href="#cb93-28" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>one, <span class="at">y=</span>two, <span class="at">label=</span>scales<span class="sc">::</span><span class="fu">percent</span>(orders, <span class="at">accuracy =</span> <span class="fl">0.01</span>)), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb93-29"><a href="#cb93-29" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Cross-selling sub-categories for all the time&quot;</span>, </span>
<span id="cb93-30"><a href="#cb93-30" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="st">&quot;Sub-categories which customers prefered to buy together per one order/transaction.&quot;</span>,</span>
<span id="cb93-31"><a href="#cb93-31" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot;Sub-Catgeory&quot;</span>, <span class="at">y=</span><span class="st">&quot;Sub-Catgeory&quot;</span>) <span class="sc">+</span></span>
<span id="cb93-32"><a href="#cb93-32" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>, <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb93-33"><a href="#cb93-33" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) <span class="sc">+</span></span>
<span id="cb93-34"><a href="#cb93-34" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>segment, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/cross-selling-segment-1.png" width="100%" /></p>
<p>Rows and columns contain all the sub-categories within the store.
Each cell represents the percentage of total number of orders for all
the time, buying a product of sub-category on the Y-axis the customer
also buying a products on the X-axis in one order.</p>
<p>The redder the cell becomes, the higher the number of orders contain
the same sub-category that crosses by row section.</p>
</div>
<div id="basket-ref" class="section level2">
<h2>What is average basket size and value?</h2>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" tabindex="-1"></a>basket <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb94-2"><a href="#cb94-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="#cb94-3" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>, Year) <span class="sc">%&gt;%</span></span>
<span id="cb94-4"><a href="#cb94-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Quantity =</span> <span class="fu">sum</span>(Quantity), <span class="at">Sales =</span> <span class="fu">sum</span>(Sales)) <span class="sc">%&gt;%</span></span>
<span id="cb94-5"><a href="#cb94-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb94-6"><a href="#cb94-6" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb94-7"><a href="#cb94-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Quantity =</span> <span class="fu">sum</span>(Quantity), <span class="at">Order_Count =</span> <span class="fu">n</span>(), <span class="at">Sales =</span> <span class="fu">sum</span>(Sales)) <span class="sc">%&gt;%</span></span>
<span id="cb94-8"><a href="#cb94-8" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb94-9"><a href="#cb94-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Basket_Value =</span> <span class="fu">round</span>(Sales <span class="sc">/</span> Order_Count, <span class="at">digits =</span> <span class="dv">2</span>), <span class="at">Basket_Size =</span> <span class="fu">round</span>(Quantity <span class="sc">/</span> Order_Count, <span class="at">digits =</span> <span class="dv">0</span>), </span>
<span id="cb94-10"><a href="#cb94-10" tabindex="-1"></a>         <span class="at">YoY_Growth =</span> (Sales <span class="sc">-</span> <span class="fu">lag</span>(Sales))<span class="sc">/</span><span class="fu">lag</span>(Sales)) <span class="sc">%&gt;%</span></span>
<span id="cb94-11"><a href="#cb94-11" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Quantity, Order_Count, Sales))</span></code></pre></div>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" tabindex="-1"></a><span class="co"># average basket value</span></span>
<span id="cb95-2"><a href="#cb95-2" tabindex="-1"></a>Basket_Value <span class="ot">&lt;-</span> basket[basket<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;Basket_Value&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb95-3"><a href="#cb95-3" tabindex="-1"></a><span class="co"># YoY growth basket value</span></span>
<span id="cb95-4"><a href="#cb95-4" tabindex="-1"></a>YoY_Basket_Value <span class="ot">&lt;-</span> basket[basket<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;YoY_Growth&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb95-5"><a href="#cb95-5" tabindex="-1"></a><span class="co"># basker size</span></span>
<span id="cb95-6"><a href="#cb95-6" tabindex="-1"></a>Basket_Size <span class="ot">&lt;-</span> basket[basket<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;Basket_Size&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb95-7"><a href="#cb95-7" tabindex="-1"></a></span>
<span id="cb95-8"><a href="#cb95-8" tabindex="-1"></a><span class="fu">paste</span>(latest_year, <span class="st">&quot;&gt; Basket Value:&quot;</span>, scales<span class="sc">::</span><span class="fu">dollar</span>(Basket_Value, <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="st">&quot;, YoY Basket Value:&quot;</span>, scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Basket_Value, <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="st">&quot; Basket Size:&quot;</span>, Basket_Size)</span></code></pre></div>
<pre><code>## [1] &quot;2017 &gt; Basket Value: $434.6 , YoY Basket Value: 20.4%  Basket Size: 7&quot;</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" tabindex="-1"></a>basket <span class="sc">%&gt;%</span> </span>
<span id="cb97-2"><a href="#cb97-2" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="st">&quot;YoY_Growth&quot;</span>, <span class="sc">~</span><span class="fu">cell_spec</span>(scales<span class="sc">::</span><span class="fu">percent</span>(., <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="st">&quot;html&quot;</span>, </span>
<span id="cb97-3"><a href="#cb97-3" tabindex="-1"></a>                                     <span class="at">color=</span><span class="fu">case_when</span>(. <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb97-4"><a href="#cb97-4" tabindex="-1"></a>                                                   . <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;green&quot;</span>,</span>
<span id="cb97-5"><a href="#cb97-5" tabindex="-1"></a>                                                   <span class="fu">is.na</span>(.) <span class="sc">~</span> <span class="st">&quot;lightgray&quot;</span>,</span>
<span id="cb97-6"><a href="#cb97-6" tabindex="-1"></a>                                                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;black&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb97-7"><a href="#cb97-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Basket_Value =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Basket_Value, <span class="at">accuracy =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb97-8"><a href="#cb97-8" tabindex="-1"></a>  <span class="fu">relocate</span>(YoY_Growth, <span class="at">.after =</span> Basket_Value) <span class="sc">%&gt;%</span></span>
<span id="cb97-9"><a href="#cb97-9" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Avg. Basket Value&quot;</span>, <span class="st">&quot;YoY Growth&quot;</span>, <span class="st">&quot;Basket Size&quot;</span>),</span>
<span id="cb97-10"><a href="#cb97-10" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;YoY average basket value growth&quot;</span>,</span>
<span id="cb97-11"><a href="#cb97-11" tabindex="-1"></a>      <span class="at">escape =</span> F,</span>
<span id="cb97-12"><a href="#cb97-12" tabindex="-1"></a>      <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&quot;l&quot;</span>, <span class="fu">rep</span>(<span class="st">&#39;r&#39;</span>,<span class="at">times=</span><span class="dv">3</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb97-13"><a href="#cb97-13" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb97-14"><a href="#cb97-14" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;bordered&quot;</span>), <span class="at">full_width =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table class="table table-striped table-bordered" style="margin-left: auto; margin-right: auto;">
<caption>
YoY average basket value growth
</caption>
<thead>
<tr>
<th style="text-align:left;text-align: center;">
Year
</th>
<th style="text-align:right;text-align: center;">
Avg. Basket Value
</th>
<th style="text-align:right;text-align: center;">
YoY Growth
</th>
<th style="text-align:right;text-align: center;">
Basket Size
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2014
</td>
<td style="text-align:right;">
$499.45
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
2015
</td>
<td style="text-align:right;">
$453.31
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-2.8%</span>
</td>
<td style="text-align:right;">
8
</td>
</tr>
<tr>
<td style="text-align:left;">
2016
</td>
<td style="text-align:right;">
$463.27
</td>
<td style="text-align:right;">
<span style="     color: green !important;">29.5%</span>
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
2017
</td>
<td style="text-align:right;">
$434.63
</td>
<td style="text-align:right;">
<span style="     color: green !important;">20.4%</span>
</td>
<td style="text-align:right;">
7
</td>
</tr>
</tbody>
</table>
</div>
<div
id="what-are-yoy-basket-value-growth-and-basket-size-by-customer-segment"
class="section level2">
<h2>What are YoY basket value Growth and basket size by Customer
Segment?</h2>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" tabindex="-1"></a>basket <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb98-2"><a href="#cb98-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb98-3"><a href="#cb98-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Segment, <span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>, Year) <span class="sc">%&gt;%</span></span>
<span id="cb98-4"><a href="#cb98-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Quantity =</span> <span class="fu">sum</span>(Quantity), <span class="at">Sales =</span> <span class="fu">sum</span>(Sales)) <span class="sc">%&gt;%</span></span>
<span id="cb98-5"><a href="#cb98-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb98-6"><a href="#cb98-6" tabindex="-1"></a>  <span class="fu">group_by</span>(Segment, Year) <span class="sc">%&gt;%</span></span>
<span id="cb98-7"><a href="#cb98-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Quantity =</span> <span class="fu">sum</span>(Quantity), <span class="at">Order_Count =</span> <span class="fu">n</span>(), <span class="at">Sales =</span> <span class="fu">sum</span>(Sales)) <span class="sc">%&gt;%</span></span>
<span id="cb98-8"><a href="#cb98-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Basket_Value =</span> <span class="fu">round</span>(Sales <span class="sc">/</span> Order_Count, <span class="at">digits =</span> <span class="dv">2</span>), <span class="at">Basket_Size =</span> <span class="fu">round</span>(Quantity <span class="sc">/</span> Order_Count, <span class="at">digits =</span> <span class="dv">0</span>), </span>
<span id="cb98-9"><a href="#cb98-9" tabindex="-1"></a>         <span class="at">YoY_Growth =</span> (Basket_Value <span class="sc">-</span> <span class="fu">lag</span>(Basket_Value))<span class="sc">/</span><span class="fu">lag</span>(Basket_Value)) <span class="sc">%&gt;%</span></span>
<span id="cb98-10"><a href="#cb98-10" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Quantity, Order_Count, Sales))</span>
<span id="cb98-11"><a href="#cb98-11" tabindex="-1"></a></span>
<span id="cb98-12"><a href="#cb98-12" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="fu">min</span>(basket<span class="sc">$</span>Basket_Value) <span class="sc">/</span> <span class="fu">max</span>(basket<span class="sc">$</span>Basket_Size)</span>
<span id="cb98-13"><a href="#cb98-13" tabindex="-1"></a>yoy_scale <span class="ot">&lt;-</span> <span class="fu">max</span>(basket<span class="sc">$</span>Basket_Value)</span>
<span id="cb98-14"><a href="#cb98-14" tabindex="-1"></a></span>
<span id="cb98-15"><a href="#cb98-15" tabindex="-1"></a>basket <span class="sc">%&gt;%</span></span>
<span id="cb98-16"><a href="#cb98-16" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb98-17"><a href="#cb98-17" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Basket_Value, <span class="at">fill=</span><span class="st">&quot;Average Value&quot;</span>), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb98-18"><a href="#cb98-18" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth <span class="sc">*</span> yoy_scale, <span class="at">group =</span> <span class="dv">1</span>, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>)) <span class="sc">+</span></span>
<span id="cb98-19"><a href="#cb98-19" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth <span class="sc">*</span> yoy_scale, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb98-20"><a href="#cb98-20" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth <span class="sc">*</span> yoy_scale, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth, <span class="at">accuracy =</span> <span class="fl">0.01</span>)), <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb98-21"><a href="#cb98-21" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Basket_Size <span class="sc">*</span> scale, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">linetype=</span><span class="st">&quot;15&quot;</span>) <span class="sc">+</span></span>
<span id="cb98-22"><a href="#cb98-22" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Basket_Size <span class="sc">*</span> scale, <span class="at">shape=</span> <span class="st">&quot;Size&quot;</span>), <span class="at">size=</span><span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb98-23"><a href="#cb98-23" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Basket_Size <span class="sc">*</span> scale, <span class="at">label =</span> Basket_Size), <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">color=</span><span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb98-24"><a href="#cb98-24" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> Basket_Value, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(<span class="fu">round</span>(Basket_Value, <span class="dv">1</span>))), <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb98-25"><a href="#cb98-25" tabindex="-1"></a>  </span>
<span id="cb98-26"><a href="#cb98-26" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Size&quot;</span><span class="ot">=</span><span class="st">&quot;black&quot;</span>, <span class="st">&quot;YoY Growth&quot;</span><span class="ot">=</span><span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb98-27"><a href="#cb98-27" tabindex="-1"></a>  <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Size&quot;</span><span class="ot">=</span><span class="dv">15</span>)) <span class="sc">+</span></span>
<span id="cb98-28"><a href="#cb98-28" tabindex="-1"></a>  </span>
<span id="cb98-29"><a href="#cb98-29" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>.<span class="sc">/</span>yoy_scale, <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(<span class="at">accuracy =</span> 1L), <span class="at">name=</span><span class="st">&quot;YoY Growth&quot;</span>,</span>
<span id="cb98-30"><a href="#cb98-30" tabindex="-1"></a>                                         <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">200</span>, <span class="dv">600</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">600</span>, <span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb98-31"><a href="#cb98-31" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name=</span><span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Average Value&quot;</span><span class="ot">=</span><span class="st">&quot;#ADD7A0&quot;</span>)) <span class="sc">+</span></span>
<span id="cb98-32"><a href="#cb98-32" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;YoY average basket value growth and basket size by Segment&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Average value, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb98-33"><a href="#cb98-33" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>)),</span>
<span id="cb98-34"><a href="#cb98-34" tabindex="-1"></a>         <span class="at">linetype =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>))) <span class="sc">+</span></span>
<span id="cb98-35"><a href="#cb98-35" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.key=</span><span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb98-36"><a href="#cb98-36" tabindex="-1"></a>          <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb98-37"><a href="#cb98-37" tabindex="-1"></a>          <span class="at">legend.box=</span><span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb98-38"><a href="#cb98-38" tabindex="-1"></a>          <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>, <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb98-39"><a href="#cb98-39" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) <span class="sc">+</span></span>
<span id="cb98-40"><a href="#cb98-40" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Segment)</span></code></pre></div>
<p><img src="index_files/figure-html/yoy-basket-plot-1.png" width="100%" /></p>
<p>As we can see the average basket value was dropping every year and
basket size was too.</p>
</div>
<div id="customers-ref" class="section level2">
<h2>What are number of total and new customers and YoY growth of
its?</h2>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" tabindex="-1"></a><span class="co"># New Customers</span></span>
<span id="cb99-2"><a href="#cb99-2" tabindex="-1"></a>cust <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb99-3"><a href="#cb99-3" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Customer ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-4"><a href="#cb99-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">First Year</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">year</span>(<span class="fu">min</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb99-5"><a href="#cb99-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb99-6"><a href="#cb99-6" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">First Year</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb99-7"><a href="#cb99-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">New Customers</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb99-8"><a href="#cb99-8" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb99-9"><a href="#cb99-9" tabindex="-1"></a>    <span class="co"># total unique customers</span></span>
<span id="cb99-10"><a href="#cb99-10" tabindex="-1"></a>    Orders <span class="sc">%&gt;%</span></span>
<span id="cb99-11"><a href="#cb99-11" tabindex="-1"></a>      <span class="fu">group_by</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb99-12"><a href="#cb99-12" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="st">`</span><span class="at">Unique Customers</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Customer ID</span><span class="st">`</span>)),</span>
<span id="cb99-13"><a href="#cb99-13" tabindex="-1"></a>    <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;First Year&quot;</span> <span class="ot">=</span> <span class="st">&quot;Year&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb99-14"><a href="#cb99-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">YoY Growth Unique</span><span class="st">`</span> <span class="ot">=</span> (<span class="st">`</span><span class="at">Unique Customers</span><span class="st">`</span> <span class="sc">-</span> <span class="fu">lag</span>(<span class="st">`</span><span class="at">Unique Customers</span><span class="st">`</span>))<span class="sc">/</span><span class="fu">lag</span>(<span class="st">`</span><span class="at">Unique Customers</span><span class="st">`</span>),</span>
<span id="cb99-15"><a href="#cb99-15" tabindex="-1"></a>         <span class="st">`</span><span class="at">YoY Growth New</span><span class="st">`</span> <span class="ot">=</span> (<span class="st">`</span><span class="at">New Customers</span><span class="st">`</span> <span class="sc">-</span> <span class="fu">lag</span>(<span class="st">`</span><span class="at">New Customers</span><span class="st">`</span>))<span class="sc">/</span><span class="fu">lag</span>(<span class="st">`</span><span class="at">New Customers</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb99-16"><a href="#cb99-16" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="st">`</span><span class="at">Year</span><span class="st">`</span> <span class="ot">=</span> <span class="st">`</span><span class="at">First Year</span><span class="st">`</span>, <span class="st">`</span><span class="at">New Customers</span><span class="st">`</span>, <span class="st">`</span><span class="at">YoY Growth New</span><span class="st">`</span>, <span class="st">`</span><span class="at">Unique Customers</span><span class="st">`</span>, <span class="st">`</span><span class="at">YoY Growth Unique</span><span class="st">`</span>)</span></code></pre></div>
<div class="sourceCode" id="cb100"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" tabindex="-1"></a><span class="co"># New customers</span></span>
<span id="cb100-2"><a href="#cb100-2" tabindex="-1"></a>New_Customers <span class="ot">&lt;-</span> cust[cust<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;New Customers&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb100-3"><a href="#cb100-3" tabindex="-1"></a><span class="co"># YoY Growth of new customers</span></span>
<span id="cb100-4"><a href="#cb100-4" tabindex="-1"></a>YoY_Growth_New <span class="ot">&lt;-</span> cust[cust<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;YoY Growth New&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb100-5"><a href="#cb100-5" tabindex="-1"></a><span class="co"># Unique customers</span></span>
<span id="cb100-6"><a href="#cb100-6" tabindex="-1"></a>Unique_Customers <span class="ot">&lt;-</span> cust[cust<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;Unique Customers&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb100-7"><a href="#cb100-7" tabindex="-1"></a><span class="co"># YoY Growth of new customers</span></span>
<span id="cb100-8"><a href="#cb100-8" tabindex="-1"></a>YoY_Growth_Unique <span class="ot">&lt;-</span> cust[cust<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;YoY Growth Unique&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb100-9"><a href="#cb100-9" tabindex="-1"></a></span>
<span id="cb100-10"><a href="#cb100-10" tabindex="-1"></a><span class="fu">paste</span>(latest_year,<span class="st">&quot;&gt; New Customers:&quot;</span>, New_Customers, <span class="st">&quot;, YoY Growth of New Customers:&quot;</span>, scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth_New, <span class="at">accuracy =</span> <span class="fl">0.1</span>), </span>
<span id="cb100-11"><a href="#cb100-11" tabindex="-1"></a>            <span class="st">&quot; Total Customers:&quot;</span>, Unique_Customers,</span>
<span id="cb100-12"><a href="#cb100-12" tabindex="-1"></a>            <span class="st">&quot;, YoY Growth of Total Customers:&quot;</span>, scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth_Unique, <span class="at">accuracy =</span> <span class="fl">0.1</span>))</span></code></pre></div>
<pre><code>## [1] &quot;2017 &gt; New Customers: 11 , YoY Growth of New Customers: -78.4%  Total Customers: 693 , YoY Growth of Total Customers: 8.6%&quot;</code></pre>
<div class="sourceCode" id="cb102"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" tabindex="-1"></a>cust <span class="sc">%&gt;%</span></span>
<span id="cb102-2"><a href="#cb102-2" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="st">&quot;YoY Growth New&quot;</span>, <span class="st">&quot;YoY Growth Unique&quot;</span>), <span class="sc">~</span><span class="fu">cell_spec</span>(scales<span class="sc">::</span><span class="fu">percent</span>(., <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="st">&quot;html&quot;</span>, </span>
<span id="cb102-3"><a href="#cb102-3" tabindex="-1"></a>                                     <span class="at">color=</span><span class="fu">case_when</span>(. <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb102-4"><a href="#cb102-4" tabindex="-1"></a>                                                   . <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;green&quot;</span>,</span>
<span id="cb102-5"><a href="#cb102-5" tabindex="-1"></a>                                                   <span class="fu">is.na</span>(.) <span class="sc">~</span> <span class="st">&quot;lightgray&quot;</span>,</span>
<span id="cb102-6"><a href="#cb102-6" tabindex="-1"></a>                                                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;black&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb102-7"><a href="#cb102-7" tabindex="-1"></a><span class="fu">kbl</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;New Customers&quot;</span>, <span class="st">&quot;YoY New Growth&quot;</span>, <span class="st">&quot;Unique Customers&quot;</span>, <span class="st">&quot;YoY Unique Growth&quot;</span>),</span>
<span id="cb102-8"><a href="#cb102-8" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;YoY Unique and Total Customers growth&quot;</span>,</span>
<span id="cb102-9"><a href="#cb102-9" tabindex="-1"></a>    <span class="at">escape =</span> F,</span>
<span id="cb102-10"><a href="#cb102-10" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&quot;l&quot;</span>, <span class="fu">rep</span>(<span class="st">&#39;r&#39;</span>,<span class="at">times=</span><span class="dv">4</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb102-11"><a href="#cb102-11" tabindex="-1"></a><span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb102-12"><a href="#cb102-12" tabindex="-1"></a><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;bordered&quot;</span>), <span class="at">full_width =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table class="table table-striped table-bordered" style="margin-left: auto; margin-right: auto;">
<caption>
YoY Unique and Total Customers growth
</caption>
<thead>
<tr>
<th style="text-align:left;text-align: center;">
Year
</th>
<th style="text-align:right;text-align: center;">
New Customers
</th>
<th style="text-align:right;text-align: center;">
YoY New Growth
</th>
<th style="text-align:right;text-align: center;">
Unique Customers
</th>
<th style="text-align:right;text-align: center;">
YoY Unique Growth
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2014
</td>
<td style="text-align:right;">
595
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
595
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
2015
</td>
<td style="text-align:right;">
136
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-77.1%</span>
</td>
<td style="text-align:right;">
573
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-3.7%</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
2016
</td>
<td style="text-align:right;">
51
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-62.5%</span>
</td>
<td style="text-align:right;">
638
</td>
<td style="text-align:right;">
<span style="     color: green !important;">11.3%</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
2017
</td>
<td style="text-align:right;">
11
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-78.4%</span>
</td>
<td style="text-align:right;">
693
</td>
<td style="text-align:right;">
<span style="     color: green !important;">8.6%</span>
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb103"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="fu">max</span>(cust<span class="sc">$</span><span class="st">`</span><span class="at">Unique Customers</span><span class="st">`</span>)</span>
<span id="cb103-2"><a href="#cb103-2" tabindex="-1"></a>cust <span class="sc">%&gt;%</span></span>
<span id="cb103-3"><a href="#cb103-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb103-4"><a href="#cb103-4" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> <span class="st">`</span><span class="at">Unique Customers</span><span class="st">`</span>, <span class="at">fill=</span><span class="st">&quot;Unique&quot;</span>), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-5"><a href="#cb103-5" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> <span class="st">`</span><span class="at">New Customers</span><span class="st">`</span>, <span class="at">group =</span> <span class="dv">1</span>, <span class="at">color=</span><span class="st">&quot;New&quot;</span>), <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span> </span>
<span id="cb103-6"><a href="#cb103-6" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> <span class="st">`</span><span class="at">New Customers</span><span class="st">`</span>, <span class="at">color=</span><span class="st">&quot;New&quot;</span>), <span class="at">shape=</span><span class="dv">18</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span> </span>
<span id="cb103-7"><a href="#cb103-7" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> <span class="st">`</span><span class="at">New Customers</span><span class="st">`</span>, <span class="at">label =</span> <span class="st">`</span><span class="at">New Customers</span><span class="st">`</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">5</span>) <span class="sc">+</span></span>
<span id="cb103-8"><a href="#cb103-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;New customers vs total unique customers by Year&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Unique Customers&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-9"><a href="#cb103-9" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>., <span class="at">labels =</span> <span class="cn">NULL</span>)) <span class="sc">+</span></span>
<span id="cb103-10"><a href="#cb103-10" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Unique&quot;</span><span class="ot">=</span><span class="st">&quot;#ADD7A0&quot;</span>)) <span class="sc">+</span></span>
<span id="cb103-11"><a href="#cb103-11" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;New&quot;</span><span class="ot">=</span><span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb103-12"><a href="#cb103-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/new-vs-total-customer-1.png" width="100%" /></p>
</div>
<div id="what-is-customer-lifetime-value-ctv" class="section level2">
<h2>What is Customer Lifetime Value (CTV)?</h2>
<div class="sourceCode" id="cb104"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" tabindex="-1"></a><span class="co"># Total Revenue</span></span>
<span id="cb104-2"><a href="#cb104-2" tabindex="-1"></a>total_revenue <span class="ot">&lt;-</span> general_metrics[, <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Sales&quot;</span>)]</span>
<span id="cb104-3"><a href="#cb104-3" tabindex="-1"></a><span class="co"># Customer Value</span></span>
<span id="cb104-4"><a href="#cb104-4" tabindex="-1"></a>cust_value <span class="ot">&lt;-</span> total_revenue <span class="sc">%&gt;%</span> </span>
<span id="cb104-5"><a href="#cb104-5" tabindex="-1"></a>  <span class="fu">inner_join</span>(cust <span class="sc">%&gt;%</span> </span>
<span id="cb104-6"><a href="#cb104-6" tabindex="-1"></a>               <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">factor</span>(Year)), <span class="at">by =</span> <span class="st">&quot;Year&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb104-7"><a href="#cb104-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">cv =</span> Sales <span class="sc">/</span> <span class="st">`</span><span class="at">Unique Customers</span><span class="st">`</span>)</span>
<span id="cb104-8"><a href="#cb104-8" tabindex="-1"></a></span>
<span id="cb104-9"><a href="#cb104-9" tabindex="-1"></a><span class="co"># Customer Lifetime Value</span></span>
<span id="cb104-10"><a href="#cb104-10" tabindex="-1"></a>CLV <span class="ot">&lt;-</span> cust_value <span class="sc">%&gt;%</span></span>
<span id="cb104-11"><a href="#cb104-11" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb104-12"><a href="#cb104-12" tabindex="-1"></a>    Orders <span class="sc">%&gt;%</span></span>
<span id="cb104-13"><a href="#cb104-13" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.factor</span>(<span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb104-14"><a href="#cb104-14" tabindex="-1"></a>      <span class="fu">group_by</span>(Year, <span class="st">`</span><span class="at">Customer ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb104-15"><a href="#cb104-15" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">last_date =</span> <span class="fu">last</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb104-16"><a href="#cb104-16" tabindex="-1"></a>      <span class="fu">left_join</span>(</span>
<span id="cb104-17"><a href="#cb104-17" tabindex="-1"></a>        Orders <span class="sc">%&gt;%</span></span>
<span id="cb104-18"><a href="#cb104-18" tabindex="-1"></a>          <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Customer ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb104-19"><a href="#cb104-19" tabindex="-1"></a>          <span class="fu">summarise</span>(<span class="at">first_date =</span> <span class="fu">first</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>, <span class="at">order_by =</span> <span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)),</span>
<span id="cb104-20"><a href="#cb104-20" tabindex="-1"></a>        <span class="at">by =</span> <span class="st">&quot;Customer ID&quot;</span></span>
<span id="cb104-21"><a href="#cb104-21" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb104-22"><a href="#cb104-22" tabindex="-1"></a>      <span class="fu">group_by</span>(Year, <span class="st">`</span><span class="at">Customer ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb104-23"><a href="#cb104-23" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">first_date =</span> <span class="fu">first</span>(first_date), <span class="at">last_date =</span> <span class="fu">last</span>(last_date)) <span class="sc">%&gt;%</span></span>
<span id="cb104-24"><a href="#cb104-24" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">days =</span> last_date <span class="sc">-</span> first_date) <span class="sc">%&gt;%</span></span>
<span id="cb104-25"><a href="#cb104-25" tabindex="-1"></a>      <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb104-26"><a href="#cb104-26" tabindex="-1"></a>      <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb104-27"><a href="#cb104-27" tabindex="-1"></a>      <span class="fu">summarise</span>(<span class="at">days_sum =</span> <span class="fu">sum</span>(days), <span class="at">n =</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Customer ID</span><span class="st">`</span>), <span class="at">cls =</span> <span class="fu">time_length</span>(days_sum, <span class="st">&quot;years&quot;</span>) <span class="sc">/</span> n),</span>
<span id="cb104-28"><a href="#cb104-28" tabindex="-1"></a>    <span class="at">by=</span><span class="st">&quot;Year&quot;</span></span>
<span id="cb104-29"><a href="#cb104-29" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb104-30"><a href="#cb104-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">clv =</span> cv <span class="sc">*</span> cls) <span class="sc">%&gt;%</span> </span>
<span id="cb104-31"><a href="#cb104-31" tabindex="-1"></a>  <span class="fu">select</span>(Year, clv) <span class="sc">%&gt;%</span></span>
<span id="cb104-32"><a href="#cb104-32" tabindex="-1"></a>  <span class="fu">arrange</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb104-33"><a href="#cb104-33" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YoY_Growth =</span> (clv <span class="sc">-</span> <span class="fu">lag</span>(clv))<span class="sc">/</span><span class="fu">lag</span>(clv))</span></code></pre></div>
<div class="sourceCode" id="cb105"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" tabindex="-1"></a><span class="co"># Mini-dashboard CLV metrics</span></span>
<span id="cb105-2"><a href="#cb105-2" tabindex="-1"></a>CLV_m <span class="ot">&lt;-</span> CLV[CLV<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;clv&quot;</span>][[<span class="dv">1</span>]]</span>
<span id="cb105-3"><a href="#cb105-3" tabindex="-1"></a>CLV_yoy <span class="ot">&lt;-</span> CLV[CLV<span class="sc">$</span>Year <span class="sc">==</span> latest_year, <span class="st">&quot;YoY_Growth&quot;</span>][[<span class="dv">1</span>]]</span></code></pre></div>
<div class="sourceCode" id="cb106"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" tabindex="-1"></a>CLV <span class="sc">%&gt;%</span></span>
<span id="cb106-2"><a href="#cb106-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb106-3"><a href="#cb106-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>clv, <span class="at">fill=</span><span class="st">&quot;CLV&quot;</span>), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb106-4"><a href="#cb106-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_Growth<span class="sc">*</span><span class="fu">min</span>(CLV<span class="sc">$</span>clv), <span class="at">group=</span><span class="dv">1</span>, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>)) <span class="sc">+</span></span>
<span id="cb106-5"><a href="#cb106-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_Growth<span class="sc">*</span><span class="fu">min</span>(CLV<span class="sc">$</span>clv), <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size=</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb106-6"><a href="#cb106-6" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_Growth<span class="sc">*</span><span class="fu">min</span>(CLV<span class="sc">$</span>clv), <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">shape=</span><span class="dv">21</span>, <span class="at">size=</span><span class="dv">2</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb106-7"><a href="#cb106-7" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_Growth<span class="sc">*</span><span class="fu">min</span>(CLV<span class="sc">$</span>clv), <span class="at">label=</span>scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth, <span class="at">accuracy =</span> 1L)), <span class="at">size=</span><span class="dv">3</span>, <span class="at">vjust=</span><span class="sc">-</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb106-8"><a href="#cb106-8" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>clv, <span class="at">label=</span>scales<span class="sc">::</span><span class="fu">dollar</span>(clv, <span class="at">accuracy =</span> <span class="fl">0.1</span>)), <span class="at">size=</span><span class="dv">4</span>, <span class="at">vjust=</span><span class="sc">-</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb106-9"><a href="#cb106-9" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">3200</span>)) <span class="sc">+</span></span>
<span id="cb106-10"><a href="#cb106-10" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;CLV&quot;</span><span class="ot">=</span><span class="st">&quot;#ADD7A0&quot;</span>)) <span class="sc">+</span></span>
<span id="cb106-11"><a href="#cb106-11" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;YoY Growth&quot;</span><span class="ot">=</span><span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb106-12"><a href="#cb106-12" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb106-13"><a href="#cb106-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Customer Lifetime Value&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">y =</span> <span class="st">&quot;CLV, $&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/clv-plot-1.png" width="100%" /></p>
</div>
<div id="what-are-top-profitable-products" class="section level2">
<h2>What are top profitable products?</h2>
<div class="sourceCode" id="cb107"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" tabindex="-1"></a>products <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="#cb107-2" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Product ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb107-3"><a href="#cb107-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">Product Name</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">first</span>(<span class="st">`</span><span class="at">Product Name</span><span class="st">`</span>),</span>
<span id="cb107-4"><a href="#cb107-4" tabindex="-1"></a>            <span class="at">Category =</span> <span class="fu">first</span>(Category),</span>
<span id="cb107-5"><a href="#cb107-5" tabindex="-1"></a>            <span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">first</span>(<span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>),</span>
<span id="cb107-6"><a href="#cb107-6" tabindex="-1"></a>            <span class="at">Sales =</span> <span class="fu">sum</span>(Sales),</span>
<span id="cb107-7"><a href="#cb107-7" tabindex="-1"></a>            <span class="at">Profit =</span> <span class="fu">sum</span>(Profit),</span>
<span id="cb107-8"><a href="#cb107-8" tabindex="-1"></a>            <span class="at">Quantity =</span> <span class="fu">sum</span>(Quantity)) <span class="sc">%&gt;%</span></span>
<span id="cb107-9"><a href="#cb107-9" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb107-10"><a href="#cb107-10" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>Profit) <span class="sc">%&gt;%</span></span>
<span id="cb107-11"><a href="#cb107-11" tabindex="-1"></a>  <span class="fu">select</span>(<span class="st">`</span><span class="at">Product Name</span><span class="st">`</span>, Category, <span class="st">`</span><span class="at">Sub-Category</span><span class="st">`</span>, Sales, Profit, Quantity)</span>
<span id="cb107-12"><a href="#cb107-12" tabindex="-1"></a></span>
<span id="cb107-13"><a href="#cb107-13" tabindex="-1"></a>products <span class="sc">%&gt;%</span></span>
<span id="cb107-14"><a href="#cb107-14" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb107-15"><a href="#cb107-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Product Name</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="st">`</span><span class="at">Product Name</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb107-16"><a href="#cb107-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Product Name</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">fct_reorder</span>(<span class="st">`</span><span class="at">Product Name</span><span class="st">`</span>, Profit)) <span class="sc">%&gt;%</span></span>
<span id="cb107-17"><a href="#cb107-17" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb107-18"><a href="#cb107-18" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Product Name</span><span class="st">`</span>, <span class="at">y =</span> Profit, <span class="at">fill =</span> Category), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb107-19"><a href="#cb107-19" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Product Name</span><span class="st">`</span>, <span class="at">y=</span>Profit, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Profit, <span class="at">accuracy =</span> <span class="fl">0.1</span>)), <span class="at">size =</span> <span class="dv">3</span>, <span class="at">hjust =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb107-20"><a href="#cb107-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Top-10 profitable products&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Product Name&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Profit, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb107-21"><a href="#cb107-21" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> <span class="cf">function</span>(x) <span class="fu">str_trunc</span>(x, <span class="at">width =</span> <span class="dv">24</span>, <span class="at">side =</span> <span class="st">&quot;right&quot;</span>, <span class="at">ellipsis =</span> <span class="st">&quot;...&quot;</span>)) <span class="sc">+</span></span>
<span id="cb107-22"><a href="#cb107-22" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb107-23"><a href="#cb107-23" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb107-24"><a href="#cb107-24" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/top-products-1.png" width="100%" /></p>
</div>
<div id="who-are-the-top-profitable-customers" class="section level2">
<h2>Who are the top profitable customers?</h2>
<div class="sourceCode" id="cb108"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" tabindex="-1"></a>customers <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb108-2"><a href="#cb108-2" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-3"><a href="#cb108-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), <span class="at">Profit =</span> <span class="fu">sum</span>(Profit), <span class="at">Segment =</span> <span class="fu">first</span>(Segment), <span class="st">`</span><span class="at">Customer ID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">first</span>(<span class="st">`</span><span class="at">Customer ID</span><span class="st">`</span>), <span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">first</span>(<span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb108-4"><a href="#cb108-4" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb108-5"><a href="#cb108-5" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Customer ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-6"><a href="#cb108-6" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">first</span>(<span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span>), <span class="at">Segment =</span> <span class="fu">first</span>(Segment), <span class="at">Profit =</span> <span class="fu">sum</span>(Profit), <span class="at">Orders =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb108-7"><a href="#cb108-7" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb108-8"><a href="#cb108-8" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>Profit) <span class="sc">%&gt;%</span></span>
<span id="cb108-9"><a href="#cb108-9" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="st">`</span><span class="at">Customer ID</span><span class="st">`</span>) </span>
<span id="cb108-10"><a href="#cb108-10" tabindex="-1"></a></span>
<span id="cb108-11"><a href="#cb108-11" tabindex="-1"></a>customers <span class="sc">%&gt;%</span></span>
<span id="cb108-12"><a href="#cb108-12" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb108-13"><a href="#cb108-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">as.factor</span>(<span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb108-14"><a href="#cb108-14" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">fct_reorder</span>(<span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span>, Profit)) <span class="sc">%&gt;%</span></span>
<span id="cb108-15"><a href="#cb108-15" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb108-16"><a href="#cb108-16" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span>, <span class="at">y =</span> Profit, <span class="at">fill =</span> Segment), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb108-17"><a href="#cb108-17" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="st">`</span><span class="at">Customer Name</span><span class="st">`</span>, <span class="at">y=</span>Profit, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Profit, <span class="at">accuracy =</span> <span class="fl">0.1</span>)), <span class="at">hjust =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb108-18"><a href="#cb108-18" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Top-10 profitable customers&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Customer Name&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Profit, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb108-19"><a href="#cb108-19" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb108-20"><a href="#cb108-20" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span> </span>
<span id="cb108-21"><a href="#cb108-21" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/top-customers-1.png" width="100%" /></p>
</div>
<div id="what-is-percentage-of-revenue-from-new-business"
class="section level2">
<h2>What is percentage of Revenue from new business?</h2>
<div class="sourceCode" id="cb109"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" tabindex="-1"></a>new_bis <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb109-2"><a href="#cb109-2" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Customer ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb109-3"><a href="#cb109-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">First Year</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">year</span>(<span class="fu">min</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)), <span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>), <span class="at">Month =</span> month.name[<span class="fu">month</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)]) <span class="sc">%&gt;%</span></span>
<span id="cb109-4"><a href="#cb109-4" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb109-5"><a href="#cb109-5" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Year</span><span class="st">`</span>, Month) <span class="sc">%&gt;%</span></span>
<span id="cb109-6"><a href="#cb109-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(<span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="st">`</span><span class="at">First Year</span><span class="st">`</span>, Sales, <span class="dv">0</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb109-7"><a href="#cb109-7" tabindex="-1"></a>  <span class="fu">inner_join</span>(</span>
<span id="cb109-8"><a href="#cb109-8" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb109-9"><a href="#cb109-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>), <span class="at">Month =</span> month.name[<span class="fu">month</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)]) <span class="sc">%&gt;%</span></span>
<span id="cb109-10"><a href="#cb109-10" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, Month) <span class="sc">%&gt;%</span></span>
<span id="cb109-11"><a href="#cb109-11" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), </span>
<span id="cb109-12"><a href="#cb109-12" tabindex="-1"></a>            <span class="at">Profit =</span> <span class="fu">sum</span>(Profit)),</span>
<span id="cb109-13"><a href="#cb109-13" tabindex="-1"></a><span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Month&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb109-14"><a href="#cb109-14" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;New Sales&quot;</span> <span class="ot">=</span> Sales.x, <span class="st">&quot;Total Sales&quot;</span> <span class="ot">=</span> Sales.y) <span class="sc">%&gt;%</span></span>
<span id="cb109-15"><a href="#cb109-15" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.factor</span>(Year), <span class="at">Month =</span> <span class="fu">as.factor</span>(Month), <span class="at">percent =</span> <span class="st">`</span><span class="at">New Sales</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">Total Sales</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb109-16"><a href="#cb109-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Month =</span> <span class="fu">fct_reorder</span>(Month, <span class="fu">match</span>(Month, month.name))) </span>
<span id="cb109-17"><a href="#cb109-17" tabindex="-1"></a></span>
<span id="cb109-18"><a href="#cb109-18" tabindex="-1"></a>biz <span class="ot">&lt;-</span> new_bis <span class="sc">%&gt;%</span></span>
<span id="cb109-19"><a href="#cb109-19" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Quarter =</span> lubridate<span class="sc">::</span><span class="fu">quarter</span>(<span class="fu">match</span>(Month, month.name))) <span class="sc">%&gt;%</span></span>
<span id="cb109-20"><a href="#cb109-20" tabindex="-1"></a>  <span class="fu">group_by</span>(Year, Quarter) <span class="sc">%&gt;%</span></span>
<span id="cb109-21"><a href="#cb109-21" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="st">`</span><span class="at">New Sales</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">New Sales</span><span class="st">`</span>), <span class="st">`</span><span class="at">Total Sales</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">Total Sales</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb109-22"><a href="#cb109-22" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">percent =</span> <span class="st">`</span><span class="at">New Sales</span><span class="st">`</span> <span class="sc">/</span> <span class="st">`</span><span class="at">Total Sales</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb109-23"><a href="#cb109-23" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YQ =</span> <span class="fu">paste0</span>(<span class="st">&quot;Q&quot;</span>, Quarter, <span class="st">&quot;&#39;&quot;</span>, <span class="fu">substring</span>(<span class="fu">as.character</span>(Year),<span class="fu">nchar</span>(<span class="fu">as.character</span>(Year))<span class="sc">-</span><span class="dv">1</span>)), <span class="at">n =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb109-24"><a href="#cb109-24" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YQ =</span> <span class="fu">as.factor</span>(YQ)) <span class="sc">%&gt;%</span></span>
<span id="cb109-25"><a href="#cb109-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YQ =</span> <span class="fu">reorder_value</span>(YQ, n, <span class="cn">FALSE</span>))</span>
<span id="cb109-26"><a href="#cb109-26" tabindex="-1"></a>  </span>
<span id="cb109-27"><a href="#cb109-27" tabindex="-1"></a>scale <span class="ot">&lt;-</span> (biz <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(YQ) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="st">`</span><span class="at">Total Sales</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">sum</span>(<span class="st">`</span><span class="at">Total Sales</span><span class="st">`</span>)) <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(<span class="at">max =</span> <span class="fu">max</span>(<span class="st">`</span><span class="at">Total Sales</span><span class="st">`</span>)))<span class="sc">$</span>max</span>
<span id="cb109-28"><a href="#cb109-28" tabindex="-1"></a>  </span>
<span id="cb109-29"><a href="#cb109-29" tabindex="-1"></a>biz <span class="sc">%&gt;%</span></span>
<span id="cb109-30"><a href="#cb109-30" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb109-31"><a href="#cb109-31" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> YQ, <span class="at">y =</span> <span class="st">`</span><span class="at">Total Sales</span><span class="st">`</span>, <span class="at">fill=</span><span class="st">&quot;Total Revenue&quot;</span>), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb109-32"><a href="#cb109-32" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> YQ, <span class="at">y =</span> <span class="st">`</span><span class="at">New Sales</span><span class="st">`</span>, <span class="at">fill=</span><span class="st">&quot;New Revenue&quot;</span>), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb109-33"><a href="#cb109-33" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> YQ, <span class="at">y =</span> percent <span class="sc">*</span>scale, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb109-34"><a href="#cb109-34" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> YQ, <span class="at">y =</span> percent <span class="sc">*</span>scale, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb109-35"><a href="#cb109-35" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> YQ, <span class="at">y =</span> percent <span class="sc">*</span>scale, <span class="at">group =</span> <span class="dv">1</span>), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">color =</span> <span class="st">&quot;white&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb109-36"><a href="#cb109-36" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> YQ, <span class="at">y =</span> percent <span class="sc">*</span>scale, <span class="at">group =</span> <span class="dv">1</span>, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(percent, <span class="at">accuracy =</span> <span class="fl">0.1</span>)), <span class="at">size =</span> <span class="fl">2.5</span>, <span class="at">vjust =</span> <span class="sc">-</span><span class="fl">1.5</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb109-37"><a href="#cb109-37" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fl">4.5</span>), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb109-38"><a href="#cb109-38" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fl">8.5</span>), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb109-39"><a href="#cb109-39" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fl">12.5</span>), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>) <span class="sc">+</span></span>
<span id="cb109-40"><a href="#cb109-40" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Percentage of Revenue From New Business vs Total Revenue&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Quarter&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Revenue, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb109-41"><a href="#cb109-41" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">&quot; K&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">300e3</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">300e3</span>, <span class="fl">25e3</span>)) <span class="sc">+</span></span>
<span id="cb109-42"><a href="#cb109-42" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="st">&quot; &quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Price&quot;</span> <span class="ot">=</span> <span class="st">&quot;black&quot;</span>))<span class="sc">+</span></span>
<span id="cb109-43"><a href="#cb109-43" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Total Revenue&quot;</span> <span class="ot">=</span> <span class="st">&quot;#ADD7A0&quot;</span>, <span class="st">&quot;New Revenue&quot;</span> <span class="ot">=</span> <span class="st">&quot;#4BA15D&quot;</span>))<span class="sc">+</span></span>
<span id="cb109-44"><a href="#cb109-44" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>)),</span>
<span id="cb109-45"><a href="#cb109-45" tabindex="-1"></a>         <span class="at">linetype =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>))) <span class="sc">+</span></span>
<span id="cb109-46"><a href="#cb109-46" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.key=</span><span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb109-47"><a href="#cb109-47" tabindex="-1"></a>          <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb109-48"><a href="#cb109-48" tabindex="-1"></a>          <span class="at">legend.box=</span><span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb109-49"><a href="#cb109-49" tabindex="-1"></a>          <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>)  </span></code></pre></div>
<p><img src="index_files/figure-html/new-biz-revenue-1.png" width="100%" /></p>
</div>
<div id="which-cityregionstate-is-the-best-selling-and-most-profitable"
class="section level2">
<h2>Which city/region/state is the best selling and most
profitable?</h2>
<div id="region" class="section level3">
<h3>Region</h3>
<p>Best selling and most profitable Region for all the time in absolute
numbers.</p>
<div class="sourceCode" id="cb110"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb110-2"><a href="#cb110-2" tabindex="-1"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb110-3"><a href="#cb110-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), </span>
<span id="cb110-4"><a href="#cb110-4" tabindex="-1"></a>            <span class="at">Profit =</span> <span class="fu">sum</span>(Profit)) <span class="sc">%&gt;%</span></span>
<span id="cb110-5"><a href="#cb110-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb110-6"><a href="#cb110-6" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>Profit) <span class="sc">%&gt;%</span></span>
<span id="cb110-7"><a href="#cb110-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Sales =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Sales, <span class="at">accuracy =</span> <span class="fl">0.01</span>), </span>
<span id="cb110-8"><a href="#cb110-8" tabindex="-1"></a>         <span class="at">Profit =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Profit, <span class="at">accuracy =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb110-9"><a href="#cb110-9" tabindex="-1"></a>  <span class="fu">kbl</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Region&quot;</span>, <span class="st">&quot;Sales&quot;</span>, <span class="st">&quot;Profit&quot;</span>),</span>
<span id="cb110-10"><a href="#cb110-10" tabindex="-1"></a>      <span class="at">caption =</span> <span class="st">&quot;Total Sales and Profit by Region for all the time&quot;</span>, </span>
<span id="cb110-11"><a href="#cb110-11" tabindex="-1"></a>      <span class="at">escape =</span> F, <span class="at">align =</span> <span class="st">&quot;lrr&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb110-12"><a href="#cb110-12" tabindex="-1"></a>  <span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb110-13"><a href="#cb110-13" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;bordered&quot;</span>), <span class="at">full_width =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table class="table table-striped table-bordered" style="margin-left: auto; margin-right: auto;">
<caption>
Total Sales and Profit by Region for all the time
</caption>
<thead>
<tr>
<th style="text-align:left;text-align: center;">
Region
</th>
<th style="text-align:right;text-align: center;">
Sales
</th>
<th style="text-align:right;text-align: center;">
Profit
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
West
</td>
<td style="text-align:right;">
$725,457.82
</td>
<td style="text-align:right;">
$108,418.45
</td>
</tr>
<tr>
<td style="text-align:left;">
East
</td>
<td style="text-align:right;">
$678,499.87
</td>
<td style="text-align:right;">
$91,534.84
</td>
</tr>
<tr>
<td style="text-align:left;">
South
</td>
<td style="text-align:right;">
$391,721.90
</td>
<td style="text-align:right;">
$46,749.43
</td>
</tr>
<tr>
<td style="text-align:left;">
Central
</td>
<td style="text-align:right;">
$501,239.89
</td>
<td style="text-align:right;">
$39,706.36
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb111"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" tabindex="-1"></a><span class="co"># Most Profitable region</span></span>
<span id="cb111-2"><a href="#cb111-2" tabindex="-1"></a>plot1 <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb111-3"><a href="#cb111-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb111-4"><a href="#cb111-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Profit =</span> <span class="fu">sum</span>(Profit)) <span class="sc">%&gt;%</span></span>
<span id="cb111-5"><a href="#cb111-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb111-6"><a href="#cb111-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> Profit <span class="sc">/</span> <span class="fu">sum</span>(Profit)) <span class="sc">%&gt;%</span> </span>
<span id="cb111-7"><a href="#cb111-7" tabindex="-1"></a>  <span class="fu">arrange</span>(perc) <span class="sc">%&gt;%</span></span>
<span id="cb111-8"><a href="#cb111-8" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y=</span>perc, <span class="at">fill=</span>Region)) <span class="sc">+</span></span>
<span id="cb111-9"><a href="#cb111-9" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb111-10"><a href="#cb111-10" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>scales<span class="sc">::</span><span class="fu">percent</span>(perc)),</span>
<span id="cb111-11"><a href="#cb111-11" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb111-12"><a href="#cb111-12" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb111-13"><a href="#cb111-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Most Profitable Region for all the time&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb111-14"><a href="#cb111-14" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb111-15"><a href="#cb111-15" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb111-16"><a href="#cb111-16" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-17"><a href="#cb111-17" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-18"><a href="#cb111-18" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-19"><a href="#cb111-19" tabindex="-1"></a>        <span class="at">panel.grid  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-20"><a href="#cb111-20" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-21"><a href="#cb111-21" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-22"><a href="#cb111-22" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb111-23"><a href="#cb111-23" tabindex="-1"></a></span>
<span id="cb111-24"><a href="#cb111-24" tabindex="-1"></a><span class="co"># Which region makes most total losses?</span></span>
<span id="cb111-25"><a href="#cb111-25" tabindex="-1"></a>plot2 <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb111-26"><a href="#cb111-26" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb111-27"><a href="#cb111-27" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Profit =</span> <span class="fu">sum</span>(Profit), <span class="at">Region =</span> <span class="fu">first</span>(Region)) <span class="sc">%&gt;%</span></span>
<span id="cb111-28"><a href="#cb111-28" tabindex="-1"></a>  <span class="fu">group_by</span>(Region) <span class="sc">%&gt;%</span></span>
<span id="cb111-29"><a href="#cb111-29" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">perc_losses =</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>[Profit <span class="sc">&lt;</span> <span class="dv">0</span>])<span class="sc">/</span><span class="fu">n</span>(),</span>
<span id="cb111-30"><a href="#cb111-30" tabindex="-1"></a>            <span class="at">losses_count =</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>[Profit <span class="sc">&lt;</span> <span class="dv">0</span>]),</span>
<span id="cb111-31"><a href="#cb111-31" tabindex="-1"></a>            <span class="at">total_count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb111-32"><a href="#cb111-32" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y=</span>perc_losses, <span class="at">fill=</span>Region)) <span class="sc">+</span></span>
<span id="cb111-33"><a href="#cb111-33" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb111-34"><a href="#cb111-34" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>scales<span class="sc">::</span><span class="fu">percent</span>(perc_losses)),</span>
<span id="cb111-35"><a href="#cb111-35" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb111-36"><a href="#cb111-36" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb111-37"><a href="#cb111-37" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;# of Loss orders by Region&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb111-38"><a href="#cb111-38" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb111-39"><a href="#cb111-39" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb111-40"><a href="#cb111-40" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-41"><a href="#cb111-41" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-42"><a href="#cb111-42" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-43"><a href="#cb111-43" tabindex="-1"></a>        <span class="at">panel.grid  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-44"><a href="#cb111-44" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-45"><a href="#cb111-45" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb111-46"><a href="#cb111-46" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span>
<span id="cb111-47"><a href="#cb111-47" tabindex="-1"></a>  </span>
<span id="cb111-48"><a href="#cb111-48" tabindex="-1"></a>plot1</span>
<span id="cb111-49"><a href="#cb111-49" tabindex="-1"></a>plot2</span></code></pre></div>
<p><img src="index_files/figure-html/profitable-region-1.png" width="50%" /><img src="index_files/figure-html/profitable-region-2.png" width="50%" /></p>
<p>Our observations are: + The most profitable <strong>Region</strong>
is West. It is almost 38% of Profit. The less profitable region is
Central Region. + West Region has less number of loss orders, and
Central Region has the most number os loss orders. + East Region has
almost 1/3 part of total profit, but the region has high number of loss
orders.</p>
<div id="what-are-yoy-sales-and-profit-growth-by-region"
class="section level4">
<h4>What are YoY Sales and Profit growth by Region?</h4>
<div class="sourceCode" id="cb112"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" tabindex="-1"></a>YoY_reg <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb112-2"><a href="#cb112-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb112-3"><a href="#cb112-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Region, Year) <span class="sc">%&gt;%</span></span>
<span id="cb112-4"><a href="#cb112-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales),</span>
<span id="cb112-5"><a href="#cb112-5" tabindex="-1"></a>            <span class="at">Profit =</span> <span class="fu">sum</span>(Profit)) <span class="sc">%&gt;%</span></span>
<span id="cb112-6"><a href="#cb112-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YoY_Growth_Sales =</span> (Sales <span class="sc">-</span> <span class="fu">lag</span>(Sales))<span class="sc">/</span><span class="fu">lag</span>(Sales),</span>
<span id="cb112-7"><a href="#cb112-7" tabindex="-1"></a>         <span class="at">YoY_Growth_Profit =</span> (Profit <span class="sc">-</span> <span class="fu">lag</span>(Profit))<span class="sc">/</span><span class="fu">abs</span>(<span class="fu">lag</span>(Profit)))</span>
<span id="cb112-8"><a href="#cb112-8" tabindex="-1"></a></span>
<span id="cb112-9"><a href="#cb112-9" tabindex="-1"></a>reg_table <span class="ot">&lt;-</span> YoY_reg <span class="sc">%&gt;%</span></span>
<span id="cb112-10"><a href="#cb112-10" tabindex="-1"></a><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span>, <span class="st">&quot;Profit&quot;</span>, <span class="st">&quot;YoY_Growth_Sales&quot;</span>, <span class="st">&quot;YoY_Growth_Profit&quot;</span>))</span>
<span id="cb112-11"><a href="#cb112-11" tabindex="-1"></a></span>
<span id="cb112-12"><a href="#cb112-12" tabindex="-1"></a>sales_columns <span class="ot">&lt;-</span> reg_table <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;Sales&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb112-13"><a href="#cb112-13" tabindex="-1"></a>profit_columns <span class="ot">&lt;-</span> reg_table <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;Profit&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb112-14"><a href="#cb112-14" tabindex="-1"></a>yoy_sales_columns <span class="ot">&lt;-</span> reg_table <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;YoY_Growth_Sales_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb112-15"><a href="#cb112-15" tabindex="-1"></a>yoy_profit_columns <span class="ot">&lt;-</span> reg_table <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;YoY_Growth_Profit_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb112-16"><a href="#cb112-16" tabindex="-1"></a></span>
<span id="cb112-17"><a href="#cb112-17" tabindex="-1"></a>reg_table <span class="sc">%&gt;%</span> <span class="fu">select</span>(sales_columns, profit_columns) <span class="sc">%&gt;%</span></span>
<span id="cb112-18"><a href="#cb112-18" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">dollar</span>(., <span class="at">accurate =</span> <span class="fl">0.01</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb112-19"><a href="#cb112-19" tabindex="-1"></a><span class="fu">kbl</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Region&quot;</span>, <span class="fu">as.character</span>(<span class="dv">2014</span><span class="sc">:</span><span class="dv">2017</span>), <span class="fu">as.character</span>(<span class="dv">2014</span><span class="sc">:</span><span class="dv">2017</span>)),</span>
<span id="cb112-20"><a href="#cb112-20" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Sales and Profit by Region&quot;</span>,</span>
<span id="cb112-21"><a href="#cb112-21" tabindex="-1"></a>    <span class="at">escape =</span> F,</span>
<span id="cb112-22"><a href="#cb112-22" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&quot;l&quot;</span>, <span class="fu">rep</span>(<span class="st">&#39;r&#39;</span>,<span class="at">times=</span><span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb112-23"><a href="#cb112-23" tabindex="-1"></a><span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb112-24"><a href="#cb112-24" tabindex="-1"></a><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;bordered&quot;</span>), <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb112-25"><a href="#cb112-25" tabindex="-1"></a><span class="fu">add_header_above</span>(<span class="at">header =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;Sales&quot;</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">&quot;Profit&quot;</span> <span class="ot">=</span> <span class="dv">4</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">border_left =</span> <span class="cn">TRUE</span>, <span class="at">border_right =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table class="table table-striped table-bordered" style="margin-left: auto; margin-right: auto;">
<caption>
Sales and Profit by Region
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; font-weight: bold; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Sales
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; font-weight: bold; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Profit
</div>
</th>
</tr>
<tr>
<th style="text-align:left;text-align: center;">
Region
</th>
<th style="text-align:right;text-align: center;">
2014
</th>
<th style="text-align:right;text-align: center;">
2015
</th>
<th style="text-align:right;text-align: center;">
2016
</th>
<th style="text-align:right;text-align: center;">
2017
</th>
<th style="text-align:right;text-align: center;">
2014
</th>
<th style="text-align:right;text-align: center;">
2015
</th>
<th style="text-align:right;text-align: center;">
2016
</th>
<th style="text-align:right;text-align: center;">
2017
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Central
</td>
<td style="text-align:right;">
$103,838
</td>
<td style="text-align:right;">
$102,874
</td>
<td style="text-align:right;">
$147,429
</td>
<td style="text-align:right;">
$147,098
</td>
<td style="text-align:right;">
$539.55
</td>
<td style="text-align:right;">
$11,716.80
</td>
<td style="text-align:right;">
$19,899.16
</td>
<td style="text-align:right;">
$7,550.84
</td>
</tr>
<tr>
<td style="text-align:left;">
East
</td>
<td style="text-align:right;">
$128,399
</td>
<td style="text-align:right;">
$156,332
</td>
<td style="text-align:right;">
$180,686
</td>
<td style="text-align:right;">
$213,083
</td>
<td style="text-align:right;">
$17,071.67
</td>
<td style="text-align:right;">
$21,091.01
</td>
<td style="text-align:right;">
$20,141.60
</td>
<td style="text-align:right;">
$33,230.56
</td>
</tr>
<tr>
<td style="text-align:left;">
South
</td>
<td style="text-align:right;">
$103,846
</td>
<td style="text-align:right;">
$71,359.98
</td>
<td style="text-align:right;">
$93,610.22
</td>
<td style="text-align:right;">
$122,906
</td>
<td style="text-align:right;">
$11,879.12
</td>
<td style="text-align:right;">
$8,318.59
</td>
<td style="text-align:right;">
$17,702.81
</td>
<td style="text-align:right;">
$8,848.91
</td>
</tr>
<tr>
<td style="text-align:left;">
West
</td>
<td style="text-align:right;">
$147,883
</td>
<td style="text-align:right;">
$139,966
</td>
<td style="text-align:right;">
$187,480
</td>
<td style="text-align:right;">
$250,128
</td>
<td style="text-align:right;">
$20,065.69
</td>
<td style="text-align:right;">
$20,492.19
</td>
<td style="text-align:right;">
$24,051.61
</td>
<td style="text-align:right;">
$43,808.96
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb113"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" tabindex="-1"></a>yoy_growth_columns <span class="ot">&lt;-</span> reg_table <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;YoY_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb113-2"><a href="#cb113-2" tabindex="-1"></a>reg_table <span class="sc">%&gt;%</span> <span class="fu">select</span>(yoy_growth_columns) <span class="sc">%&gt;%</span></span>
<span id="cb113-3"><a href="#cb113-3" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span><span class="fu">cell_spec</span>(scales<span class="sc">::</span><span class="fu">percent</span>(., <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="st">&quot;html&quot;</span>, <span class="at">color=</span><span class="fu">case_when</span>(. <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb113-4"><a href="#cb113-4" tabindex="-1"></a>                                                   . <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;green&quot;</span>,</span>
<span id="cb113-5"><a href="#cb113-5" tabindex="-1"></a>                                                   <span class="fu">is.na</span>(.) <span class="sc">~</span> <span class="st">&quot;lightgray&quot;</span>,</span>
<span id="cb113-6"><a href="#cb113-6" tabindex="-1"></a>                                                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;black&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb113-7"><a href="#cb113-7" tabindex="-1"></a><span class="fu">kbl</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Region&quot;</span>, <span class="fu">as.character</span>(<span class="dv">2014</span><span class="sc">:</span><span class="dv">2017</span>), <span class="fu">as.character</span>(<span class="dv">2014</span><span class="sc">:</span><span class="dv">2017</span>)),</span>
<span id="cb113-8"><a href="#cb113-8" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Year over the year Sales and Profit growth by Region&quot;</span>,</span>
<span id="cb113-9"><a href="#cb113-9" tabindex="-1"></a>    <span class="at">escape =</span> F,</span>
<span id="cb113-10"><a href="#cb113-10" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&quot;l&quot;</span>, <span class="fu">rep</span>(<span class="st">&#39;r&#39;</span>,<span class="at">times=</span><span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb113-11"><a href="#cb113-11" tabindex="-1"></a><span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb113-12"><a href="#cb113-12" tabindex="-1"></a><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;bordered&quot;</span>), <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb113-13"><a href="#cb113-13" tabindex="-1"></a><span class="fu">add_header_above</span>(<span class="at">header =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;YoY Sales Growth&quot;</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">&quot;YoY Profit Growth&quot;</span> <span class="ot">=</span> <span class="dv">4</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">border_left =</span> <span class="cn">TRUE</span>, <span class="at">border_right =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table class="table table-striped table-bordered" style="margin-left: auto; margin-right: auto;">
<caption>
Year over the year Sales and Profit growth by Region
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; font-weight: bold; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
YoY Sales Growth
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; font-weight: bold; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
YoY Profit Growth
</div>
</th>
</tr>
<tr>
<th style="text-align:left;text-align: center;">
Region
</th>
<th style="text-align:right;text-align: center;">
2014
</th>
<th style="text-align:right;text-align: center;">
2015
</th>
<th style="text-align:right;text-align: center;">
2016
</th>
<th style="text-align:right;text-align: center;">
2017
</th>
<th style="text-align:right;text-align: center;">
2014
</th>
<th style="text-align:right;text-align: center;">
2015
</th>
<th style="text-align:right;text-align: center;">
2016
</th>
<th style="text-align:right;text-align: center;">
2017
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Central
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-0.9%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">43.3%</span>
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-0.2%</span>
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">2 071.6%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">69.8%</span>
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-62.1%</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
East
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">21.8%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">15.6%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">17.9%</span>
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">23.5%</span>
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-4.5%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">65.0%</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
South
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-31.3%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">31.2%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">31.3%</span>
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-30.0%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">112.8%</span>
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-50.0%</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
West
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-5.4%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">33.9%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">33.4%</span>
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">2.1%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">17.4%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">82.1%</span>
</td>
</tr>
</tbody>
</table>
</div>
<div id="yoy-sales-growth-1" class="section level4">
<h4>YoY Sales Growth</h4>
<div class="sourceCode" id="cb114"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" tabindex="-1"></a>YoY_reg <span class="sc">%&gt;%</span></span>
<span id="cb114-2"><a href="#cb114-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb114-3"><a href="#cb114-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>Sales, <span class="at">fill=</span>Region, <span class="at">group=</span>Region), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb114-4"><a href="#cb114-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_Growth_Sales<span class="sc">*</span><span class="fu">max</span>(YoY_reg<span class="sc">$</span>Sales[YoY_reg<span class="sc">$</span>Year <span class="sc">==</span> Year]), <span class="at">group=</span>Region)) <span class="sc">+</span></span>
<span id="cb114-5"><a href="#cb114-5" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_Growth_Sales<span class="sc">*</span><span class="fu">max</span>(YoY_reg<span class="sc">$</span>Sales[YoY_reg<span class="sc">$</span>Year <span class="sc">==</span> Year]), <span class="at">group=</span>Region), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb114-6"><a href="#cb114-6" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_Growth_Sales<span class="sc">*</span><span class="fu">max</span>(YoY_reg<span class="sc">$</span>Sales[YoY_reg<span class="sc">$</span>Year <span class="sc">==</span> Year]), <span class="at">group=</span>Region), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb114-7"><a href="#cb114-7" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_Growth_Sales<span class="sc">*</span><span class="fu">max</span>(YoY_reg<span class="sc">$</span>Sales[YoY_reg<span class="sc">$</span>Year <span class="sc">==</span> Year]), </span>
<span id="cb114-8"><a href="#cb114-8" tabindex="-1"></a>                <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth_Sales, <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="at">group=</span>Region), <span class="at">vjust=</span><span class="sc">-</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb114-9"><a href="#cb114-9" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot; K&quot;</span>)) <span class="sc">+</span></span>
<span id="cb114-10"><a href="#cb114-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;YoY Sales Growth by Region&quot;</span>, <span class="at">x=</span><span class="st">&quot;Year&quot;</span>, <span class="at">y=</span><span class="st">&quot;Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb114-11"><a href="#cb114-11" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb114-12"><a href="#cb114-12" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Region) <span class="sc">+</span> </span>
<span id="cb114-13"><a href="#cb114-13" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb114-14"><a href="#cb114-14" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb114-15"><a href="#cb114-15" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/yoy-sales-region-plot-1.png" width="100%" /></p>
</div>
<div id="yoy-profit-growth-1" class="section level4">
<h4>YoY Profit Growth</h4>
<div class="sourceCode" id="cb115"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" tabindex="-1"></a>YoY_reg <span class="sc">%&gt;%</span></span>
<span id="cb115-2"><a href="#cb115-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb115-3"><a href="#cb115-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>Profit, <span class="at">fill=</span>Region, <span class="at">group=</span>Region), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb115-4"><a href="#cb115-4" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_Growth_Profit<span class="sc">*</span><span class="fu">max</span>(YoY_reg<span class="sc">$</span>Profit[YoY_reg<span class="sc">$</span>Year <span class="sc">==</span> Year]) <span class="sc">*</span></span>
<span id="cb115-5"><a href="#cb115-5" tabindex="-1"></a>                              <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2015</span> <span class="sc">&amp;</span> Region <span class="sc">==</span> <span class="st">&quot;Central&quot;</span>, <span class="fl">0.05</span>, <span class="dv">1</span>), <span class="at">group=</span>Region)) <span class="sc">+</span></span>
<span id="cb115-6"><a href="#cb115-6" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_Growth_Profit<span class="sc">*</span><span class="fu">max</span>(YoY_reg<span class="sc">$</span>Profit[YoY_reg<span class="sc">$</span>Year <span class="sc">==</span> Year]) <span class="sc">*</span></span>
<span id="cb115-7"><a href="#cb115-7" tabindex="-1"></a>                              <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2015</span> <span class="sc">&amp;</span> Region <span class="sc">==</span> <span class="st">&quot;Central&quot;</span>, <span class="fl">0.05</span>, <span class="dv">1</span>), <span class="at">group=</span>Region), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb115-8"><a href="#cb115-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_Growth_Profit<span class="sc">*</span><span class="fu">max</span>(YoY_reg<span class="sc">$</span>Profit[YoY_reg<span class="sc">$</span>Year <span class="sc">==</span> Year]) <span class="sc">*</span></span>
<span id="cb115-9"><a href="#cb115-9" tabindex="-1"></a>                              <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2015</span> <span class="sc">&amp;</span> Region <span class="sc">==</span> <span class="st">&quot;Central&quot;</span>, <span class="fl">0.05</span>, <span class="dv">1</span>), <span class="at">group=</span>Region), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb115-10"><a href="#cb115-10" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>YoY_Growth_Profit<span class="sc">*</span><span class="fu">max</span>(YoY_reg<span class="sc">$</span>Profit[YoY_reg<span class="sc">$</span>Year <span class="sc">==</span> Year]) <span class="sc">*</span></span>
<span id="cb115-11"><a href="#cb115-11" tabindex="-1"></a>                              <span class="fu">ifelse</span>(Year <span class="sc">==</span> <span class="dv">2015</span> <span class="sc">&amp;</span> Region <span class="sc">==</span> <span class="st">&quot;Central&quot;</span>, <span class="fl">0.05</span>, <span class="dv">1</span>), </span>
<span id="cb115-12"><a href="#cb115-12" tabindex="-1"></a>                <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth_Profit, <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="at">group=</span>Region), <span class="at">vjust=</span><span class="sc">-</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb115-13"><a href="#cb115-13" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot; K&quot;</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">30e3</span>, <span class="fl">70e3</span>)) <span class="sc">+</span></span>
<span id="cb115-14"><a href="#cb115-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;YoY Profit Growth by Region&quot;</span>, <span class="at">x=</span><span class="st">&quot;Year&quot;</span>, <span class="at">y=</span><span class="st">&quot;Profit, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb115-15"><a href="#cb115-15" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb115-16"><a href="#cb115-16" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Region) <span class="sc">+</span> </span>
<span id="cb115-17"><a href="#cb115-17" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb115-18"><a href="#cb115-18" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb115-19"><a href="#cb115-19" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/yoy-profit-region-plot-1.png" width="100%" /></p>
</div>
<div id="yoy-losses-orders-growth" class="section level4">
<h4>YoY Losses Orders Growth</h4>
<div class="sourceCode" id="cb116"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" tabindex="-1"></a>losses <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb116-2"><a href="#cb116-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.factor</span>(<span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb116-3"><a href="#cb116-3" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb116-4"><a href="#cb116-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Profit =</span> <span class="fu">sum</span>(Profit), <span class="at">Region =</span> <span class="fu">first</span>(Region), <span class="at">Year =</span> <span class="fu">first</span>(Year)) <span class="sc">%&gt;%</span></span>
<span id="cb116-5"><a href="#cb116-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb116-6"><a href="#cb116-6" tabindex="-1"></a>  <span class="fu">group_by</span>(Region, Year) <span class="sc">%&gt;%</span></span>
<span id="cb116-7"><a href="#cb116-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">losses =</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>[Profit <span class="sc">&lt;</span> <span class="dv">0</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb116-8"><a href="#cb116-8" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="st">`</span><span class="at">YoY Growth</span><span class="st">`</span> <span class="ot">=</span> (losses <span class="sc">-</span> <span class="fu">lag</span>(losses))<span class="sc">/</span><span class="fu">lag</span>(losses)) </span>
<span id="cb116-9"><a href="#cb116-9" tabindex="-1"></a></span>
<span id="cb116-10"><a href="#cb116-10" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="fu">max</span>(losses<span class="sc">$</span>losses)</span>
<span id="cb116-11"><a href="#cb116-11" tabindex="-1"></a></span>
<span id="cb116-12"><a href="#cb116-12" tabindex="-1"></a>losses <span class="sc">%&gt;%</span></span>
<span id="cb116-13"><a href="#cb116-13" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb116-14"><a href="#cb116-14" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>losses, <span class="at">fill=</span>Region, <span class="at">group=</span>Region), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb116-15"><a href="#cb116-15" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span><span class="st">`</span><span class="at">YoY Growth</span><span class="st">`</span> <span class="sc">*</span> scale, <span class="at">group=</span>Region)) <span class="sc">+</span></span>
<span id="cb116-16"><a href="#cb116-16" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span><span class="st">`</span><span class="at">YoY Growth</span><span class="st">`</span> <span class="sc">*</span> scale, <span class="at">group=</span>Region), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb116-17"><a href="#cb116-17" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span><span class="st">`</span><span class="at">YoY Growth</span><span class="st">`</span> <span class="sc">*</span> scale, <span class="at">group=</span>Region), <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">1.5</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb116-18"><a href="#cb116-18" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span><span class="st">`</span><span class="at">YoY Growth</span><span class="st">`</span> <span class="sc">*</span> scale, <span class="at">group=</span>Region, <span class="at">label=</span>scales<span class="sc">::</span><span class="fu">percent</span>(<span class="st">`</span><span class="at">YoY Growth</span><span class="st">`</span>, <span class="at">accuracy =</span> <span class="fl">0.1</span>)), <span class="at">vjust=</span><span class="sc">-</span><span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb116-19"><a href="#cb116-19" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">15</span>, <span class="dv">150</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">150</span>, <span class="dv">25</span>)) <span class="sc">+</span></span>
<span id="cb116-20"><a href="#cb116-20" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;YoY # of losable orders Growth by Region&quot;</span>, <span class="at">x=</span><span class="st">&quot;Year&quot;</span>, <span class="at">y=</span><span class="st">&quot;# of Losable Orders&quot;</span>) <span class="sc">+</span></span>
<span id="cb116-21"><a href="#cb116-21" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb116-22"><a href="#cb116-22" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Region) <span class="sc">+</span></span>
<span id="cb116-23"><a href="#cb116-23" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb116-24"><a href="#cb116-24" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb116-25"><a href="#cb116-25" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/yoy-losable-region-plot-1.png" width="100%" /></p>
</div>
</div>
<div id="city" class="section level3">
<h3>City</h3>
<div class="sourceCode" id="cb117"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" tabindex="-1"></a>df_cities <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb117-2"><a href="#cb117-2" tabindex="-1"></a>  <span class="fu">group_by</span>(City) <span class="sc">%&gt;%</span></span>
<span id="cb117-3"><a href="#cb117-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), <span class="at">Profit =</span> <span class="fu">sum</span>(Profit), <span class="at">Quantity =</span> <span class="fu">sum</span>(Quantity))</span></code></pre></div>
<div id="what-are-top-profitable-cities" class="section level4">
<h4>What are top profitable Cities?</h4>
<div class="sourceCode" id="cb118"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" tabindex="-1"></a>df_cities <span class="sc">%&gt;%</span></span>
<span id="cb118-2"><a href="#cb118-2" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>Profit) <span class="sc">%&gt;%</span></span>
<span id="cb118-3"><a href="#cb118-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">City =</span> <span class="fu">reorder_value</span>(City, Profit, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb118-4"><a href="#cb118-4" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-5"><a href="#cb118-5" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(Sales, Profit), <span class="at">names_to =</span> <span class="st">&quot;Name&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb118-6"><a href="#cb118-6" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb118-7"><a href="#cb118-7" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> City, <span class="at">y =</span> Value, <span class="at">fill=</span>Name), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb118-8"><a href="#cb118-8" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>City, <span class="at">y=</span>Value, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Value, <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="at">group=</span>Name), <span class="at">size=</span><span class="fl">2.5</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb118-9"><a href="#cb118-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Top 10 most profitable Cities&quot;</span>, <span class="at">x =</span> <span class="st">&quot;City&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Profit &amp; Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb118-10"><a href="#cb118-10" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">&quot; K&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">300e3</span>, <span class="at">by =</span> <span class="fl">50e3</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">300e3</span>)) <span class="sc">+</span></span>
<span id="cb118-11"><a href="#cb118-11" tabindex="-1"></a>   <span class="fu">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span> <span class="ot">=</span> <span class="st">&quot;#ADD7A0&quot;</span>, <span class="st">&quot;Profit&quot;</span> <span class="ot">=</span> <span class="st">&quot;#4BA15D&quot;</span>))<span class="sc">+</span></span>
<span id="cb118-12"><a href="#cb118-12" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>)),</span>
<span id="cb118-13"><a href="#cb118-13" tabindex="-1"></a>         <span class="at">linetype =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>))) <span class="sc">+</span></span>
<span id="cb118-14"><a href="#cb118-14" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.key=</span><span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb118-15"><a href="#cb118-15" tabindex="-1"></a>          <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb118-16"><a href="#cb118-16" tabindex="-1"></a>          <span class="at">legend.box=</span><span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb118-17"><a href="#cb118-17" tabindex="-1"></a>          <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb118-18"><a href="#cb118-18" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/top-prof-cities-1.png" width="100%" /></p>
</div>
<div id="what-are-bottom-profitable-cities" class="section level4">
<h4>What are bottom profitable Cities?</h4>
<div class="sourceCode" id="cb119"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" tabindex="-1"></a>df_cities <span class="sc">%&gt;%</span></span>
<span id="cb119-2"><a href="#cb119-2" tabindex="-1"></a>  <span class="fu">arrange</span>(Profit) <span class="sc">%&gt;%</span></span>
<span id="cb119-3"><a href="#cb119-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">City =</span> <span class="fu">reorder_value</span>(City, Profit, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb119-4"><a href="#cb119-4" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-5"><a href="#cb119-5" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(Sales, Profit), <span class="at">names_to =</span> <span class="st">&quot;Name&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb119-6"><a href="#cb119-6" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb119-7"><a href="#cb119-7" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> City, <span class="at">y =</span> Value, <span class="at">fill=</span>Name), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb119-8"><a href="#cb119-8" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>City, <span class="at">y=</span>Value, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Value, <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="at">group=</span>Name,</span>
<span id="cb119-9"><a href="#cb119-9" tabindex="-1"></a>                <span class="at">hjust =</span> <span class="fu">ifelse</span>(Value <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="fl">1.1</span>, <span class="sc">-</span><span class="fl">0.1</span>)), <span class="at">size=</span><span class="fl">2.5</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb119-10"><a href="#cb119-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Bottom 10 most profitable Cities&quot;</span>, <span class="at">x =</span> <span class="st">&quot;State&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Profit &amp; Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb119-11"><a href="#cb119-11" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">&quot; K&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">50e3</span>, <span class="fl">200e3</span>, <span class="at">by =</span> <span class="fl">25e3</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">50e3</span>, <span class="fl">200e3</span>)) <span class="sc">+</span></span>
<span id="cb119-12"><a href="#cb119-12" tabindex="-1"></a>   <span class="fu">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span> <span class="ot">=</span> <span class="st">&quot;#ADD7A0&quot;</span>, <span class="st">&quot;Profit&quot;</span> <span class="ot">=</span> <span class="st">&quot;#4BA15D&quot;</span>))<span class="sc">+</span></span>
<span id="cb119-13"><a href="#cb119-13" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>)),</span>
<span id="cb119-14"><a href="#cb119-14" tabindex="-1"></a>         <span class="at">linetype =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>))) <span class="sc">+</span></span>
<span id="cb119-15"><a href="#cb119-15" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.key=</span><span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb119-16"><a href="#cb119-16" tabindex="-1"></a>          <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb119-17"><a href="#cb119-17" tabindex="-1"></a>          <span class="at">legend.box=</span><span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb119-18"><a href="#cb119-18" tabindex="-1"></a>          <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb119-19"><a href="#cb119-19" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/bottom-prof-cities-1.png" width="100%" /></p>
</div>
</div>
<div id="state" class="section level3">
<h3>State</h3>
<div class="sourceCode" id="cb120"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="#cb120-1" tabindex="-1"></a>df_states <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb120-2"><a href="#cb120-2" tabindex="-1"></a>  <span class="fu">group_by</span>(State) <span class="sc">%&gt;%</span></span>
<span id="cb120-3"><a href="#cb120-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), <span class="at">Profit =</span> <span class="fu">sum</span>(Profit), <span class="at">Quantity =</span> <span class="fu">sum</span>(Quantity))</span></code></pre></div>
<div id="what-are-top-profitable-states" class="section level4">
<h4>What are top profitable States?</h4>
<div class="sourceCode" id="cb121"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" tabindex="-1"></a>df_states <span class="sc">%&gt;%</span></span>
<span id="cb121-2"><a href="#cb121-2" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>Profit) <span class="sc">%&gt;%</span></span>
<span id="cb121-3"><a href="#cb121-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="fu">reorder_value</span>(State, Profit, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb121-4"><a href="#cb121-4" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-5"><a href="#cb121-5" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(Sales, Profit), <span class="at">names_to =</span> <span class="st">&quot;Name&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb121-6"><a href="#cb121-6" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb121-7"><a href="#cb121-7" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> State, <span class="at">y =</span> Value, <span class="at">fill=</span>Name), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb121-8"><a href="#cb121-8" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>State, <span class="at">y=</span>Value, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Value, <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="at">group=</span>Name), <span class="at">size=</span><span class="fl">2.5</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>), <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span>) <span class="sc">+</span></span>
<span id="cb121-9"><a href="#cb121-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Top 10 most profitable States&quot;</span>, <span class="at">x =</span> <span class="st">&quot;State&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Profit &amp; Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb121-10"><a href="#cb121-10" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">&quot; K&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">500e3</span>, <span class="at">by =</span> <span class="fl">50e3</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">500e3</span>)) <span class="sc">+</span></span>
<span id="cb121-11"><a href="#cb121-11" tabindex="-1"></a>   <span class="fu">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span> <span class="ot">=</span> <span class="st">&quot;#ADD7A0&quot;</span>, <span class="st">&quot;Profit&quot;</span> <span class="ot">=</span> <span class="st">&quot;#4BA15D&quot;</span>))<span class="sc">+</span></span>
<span id="cb121-12"><a href="#cb121-12" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>)),</span>
<span id="cb121-13"><a href="#cb121-13" tabindex="-1"></a>         <span class="at">linetype =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>))) <span class="sc">+</span></span>
<span id="cb121-14"><a href="#cb121-14" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.key=</span><span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb121-15"><a href="#cb121-15" tabindex="-1"></a>          <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb121-16"><a href="#cb121-16" tabindex="-1"></a>          <span class="at">legend.box=</span><span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb121-17"><a href="#cb121-17" tabindex="-1"></a>          <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb121-18"><a href="#cb121-18" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/top-states-plot-1.png" width="100%" /></p>
</div>
<div id="what-are-bottom-profitable-states" class="section level4">
<h4>What are bottom profitable States?</h4>
<div class="sourceCode" id="cb122"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" tabindex="-1"></a>df_states <span class="sc">%&gt;%</span></span>
<span id="cb122-2"><a href="#cb122-2" tabindex="-1"></a>  <span class="fu">arrange</span>(Profit) <span class="sc">%&gt;%</span></span>
<span id="cb122-3"><a href="#cb122-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">State =</span> <span class="fu">reorder_value</span>(State, Profit, <span class="cn">FALSE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb122-4"><a href="#cb122-4" tabindex="-1"></a>  <span class="fu">head</span>(<span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb122-5"><a href="#cb122-5" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(Sales, Profit), <span class="at">names_to =</span> <span class="st">&quot;Name&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb122-6"><a href="#cb122-6" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb122-7"><a href="#cb122-7" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> State, <span class="at">y =</span> Value, <span class="at">fill=</span>Name), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb122-8"><a href="#cb122-8" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x=</span>State, <span class="at">y=</span>Value, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Value, <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="at">group=</span>Name,</span>
<span id="cb122-9"><a href="#cb122-9" tabindex="-1"></a>                <span class="at">hjust =</span> <span class="fu">ifelse</span>(Value <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="fl">1.1</span>, <span class="sc">-</span><span class="fl">0.1</span>)), <span class="at">size=</span><span class="fl">2.5</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb122-10"><a href="#cb122-10" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Bottom 10 most profitable States&quot;</span>, <span class="at">x =</span> <span class="st">&quot;State&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Profit &amp; Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb122-11"><a href="#cb122-11" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">suffix =</span> <span class="st">&quot; K&quot;</span>, <span class="at">scale =</span> <span class="fl">1e-3</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">50e3</span>, <span class="fl">200e3</span>, <span class="at">by =</span> <span class="fl">25e3</span>), <span class="at">limits=</span><span class="fu">c</span>(<span class="sc">-</span><span class="fl">50e3</span>, <span class="fl">200e3</span>)) <span class="sc">+</span></span>
<span id="cb122-12"><a href="#cb122-12" tabindex="-1"></a>   <span class="fu">scale_fill_manual</span>(<span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span> <span class="ot">=</span> <span class="st">&quot;#ADD7A0&quot;</span>, <span class="st">&quot;Profit&quot;</span> <span class="ot">=</span> <span class="st">&quot;#4BA15D&quot;</span>))<span class="sc">+</span></span>
<span id="cb122-13"><a href="#cb122-13" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>)),</span>
<span id="cb122-14"><a href="#cb122-14" tabindex="-1"></a>         <span class="at">linetype =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">fill =</span> <span class="cn">NA</span>))) <span class="sc">+</span></span>
<span id="cb122-15"><a href="#cb122-15" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.key=</span><span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">color=</span><span class="st">&quot;white&quot;</span>),</span>
<span id="cb122-16"><a href="#cb122-16" tabindex="-1"></a>          <span class="at">legend.title=</span><span class="fu">element_blank</span>(),</span>
<span id="cb122-17"><a href="#cb122-17" tabindex="-1"></a>          <span class="at">legend.box=</span><span class="st">&quot;horizontal&quot;</span>,</span>
<span id="cb122-18"><a href="#cb122-18" tabindex="-1"></a>          <span class="at">legend.position=</span><span class="st">&quot;bottom&quot;</span>) <span class="sc">+</span></span>
<span id="cb122-19"><a href="#cb122-19" tabindex="-1"></a>  <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="index_files/figure-html/bottom-states-plot-1.png" width="100%" /></p>
</div>
</div>
</div>
<div id="which-is-the-preferred-ship-mode" class="section level2">
<h2>Which is the preferred ship mode?</h2>
<div class="sourceCode" id="cb123"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb123-2"><a href="#cb123-2" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Ship Mode</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb123-3"><a href="#cb123-3" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">count =</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb123-4"><a href="#cb123-4" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb123-5"><a href="#cb123-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">perc =</span> count <span class="sc">/</span> <span class="fu">sum</span>(count)) <span class="sc">%&gt;%</span> </span>
<span id="cb123-6"><a href="#cb123-6" tabindex="-1"></a>  <span class="fu">arrange</span>(perc) <span class="sc">%&gt;%</span></span>
<span id="cb123-7"><a href="#cb123-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent</span>(perc)) <span class="sc">%&gt;%</span></span>
<span id="cb123-8"><a href="#cb123-8" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="st">&quot;&quot;</span>, <span class="at">y=</span>perc, <span class="at">fill=</span><span class="st">`</span><span class="at">Ship Mode</span><span class="st">`</span>)) <span class="sc">+</span></span>
<span id="cb123-9"><a href="#cb123-9" tabindex="-1"></a>  <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb123-10"><a href="#cb123-10" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label =</span> labels),</span>
<span id="cb123-11"><a href="#cb123-11" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb123-12"><a href="#cb123-12" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-13"><a href="#cb123-13" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Most preferred Ship Mode&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-14"><a href="#cb123-14" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb123-15"><a href="#cb123-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb123-16"><a href="#cb123-16" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb123-17"><a href="#cb123-17" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb123-18"><a href="#cb123-18" tabindex="-1"></a>        <span class="at">panel.grid  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb123-19"><a href="#cb123-19" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb123-20"><a href="#cb123-20" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="index_files/figure-html/preferred-ship-mode-1.png" width="100%" /></p>
</div>
<div id="customer-segment" class="section level2">
<h2>Customer Segment</h2>
<p>The questions we are trying to answer:</p>
<ul>
<li>What size of customer segments?</li>
<li>Which customer segment is the best selling for all the time?</li>
<li>Which customer segment is the most profitable for all the time?</li>
<li>What is year over year Sales growth of customer segments for the
latest year?</li>
<li>What is year over year Profit growth of customer segments for the
latest year?</li>
<li>Which customer segment makes more losses for all the time?</li>
<li>What is year over year losses growth of customer segment for the
lateast year?</li>
</ul>
<div class="sourceCode" id="cb124"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" tabindex="-1"></a><span class="co"># total pivot table by segment</span></span>
<span id="cb124-2"><a href="#cb124-2" tabindex="-1"></a>total_pivottable_segment <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb124-3"><a href="#cb124-3" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb124-4"><a href="#cb124-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), <span class="at">Profit =</span> <span class="fu">sum</span>(Profit), <span class="at">Segment =</span> <span class="fu">first</span>(Segment), <span class="st">`</span><span class="at">Customer ID</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">first</span>(<span class="st">`</span><span class="at">Customer ID</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb124-5"><a href="#cb124-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb124-6"><a href="#cb124-6" tabindex="-1"></a>  <span class="fu">group_by</span>(Segment) <span class="sc">%&gt;%</span></span>
<span id="cb124-7"><a href="#cb124-7" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">sum</span>(Sales), <span class="at">Profit =</span> <span class="fu">sum</span>(Profit), <span class="st">`</span><span class="at"># of Orders</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>), <span class="st">`</span><span class="at"># of Customers</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Customer ID</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb124-8"><a href="#cb124-8" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb124-9"><a href="#cb124-9" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="sc">-</span>Profit)</span></code></pre></div>
<div class="sourceCode" id="cb125"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="#cb125-1" tabindex="-1"></a><span class="co"># total sales</span></span>
<span id="cb125-2"><a href="#cb125-2" tabindex="-1"></a>total_pivottable_segment <span class="sc">%&gt;%</span></span>
<span id="cb125-3"><a href="#cb125-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Segment, <span class="at">y =</span> Sales, <span class="at">fill =</span> Segment)) <span class="sc">+</span></span>
<span id="cb125-4"><a href="#cb125-4" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb125-5"><a href="#cb125-5" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Segment, <span class="at">y =</span> Sales, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Sales, <span class="at">accuracy =</span> 1L, <span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>)), </span>
<span id="cb125-6"><a href="#cb125-6" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb125-7"><a href="#cb125-7" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">accuracy =</span> 1L, <span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">1250e3</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">1250e3</span>, <span class="fl">250e3</span>)) <span class="sc">+</span></span>
<span id="cb125-8"><a href="#cb125-8" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb125-9"><a href="#cb125-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total Sales&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Segment&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sales, $&quot;</span>) </span>
<span id="cb125-10"><a href="#cb125-10" tabindex="-1"></a></span>
<span id="cb125-11"><a href="#cb125-11" tabindex="-1"></a><span class="co"># totaL profit</span></span>
<span id="cb125-12"><a href="#cb125-12" tabindex="-1"></a>total_pivottable_segment <span class="sc">%&gt;%</span></span>
<span id="cb125-13"><a href="#cb125-13" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Segment, <span class="at">y =</span> Profit, <span class="at">fill =</span> Segment)) <span class="sc">+</span></span>
<span id="cb125-14"><a href="#cb125-14" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb125-15"><a href="#cb125-15" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Segment, <span class="at">y =</span> Profit, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">dollar</span>(Profit, <span class="at">accuracy =</span> 1L, <span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>)), </span>
<span id="cb125-16"><a href="#cb125-16" tabindex="-1"></a>            <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb125-17"><a href="#cb125-17" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">accuracy =</span> 1L, <span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">160e3</span>)) <span class="sc">+</span></span>
<span id="cb125-18"><a href="#cb125-18" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb125-19"><a href="#cb125-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total Profit&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Segment&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Profit, $&quot;</span>) </span>
<span id="cb125-20"><a href="#cb125-20" tabindex="-1"></a></span>
<span id="cb125-21"><a href="#cb125-21" tabindex="-1"></a><span class="co"># total # of orders</span></span>
<span id="cb125-22"><a href="#cb125-22" tabindex="-1"></a>total_pivottable_segment <span class="sc">%&gt;%</span></span>
<span id="cb125-23"><a href="#cb125-23" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> Segment, <span class="at">y =</span> <span class="st">`</span><span class="at"># of Orders</span><span class="st">`</span>, <span class="at">fill =</span> Segment)) <span class="sc">+</span></span>
<span id="cb125-24"><a href="#cb125-24" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="at">show.legend =</span> <span class="cn">FALSE</span>) <span class="sc">+</span></span>
<span id="cb125-25"><a href="#cb125-25" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Segment, <span class="at">y =</span> <span class="st">`</span><span class="at"># of Orders</span><span class="st">`</span>, <span class="at">label =</span> <span class="st">`</span><span class="at"># of Orders</span><span class="st">`</span>), <span class="at">vjust =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb125-26"><a href="#cb125-26" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">3e3</span>)) <span class="sc">+</span></span>
<span id="cb125-27"><a href="#cb125-27" tabindex="-1"></a>  <span class="fu">scale_x_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">45</span>)) <span class="sc">+</span> </span>
<span id="cb125-28"><a href="#cb125-28" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb125-29"><a href="#cb125-29" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Total # of Orders&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Segment&quot;</span>, <span class="at">y =</span> <span class="st">&quot;# of Orders&quot;</span>) </span></code></pre></div>
<p><img src="index_files/figure-html/total-segment-plotsm-1.png" width="50%" /><img src="index_files/figure-html/total-segment-plotsm-2.png" width="50%" /><img src="index_files/figure-html/total-segment-plotsm-3.png" width="50%" /></p>
<div class="sourceCode" id="cb126"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" tabindex="-1"></a><span class="co"># total pivot table viz</span></span>
<span id="cb126-2"><a href="#cb126-2" tabindex="-1"></a>total_pivottable_segment <span class="sc">%&gt;%</span></span>
<span id="cb126-3"><a href="#cb126-3" tabindex="-1"></a>  <span class="fu">mutate_at</span>(<span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">3</span>), <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">dollar</span>(., <span class="at">accuracy =</span> 1L)) <span class="sc">%&gt;%</span></span>
<span id="cb126-4"><a href="#cb126-4" tabindex="-1"></a><span class="fu">kbl</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Customer Segment&quot;</span>, <span class="st">&quot;Sales&quot;</span>, <span class="st">&quot;Profit&quot;</span>, <span class="st">&quot;# of Orders&quot;</span>, <span class="st">&quot;# of Customers&quot;</span>),</span>
<span id="cb126-5"><a href="#cb126-5" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Total metrics by Customer Segment for all the time.&quot;</span>,</span>
<span id="cb126-6"><a href="#cb126-6" tabindex="-1"></a>    <span class="at">escape =</span> F,</span>
<span id="cb126-7"><a href="#cb126-7" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&quot;l&quot;</span>, <span class="fu">rep</span>(<span class="st">&#39;r&#39;</span>,<span class="at">times=</span><span class="dv">4</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb126-8"><a href="#cb126-8" tabindex="-1"></a><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;bordered&quot;</span>), <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb126-9"><a href="#cb126-9" tabindex="-1"></a><span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>)</span></code></pre></div>
<table class="table table-striped table-bordered" style="margin-left: auto; margin-right: auto;">
<caption>
Total metrics by Customer Segment for all the time.
</caption>
<thead>
<tr>
<th style="text-align:left;text-align: center;">
Customer Segment
</th>
<th style="text-align:right;text-align: center;">
Sales
</th>
<th style="text-align:right;text-align: center;">
Profit
</th>
<th style="text-align:right;text-align: center;">
# of Orders
</th>
<th style="text-align:right;text-align: center;">
# of Customers
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Consumer
</td>
<td style="text-align:right;">
$1,161,401
</td>
<td style="text-align:right;">
$134,119
</td>
<td style="text-align:right;">
2586
</td>
<td style="text-align:right;">
409
</td>
</tr>
<tr>
<td style="text-align:left;">
Corporate
</td>
<td style="text-align:right;">
$706,146
</td>
<td style="text-align:right;">
$91,979
</td>
<td style="text-align:right;">
1514
</td>
<td style="text-align:right;">
236
</td>
</tr>
<tr>
<td style="text-align:left;">
Home Office
</td>
<td style="text-align:right;">
$429,372
</td>
<td style="text-align:right;">
$60,311
</td>
<td style="text-align:right;">
909
</td>
<td style="text-align:right;">
148
</td>
</tr>
</tbody>
</table>
<div id="what-are-sizes-of-customer-segments" class="section level3">
<h3>What are sizes of Customer Segments?</h3>
<div class="sourceCode" id="cb127"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" tabindex="-1"></a>total_pivottable_segment <span class="sc">%&gt;%</span></span>
<span id="cb127-2"><a href="#cb127-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y=</span><span class="st">`</span><span class="at"># of Customers</span><span class="st">`</span>, <span class="at">fill=</span>Segment)) <span class="sc">+</span></span>
<span id="cb127-3"><a href="#cb127-3" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb127-4"><a href="#cb127-4" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>scales<span class="sc">::</span><span class="fu">percent</span>(<span class="st">`</span><span class="at"># of Customers</span><span class="st">`</span><span class="sc">/</span><span class="fu">sum</span>(<span class="st">`</span><span class="at"># of Customers</span><span class="st">`</span>), <span class="at">accuracy =</span> <span class="fl">0.1</span>)),</span>
<span id="cb127-5"><a href="#cb127-5" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb127-6"><a href="#cb127-6" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb127-7"><a href="#cb127-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;% of Total Customers by Segment&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb127-8"><a href="#cb127-8" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb127-9"><a href="#cb127-9" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb127-10"><a href="#cb127-10" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb127-11"><a href="#cb127-11" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb127-12"><a href="#cb127-12" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb127-13"><a href="#cb127-13" tabindex="-1"></a>        <span class="at">panel.grid  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb127-14"><a href="#cb127-14" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb127-15"><a href="#cb127-15" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>())</span>
<span id="cb127-16"><a href="#cb127-16" tabindex="-1"></a></span>
<span id="cb127-17"><a href="#cb127-17" tabindex="-1"></a>total_pivottable_segment <span class="sc">%&gt;%</span></span>
<span id="cb127-18"><a href="#cb127-18" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y=</span><span class="st">`</span><span class="at"># of Orders</span><span class="st">`</span>, <span class="at">fill=</span>Segment)) <span class="sc">+</span></span>
<span id="cb127-19"><a href="#cb127-19" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb127-20"><a href="#cb127-20" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>scales<span class="sc">::</span><span class="fu">percent</span>(<span class="st">`</span><span class="at"># of Orders</span><span class="st">`</span><span class="sc">/</span><span class="fu">sum</span>(<span class="st">`</span><span class="at"># of Orders</span><span class="st">`</span>), <span class="at">accuracy =</span> <span class="fl">0.1</span>)),</span>
<span id="cb127-21"><a href="#cb127-21" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb127-22"><a href="#cb127-22" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb127-23"><a href="#cb127-23" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;% of Total Orders by Segment&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb127-24"><a href="#cb127-24" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb127-25"><a href="#cb127-25" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb127-26"><a href="#cb127-26" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb127-27"><a href="#cb127-27" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb127-28"><a href="#cb127-28" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb127-29"><a href="#cb127-29" tabindex="-1"></a>        <span class="at">panel.grid  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb127-30"><a href="#cb127-30" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb127-31"><a href="#cb127-31" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="index_files/figure-html/segment-sizem-1.png" width="50%" /><img src="index_files/figure-html/segment-sizem-2.png" width="50%" /></p>
</div>
<div id="losses" class="section level3">
<h3>Losses</h3>
<div class="sourceCode" id="cb128"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" tabindex="-1"></a><span class="co"># losses segment</span></span>
<span id="cb128-2"><a href="#cb128-2" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb128-3"><a href="#cb128-3" tabindex="-1"></a>  <span class="fu">group_by</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>) <span class="sc">%&gt;%</span></span>
<span id="cb128-4"><a href="#cb128-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Profit =</span> <span class="fu">sum</span>(Profit), <span class="at">Segment =</span> <span class="fu">first</span>(Segment)) <span class="sc">%&gt;%</span></span>
<span id="cb128-5"><a href="#cb128-5" tabindex="-1"></a>  <span class="fu">group_by</span>(Segment) <span class="sc">%&gt;%</span></span>
<span id="cb128-6"><a href="#cb128-6" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">perc_losses =</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>[Profit <span class="sc">&lt;</span> <span class="dv">0</span>])<span class="sc">/</span><span class="fu">n</span>(),</span>
<span id="cb128-7"><a href="#cb128-7" tabindex="-1"></a>            <span class="at">losses_count =</span> <span class="fu">n_distinct</span>(<span class="st">`</span><span class="at">Order ID</span><span class="st">`</span>[Profit <span class="sc">&lt;</span> <span class="dv">0</span>]),</span>
<span id="cb128-8"><a href="#cb128-8" tabindex="-1"></a>            <span class="at">total_count =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb128-9"><a href="#cb128-9" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y=</span>perc_losses, <span class="at">fill=</span>Segment)) <span class="sc">+</span></span>
<span id="cb128-10"><a href="#cb128-10" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb128-11"><a href="#cb128-11" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">label=</span>scales<span class="sc">::</span><span class="fu">percent</span>(perc_losses)),</span>
<span id="cb128-12"><a href="#cb128-12" tabindex="-1"></a>            <span class="at">position =</span> <span class="fu">position_stack</span>(<span class="at">vjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb128-13"><a href="#cb128-13" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb128-14"><a href="#cb128-14" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Number of Losable Orders&quot;</span>, <span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb128-15"><a href="#cb128-15" tabindex="-1"></a>       <span class="at">subtitle =</span> <span class="fu">bquote</span>(<span class="st">&quot;All the Customer Segments have &quot;</span><span class="sc">~</span><span class="fu">bold</span>(<span class="st">&quot;almost the same&quot;</span>)<span class="sc">~</span><span class="st">&quot; percentage of lossable orders.&quot;</span>)) <span class="sc">+</span></span>
<span id="cb128-16"><a href="#cb128-16" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>()) <span class="sc">+</span></span>
<span id="cb128-17"><a href="#cb128-17" tabindex="-1"></a>  <span class="fu">coord_polar</span>(<span class="at">theta =</span> <span class="st">&quot;y&quot;</span>) <span class="sc">+</span></span>
<span id="cb128-18"><a href="#cb128-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-19"><a href="#cb128-19" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-20"><a href="#cb128-20" tabindex="-1"></a>        <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-21"><a href="#cb128-21" tabindex="-1"></a>        <span class="at">panel.grid  =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-22"><a href="#cb128-22" tabindex="-1"></a>        <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb128-23"><a href="#cb128-23" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="index_files/figure-html/segment-losses-1.png" width="100%" /></p>
<p>These plots appear total metrics. Let’s build a table with year over
year growth of sales and profit.</p>
</div>
<div id="what-are-yoy-growth-sales-and-profit-by-customer-segment"
class="section level3">
<h3>What are YoY Growth Sales and Profit by Customer Segment?</h3>
<div class="sourceCode" id="cb129"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" tabindex="-1"></a>YoY_seg <span class="ot">&lt;-</span> Orders <span class="sc">%&gt;%</span></span>
<span id="cb129-2"><a href="#cb129-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">year</span>(<span class="st">`</span><span class="at">Order Date</span><span class="st">`</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb129-3"><a href="#cb129-3" tabindex="-1"></a>  <span class="fu">group_by</span>(Segment, Year) <span class="sc">%&gt;%</span></span>
<span id="cb129-4"><a href="#cb129-4" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Sales =</span> <span class="fu">round</span>(<span class="fu">sum</span>(Sales), <span class="dv">2</span>), </span>
<span id="cb129-5"><a href="#cb129-5" tabindex="-1"></a>            <span class="at">Profit =</span> <span class="fu">round</span>(<span class="fu">sum</span>(Profit), <span class="dv">2</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb129-6"><a href="#cb129-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YoY_Growth_Sales =</span> (Sales <span class="sc">-</span> <span class="fu">lag</span>(Sales))<span class="sc">/</span><span class="fu">lag</span>(Sales),</span>
<span id="cb129-7"><a href="#cb129-7" tabindex="-1"></a>         <span class="at">YoY_Growth_Profit =</span> (Profit <span class="sc">-</span> <span class="fu">lag</span>(Profit))<span class="sc">/</span><span class="fu">abs</span>(<span class="fu">lag</span>(Profit))) </span>
<span id="cb129-8"><a href="#cb129-8" tabindex="-1"></a></span>
<span id="cb129-9"><a href="#cb129-9" tabindex="-1"></a>YoY_segment <span class="ot">&lt;-</span> YoY_seg <span class="sc">%&gt;%</span></span>
<span id="cb129-10"><a href="#cb129-10" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="st">&quot;Year&quot;</span>, <span class="at">values_from =</span> <span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span>, <span class="st">&quot;Profit&quot;</span>, <span class="st">&quot;YoY_Growth_Sales&quot;</span>, <span class="st">&quot;YoY_Growth_Profit&quot;</span>))</span>
<span id="cb129-11"><a href="#cb129-11" tabindex="-1"></a></span>
<span id="cb129-12"><a href="#cb129-12" tabindex="-1"></a>sales_profit_columns <span class="ot">&lt;-</span> YoY_segment <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="fu">c</span>(<span class="st">&quot;Sales&quot;</span>, <span class="st">&quot;Profit&quot;</span>))) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span></code></pre></div>
<div class="sourceCode" id="cb130"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" tabindex="-1"></a>YoY_segment <span class="sc">%&gt;%</span> </span>
<span id="cb130-2"><a href="#cb130-2" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(sales_profit_columns)) <span class="sc">%&gt;%</span></span>
<span id="cb130-3"><a href="#cb130-3" tabindex="-1"></a>  <span class="fu">mutate_at</span>(sales_profit_columns, <span class="sc">~</span>scales<span class="sc">::</span><span class="fu">dollar</span>(., <span class="at">accuracy =</span> 1L)) <span class="sc">%&gt;%</span></span>
<span id="cb130-4"><a href="#cb130-4" tabindex="-1"></a><span class="fu">kbl</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Customer Segment&quot;</span>, <span class="fu">as.character</span>(<span class="dv">2014</span><span class="sc">:</span><span class="dv">2017</span>), <span class="fu">as.character</span>(<span class="dv">2014</span><span class="sc">:</span><span class="dv">2017</span>)),</span>
<span id="cb130-5"><a href="#cb130-5" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Sales and Profit by Customer Segment&quot;</span>,</span>
<span id="cb130-6"><a href="#cb130-6" tabindex="-1"></a>    <span class="at">escape =</span> F,</span>
<span id="cb130-7"><a href="#cb130-7" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&quot;l&quot;</span>, <span class="fu">rep</span>(<span class="st">&#39;r&#39;</span>,<span class="at">times=</span><span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb130-8"><a href="#cb130-8" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;bordered&quot;</span>), <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb130-9"><a href="#cb130-9" tabindex="-1"></a><span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb130-10"><a href="#cb130-10" tabindex="-1"></a><span class="fu">add_header_above</span>(<span class="at">header =</span> <span class="fu">c</span>(<span class="st">&quot; &quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;Sales&quot;</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">&quot;Profit&quot;</span> <span class="ot">=</span> <span class="dv">4</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">border_left =</span> <span class="cn">TRUE</span>, <span class="at">border_right =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table class="table table-striped table-bordered" style="margin-left: auto; margin-right: auto;">
<caption>
Sales and Profit by Customer Segment
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; font-weight: bold; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Sales
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; font-weight: bold; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
Profit
</div>
</th>
</tr>
<tr>
<th style="text-align:left;text-align: center;">
Customer Segment
</th>
<th style="text-align:right;text-align: center;">
2014
</th>
<th style="text-align:right;text-align: center;">
2015
</th>
<th style="text-align:right;text-align: center;">
2016
</th>
<th style="text-align:right;text-align: center;">
2017
</th>
<th style="text-align:right;text-align: center;">
2014
</th>
<th style="text-align:right;text-align: center;">
2015
</th>
<th style="text-align:right;text-align: center;">
2016
</th>
<th style="text-align:right;text-align: center;">
2017
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Consumer
</td>
<td style="text-align:right;">
$266,097
</td>
<td style="text-align:right;">
$266,536
</td>
<td style="text-align:right;">
$296,864
</td>
<td style="text-align:right;">
$331,905
</td>
<td style="text-align:right;">
$24,320
</td>
<td style="text-align:right;">
$28,460
</td>
<td style="text-align:right;">
$35,771
</td>
<td style="text-align:right;">
$45,568
</td>
</tr>
<tr>
<td style="text-align:left;">
Corporate
</td>
<td style="text-align:right;">
$128,435
</td>
<td style="text-align:right;">
$128,757
</td>
<td style="text-align:right;">
$207,106
</td>
<td style="text-align:right;">
$241,848
</td>
<td style="text-align:right;">
$13,513
</td>
<td style="text-align:right;">
$20,688
</td>
<td style="text-align:right;">
$30,995
</td>
<td style="text-align:right;">
$26,782
</td>
</tr>
<tr>
<td style="text-align:left;">
Home Office
</td>
<td style="text-align:right;">
$89,434
</td>
<td style="text-align:right;">
$75,239
</td>
<td style="text-align:right;">
$105,235
</td>
<td style="text-align:right;">
$159,463
</td>
<td style="text-align:right;">
$11,723
</td>
<td style="text-align:right;">
$12,470
</td>
<td style="text-align:right;">
$15,029
</td>
<td style="text-align:right;">
$21,089
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb131"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" tabindex="-1"></a>yoy_growth_columns <span class="ot">&lt;-</span> YoY_segment <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;YoY_&quot;</span>)) <span class="sc">%&gt;%</span> <span class="fu">colnames</span>()</span>
<span id="cb131-2"><a href="#cb131-2" tabindex="-1"></a></span>
<span id="cb131-3"><a href="#cb131-3" tabindex="-1"></a>YoY_segment <span class="sc">%&gt;%</span> <span class="fu">select</span>(yoy_growth_columns) <span class="sc">%&gt;%</span></span>
<span id="cb131-4"><a href="#cb131-4" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.numeric, <span class="sc">~</span><span class="fu">cell_spec</span>(scales<span class="sc">::</span><span class="fu">percent</span>(., <span class="at">accuracy =</span> <span class="fl">0.1</span>), <span class="st">&quot;html&quot;</span>, <span class="at">color=</span><span class="fu">case_when</span>(. <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb131-5"><a href="#cb131-5" tabindex="-1"></a>                                                   . <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;green&quot;</span>,</span>
<span id="cb131-6"><a href="#cb131-6" tabindex="-1"></a>                                                   <span class="fu">is.na</span>(.) <span class="sc">~</span> <span class="st">&quot;lightgray&quot;</span>,</span>
<span id="cb131-7"><a href="#cb131-7" tabindex="-1"></a>                                                   <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;black&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb131-8"><a href="#cb131-8" tabindex="-1"></a><span class="fu">kbl</span>(<span class="at">col.names =</span> <span class="fu">c</span>(<span class="st">&quot;Customer Segment&quot;</span>, <span class="fu">as.character</span>(<span class="dv">2014</span><span class="sc">:</span><span class="dv">2017</span>), <span class="fu">as.character</span>(<span class="dv">2014</span><span class="sc">:</span><span class="dv">2017</span>)),</span>
<span id="cb131-9"><a href="#cb131-9" tabindex="-1"></a>             <span class="at">caption =</span> <span class="st">&quot;Year over the year Sales and Profit growth by Customer Segment&quot;</span>,</span>
<span id="cb131-10"><a href="#cb131-10" tabindex="-1"></a>    <span class="at">escape =</span> F,</span>
<span id="cb131-11"><a href="#cb131-11" tabindex="-1"></a>    <span class="at">align =</span> <span class="fu">c</span>(<span class="st">&quot;l&quot;</span>, <span class="fu">rep</span>(<span class="st">&#39;r&#39;</span>,<span class="at">times=</span><span class="dv">8</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb131-12"><a href="#cb131-12" tabindex="-1"></a><span class="fu">row_spec</span>(<span class="dv">0</span>, <span class="at">align =</span> <span class="st">&quot;c&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb131-13"><a href="#cb131-13" tabindex="-1"></a><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;bordered&quot;</span>), <span class="at">full_width =</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb131-14"><a href="#cb131-14" tabindex="-1"></a><span class="fu">add_header_above</span>(<span class="at">header =</span> <span class="fu">c</span>(<span class="st">&quot;&quot;</span>, <span class="st">&quot;YoY Sales Growth&quot;</span> <span class="ot">=</span> <span class="dv">4</span>, <span class="st">&quot;YoY Profit Growth&quot;</span> <span class="ot">=</span> <span class="dv">4</span>), <span class="at">bold =</span> <span class="cn">TRUE</span>, <span class="at">border_left =</span> <span class="cn">TRUE</span>, <span class="at">border_right =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<table class="table table-striped table-bordered" style="margin-left: auto; margin-right: auto;">
<caption>
Year over the year Sales and Profit growth by Customer Segment
</caption>
<thead>
<tr>
<th style="empty-cells: hide;border-bottom:hidden;" colspan="1">
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; font-weight: bold; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
YoY Sales Growth
</div>
</th>
<th style="border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; font-weight: bold; " colspan="4">
<div style="border-bottom: 1px solid #ddd; padding-bottom: 5px; ">
YoY Profit Growth
</div>
</th>
</tr>
<tr>
<th style="text-align:left;text-align: center;">
Customer Segment
</th>
<th style="text-align:right;text-align: center;">
2014
</th>
<th style="text-align:right;text-align: center;">
2015
</th>
<th style="text-align:right;text-align: center;">
2016
</th>
<th style="text-align:right;text-align: center;">
2017
</th>
<th style="text-align:right;text-align: center;">
2014
</th>
<th style="text-align:right;text-align: center;">
2015
</th>
<th style="text-align:right;text-align: center;">
2016
</th>
<th style="text-align:right;text-align: center;">
2017
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Consumer
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">0.2%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">11.4%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">11.8%</span>
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">17.0%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">25.7%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">27.4%</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Corporate
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">0.3%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">60.9%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">16.8%</span>
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">53.1%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">49.8%</span>
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-13.6%</span>
</td>
</tr>
<tr>
<td style="text-align:left;">
Home Office
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: red !important;">-15.9%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">39.9%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">51.5%</span>
</td>
<td style="text-align:right;">
<span style="     color: lightgray !important;">NA</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">6.4%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">20.5%</span>
</td>
<td style="text-align:right;">
<span style="     color: green !important;">40.3%</span>
</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb132"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="#cb132-1" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="fu">max</span>(YoY_seg<span class="sc">$</span>Sales)</span>
<span id="cb132-2"><a href="#cb132-2" tabindex="-1"></a>YoY_seg <span class="sc">%&gt;%</span></span>
<span id="cb132-3"><a href="#cb132-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb132-4"><a href="#cb132-4" tabindex="-1"></a>   <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>Sales, <span class="at">fill=</span>Segment)) <span class="sc">+</span></span>
<span id="cb132-5"><a href="#cb132-5" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Sales <span class="sc">*</span> <span class="fu">max</span>(YoY_seg<span class="sc">$</span>Sales[YoY_seg<span class="sc">$</span>Segment <span class="sc">==</span> Segment]), <span class="at">group =</span> Segment, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb132-6"><a href="#cb132-6" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Sales <span class="sc">*</span> <span class="fu">max</span>(YoY_seg<span class="sc">$</span>Sales[YoY_seg<span class="sc">$</span>Segment <span class="sc">==</span> Segment]), <span class="at">group =</span> Segment, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb132-7"><a href="#cb132-7" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Sales <span class="sc">*</span> <span class="fu">max</span>(YoY_seg<span class="sc">$</span>Sales[YoY_seg<span class="sc">$</span>Segment <span class="sc">==</span> Segment]), <span class="at">group =</span> Segment, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">shape=</span><span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb132-8"><a href="#cb132-8" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Sales <span class="sc">*</span> <span class="fu">max</span>(YoY_seg<span class="sc">$</span>Sales[YoY_seg<span class="sc">$</span>Segment <span class="sc">==</span> Segment]), </span>
<span id="cb132-9"><a href="#cb132-9" tabindex="-1"></a>                  <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth_Sales, <span class="at">accuracy=</span><span class="fl">0.1</span>),</span>
<span id="cb132-10"><a href="#cb132-10" tabindex="-1"></a>                  <span class="at">vjust =</span> <span class="fu">ifelse</span>(YoY_Growth_Sales <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">2</span>, <span class="sc">-</span><span class="fl">1.5</span>)), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb132-11"><a href="#cb132-11" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;YoY Sales Growth by Customer Segment&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Customer Segment&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb132-12"><a href="#cb132-12" tabindex="-1"></a>   <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>.<span class="sc">/</span>scale, <span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)), </span>
<span id="cb132-13"><a href="#cb132-13" tabindex="-1"></a>                      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">number</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">350e3</span>, <span class="at">by=</span><span class="fl">50e3</span>), <span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">100e3</span>, <span class="fl">350e3</span>),</span>
<span id="cb132-14"><a href="#cb132-14" tabindex="-1"></a>                      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">350e3</span>, <span class="at">by=</span><span class="fl">50e3</span>)) <span class="sc">+</span></span>
<span id="cb132-15"><a href="#cb132-15" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;YoY Growth&quot;</span><span class="ot">=</span><span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb132-16"><a href="#cb132-16" tabindex="-1"></a>    <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb132-17"><a href="#cb132-17" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Segment) <span class="sc">+</span></span>
<span id="cb132-18"><a href="#cb132-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb132-19"><a href="#cb132-19" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb132-20"><a href="#cb132-20" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<p><img src="index_files/figure-html/yoy-segment-plot-1.png" width="100%" /></p>
<div class="sourceCode" id="cb133"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" tabindex="-1"></a>scale <span class="ot">&lt;-</span> <span class="fu">max</span>(YoY_seg<span class="sc">$</span>Profit)</span>
<span id="cb133-2"><a href="#cb133-2" tabindex="-1"></a>YoY_seg <span class="sc">%&gt;%</span></span>
<span id="cb133-3"><a href="#cb133-3" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb133-4"><a href="#cb133-4" tabindex="-1"></a>   <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">x=</span>Year, <span class="at">y=</span>Profit, <span class="at">fill=</span>Segment)) <span class="sc">+</span></span>
<span id="cb133-5"><a href="#cb133-5" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Profit <span class="sc">*</span> <span class="fu">max</span>(YoY_seg<span class="sc">$</span>Profit[YoY_seg<span class="sc">$</span>Segment <span class="sc">==</span> Segment]), <span class="at">group =</span> Segment, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="fl">0.75</span>) <span class="sc">+</span> </span>
<span id="cb133-6"><a href="#cb133-6" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Profit <span class="sc">*</span> <span class="fu">max</span>(YoY_seg<span class="sc">$</span>Profit[YoY_seg<span class="sc">$</span>Segment <span class="sc">==</span> Segment]), <span class="at">group =</span> Segment, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb133-7"><a href="#cb133-7" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Profit <span class="sc">*</span> <span class="fu">max</span>(YoY_seg<span class="sc">$</span>Profit[YoY_seg<span class="sc">$</span>Segment <span class="sc">==</span> Segment]), <span class="at">group =</span> Segment, <span class="at">color=</span><span class="st">&quot;YoY Growth&quot;</span>), <span class="at">shape=</span><span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span> </span>
<span id="cb133-8"><a href="#cb133-8" tabindex="-1"></a>    <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> Year, <span class="at">y =</span> YoY_Growth_Profit <span class="sc">*</span> <span class="fu">max</span>(YoY_seg<span class="sc">$</span>Profit[YoY_seg<span class="sc">$</span>Segment <span class="sc">==</span> Segment]), </span>
<span id="cb133-9"><a href="#cb133-9" tabindex="-1"></a>                  <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">percent</span>(YoY_Growth_Profit, <span class="at">accuracy=</span>1L),</span>
<span id="cb133-10"><a href="#cb133-10" tabindex="-1"></a>                  <span class="at">vjust =</span> <span class="fu">ifelse</span>(YoY_Growth_Profit <span class="sc">&lt;</span> <span class="dv">0</span>, <span class="dv">2</span>, <span class="sc">-</span><span class="fl">1.5</span>)), <span class="at">size =</span> <span class="dv">4</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span></span>
<span id="cb133-11"><a href="#cb133-11" tabindex="-1"></a>   <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;YoY Profit Growth by Customer Segment&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Customer Segment&quot;</span>, <span class="at">y =</span> <span class="st">&quot;Profit, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb133-12"><a href="#cb133-12" tabindex="-1"></a>   <span class="fu">scale_y_continuous</span>(<span class="at">sec.axis =</span> <span class="fu">sec_axis</span>(<span class="at">trans =</span> <span class="sc">~</span>.<span class="sc">/</span>scale, <span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.2</span>)), </span>
<span id="cb133-13"><a href="#cb133-13" tabindex="-1"></a>                      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">number</span>(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">50e3</span>, <span class="at">by=</span><span class="fl">10e3</span>), <span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">10e3</span>, <span class="fl">50e3</span>),</span>
<span id="cb133-14"><a href="#cb133-14" tabindex="-1"></a>                      <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">50e3</span>, <span class="at">by=</span><span class="fl">10e3</span>)) <span class="sc">+</span></span>
<span id="cb133-15"><a href="#cb133-15" tabindex="-1"></a>    <span class="fu">scale_fill_brewer</span>(<span class="at">palette=</span><span class="st">&quot;Greens&quot;</span>) <span class="sc">+</span></span>
<span id="cb133-16"><a href="#cb133-16" tabindex="-1"></a>  <span class="fu">scale_colour_manual</span>(<span class="at">name =</span> <span class="st">&quot;&quot;</span>, <span class="at">values=</span><span class="fu">c</span>(<span class="st">&quot;YoY Growth&quot;</span><span class="ot">=</span><span class="st">&quot;black&quot;</span>)) <span class="sc">+</span></span>
<span id="cb133-17"><a href="#cb133-17" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(.<span class="sc">~</span>Segment) <span class="sc">+</span></span>
<span id="cb133-18"><a href="#cb133-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>, <span class="at">legend.title =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb133-19"><a href="#cb133-19" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb133-20"><a href="#cb133-20" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<p><img src="index_files/figure-html/yoy-profit-segment-1.png" width="100%" /></p>
</div>
</div>
<div id="correlation" class="section level2">
<h2>Correlation</h2>
<div class="sourceCode" id="cb134"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(Orders <span class="sc">%&gt;%</span> <span class="fu">select_if</span>(is.numeric))</span>
<span id="cb134-2"><a href="#cb134-2" tabindex="-1"></a></span>
<span id="cb134-3"><a href="#cb134-3" tabindex="-1"></a><span class="co"># correlations</span></span>
<span id="cb134-4"><a href="#cb134-4" tabindex="-1"></a><span class="fu">cor</span>(df)</span></code></pre></div>
<pre><code>##                Sales    Quantity     Discount      Profit
## Sales     1.00000000 0.200807993 -0.028196580  0.47906668
## Quantity  0.20080799 1.000000000  0.008679525  0.06624144
## Discount -0.02819658 0.008679525  1.000000000 -0.21948100
## Profit    0.47906668 0.066241444 -0.219481001  1.00000000</code></pre>
<div class="sourceCode" id="cb136"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="#cb136-1" tabindex="-1"></a>l <span class="ot">&lt;-</span> <span class="fu">length</span>(<span class="fu">unique</span>(Orders<span class="sc">$</span>Segment))</span>
<span id="cb136-2"><a href="#cb136-2" tabindex="-1"></a></span>
<span id="cb136-3"><a href="#cb136-3" tabindex="-1"></a><span class="co"># plot correlations</span></span>
<span id="cb136-4"><a href="#cb136-4" tabindex="-1"></a><span class="fu">pairs</span>(df,       </span>
<span id="cb136-5"><a href="#cb136-5" tabindex="-1"></a>      <span class="at">pch =</span> <span class="dv">19</span>, </span>
<span id="cb136-6"><a href="#cb136-6" tabindex="-1"></a>      <span class="at">col =</span> <span class="fu">hcl.colors</span>(l, <span class="st">&quot;Temps&quot;</span>)[Orders<span class="sc">$</span>Segment],</span>
<span id="cb136-7"><a href="#cb136-7" tabindex="-1"></a>      <span class="at">main =</span> <span class="st">&quot;Correlations&quot;</span>,   </span>
<span id="cb136-8"><a href="#cb136-8" tabindex="-1"></a>      <span class="at">gap =</span> <span class="dv">0</span>,     </span>
<span id="cb136-9"><a href="#cb136-9" tabindex="-1"></a>      <span class="at">row1attop =</span> <span class="cn">FALSE</span>, </span>
<span id="cb136-10"><a href="#cb136-10" tabindex="-1"></a>      <span class="at">labels =</span> <span class="fu">colnames</span>(df), </span>
<span id="cb136-11"><a href="#cb136-11" tabindex="-1"></a>      <span class="at">cex.labels =</span> <span class="fl">0.8</span>,  </span>
<span id="cb136-12"><a href="#cb136-12" tabindex="-1"></a>      <span class="at">font.labels =</span> <span class="dv">1</span>) </span></code></pre></div>
<p><img src="index_files/figure-html/correlations-1.png" width="100%" /></p>
<div id="how-sales-affect-profit" class="section level3">
<h3>How Sales affect Profit?</h3>
<div class="sourceCode" id="cb137"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb137-2"><a href="#cb137-2" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb137-3"><a href="#cb137-3" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">color =</span> <span class="st">&quot;darkgray&quot;</span>, <span class="at">size=</span><span class="fl">0.25</span>) <span class="sc">+</span></span>
<span id="cb137-4"><a href="#cb137-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>Sales, <span class="at">y=</span>Profit), <span class="at">color=</span><span class="st">&quot;#4BA15D&quot;</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">fill=</span><span class="st">&quot;#ADD7A0&quot;</span>, <span class="at">alpha=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb137-5"><a href="#cb137-5" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>, <span class="at">accuracy =</span> 1L),</span>
<span id="cb137-6"><a href="#cb137-6" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">25e3</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">25e3</span>, <span class="fl">2.5e3</span>)) <span class="sc">+</span></span>
<span id="cb137-7"><a href="#cb137-7" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>, <span class="at">accuracy =</span> 1L),</span>
<span id="cb137-8"><a href="#cb137-8" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">7e3</span>, <span class="fl">9e3</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">7e3</span>, <span class="fl">9e3</span>, <span class="fl">1e3</span>)) <span class="sc">+</span></span>
<span id="cb137-9"><a href="#cb137-9" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Sales and Profit correlation&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Sales, $&quot;</span>, <span class="at">y=</span><span class="st">&quot;Profit, $&quot;</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/sales-profit-correlation-1.png" width="100%" /></p>
</div>
<div id="how-discount-affects-sales-and-profit" class="section level3">
<h3>How discount affects sales and profit?</h3>
<div class="sourceCode" id="cb138"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="#cb138-1" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb138-2"><a href="#cb138-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Discount, <span class="at">y=</span>Sales)) <span class="sc">+</span></span>
<span id="cb138-3"><a href="#cb138-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Segment), <span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">position =</span> <span class="fu">position_jitter</span>()) <span class="sc">+</span></span>
<span id="cb138-4"><a href="#cb138-4" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.8</span>, <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb138-5"><a href="#cb138-5" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>, <span class="at">accuracy =</span> 1L),</span>
<span id="cb138-6"><a href="#cb138-6" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">25e3</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">25e3</span>, <span class="fl">5e3</span>)) <span class="sc">+</span></span>
<span id="cb138-7"><a href="#cb138-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Discount and Sales correlation by Customer Segment&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Discount&quot;</span>, <span class="at">y=</span><span class="st">&quot;Sales, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb138-8"><a href="#cb138-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb138-9"><a href="#cb138-9" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb138-10"><a href="#cb138-10" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) <span class="sc">+</span></span>
<span id="cb138-11"><a href="#cb138-11" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Segment, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/discount-affect-1.png" width="100%" /></p>
<div class="sourceCode" id="cb139"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" tabindex="-1"></a>Orders <span class="sc">%&gt;%</span></span>
<span id="cb139-2"><a href="#cb139-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x=</span>Discount, <span class="at">y=</span>Profit)) <span class="sc">+</span></span>
<span id="cb139-3"><a href="#cb139-3" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">color=</span>Segment), <span class="at">alpha=</span><span class="fl">0.5</span>, <span class="at">position =</span> <span class="fu">position_jitter</span>()) <span class="sc">+</span></span>
<span id="cb139-4"><a href="#cb139-4" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_percent</span>(), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="fl">0.8</span>, <span class="fl">0.1</span>)) <span class="sc">+</span></span>
<span id="cb139-5"><a href="#cb139-5" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">label_number</span>(<span class="at">scale =</span> <span class="fl">1e-3</span>, <span class="at">suffix =</span> <span class="st">&quot;K&quot;</span>, <span class="at">accuracy =</span> 1L),</span>
<span id="cb139-6"><a href="#cb139-6" tabindex="-1"></a>                     <span class="at">limits =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">7e3</span>, <span class="fl">9e3</span>), <span class="at">breaks =</span> <span class="fu">seq</span>(<span class="sc">-</span><span class="fl">7e3</span>, <span class="fl">9e3</span>, <span class="fl">2e3</span>)) <span class="sc">+</span></span>
<span id="cb139-7"><a href="#cb139-7" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Discount and Profit correlation by Customer Segment&quot;</span>, <span class="at">x =</span> <span class="st">&quot;Discount&quot;</span>, <span class="at">y=</span><span class="st">&quot;Profit, $&quot;</span>) <span class="sc">+</span></span>
<span id="cb139-8"><a href="#cb139-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="st">&quot;none&quot;</span>,</span>
<span id="cb139-9"><a href="#cb139-9" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb139-10"><a href="#cb139-10" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>)) <span class="sc">+</span></span>
<span id="cb139-11"><a href="#cb139-11" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Segment, <span class="at">ncol =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="index_files/figure-html/discount-affect-2.png" width="100%" /></p>
</div>
</div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiU3VwZXJzdG9yZSBTYWxlcyBBbmFseXNpcyAoRURBKSIKb3V0cHV0OgogIGh0bWxfZG9jdW1lbnQ6CiAgICBjb2RlX2Rvd25sb2FkOiB0cnVlCiAgICB0b2M6IFRSVUUKICAgIHRvY19kZXB0aDogNAogICAgbnVtYmVyX3NlY3Rpb25zOiBmYWxzZSAgCiAgICB0aGVtZTogdW5pdGVkICAKICAgIGhpZ2hsaWdodDogcHlnbWVudHMKICAgIHNlbGZfY29udGFpbmVkOiBubwogICAgICAKLS0tCgpgYGB7Y3NzLCBlY2hvPUZBTFNFfQouZ3JpZC1jb250YWluZXIgewogIGRpc3BsYXk6IGdyaWQ7CiAgZ2FwOiAxNXB4OwogIGdyaWQtdGVtcGxhdGUtY29sdW1uczogYXV0byBhdXRvIGF1dG87Cn0KCi5ncmlkLWl0ZW0gewogIGJvcmRlcjogMXB4IHNvbGlkIGxpZ2h0Z3JheTsKICBwYWRkaW5nOiAxNXB4OwogIHRleHQtYWxpZ246IGxlZnQ7CiAgdmVydGljYWwtYWxpZ246IHRvcDsKfQoKLmdyaWQtY29udGFpbmVyLS1maXQgewogIGdyaWQtdGVtcGxhdGUtY29sdW1uczogcmVwZWF0KGF1dG8tZml0LCBtaW5tYXgoMjQwcHgsIDFmcikpOwp9CgoucGFyZW50IHsKICAgIGRpc3BsYXk6IGdyaWQ7CiAgICBncmlkLXRlbXBsYXRlLWNvbHVtbnM6IHJlcGVhdCgyLCAxZnIpOwogICAgZ3JpZC10ZW1wbGF0ZS1yb3dzOiA0MHB4IHJlcGVhdCgyLCAxZnIpOwogICAgZ3JpZC1jb2x1bW4tZ2FwOiAwcHg7CiAgICBncmlkLXJvdy1nYXA6IDE1cHg7Cn0KCi5kaXZfMCB7IGdyaWQtYXJlYTogMSAvIDEgLyAyIC8gNTsgdGV4dC1hbGlnbjogcmlnaHQ7fQouZGl2X3RvcF9sZWZ0IHsgZ3JpZC1hcmVhOiAyIC8gMSAvIDMgLyAzOyB9Ci5kaXZfdG9wX3JpZ2h0IHsgZ3JpZC1hcmVhOiAyIC8gMyAvIDMgLyA1OyB0ZXh0LWFsaWduOiByaWdodDt9Ci5kaXZfYm90dG9tX2xlZnQgeyBncmlkLWFyZWE6IDMgLyAxIC8gNCAvIDM7IH0KLmRpdl9ib3R0b21fcmlnaHQgeyBncmlkLWFyZWE6IDMgLyAzIC8gNCAvIDU7IHRleHQtYWxpZ246IHJpZ2h0O30KCmBgYAoKYGBge3Igc2V0dXAsIGluY2x1ZGU9RkFMU0V9Cgprbml0cjo6b3B0c19jaHVuayRzZXQob3V0LndpZHRoID0gIjEwMCUiLCBlY2hvID0gVFJVRSwgbWVzc2FnZT1GQUxTRSwgd2FybmluZz1GQUxTRSwgcmVzdWx0cz0nbWFya3VwJywgdGlkeT1UUlVFLAogICAgICAgICAgICAgICAgICAgICAgdGlkeS5vcHRzPWxpc3QoYXJyb3c9VFJVRSwgaW5kZW50PTIsIHdpZHRoLmN1dG9mZj03NSkpCgpgYGAKCiMgSW50cm9kdWN0aW9uCgpUaGUgZGF0YXNldCBjb250YWlucyBzYWxlcywgcHJvZml0LCBzaGlwcGluZyBhbmQgZ2VvZ3JhcGhpY2FsIGluZm9ybWF0aW9uLCBjYXRlZ29yaWVzIGFuZCBzdWItY2F0ZWdvcmllcyBvZiBzb2xkIHByb2R1Y3RzLgoKIyBPYmplY3RpdmVzCgoxLiAgVW5kZXJzdGFuZCB0aGUgZGF0YSwgc3RydWN0dXJlIGFuZCBkYXRhIHR5cGVzLgoyLiAgQ2xlYW4gZGF0YS4KMy4gIFRyYW5zZm9ybSBkYXRhIGZvciBhbmFseXNpcy4KNC4gIEFuc3dlciB0aGUgZm9sbG93aW5nIHF1ZXN0aW9uczoKCiAgICArIEdlbmVyYWwgTWV0cmljczoKICAgICAgICArIFdoYXQgaXMgdGhlIGdyb3NzIHNhbGVzIHJldmVudWU/CiAgICAgICAgKyBXaGF0IGlzIHRoZSB0b3RhbCBwcm9maXQ/CiAgICAgICAgKyBXaGF0IGlzIGF2ZXJhZ2UgYmFza2V0IHNpemUgYW5kIHZhbHVlPwogICAgICAgICsgV2hhdCBpcyBDdXN0b21lciBMaWZldGltZSBWYWx1ZSAoQ1RWKT8KICAgICAgICArIFdoYXQgYXJlIG51bWJlciBvZiB0b3RhbCBhbmQgbmV3IGN1c3RvbWVycz8KICAgICAgICArIFdoYXQgYXJlIHRvdGFsIGFuZCBsb3NzIG9yZGVycz8KICAgIAogICAgKyBTYWxlcyAmIFByb2ZpdDoKICAgICAgICArIFdoYXQgaXMgdG90YWwgZ3Jvc3MgcmV2ZW51ZSBhbmQgWW9ZIGdyb3d0aCByYXRlIG9mIGl0cz8KICAgICAgICArIFdoYXQgaXMgdG90YWwgcHJvZml0IGFuZCBZb1kgZ3Jvd3RoIHJhdGUgb2YgaXRzPwogICAgICAgICsgV2hpY2ggYXJlIFNhbGVzIGFuZCBhdmVyYWdlIFByaWNlIHF1YXJ0ZXJseSBieSBzZWdtZW50PwogICAgICAgICsgV2hhdCBpcyBhdmVyYWdlIG9yZGVyIHZhbHVlIGJ5IG1vbnRoPwogICAgICAgICsgV2hhdCBpcyBhdmVyYWdlIG9yZGVyIHZhbHVlIGJ5IHdlZWs/CiAgICAgICAgKyBXaGF0IGlzIGF2ZXJhZ2Ugb3JkZXIgdmFsdWUgYnkgZGF0ZT8KICAgICAgICArIFdoYXQgaXMgYXZlcmFnZSBvcmRlciB2YWx1ZSBieSBkYXkgb2Ygd2Vlaz8KICAgIAogICAgKyBDYXRlZ29yeToKICAgICAgICArIFdoaWNoIENhdGVnb3J5IGFyZSBiZXN0IHNlbGxpbmcgYW5kIG1vc3QgcHJvZml0YWJsZT8KICAgICAgICArIFdoYXQgaXMgWW9ZIFNhbGVzIGFuZCBQcm9maXQgR3Jvd3RoIGJ5IENhdGVnb3J5PwogICAgCiAgICArIE9yZGVyczoKICAgICAgICArIFdoYXQgYXJlIHRvdGFsIGFuZCBsb3NzIG9yZGVycyBhbmQgWW9ZIEdyb3d0aCBvZiBpdHM/CgogICAgKyBTdWItQ2F0ZWdvcnk6CiAgICAgICAgKyBXaGljaCBTdWItQ2F0ZWdvcnkgYXJlIGJlc3Qgc2VsbGluZyBhbmQgbW9zdCBwcm9maXRhYmxlL2xvc3NhYmxlPwogICAgICAgICsgV2hhdCBpcyBZb1kgU2FsZXMgYW5kIFByb2ZpdCBHcm93dGggYnkgU3ViLUNhdGVnb3J5PwogICAgICAgICsgV2hpY2ggc3ViLWNhdGVnb3JpZXMgZG8gY3VzdG9tZXJzIHByZWZlciB0byBidXkgdG9nZXRoZXIgYXQgdGhlIHNhbWUgdGltZT8KCiAgICArIEJhc2tldDoKICAgICAgICArIFdoYXQgaXMgYXZlcmFnZSBiYXNrZXQgc2l6ZSBhbmQgdmFsdWU/CiAgICAgICAgKyBXaGF0IGFyZSBZb1kgYmFza2V0IHZhbHVlIEdyb3d0aCBhbmQgYmFza2V0IHNpemUgYnkgQ3VzdG9tZXIgU2VnbWVudD8KCiAgICArIEN1c3RvbWVyIExpZmV0aW1lIFZhbHVlOgogICAgICAgICsgV2hhdCBpcyBDdXN0b21lciBMaWZldGltZSBWYWx1ZSAoQ1RWKT8KICAgICAgICArIFdoYXQgaXMgWW9ZIENUViBHcm93dGg/CgogICAgKyBDdXN0b21lcjoKICAgICAgICArIFdoYXQgYXJlIG51bWJlciBvZiB0b3RhbCBhbmQgbmV3IGN1c3RvbWVycz8gCiAgICAgICAgKyBXaGF0IGFyZSBZb1kgdG90YWwgYW5kIG5ldyBjdXN0b21lcnMgZ3Jvd3RoPwogICAgICAgICsgV2hvIGFyZSB0aGUgdG9wIHByb2ZpdGFibGUgY3VzdG9tZXJzPwogICAgICAgICsgV2hhdCBpcyBwZXJjZW50YWdlIG9mIFJldmVudWUgZnJvbSBuZXcgYnVzaW5lc3M/CgogICAgKyBQcm9kdWN0OgogICAgICAgICsgV2hhdCBhcmUgdG9wIHByb2ZpdGFibGUgcHJvZHVjdHM/CgogICAgKyBSZWdpb24vU3RhdGUvQ2l0eToKICAgICAgICArIFdoaWNoIGNpdHkvcmVnaW9uL3N0YXRlIGlzIHRoZSBiZXN0IHNlbGxpbmcgYW5kIG1vc3QgcHJvZml0YWJsZT8KICAgICAgICArIFdoYXQgYXJlIFlvWSBTYWxlcyBhbmQgUHJvZml0IGdyb3d0aCBieSBSZWdpb24/CiAgICAgICAgKyBXaGF0IGlzIFlvWSBsb3NzIE9yZGVycyBHcm93dGggYnkgUmVnaW9uPwogICAgICAgICsgV2hhdCBhcmUgdG9wL2JvdHRvbSBwcm9maXRhYmxlIENpdGllcz8KICAgICAgICArIFdoYXQgYXJlIHRvcC9ib3R0b20gcHJvZml0YWJsZSBTdGF0ZXM/CgogICAgKyBTaGlwIE1vZGU6CiAgICAgICAgKyBXaGljaCBpcyB0aGUgcHJlZmVycmVkIHNoaXAgbW9kZT8KCiAgICArIEN1c3RvbWVyIFNlZ21lbnQ6CiAgICAgICAgKyBXaGF0IGFyZSBzaXplcyBvZiBDdXN0b21lciBTZWdtZW50cz8KICAgICAgICArIFdoYXQgYXJlIFlvWSBHcm93dGggU2FsZXMgYW5kIFByb2ZpdCBieSBDdXN0b21lciBTZWdtZW50PwoKICAgICsgQ29ycmVsYXRpb246CiAgICAgICAgKyBIb3cgU2FsZXMgYWZmZWN0IFByb2ZpdD8KICAgICAgICArIEhvdyBkaXNjb3VudCBhZmZlY3RzIHNhbGVzIGFuZCBwcm9maXQ/CgojIERhdGFzZXQKCkRhdGFzZXQgaXMgbG9jYXRlZCBpbiBLYWdnbGUgYW5kIG5hbWVkIGFzIFtTdXBlcnN0b3JlIERhdGFzZXRdKGh0dHBzOi8vd3d3LmthZ2dsZS5jb20vZGF0YXNldHMvdml2ZWs0Njgvc3VwZXJzdG9yZS1kYXRhc2V0LWZpbmFsKS4KCiMgTWV0YWRhdGEKCnwgVmFyaWFibGUgbmFtZSB8IERlc2NyaXB0aW9uICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfAp8Oi0tLS0tLS0tLS0tLS0tfDotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLXwKfCBSb3cgSUQgICAgICAgIHwgVW5pcXVlIElEIGZvciBlYWNoIHJvdy4gICAgICAgICAgICAgICAgICB8CnwgT3JkZXIgSUQgICAgICB8IFVuaXF1ZSBPcmRlciBJRCBmb3IgZWFjaCBDdXN0b21lci4gICAgICAgfAp8IE9yZGVyIERhdGUgICAgfCBPcmRlciBEYXRlIG9mIHRoZSBwcm9kdWN0LiAgICAgICAgICAgICAgIHwKfCBTaGlwIERhdGUgICAgIHwgU2hpcHBpbmcgRGF0ZSBvZiB0aGUgUHJvZHVjdC4gICAgICAgICAgICB8CnwgU2hpcCBNb2RlICAgICB8IFNoaXBwaW5nIE1vZGUgc3BlY2lmaWVkIGJ5IHRoZSBDdXN0b21lci4gfAp8IEN1c3RvbWVyIElEICAgfCBVbmlxdWUgSUQgdG8gaWRlbnRpZnkgZWFjaCBDdXN0b21lci4gICAgIHwKfCBDdXN0b21lciBOYW1lIHwgTmFtZSBvZiB0aGUgQ3VzdG9tZXIuICAgICAgICAgICAgICAgICAgICB8CnwgU2VnbWVudCAgICAgICB8IFRoZSBzZWdtZW50IHdoZXJlIHRoZSBDdXN0b21lciBiZWxvbmdzLiAgfAp8IENpdHkgICAgICAgICAgfCBDaXR5IG9mIHJlc2lkZW5jZSBvZiBvZiB0aGUgQ3VzdG9tZXIuICAgIHwKfCBTdGF0ZSAgICAgICAgIHwgU3RhdGUgb2YgcmVzaWRlbmNlIG9mIHRoZSBDdXN0b21lci4gICAgICB8CnwgQ291bnRyeSAgICAgICB8IENvdW50cnkgb2YgcmVzaWRlbmNlIG9mIHRoZSBDdXN0b21lci4gICAgfAp8IFBvc3RhbCBDb2RlICAgfCBQb3N0YWwgQ29kZSBvZiBldmVyeSBDdXN0b21lci4gICAgICAgICAgIHwKfCBSZWdpb24gICAgICAgIHwgUmVnaW9uIHdoZXJlIHRoZSBDdXN0b21lciBiZWxvbmcuICAgICAgICB8CnwgUHJvZHVjdCBJRCAgICB8IFVuaXF1ZSBJRCBvZiB0aGUgUHJvZHVjdC4gICAgICAgICAgICAgICAgfAp8IENhdGVnb3J5ICAgICAgfCBDYXRlZ29yeSBvZiB0aGUgcHJvZHVjdCBvcmRlcmVkLiAgICAgICAgIHwKfCBTdWItQ2F0ZWdvcnkgIHwgU3ViLUNhdGVnb3J5IG9mIHRoZSBwcm9kdWN0IG9yZGVyZWQuICAgICB8CnwgUHJvZHVjdCBOYW1lICB8IE5hbWUgb2YgdGhlIFByb2R1Y3QgICAgICAgICAgICAgICAgICAgICAgfAp8IFNhbGVzICAgICAgICAgfCBTYWxlcyBvZiB0aGUgUHJvZHVjdC4gICAgICAgICAgICAgICAgICAgIHwKfCBRdWFudGl0eSAgICAgIHwgUXVhbnRpdHkgb2YgdGhlIFByb2R1Y3QuICAgICAgICAgICAgICAgICB8CnwgRGlzY291bnQgICAgICB8IERpc2NvdW50IHByb3ZpZGVkLiAgICAgICAgICAgICAgICAgICAgICAgfAp8IFByb2ZpdCAgICAgICAgfCBQcm9maXQvTG9zcyBpbmN1cnJlZC4gICAgICAgICAgICAgICAgICAgIHwKCiMgUHJlcGFyYXRpb24KCkFsbCB0aGUgcmVxdWlyZWQgbGlicmFyaWVzIGhhdmUgdG8gYmUgaW5zdGFsbGVkLgoKYGBge3IgbG9hZGluZy1saWJyYXJ5fQoKIyBsb2FkaW5nIHJlcXVpcmVkIGxpYnJhcmllcwoKbGlicmFyeShkcGx5cikKbGlicmFyeSh0aWR5dmVyc2UpCmxpYnJhcnkoa2FibGVFeHRyYSkKCmBgYAoKYGBge3IgdGhlbWUtc2V0dXB9CgojIHNldHVwIHBsb3RzIHRoZW1lCnRoZW1lX3NldCh0aGVtZV9saWdodCgpKQp0aGVtZV91cGRhdGUoYXhpcy50aXRsZSA9IGVsZW1lbnRfdGV4dChmYWNlID0gImJvbGQiKSwgCiAgICAgICAgICAgICBwbG90LnRpdGxlID0gZWxlbWVudF90ZXh0KGZhY2UgPSAiYm9sZCIpLAogICAgICAgICAgICAgcGFuZWwuZ3JpZC5tYWpvciA9IGVsZW1lbnRfbGluZShjb2xvciA9ICJkYXJrZ3JheSIsIGxpbmV0eXBlID0gImRvdHRlZCIpLAogICAgICAgICAgICAgcGFuZWwuZ3JpZC5taW5vciA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICAgICAgIHBhbmVsLmJhY2tncm91bmQgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgICAgICBwYW5lbC5ib3JkZXI9IGVsZW1lbnRfcmVjdChjb2xvcj0iZGFya2dyYXkiKSwKICAgICAgICAgICAgIHBsb3QubWFyZ2luID0gdW5pdChjKC41LCAxLCAxLCAxKSwgImxpbmVzIikpCgpgYGAKCgojIERhdGEgTG9hZGluZwoKYGBge3IgbG9hZGluZy1kYXRhfQoKIyBMb2FkaW5nIGRhdGEKT3JkZXJzIDwtIHJlYWRfY3N2KCIuL2RhdGEvU2FtcGxlIC0gU3VwZXJzdG9yZS5jc3YiKQoKIyBLQUdHTEUKI09yZGVycyA8LSByZWFkX2NzdigiL2thZ2dsZS9pbnB1dC9zdXBlcnN0b3JlLWRhdGFzZXQtZmluYWwvU2FtcGxlIC0gU3VwZXJzdG9yZS5jc3YiKQoKIyBDb2x1bW4gbmFtZXMKY29sbmFtZXMoT3JkZXJzKQojIERpbWVudGlvbgpzaXplX3N1bShPcmRlcnMpCgpgYGAKCmBgYHtyIGRhdGEtc3RydWN0dXJlLCBlcnJvcj1UUlVFfQoKCiMgU3RydWN0dXJlID0+IFRoaXMgY29kZSB3aWxsIGFwcGVhciBlcnJvciBvbiBLYWdnbGUhCmdsaW1wc2UoT3JkZXJzKQoKYGBgCgpDaGVjayBjaGFyYWN0ZXIgY29sdW1ucyB3aGV0aGVyIGFsbCBjb2x1bW5zIGhhdmUgYW4gdmFsaWQgVVRGLTggZW5jb2Rpbmcgd2hpY2ggY291bGQgYWZmZWN0IFIgZnVuY3Rpb25zIHByb2NlZWRpbmcuCgpgYGB7ciBjaGVja19jaGFyYWN0ZXJzfQoKIyBnZXQgYWxsIGNvbHVtbnMgdGhhdCBoYXZlIGFuIGludmFsaWQgVVRGLTggZW5jb2RpbmcKaW52YWxpZF9jb2xzIDwtIE9yZGVycyAlPiUKICBzZWxlY3RfaWYoaXMuY2hhcmFjdGVyKSAlPiUKICBzdW1tYXJpc2VfYWxsKH5zdW0oIXZhbGlkVVRGOCguKSkpICU+JQogIHNlbGVjdF9pZih+LiA+IDApOyBpbnZhbGlkX2NvbHMKCmBgYAoKKipQcm9kdWN0IE5hbWUqKiBhbmQgKipDdXN0b21lciBOYW1lKiogaGF2ZSBpbnZhbGlkIFVURi04IGVuY29kaW5nIHRoYXQgd291bGQgYWZmZWN0IG5lZ2F0aXZlbHkgb24gcGxvdHRpbmcgdGhlIHZhcmlhYmxlcyBhbmQgb3V0cHV0IHNvbWUgUiBmdW5jdGlvbnMgb24gS2FnZ2xlLgoKYGBge3IgY3VzdG9tZXItbmFtZS1lbmNvZGluZ30KCiMgQ3VzdG9tZXIgTmFtZQppbnZhbGlkX2N1c3RvbWVyX25hbWUgPC0gT3JkZXJzICU+JQogIHNlbGVjdChgQ3VzdG9tZXIgTmFtZWApICU+JQogIGZpbHRlcighdmFsaWRVVEY4KGBDdXN0b21lciBOYW1lYCkpICU+JQogIGRpc3RpbmN0KCk7IGludmFsaWRfY3VzdG9tZXJfbmFtZQoKYGBgCgpgYGB7ciBhc2NpaS10cmFuc2Zvcm0tY3VzdG9tZXItbmFtZX0KCmludmFsaWRfY3VzdG9tZXJfbmFtZSAlPiUKICBtdXRhdGUoYXNjaWkgPSBzdHJpbmdpOjpzdHJpX3RyYW5zX2dlbmVyYWwoYEN1c3RvbWVyIE5hbWVgLCAiTGF0aW4tQVNDSUkiKSkKCmBgYAoKQWxsIHN0cmluZ3MgaW4gUiBjb3VsZCBiZSBvbmx5IGluIHRocmVlIGVuY29kaW5ncyAtIFVURi04ICwgTGF0aW4xIGFuZCBuYXRpdmUuCkxldCdzIHRyeSAqKmxhdGluMSoqLgoKYGBge3IgZW5jb2RpbmctY3VzdG9tZXItbmFtZX0KCkVuY29kaW5nKGludmFsaWRfY3VzdG9tZXJfbmFtZSRgQ3VzdG9tZXIgTmFtZWApIDwtICJsYXRpbjEiCmludmFsaWRfY3VzdG9tZXJfbmFtZSRgQ3VzdG9tZXIgTmFtZWAKCiMgYXBwbHkgdGhpcyBhcHByb2FjaCB0byB0aGUgd2hvbGUgQ3VzdG9tZXIgTmFtZSBjb2x1bW4KRW5jb2RpbmcoT3JkZXJzJGBDdXN0b21lciBOYW1lYCkgPC0gImxhdGluMSIKCmBgYAoKQ2hlY2sgKipQcm9kdWN0IE5hbWUqKi4KCmBgYHtyIHByb2R1Y3QtbmFtZS1jaGVja30KCiMgUHJvZHVjdCBOYW1lCmludmFsaWRfcHJvZHVjdF9uYW1lIDwtIE9yZGVycyAlPiUKICBzZWxlY3QoYFByb2R1Y3QgTmFtZWApICU+JQogIGZpbHRlcighdmFsaWRVVEY4KGBQcm9kdWN0IE5hbWVgKSkgJT4lCiAgZGlzdGluY3QoKTsgaW52YWxpZF9wcm9kdWN0X25hbWUKCmBgYAoKYGBge3IgdHJ5LXR5cGUtY29udmVydH0KdHlwZV9jb252ZXJ0KE9yZGVycyAlPiUKICBzZWxlY3QoYFByb2R1Y3QgTmFtZWApICU+JQogIGZpbHRlcighdmFsaWRVVEY4KGBQcm9kdWN0IE5hbWVgKSkgJT4lCiAgZGlzdGluY3QoKSwgbG9jYWxlID0gcmVhZHI6OmxvY2FsZShlbmNvZGluZyA9ICJsYXRpbjEiKSkgJT4lCiAgbXV0YXRlKGBQcm9kdWN0IE5hbWVgID0gaWNvbnYoYFByb2R1Y3QgTmFtZWAsInV0Zi04IiwgImxhdGluMSIsIHN1Yj0iICIpKQoKYGBgCgpDaGFuZ2UgZW5jb2RpbmcgZm9yIHRoZSB3aG9sZSAqKlByb2R1Y3QgTmFtZSoqIGNvbHVtbi4KCmBgYHtyIGVuY29kaW5nLXByb2R1Y3QtbmFtZX0KCkVuY29kaW5nKE9yZGVycyRgUHJvZHVjdCBOYW1lYCkgPC0gImxhdGluMSIKCmBgYAoKYGBge3IgZGF0YS1zdHJ1Y3R1cmUtMn0KCiMgU3RydWN0dXJlCmdsaW1wc2UoT3JkZXJzKQogIApgYGAKCiMgRGF0YSBDbGVhbnNpbmcKCiMjIE1pc3NpbmcgRGF0YQoKYGBge3IgbWlzc2luZy1kYXRhLTF9CgojIG1pc3NpbmcgdmFsdWVzCm1pc3NpbmdfdmFsdWVzIDwtIGxhcHBseShPcmRlcnMsIGZ1bmN0aW9uKHgpIHN1bShpcy5uYSh4KSB8IHggJWluJSBjKCIiLCAiTkEiKSkpCm1pc3NpbmdfdmFsdWVzW21pc3NpbmdfdmFsdWVzID4gMF0KCmBgYAoKVGhlcmUgYXJlIG5vIE5BIGRhdGEgaW4gdGhlIHRhYmxlLgoKIyMgRHVwbGljYXRlZCBEYXRhCgpgYGB7ciBkdXBsaWNhdGUtZGF0YX0KCiMgRHVwbGljYXRlIGRhdGEKT3JkZXJzICU+JQogIGdyb3VwX2J5X2FsbCgpICU+JQogIGZpbHRlcihuKCkgPiAxKSAlPiUKICB1bmdyb3VwKCkKCmBgYAoKVGhlcmUgYXJlIE5PIGR1cGxpY2F0ZXMsIGJ1dC4uLgoKQSBudW1iZXIgb2Ygcm93cyBpcyAqKjk5OTQqKi4gTGV0J3MgcmVtb3ZlIHVzZWxlc3MgdmFyaWFibGUgKipSb3cgSUQqKiBhbmQgY2hlY2sgZHVwbGljYXRlcyBhZ2Fpbi4KCmBgYHtyIHJlbW92ZS1kdXBsaWNhdGVzLCBwYWdlZC5wcmludD1UUlVFfQoKIyBOdW1iZXIgb2YgZnVsbCBkdXBsaWNhdGVzCnN1bShPcmRlcnMgJT4lIHNlbGVjdCgtYFJvdyBJRGApICU+JSBkdXBsaWNhdGVkKCkpCgojIEFsbCBkdXBsaWNhdGVzCk9yZGVycyAlPiUgCiAgc2VsZWN0KC1gUm93IElEYCkgJT4lCiAgZ3JvdXBfYnlfYWxsKCkgJT4lCiAgZmlsdGVyKG4oKSA+IDEpICU+JQogIHVuZ3JvdXAoKQoKIyBrZWVwIHVuaXF1ZSByb3dzIG9ubHkKT3JkZXJzIDwtIE9yZGVycyAlPiUgc2VsZWN0KC1gUm93IElEYCkgJT4lIHVuaXF1ZSgpCgojIGNoZWNrIHN0cnVjdHVyZSBhbmQgZGltZW5zaW9uCmdsaW1wc2UoT3JkZXJzKQoKYGBgCgpOb3cgaXQncyAqKjk5OTMqKiwgc28gb25lIGR1cGxpY2F0ZSB3YXMgcmVtb3ZlZC4KCiMgRGF0YSBUcmFuc2Zvcm1hdGlvbgoKTGV0J3MgbG9vayBhdCB0aGUgYWxsIGNoYXJhY3RlciB2YXJpYWJsZXMgYW5kIHRoZWlyIHVuaXF1ZSB2YWx1ZXMuCgpgYGB7ciBudW1iZXItdW5pcXVlLXZhbHVlc30KIAojIE51bWJlciBvZiB1bmlxdWUgdmFsdWVzIGluIGVhY2ggY29sdW1uCnVuaV9jb3VudCA8LSBhcy5kYXRhLmZyYW1lKHNhcHBseShPcmRlcnMgJT4lIHNlbGVjdF9pZihpcy5jaGFyYWN0ZXIpLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHgpIGxlbmd0aCh1bmlxdWUoeCkpLCBzaW1wbGlmeSA9IFQpKQp1bmlfY291bnQgPC0gcm93bmFtZXNfdG9fY29sdW1uKHVuaV9jb3VudCwgdmFyPSJzIikKY29sbmFtZXModW5pX2NvdW50KSA8LSBjKCJWYXJpYWJsZSBOYW1lIiwgIiMgb2YgVW5pcXVlIFZhbHVlcyIpCgpgYGAKCmBgYHtyIHByaW50LXVuaS1jb3VudCwgcGFnZWQucHJpbnQ9VFJVRSwgcm93cy5wcmludD1ucm93KHVuaV9jb3VudCl9CgojIFByaW50IHZhcmlhYmxlcwprbml0cjo6a25pdF9wcmludCh1bmlfY291bnQpCgpgYGAKClRoZXNlIHZhcmlhYmxlcyAqKlNoaXAgTW9kZSoqLCAqKlNlZ21lbnQqKiwgKipDb3VudHJ5KiosICoqQ2l0eSoqLCAqKlN0YXRlKiosICoqUmVnaW9uKiosICoqQ2F0ZWdvcnkqKiwgKipTdWItQ2F0ZWdvcnkqKiBoYXZlIHRvIGJlIGEgKkZhY3RvciogZGF0YSB0eXBlLCBhbmQgKipPcmRlciBEYXRlKiosICoqU2hpcCBEYXRlKiogYXMgKkRhdGUqIGRhdGEgdHlwZS4KCmBgYHtyIGNvbnZlcnQtZGF0YS10eXBlfQoKZmFjdG9yX2NvbHVtbnMgPC0gYygiU2hpcCBNb2RlIiwgIlNlZ21lbnQiLCAiQ291bnRyeSIsICJDaXR5IiwgCiAgICAgICAgICAgICAgICAgICAgIlN0YXRlIiwgIlJlZ2lvbiIsICJDYXRlZ29yeSIsICJTdWItQ2F0ZWdvcnkiKQpkYXRlX2NvbHVtbnMgPC0gYygiT3JkZXIgRGF0ZSIsICJTaGlwIERhdGUiKQoKIyBtYWtlIGZhY3RvcnMgYW5kIGZvcm1hdCBkYXRlIHZhcmlhYmxlcy4KT3JkZXJzIDwtIE9yZGVycyAlPiUKICBtdXRhdGVfYXQoZmFjdG9yX2NvbHVtbnMsIGFzLmZhY3RvcikgJT4lCiAgbXV0YXRlX2F0KGRhdGVfY29sdW1ucywgfmFzLkRhdGUoLiwgZm9ybWF0PSIlbS8lZC8lWSIpKQoKIyBtYWtlIFF1YW50aXR5IGFzIEludGVnZXIKT3JkZXJzIDwtIE9yZGVycyAlPiUKICBtdXRhdGUoUXVhbnRpdHkgPSBhcy5pbnRlZ2VyKFF1YW50aXR5KSkKCiMgY2hlY2sgc3RydWN0dXJlCmdsaW1wc2UoT3JkZXJzKQoKYGBgCgpEb3VibGUgY2hlY2sgdGhlIG1pc3NpbmcgdmFsdWVzLgoKYGBge3IgbWlzc2luZy1kYXRhLTN9CgptaXNzaW5nX3ZhbHVlcyA8LSBsYXBwbHkoT3JkZXJzLCAKICAgICAgICAgICAgICAgICAgICAgICAgIGZ1bmN0aW9uKHgpIHN1bShpcy5uYSh4KSB8IHggJWluJSBjKCIiLCAiTkEiKSkpCm1pc3NpbmdfdmFsdWVzW21pc3NpbmdfdmFsdWVzID4gMF0KCmBgYAoKVGhlcmUgYXJlIHN0aWxsIE5PIG1pc3NpbmcgdmFsdWVzLgoKCiMgRGVzY3JpcHRpdmUgU3RhdGlzdGljcwoKYGBge3Igc3VtbWFyeX0KCiMgc3VtbWFyeSBkYXRhIHZhcmlhYmxlcwpzdW1tYXJ5KE9yZGVycykKCmBgYAoKTGV0J3MgbGVhcm4gdmFyaWFibGVzIGNsb3Nlci4KCgojIyBDYXRlZ29yeWNhbCBWYXJpYWJlbHMgKEZhY3RvcnMpCgpgYGB7ciBjYXRlZ29yeWNhbC1kZXNjcmlwdGl2ZSwgZmlnLnNob3c9ImhvbGQiLCBvdXQud2lkdGg9IjUwJSJ9CgojIHJlLW9yZGVyIGxldmVscwpyZW9yZGVyX3NpemUgPC0gZnVuY3Rpb24oeCkgewogICAgICAgIGZhY3Rvcih4LCBsZXZlbHMgPSBuYW1lcyhzb3J0KHRhYmxlKHgpLCBkZWNyZWFzaW5nID0gVFJVRSkpKQp9CgpyZW9yZGVyX3ZhbHVlIDwtIGZ1bmN0aW9uKHgsIHZhbHVlLCBkZWNyZWFzaW5nKSB7CiAgYSA8LSBhcnJheSh2YWx1ZSkKICBuYW1lcyhhKSA8LSB4CiAgaWYoZGVjcmVhc2luZyl7CiAgICBmYWN0b3IoeCwgbGV2ZWxzID0gbmFtZXMoc29ydChhLCBkZWNyZWFzaW5nID0gVFJVRSkpKQogIH1lbHNlewogICAgZmFjdG9yKHgsIGxldmVscyA9IG5hbWVzKHNvcnQoYSkpKQogIH0KfQoKYWxsX2ZhY3RvcnMgPC0gT3JkZXJzICU+JQogIHNlbGVjdF9pZihpcy5mYWN0b3IpICU+JQogIHNlbGVjdCgtQ2l0eSkgIyBleGNlcHQgQ2l0eSBhcyBpdCBoYXMgYSBsb3Qgb2YgCiAgICAgICAgICAgICAgICAjIGxldmVscyBvZiBmYWN0b3IgYW5kIGl0IHdvdWxkIGJlIAogICAgICAgICAgICAgICAgIyBoYXJkIHRvIGFuYWx5c2UgaXQKCmZvcihmY3QgaW4gY29sbmFtZXMoYWxsX2ZhY3RvcnMpKXsKICBwcmludChhbGxfZmFjdG9ycyAlPiUKICAgICAgICAgIGdncGxvdChhZXMoeCA9IHJlb3JkZXJfc2l6ZShnZXQoZmN0KSkpKSArCiAgICAgICAgICBnZW9tX2JhcihhZXMoeSA9ICguLmNvdW50Li4pL3N1bSguLmNvdW50Li4pKSwgCiAgICAgICAgICAgICAgICAgICBmaWxsPSIjNEJBMTVEIiwgc2hvdy5sZWdlbmQgPSBGQUxTRSkgKwogICAgICAgICAgeGxhYihmY3QpICsKICAgICAgICAgIHNjYWxlX3lfY29udGludW91cyhsYWJlbHMgPSBzY2FsZXM6OnBlcmNlbnQsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5hbWUgPSAiUHJvcG9ydGlvbiIpICsKICAgICAgICAgIGxhYnModGl0bGU9cGFzdGUwKCJQcm9wb3J0aW9uIG9mICIsIGZjdCwgIiB2YXJpYWJsZSIpKSArCiAgICAgICAgICB0aGVtZShheGlzLnRleHQueCA9IGVsZW1lbnRfdGV4dCgKICAgICAgICAgICAgYW5nbGUgPSBpZmVsc2UobnJvdyh1bmlxdWUoYWxsX2ZhY3RvcnNbLCBmY3RdKSkgPiA0LCA0NSwgMCksIAogICAgICAgICAgICBoanVzdCA9IGlmZWxzZShucm93KHVuaXF1ZShhbGxfZmFjdG9yc1ssIGZjdF0pKSA+IDQsIDEsIDAuNSkpKSArCiAgICAgICAgICB0aGVtZShwbG90Lm1hcmdpbiA9IHVuaXQoYyguNSwgMSwgMSwgMSksICJsaW5lcyIpKSApCn0KCmBgYAoKQXMgKipDaXR5KiogdmFyaWFibGUgaGFzIGh1bmRyZWRzIGxldmVscywgbGV0J3MgaW1wcm92ZSByZWFkYWJpbGl0eSBvZiAqKkNpdHkqKiBkZXNjcmlwdGl2ZSBzdGF0aXN0aWNzIGFuZCBncm91cCBjaXRpZXMgd2l0aCBwcm9wb3J0aW9uIGxlc3MgdGhhdCAxJSBvZiB0aGUgdG90YWwgYXMgKk90aGVyKi4KCmBgYHtyIGNpdHktc3VtbWFyeX0KCgpPcmRlcnMgJT4lCiAgc2VsZWN0KENpdHkpICU+JQogIGdyb3VwX2J5KENpdHkpICU+JQogIG11dGF0ZShwcm9wID0gbigpKSAlPiUKICB1bmdyb3VwKCkgJT4lCiAgbXV0YXRlKEdyb3VwID0gaWZlbHNlKHByb3AgLyBuKCkgPCAwLjAxLCAiT3RoZXIiLCBhcy5jaGFyYWN0ZXIoQ2l0eSkpLAogICAgICAgICBHcm91cCA9IGFzLmZhY3RvcihHcm91cCkpICU+JSAKICBnZ3Bsb3QoYWVzKHggPSByZW9yZGVyX3NpemUoR3JvdXApLCBmaWxsPWlmZWxzZShHcm91cCA9PSAiT3RoZXIiLCAiT3RoZXIiLCAiQ2l0eSIpKSkgKwogICAgICAgICAgICAgICAgICAgICAgZ2VvbV9iYXIoYWVzKHkgPSAoLi5jb3VudC4uKS9zdW0oLi5jb3VudC4uKSksIHNob3cubGVnZW5kID0gRkFMU0UpICsKICAgICAgICAgICAgICAgICAgICAgIHhsYWIoIkNpdHkiKSArCiAgICAgICAgICAgICAgICAgICAgICBzY2FsZV95X2NvbnRpbnVvdXMobGFiZWxzID0gc2NhbGVzOjpwZXJjZW50LCBuYW1lID0gIlByb3BvcnRpb24iKSArCiAgICAgICAgICAgICAgICAgICAgICBzY2FsZV9maWxsX21hbnVhbChuYW1lPSIiLCB2YWx1ZXMgPSBjKE90aGVyPSIjRUNFQ0VDIiwgIkNpdHkiPSIjNEJBMTVEIikpICsKICAgICAgICAgICAgICAgICAgICAgIHRoZW1lKGF4aXMudGV4dC54ID0gZWxlbWVudF90ZXh0KGFuZ2xlID0gNDUsIGhqdXN0ID0gMSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGVnZW5kLnBvc2l0aW9uPSJub25lIikgKwogICAgICAgICAgICAgICAgICAgICAgbGFicyh0aXRsZT0iUHJvcG9ydGlvbiBvZiBDaXR5IHZhcmlhYmxlIikKCmBgYAoKCiMjIERhdGUgVHlwZSBWYXJpYWJlbHMKCkxldCdzIGRlY29tcG9zZSBkYXRlIHZhcmlhYmxlcyBvbiBkYXRlIHBhcnRzIGFuZCBhbmFseXNlIHRoZW0uCgojIyMgT3JkZXIgRGF0ZQoKYGBge3Igb3JkZXItZGF0ZS1zdW1tYXJ5LCBmaWcuc2hvdz0iaG9sZCIsIG91dC53aWR0aD0iNTAlIn0KCmFsbF9kYXRlIDwtIE9yZGVycyAlPiUKICBzZWxlY3RfaWYoaXMuRGF0ZSkKCnN1bW1hcnkoYWxsX2RhdGUpCgpvcmRlcl9kYXRlX3BhcnRzIDwtIGFsbF9kYXRlICU+JQogIG11dGF0ZShgWWVhcnNgPSBhcy5mYWN0b3IoeWVhcihgT3JkZXIgRGF0ZWApKSwgCiAgICAgICAgIGBNb250aHNgPSBhcy5mYWN0b3IobW9udGgubmFtZVttb250aChgT3JkZXIgRGF0ZWApXSksCiAgICAgICAgIGBXZWVrc2A9IGFzLmZhY3Rvcih3ZWVrKGBPcmRlciBEYXRlYCkpLAogICAgICAgICBgV2Vla2RheXNgPSBhcy5mYWN0b3Iod2Vla2RheXMoYE9yZGVyIERhdGVgKSksCiAgICAgICAgIGBEYXlzYD0gYXMuZmFjdG9yKGRheShgT3JkZXIgRGF0ZWApKSkgJT4lCiAgc2VsZWN0KC1jKCJPcmRlciBEYXRlIiwgIlNoaXAgRGF0ZSIpKQoKIyBPcmRlciBEYXRlCmZvcihwYXJ0IGluIGNvbG5hbWVzKG9yZGVyX2RhdGVfcGFydHMpKXsKICBwcmludChvcmRlcl9kYXRlX3BhcnRzICU+JSBnZ3Bsb3QoYWVzKHggPSByZW9yZGVyX3NpemUoZ2V0KHBhcnQpKSkpICsKICAgICAgICAgICAgICAgICAgICAgIGdlb21fYmFyKGFlcyh5ID0gKC4uY291bnQuLikvc3VtKC4uY291bnQuLikpLCBmaWxsPSIjNEJBMTVEIiwgc2hvdy5sZWdlbmQgPSBGQUxTRSkgKwogICAgICAgICAgICAgICAgICAgICAgeGxhYihwYXJ0KSArCiAgICAgICAgICAgICAgICAgICAgICBzY2FsZV95X2NvbnRpbnVvdXMobGFiZWxzID0gc2NhbGVzOjpwZXJjZW50LCBuYW1lID0gIlByb3BvcnRpb24iKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVtZShheGlzLnRleHQueCA9IGVsZW1lbnRfdGV4dChhbmdsZSA9IDQ1LCBoanVzdCA9IDEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZ2VuZC5wb3NpdGlvbj0ibm9uZSIpICsgCiAgICAgICBsYWJzKHRpdGxlPXBhc3RlMCgiUHJvcG9ydGlvbiBvZiAiLCBwYXJ0LCIgaW4gT3JkZXIgRGF0ZSB2YXJpYWJsZSIpKSArCiAgICAgICB0aGVtZShwbG90Lm1hcmdpbiA9IHVuaXQoYyguNSwgMSwgMSwgMSksICJsaW5lcyIpKSApCn0KCmBgYAoKCiMjIyBTaGlwIERhdGUKCmBgYHtyIHNoaXAtZGF0ZS1zdW1tYXJ5LCBmaWcuc2hvdz0iaG9sZCIsIG91dC53aWR0aD0iNTAlIn0KCnNoaXBfZGF0ZV9wYXJ0cyA8LSBhbGxfZGF0ZSAlPiUKICBtdXRhdGUoYFllYXJzYD0gYXMuZmFjdG9yKHllYXIoYFNoaXAgRGF0ZWApKSwgCiAgICAgICAgIGBNb250aHNgPSBhcy5mYWN0b3IobW9udGgubmFtZVttb250aChgU2hpcCBEYXRlYCldKSwKICAgICAgICAgYFdlZWtzYD0gYXMuZmFjdG9yKHdlZWsoYFNoaXAgRGF0ZWApKSwKICAgICAgICAgYFdlZWtkYXlzYD0gYXMuZmFjdG9yKHdlZWtkYXlzKGBTaGlwIERhdGVgKSksCiAgICAgICAgIGBEYXlzYD0gYXMuZmFjdG9yKGRheShgU2hpcCBEYXRlYCkpKSAlPiUKICBzZWxlY3QoLWMoIk9yZGVyIERhdGUiLCAiU2hpcCBEYXRlIikpCgojIE9yZGVyIERhdGUKZm9yKHBhcnQgaW4gY29sbmFtZXMoc2hpcF9kYXRlX3BhcnRzKSl7CiAgcHJpbnQoc2hpcF9kYXRlX3BhcnRzICU+JSBnZ3Bsb3QoYWVzKHggPSByZW9yZGVyX3NpemUoZ2V0KHBhcnQpKSkpICsKICAgICAgICAgICAgICAgICAgICAgIGdlb21fYmFyKGFlcyh5ID0gKC4uY291bnQuLikvc3VtKC4uY291bnQuLikpLCBmaWxsPSIjNEJBMTVEIiwgc2hvdy5sZWdlbmQgPSBGQUxTRSkgKwogICAgICAgICAgICAgICAgICAgICAgeGxhYihwYXJ0KSArCiAgICAgICAgICAgICAgICAgICAgICBzY2FsZV95X2NvbnRpbnVvdXMobGFiZWxzID0gc2NhbGVzOjpwZXJjZW50LCBuYW1lID0gIlByb3BvcnRpb24iKSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aGVtZShheGlzLnRleHQueCA9IGVsZW1lbnRfdGV4dChhbmdsZSA9IDQ1LCBoanVzdCA9IDEpLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxlZ2VuZC5wb3NpdGlvbj0ibm9uZSIpICsgCiAgICAgICBsYWJzKHRpdGxlPXBhc3RlMCgiUHJvcG9ydGlvbiBvZiAiLCBwYXJ0LCIgaW4gU2hpcCBEYXRlIHZhcmlhYmxlIikpICsKICAgICAgIHRoZW1lKHBsb3QubWFyZ2luID0gdW5pdChjKC41LCAxLCAxLCAxKSwgImxpbmVzIikpICkKfQoKYGBgCgoKIyMgTnVtZXJpYyBUeXBlIFZhcmlhYmVscwoKYGBge3IgYWxsLW51bS12YXJzfQoKYWxsX251bWVyaWMgPC0gT3JkZXJzICU+JQogIHNlbGVjdF9pZihpcy5udW1lcmljKQoKc3VtbWFyeShhbGxfbnVtZXJpYykKCmBgYAoKCiMjIyBTYWxlcyB2YXJpYWJsZQoKYGBge3Igc2FsZXMtdmFyfQoKTW9kZSA8LSBmdW5jdGlvbih4KSB7CiBhIDwtIHRhYmxlKHgpCiBhcy5udW1lcmljKG5hbWVzKGEpW2EgPT0gbWF4KGEpXSkKfQoKT3JkZXJzICU+JQogIGdncGxvdChhZXMoeD1TYWxlcykpICsKICBnZW9tX2hpc3RvZ3JhbShhZXMoeT0uLmRlbnNpdHkuLiksIGNvbG91cj0iYmxhY2siLCBmaWxsPSJ3aGl0ZSIsIGJpbnMgPSAxMDApKwogIGdlb21fZGVuc2l0eShjb2xvciA9ICJkYXJrYmx1ZSIsIGZpbGw9ImxpZ2h0Ymx1ZSIsIGFscGhhPTAuNSkgKwogIGdlb21fdmxpbmUoeGludGVyY2VwdCA9IG1lYW4oT3JkZXJzJFNhbGVzKSwgbGluZXR5cGU9ImRhc2hlZCIsIGNvbG91cj0icmVkIikgKwogIGdlb21fdmxpbmUoeGludGVyY2VwdCA9IG1lZGlhbihPcmRlcnMkU2FsZXMpLCBsaW5ldHlwZT0iZGFzaGVkIiwgY29sb3VyPSJibHVlIikgKwogIGFubm90YXRlKCJyZWN0IiwgeG1pbj03ZTMsIHhtYXg9MTNlMywgeW1pbj00ZS0zLCB5bWF4PTUuNWUtMywgIGNvbG9yPSJibGFjayIsIGZpbGw9IndoaXRlIikgKwogIGFubm90YXRlKCJ0ZXh0IiwgeD0xMGUzLCB5PTVlLTMsIGxhYmVsPXBhc3RlKCJtZWFuID0iLCBzY2FsZXM6OmRvbGxhcihtZWFuKE9yZGVycyRTYWxlcyksIGFjY3VyYWN5ID0gMC4wMSkpLCBjb2xvcj0icmVkIikgKwogIGFubm90YXRlKCJ0ZXh0IiwgeD0xMGUzLCB5PTQuNWUtMywgbGFiZWw9cGFzdGUoIm1lZGlhbiA9Iiwgc2NhbGVzOjpkb2xsYXIobWVkaWFuKE9yZGVycyRTYWxlcyksIGFjY3VyYWN5ID0gMC4wMSkpLCBjb2xvcj0iYmx1ZSIpICsgCiAgbGFicyh0aXRsZT0iRGlzdGlidXRpb24gb2YgU2FsZXMgdmFyaWFibGUiKQoKYGBgCgoKIyMjIFByb2ZpdCB2YXJpYWJsZQoKYGBge3IgcHJvZml0LXZhcn0KCk9yZGVycyAlPiUKICBnZ3Bsb3QoYWVzKHg9UHJvZml0KSkgKwogIGdlb21faGlzdG9ncmFtKGFlcyh5PS4uZGVuc2l0eS4uKSwgY29sb3VyPSJibGFjayIsIGZpbGw9IndoaXRlIiwgYmlucyA9IDEwMCkrCiAgZ2VvbV9kZW5zaXR5KGNvbG9yID0gImRhcmtibHVlIiwgZmlsbD0ibGlnaHRibHVlIiwgYWxwaGE9MC41KSArCiAgZ2VvbV92bGluZSh4aW50ZXJjZXB0ID0gbWVhbihPcmRlcnMkUHJvZml0KSwgbGluZXR5cGU9ImRhc2hlZCIsIGNvbG91cj0icmVkIikgKwogIGdlb21fdmxpbmUoeGludGVyY2VwdCA9IG1lZGlhbihPcmRlcnMkUHJvZml0KSwgbGluZXR5cGU9ImRhc2hlZCIsIGNvbG91cj0iYmx1ZSIpICsKICBhbm5vdGF0ZSgicmVjdCIsIHhtaW49M2UzLCB4bWF4PTdlMywgeW1pbj00ZS0yLCB5bWF4PTUuNWUtMiwgIGNvbG9yPSJibGFjayIsIGZpbGw9IndoaXRlIikgKwogIGFubm90YXRlKCJ0ZXh0IiwgeD01ZTMsIHk9NWUtMiwgbGFiZWw9cGFzdGUoIm1lYW4gPSIsIHNjYWxlczo6ZG9sbGFyKG1lYW4oT3JkZXJzJFByb2ZpdCksIGFjY3VyYWN5ID0gMC4wMSkpLCBjb2xvcj0icmVkIikgKwogIGFubm90YXRlKCJ0ZXh0IiwgeD01ZTMsIHk9NC41ZS0yLCBsYWJlbD1wYXN0ZSgibWVkaWFuID0iLCBzY2FsZXM6OmRvbGxhcihtZWRpYW4oT3JkZXJzJFByb2ZpdCksIGFjY3VyYWN5ID0gMC4wMSkpLCBjb2xvcj0iYmx1ZSIpICsKICBsYWJzKHRpdGxlPSJEaXN0aWJ1dGlvbiBvZiBQcm9maXQgdmFyaWFibGUiKQoKCmBgYAoKVGhlICoqU2FsZXMqKiBhbmQgKipQcm9maXQqKiB2YXJpYWJsZXMgaGFzIHJpZ2h0IHNrZXdlZCBkaXN0cmlidXRpb25zLgoKCiMjIyBEaXNjb3VudCB2YXJpYWJsZQoKYGBge3IgZGlzY291bnQtdmFyfQoKIyBEaXNjb3VudAoKT3JkZXJzICU+JQptdXRhdGUoRGlzY291bnQ9c2NhbGVzOjpwZXJjZW50KERpc2NvdW50KSkgJT4lCmdncGxvdChhZXMoeCA9IERpc2NvdW50KSkgKwogICAgICAgICAgICAgICAgICAgICAgZ2VvbV9iYXIoYWVzKHkgPSAoLi5jb3VudC4uKS9zdW0oLi5jb3VudC4uKSksIGZpbGw9IiM0QkExNUQiLCBzaG93LmxlZ2VuZCA9IEZBTFNFKSArCiAgICAgICAgICAgICAgICAgICAgICB4bGFiKCJEaXNjb3VudCIpICsKICAgICAgICAgICAgICAgICAgICAgIHNjYWxlX3lfY29udGludW91cyhsYWJlbHMgPSBzY2FsZXM6OnBlcmNlbnQsIG5hbWUgPSAiUHJvcG9ydGlvbiIpICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbj0ibm9uZSIpICsKICBsYWJzKHRpdGxlPSJQcm9wb3J0aW9uIG9mIERpc2NvdW50IHZhcmlhYmxlIikKCmBgYAoKCiMjIyBRdWFudGl0eSB2YXJpYWJsZQoKYGBge3IgcXVhbnRpdHktdmFyfQoKIyBRdWFudGl0eQpPcmRlcnMgJT4lCiAgbXV0YXRlKFF1YW50aXR5ID0gYXMuZmFjdG9yKFF1YW50aXR5KSkgJT4lCiAgZ2dwbG90KGFlcyh4ID0gUXVhbnRpdHkpKSArCiAgICBnZW9tX2JhcihhZXMoeSA9ICguLmNvdW50Li4pL3N1bSguLmNvdW50Li4pKSwgZmlsbD0iIzRCQTE1RCIsIHNob3cubGVnZW5kID0gRkFMU0UpICsKICAgIHhsYWIoIlF1YW50aXR5IikgKwogICAgc2NhbGVfeV9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6cGVyY2VudCwgbmFtZSA9ICJQcm9wb3J0aW9uIikgKwogICAgdGhlbWUobGVnZW5kLnBvc2l0aW9uPSJub25lIikgKwogICAgbGFicyh0aXRsZT0iUHJvcG9ydGlvbiBvZiBRdWFudGl0eSB2YXJpYWJsZSIpCgpgYGAKCgojIEV4cGxvcmF0b3J5IERhdGEgQW5hbHlzaXMKCmBgYHtyIGxhdGVzdC15ZWFyfQoKeWVhcnMgPC0gT3JkZXJzICU+JSAKICAgICAgICAgIG11dGF0ZShZZWFyID0geWVhcihgT3JkZXIgRGF0ZWApKSAlPiUgCiAgICAgICAgICBzZWxlY3QoWWVhcikgJT4lIAogICAgICAgICAgZGlzdGluY3QoKSAlPiUgCiAgICAgICAgICBhcnJhbmdlKFllYXIpCgojIGxhdGVzdCB5ZWFyIGluIHRoZSBkYXRhc2V0CmxhdGVzdF95ZWFyIDwtIG1heCh5ZWFycykKCmBgYAoKYGBge3IgbWluaS1kYXNoYm9hciwgaW5jbHVkZSA9IEZBTFNFLCByZWYubGFiZWwgPSBjKCJnZW5lcmFsLW1ldHJpY3MiLCAieW95LWN1c3RvbWVycyIsICJzdW1tYXJpc2UtY3VzdG9tZXJzIiwgImdyb3NzLXNhbGVzIiwgInRvdGFsLXByb2ZpdCIsICJiYXNrZXQtbWV0cmljcy0xIiwgImJhc2tldC1tZXRyaWNzLTIiLCAiY3VzdG9tZXItbGlmZXRpbWUtdmFsdWUiLCAidG90YWwtbG9zc2VzLW9yZGVycyIsICJsb3NzZXMtMSIsICJsb3NzZXMtMiIsICJjbHYtbWV0cmljcyIpfQpgYGAKCiMjIEdlbmVyYWwgTWV0cmljcyB7LnRhYnNldH0KClF1ZXN0aW9ucyB3ZSBhcmUgdHJ5aW5nIHRvIGFuc3dlcjoKCiogV2hhdCBpcyB0aGUgZ3Jvc3Mgc2FsZXMgcmV2ZW51ZT8KKiBXaGF0IGlzIHRoZSB0b3RhbCBwcm9maXQ/CiogV2hhdCBpcyB0aGUgdG90YWwgbnVtYmVyIG9mIGN1c3RvbWVycz8KKiBXaGF0IGlzIG51bWJlciBvZiBuZXcgY3VzdG9tZXJzPwoqIFdoYXQgaXMgYXZlcmFnZSBiYXNrZXQgc2l6ZSBhbmQgdmFsdWU/CiogV2hhdCBpcyBDdXN0b21lciBMaWZldGltZSBWYWx1ZSAoQ0xWKT8KICAgCkxldCdzIGZpbmQgb3V0IGdlbmVyYWwgbWV0cmljcyBmb3IgbGF0ZXN0IHllYXIuIEl0J3MgKipgciBsYXRlc3RfeWVhcmAqKiB5ZWFyIGluIHRoaXMgZGF0YXNldCBhbmQgYnVpbGQgbWluaS1kYXNoYm9hcmQuIAoKPiAqKl9OT1RFOl8qKiBDbGljayBvbiAqKsK6wrrCuioqIG9mIHRoZSBtZXRyaWMgdG8gZ28gdG8gdGhlIGNvZGUgb2YgdGhlIGNhbGN1bGF0aW9uIG9mIGl0cy4KCgojIyMgQ29kZSBGb3JtYXR0aW5nCgpgYGB7ciBjb2RlLWZvcm1hdHRpbmd9Cgpjb2xvcml6ZV9sYWJlbCA8LSBmdW5jdGlvbih4KSB7CiAgc3ByaW50ZigiPGRpdj48c3BhbiBzdHlsZT0nY29sb3I6IGRhcmtncmF5OyBmb250LXNpemU6IDExcHg7Jz4lczwvc3Bhbj48L2Rpdj4iLCB4KQp9CmRvbGxhciA8LSBmdW5jdGlvbih4LCBhY2N1cmFjeSkgewogICAgdmFsdWUgPC0gc2NhbGVzOjpkb2xsYXIoeCwgYWNjdXJhY3kgPSBhY2N1cmFjeSk7CiAgICBzcHJpbnRmKCI8ZGl2PjxzcGFuIHN0eWxlPSdjb2xvcjogYmxhY2s7IGZvbnQtc2l6ZTogMjhweDsnPiVzPC9zcGFuPjwvZGl2PiIsIHZhbHVlKQp9Cm51bWJlciA8LSBmdW5jdGlvbih4LCBhY2N1cmFjeSkgewogICAgdmFsdWUgPC0gc2NhbGVzOjpudW1iZXIoeCwgYWNjdXJhY3kgPSBhY2N1cmFjeSk7CiAgICBzcHJpbnRmKCI8ZGl2PjxzcGFuIHN0eWxlPSdjb2xvcjogYmxhY2s7IGZvbnQtc2l6ZTogMjhweDsnPiVzPC9zcGFuPjwvZGl2PiIsIHZhbHVlKQp9CmNvbG9yaXplX3BlcmNlbnQgPC0gZnVuY3Rpb24oeCwgYWNjdXJhY3kpIHsKICB2YWx1ZSA8LSBzY2FsZXM6OnBlcmNlbnQoeCwgYWNjdXJhY3kgPSBhY2N1cmFjeSk7IAogIGlmKHggPCAwKXsKICAgIHNwcmludGYoJzxkaXY+PHNwYW4+PHN2ZyBzdHlsZT0idmVydGljYWwtYWxpZ246IG1pZGRsZTsiIHdpZHRoPSIzMHB4IiBoZWlnaHQ9IjMwcHgiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTguNzI3OTggMTUuNzk1TDMuNzI3OTggNy43OTVDMy4xMDM1NiA2Ljc5NTkzIDMuODIxODMgNS41IDQuOTk5OTggNS41TDE1IDUuNUMxNi4xNzgxIDUuNSAxNi44OTY0IDYuNzk1OTMgMTYuMjcyIDcuNzk1TDExLjI3MiAxNS43OTVDMTAuNjg0NSAxNi43MzUgOS4zMTU0OSAxNi43MzUgOC43Mjc5OCAxNS43OTVaIiBmaWxsPSJyZWQiLz4KPC9zdmc+PC9zcGFuPjxzcGFuIHN0eWxlPSJ2ZXJ0aWNhbC1hbGlnbjogbWlkZGxlOyBjb2xvcjogcmVkOyBmb250LXNpemU6IDI0cHg7Ij4lczwvc3Bhbj48L2Rpdj4nLCB2YWx1ZSkKICB9ZWxzZXsKICAgIHNwcmludGYoJzxkaXY+PHNwYW4+PHN2ZyBzdHlsZT0idmVydGljYWwtYWxpZ246IG1pZGRsZTsiIHdpZHRoPSIzMHB4IiBoZWlnaHQ9IjMwcHgiIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTExLjI3MiA1LjIwNUwxNi4yNzIgMTMuMjA1QzE2Ljg5NjQgMTQuMjA0MSAxNi4xNzgyIDE1LjUgMTUgMTUuNUg1LjAwMDAyQzMuODIxODYgMTUuNSAzLjEwMzYgMTQuMjA0MSAzLjcyODAyIDEzLjIwNUw4LjcyODAyIDUuMjA1QzkuMzE1NTIgNC4yNjUgMTAuNjg0NSA0LjI2NSAxMS4yNzIgNS4yMDVaIiBmaWxsPSJncmVlbiIvPjwvc3ZnPjwvc3Bhbj48c3BhbiBzdHlsZT0idmVydGljYWwtYWxpZ246IG1pZGRsZTsgY29sb3I6IGdyZWVuOyBmb250LXNpemU6IDI0cHg7Ij4lczwvc3Bhbj48L2Rpdj4nLCB2YWx1ZSkKICB9Cn0KCnJlZl9sYWJlbCA8LSBmdW5jdGlvbihsYWJlbCl7CiAgICBzcHJpbnRmKCc8ZGl2PjxzcGFuPjxhIGhyZWY9IiMlcyIgc3R5bGU9ImZvbnQtc2l6ZTogMTZweDt0ZXh0LWRlY29yYXRpb246IG5vbmU7IG1hcmdpbjowOyBwYWRkaW5nOjA7IHZlcnRpY2FsLWFsaWduOiBtaWRkbGU7IiB0YXJnZXQ9Il9zZWxmIiByZWw9IiBub3JlZmVycmVyIG5vZm9sbG93Ij7CusK6wro8L2E+PC9zcGFuPjwvZGl2PicsIGxhYmVsKQp9CmBgYAoKIyMjIE1ldHJpY3Mgey5hY3RpdmV9Cgo6OjogeyNncmlkX2NvbnRhaW5lciAuZ3JpZC1jb250YWluZXIgLmdyaWQtY29udGFpbmVyLS1maXR9Cgo6OjogeyNyZXZlbnVlIC5ncmlkLWl0ZW0gLnBhcmVudH0KOjo6IGRpdl8wCmByIHggPC0gcmVmX2xhYmVsKCJyZXZlbnVlLXJlZiIpOyB4YAo6OjoKCjo6OiBkaXZfdG9wX2xlZnQKYHIgeCA8LSBjb2xvcml6ZV9sYWJlbCgiR1JPU1MgUkVWRU5VRSIpOyB4YApgciB4IDwtIEdyb3NzX1NhbGVzOyBkb2xsYXIoeCwgMC4xKWAKOjo6Cgo6OjogZGl2X2JvdHRvbV9sZWZ0CmByIHggPC0gY29sb3JpemVfbGFiZWwoIllvWSBHUk9XVEgiKTsgeGAKYHIgeCA8LSBjb2xvcml6ZV9wZXJjZW50KFlvWV9Hcm93dGhfU2FsZXMsIDAuMSk7IHhgCjo6Ogo6OjoKCjo6OiB7I3Byb2ZpdCAuZ3JpZC1pdGVtIC5wYXJlbnR9Cjo6OiBkaXZfMApgciB4IDwtIHJlZl9sYWJlbCgicHJvZml0LXJlZiIpOyB4YAo6OjoKCjo6OiBkaXZfdG9wX2xlZnQKYHIgeCA8LSBjb2xvcml6ZV9sYWJlbCgiUFJPRklUIik7IHhgCmByIHggPC0gZG9sbGFyKHByb2ZpdCwgMC4xKTsgeGAKOjo6Cgo6OjogZGl2X2JvdHRvbV9sZWZ0CmByIHggPC0gY29sb3JpemVfbGFiZWwoIllvWSBHUk9XVEgiKTsgeGAKYHIgeCA8LSBZb1lfR3Jvd3RoX1Byb2ZpdDsgY29sb3JpemVfcGVyY2VudCh4LCAwLjEpYAo6OjoKOjo6Cgo6OjogeyNiYXNrZXQgLmdyaWQtaXRlbSAucGFyZW50fQo6OjogZGl2XzAKYHIgeCA8LSByZWZfbGFiZWwoImJhc2tldC1yZWYiKTsgeGAKOjo6Cgo6OjogZGl2X3RvcF9sZWZ0CmByIHggPC0gY29sb3JpemVfbGFiZWwoIkJBU0tFVCBWQUxVRSIpOyB4YApgciB4IDwtIGRvbGxhcihCYXNrZXRfVmFsdWUsIDAuMSk7IHhgCjo6OgoKOjo6IGRpdl9ib3R0b21fbGVmdApgciB4IDwtIGNvbG9yaXplX2xhYmVsKCJZb1kgR1JPV1RIIik7IHhgCmByIHggPC0gWW9ZX0Jhc2tldF9WYWx1ZTsgY29sb3JpemVfcGVyY2VudCh4LCAwLjEpYAo6OjoKCjo6OiBkaXZfYm90dG9tX3JpZ2h0CmByIHggPC0gY29sb3JpemVfbGFiZWwoIkJBU0tFVCBTSVpFIik7IHhgCmByIHggPC0gbnVtYmVyKEJhc2tldF9TaXplLCAxTCk7IHhgCjo6Ogo6OjoKCjo6OiB7I2NsdiAuZ3JpZC1pdGVtIC5wYXJlbnR9Cjo6OiBkaXZfMApgciB4IDwtIHJlZl9sYWJlbCgiY2x2LXJlZiIpOyB4YAo6OjoKCjo6OiBkaXZfdG9wX2xlZnQKYHIgeCA8LSBjb2xvcml6ZV9sYWJlbCgiQ0xWIik7IHhgCmByIHggPC0gZG9sbGFyKENMVl9tLCAwLjEpOyB4YAo6OjoKCjo6OiBkaXZfYm90dG9tX2xlZnQKYHIgeCA8LSBjb2xvcml6ZV9sYWJlbCgiWW9ZIEdST1dUSCIpOyB4YApgciB4IDwtIENMVl95b3k7IGNvbG9yaXplX3BlcmNlbnQoeCwgMC4xKWAKOjo6Cjo6OgoKOjo6IHsjbmV3Y3VzdG9tZXJzMSAuZ3JpZC1pdGVtIC5wYXJlbnR9Cjo6OiBkaXZfMApgciB4IDwtIHJlZl9sYWJlbCgiY3VzdG9tZXJzLXJlZiIpOyB4YAo6OjoKOjo6IHsuZGl2X3RvcF9sZWZ0fQpgciB4IDwtIGNvbG9yaXplX2xhYmVsKCJUT1RBTCBDVVNUT01FUlMiKTsgeGAKYHIgeCA8LSBudW1iZXIoVW5pcXVlX0N1c3RvbWVycywgMUwpOyB4YAo6OjoKOjo6IHsuZGl2X3RvcF9yaWdodH0KYHIgeCA8LSBjb2xvcml6ZV9sYWJlbCgiWW9ZIEdST1dUSCIpOyB4YApgciB4IDwtIFlvWV9Hcm93dGhfVW5pcXVlOyBjb2xvcml6ZV9wZXJjZW50KHgsIDAuMSlgCjo6Ogo6Ojogey5kaXZfYm90dG9tX2xlZnR9CmByIHggPC0gY29sb3JpemVfbGFiZWwoIk5FVyBDVVNUT01FUlMiKTsgeGAKYHIgeCA8LSBudW1iZXIoTmV3X0N1c3RvbWVycywgMUwpOyB4YAo6OjoKOjo6IHsuZGl2X2JvdHRvbV9yaWdodH0KYHIgeCA8LSBjb2xvcml6ZV9sYWJlbCgiWW9ZIEdST1dUSCIpOyB4YApgciB4IDwtIFlvWV9Hcm93dGhfTmV3OyBjb2xvcml6ZV9wZXJjZW50KHgsIDAuMSlgCjo6Ogo6OjoKCjo6OiB7I2xvc3Nlc29yZGVycyAuZ3JpZC1pdGVtIC5wYXJlbnR9Cjo6OiBkaXZfMApgciB4IDwtIHJlZl9sYWJlbCgib3JkZXJzLXJlZiIpOyB4YAo6OjoKOjo6IHsuZGl2X3RvcF9sZWZ0fQpgciB4IDwtIGNvbG9yaXplX2xhYmVsKCJUT1RBTCBPUkRFUlMiKTsgeGAKYHIgeCA8LSBudW1iZXIoVG90YWxfT3JkZXJzLCAxTCk7IHhgCjo6Ogo6Ojogey5kaXZfdG9wX3JpZ2h0fQpgciB4IDwtIGNvbG9yaXplX2xhYmVsKCJZb1kgR1JPV1RIIik7IHhgCmByIHggPC0gWW9ZX29yZGVyczsgY29sb3JpemVfcGVyY2VudCh4LCAwLjEpYAo6OjoKOjo6IHsuZGl2X2JvdHRvbV9sZWZ0fQpgciB4IDwtIGNvbG9yaXplX2xhYmVsKCJMT1NTIE9SREVSUyIpOyB4YApgciB4IDwtIG51bWJlcihMb3NzZXNfT3JkZXJzLCAxTCk7IHhgCjo6Ogo6Ojogey5kaXZfYm90dG9tX3JpZ2h0fQpgciB4IDwtIGNvbG9yaXplX2xhYmVsKCJZb1kgR1JPV1RIIik7IHhgCmByIHggPC0gWW9ZX2xvc3NlczsgY29sb3JpemVfcGVyY2VudCh4LCAwLjEpYAo6OjoKOjo6Cgo6OjoKCgojIyBXaGF0IGlzIHRvdGFsIGdyb3NzIHJldmVudWUgYW5kIFlvWSBncm93dGggcmF0ZSBvZiBpdHM/CgpgYGB7ciB0b3RhbC1waXZvdC12aXp9CgojIHBpdm90IHRhYmxlIG9mIGdyb3NzIHNhbGVzIGFuZCBwcm9maXQKWW9ZX1NhbGVzIDwtIE9yZGVycyAlPiUKICBtdXRhdGUoWWVhciA9IHllYXIoYE9yZGVyIERhdGVgKSkgJT4lCiAgZ3JvdXBfYnkoWWVhcikgJT4lCiAgc3VtbWFyaXNlKFNhbGVzID0gc3VtKFNhbGVzKSwgCiAgICAgICAgICAgIFByb2ZpdCA9IHN1bShQcm9maXQpKSAlPiUKICBhcnJhbmdlKFllYXIpICU+JQogIG11dGF0ZShZb1lfR3Jvd3RoX1NhbGVzID0gKFNhbGVzIC0gbGFnKFNhbGVzKSkvbGFnKFNhbGVzKSwKICAgICAgICAgWW9ZX0dyb3d0aF9Qcm9maXQgPSAoUHJvZml0IC0gbGFnKFByb2ZpdCkpL2FicyhsYWcoUHJvZml0KSksCiAgICAgICAgIFllYXIgPSBhcy5mYWN0b3IoWWVhcikpIAoKIyB0b3RhbCBwaXZvdCB2aXoKWW9ZX1NhbGVzICU+JQogIG11dGF0ZV9hdChjKCJZb1lfR3Jvd3RoX1NhbGVzIiwgIllvWV9Hcm93dGhfUHJvZml0IiksIAogICAgICAgICAgICB+Y2VsbF9zcGVjKHNjYWxlczo6cGVyY2VudCguLCBhY2N1cmFjeSA9IDAuMSksICJodG1sIiwgY29sb3I9Y2FzZV93aGVuKC4gPCAwIH4gInJlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gPj0gMCB+ICJncmVlbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzLm5hKC4pIH4gImxpZ2h0Z3JheSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRSVUUgfiAiYmxhY2siKSkpICU+JQogIG11dGF0ZV9hdChjKCJTYWxlcyIsICJQcm9maXQiKSwgfnNjYWxlczo6ZG9sbGFyKC4sIGFjY3VyYWN5ID0gMC4wMSkpICU+JQogIHJlbG9jYXRlKFlvWV9Hcm93dGhfU2FsZXMsIC5hZnRlciA9IFNhbGVzKSAlPiUKa2JsKGNvbC5uYW1lcyA9IGMoIlllYXIiLCAiVG90YWwiLCAiWW9ZIEdyb3d0aCIsICJUb3RhbCIsICJZb1kgR3Jvd3RoIiksCiAgICAgICAgICAgICBjYXB0aW9uID0gIlRvdGFsIHNhbGVzIGFuZCBwcm9maXQgYW5kIFlvWSBncm93dGggb2YgaXRzLiIsCiAgICBlc2NhcGUgPSBGLAogICAgYWxpZ24gPSBjKCJscnJyciIpKSAlPiUKcm93X3NwZWMoMCwgYWxpZ24gPSAiYyIpICU+JQprYWJsZV9zdHlsaW5nKGJvb3RzdHJhcF9vcHRpb25zID0gYygic3RyaXBlZCIsICJib3JkZXJlZCIpLCBmdWxsX3dpZHRoID0gVFJVRSkgJT4lCmFkZF9oZWFkZXJfYWJvdmUoaGVhZGVyID0gYygiICIsICJTYWxlcyIgPSAyLCAiUHJvZml0IiA9IDIpLCBib2xkID0gVFJVRSwgYm9yZGVyX2xlZnQgPSBUUlVFLCBib3JkZXJfcmlnaHQgPSBUUlVFKQoKYGBgCgpgYGB7ciB0b3RhbC1ncm9zcy1yZXZlbnVlLXBsb3R9CgojIFNjYWxlIGZvciBzZWNvbmQgYXhpcwpzY2FsZSA8LSBtYXgoWW9ZX1NhbGVzJFNhbGVzKQoKWW9ZX1NhbGVzICU+JQogIGdncGxvdCgpICsKICBnZW9tX2JhcihhZXMoeCA9IFllYXIsIHkgPSBTYWxlcywgZmlsbD0iR3Jvc3MgUmV2ZW51ZSIpLCAKICAgICAgICAgICBzdGF0ID0gImlkZW50aXR5Iiwgc2hvdy5sZWdlbmQgPSBUUlVFKSArCiAgZ2VvbV9obGluZSh5aW50ZXJjZXB0ID0gMCwgY29sb3I9ImRhcmtncmF5IikgKwogIGdlb21fbGluZShhZXMoeCA9IFllYXIsIHkgPSBZb1lfR3Jvd3RoX1NhbGVzICogc2NhbGUsIGdyb3VwID0gMSwgY29sb3I9IllvWSBHcm93dGgiKSwgc2l6ZSA9IDAuNzUpICsgCiAgZ2VvbV9wb2ludChhZXMoeCA9IFllYXIsIHkgPSBZb1lfR3Jvd3RoX1NhbGVzICogc2NhbGUsIGNvbG9yPSJZb1kgR3Jvd3RoIiksIHNpemUgPSAzKSArIAogIGdlb21fcG9pbnQoYWVzKHggPSBZZWFyLCB5ID0gWW9ZX0dyb3d0aF9TYWxlcyAqIHNjYWxlLCBjb2xvcj0iWW9ZIEdyb3d0aCIpLCAKICAgICAgICAgICAgIHNoYXBlPTIxLCBmaWxsID0gIndoaXRlIiwgc2l6ZSA9IDIpICsgCiAgZ2VvbV90ZXh0KGFlcyh4ID0gWWVhciwgeSA9IFlvWV9Hcm93dGhfU2FsZXMgKiBzY2FsZSwgCiAgICAgICAgICAgICAgICBsYWJlbCA9IHNjYWxlczo6cGVyY2VudChZb1lfR3Jvd3RoX1NhbGVzLCBhY2N1cmFjeSA9IDAuMSkpLCAKICAgICAgICAgICAgdmp1c3QgPSAtMS41LCBzaXplID0gNCwgY29sb3IgPSAiYmxhY2siKSArCiAgZ2VvbV90ZXh0KGFlcyh4ID0gWWVhciwgeSA9IFNhbGVzLCAKICAgICAgICAgICAgICAgIGxhYmVsID0gc2NhbGVzOjpkb2xsYXIoU2FsZXMsIGFjY3VyYWN5ID0gMC4xLCBzY2FsZSA9IDFlLTMsIHN1ZmZpeCA9ICIgSyIpKSwgCiAgICAgICAgICAgIHZqdXN0ID0gLTEuMiwgc2l6ZSA9IDQsIGNvbG9yID0gImJsYWNrIikgKwogIHNjYWxlX3lfY29udGludW91cyhzZWMuYXhpcyA9IHNlY19heGlzKHRyYW5zID0gfi4vc2NhbGUsIG5hbWUgPSAiWW9ZIEdyb3d0aCIsIAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxhYmVscyA9IHNjYWxlczo6bGFiZWxfcGVyY2VudCgpLCBicmVha3MgPSBzZXEoMCwgMSwgMC4yKSksIAogICAgICAgICAgICAgICAgICAgICBsYWJlbHMgPSBzY2FsZXM6OmxhYmVsX251bWJlcihzdWZmaXggPSAiIEsiLCBzY2FsZSA9IDFlLTMpLAogICAgICAgICAgICAgICAgICAgICBsaW1pdHMgPSBjKC0zMGUzLCA4MjBlMykpICsKICBzY2FsZV9maWxsX21hbnVhbChuYW1lID0gIiIsIHZhbHVlcz1jKCJHcm9zcyBSZXZlbnVlIj0iI0FERDdBMCIpKSArIAogIHNjYWxlX2NvbG9yX21hbnVhbChuYW1lID0gIiIsIHZhbHVlcz1jKCJZb1kgR3Jvd3RoIj0iYmxhY2siKSkgKwogIGxhYnModGl0bGUgPSAiVG90YWwgZ3Jvc3MgcmV2ZW51ZSAmIHllYXIgb3ZlciB5ZWFyIChZb1kpIGdyb3d0aCByYXRlIiwgeSA9ICJHcm9zcyBSZXZlbnVlLCAkIikgKwogIGd1aWRlcyhjb2xvciA9IGd1aWRlX2xlZ2VuZChvdmVycmlkZS5hZXMgPSBsaXN0KGZpbGwgPSAid2hpdGUiKSksCiAgICAgICAgIGxpbmV0eXBlID0gZ3VpZGVfbGVnZW5kKG92ZXJyaWRlLmFlcyA9IGxpc3QoZmlsbCA9ICJ3aGl0ZSIpKSkgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJib3R0b20iLAogICAgICAgIGxlZ2VuZC5ib3g9Imhvcml6b250YWwiLAogICAgICAgIGxlZ2VuZC5rZXkgPSBlbGVtZW50X3JlY3QoZmlsbD0id2hpdGUiLCBjb2xvcj0id2hpdGUiKSwKICAgICAgICBheGlzLnRpdGxlLnggPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgYXhpcy50ZXh0LnggPSBlbGVtZW50X3RleHQoZmFjZT0iYm9sZCIpKSAKCmBgYAoKT3VyIG9ic2VydmF0aW9ucyBhcmU6CgotICAgVG90YWwgcmV2ZW51ZSBpbiAyMDE3IGlzICQ3MzMuMiBLIGFuZCB0aGUgdG90YWwgYW1vdW50IG9mIHJldmVudWUgc2hvd3MgcGVybWFuZW50IFlvWSBncm93dGggaW4gYWJzb2x1dGUgbnVtYmVycyBleGNlcHQgaW4gMjAxNSB0aGF0IHNob3dlZCBzbWFsbCBkcm9wcGluZy4KLSAgIDIwMTcgeWVhciBzaG93cyBkcm9wcGluZyBvZiBZb1kgU2FsZXMgZ3Jvd3RoIHJhdGUgb24gOS4xJSB2cyBwcmV2aW91cyB5ZWFyLCB0aGF0IHNob3dlZCBtb3JlIHRoYW4gMzAlIGdyb3d0aCBmcm9tIG5lZ2F0aXZlIHBvc2l0aW9uIGluIDIwMTUuCgoKIyMgV2hhdCBpcyB0b3RhbCBwcm9maXQgYW5kIFlvWSBncm93dGggcmF0ZSBvZiBpdHM/CgpgYGB7ciB0b3RhbC1wcm9maXQtcGxvdH0KCiMgc2NhbGUgZm9yIHNlY29uZCBheGlzCnNjYWxlIDwtIG1heChZb1lfU2FsZXMkUHJvZml0KQpZb1lfU2FsZXMgJT4lCiAgZ2dwbG90KCkgKwogIGdlb21fYmFyKGFlcyh4ID0gWWVhciwgeSA9IFByb2ZpdCwgZmlsbD0iVG90YWwgUHJvZml0IiksIAogICAgICAgICAgIHN0YXQgPSAiaWRlbnRpdHkiLCBzaG93LmxlZ2VuZCA9IFRSVUUpICsKICBnZW9tX2xpbmUoYWVzKHggPSBZZWFyLCAKICAgICAgICAgICAgICAgIHkgPSBZb1lfR3Jvd3RoX1Byb2ZpdCAqIHNjYWxlLCAKICAgICAgICAgICAgICAgIGdyb3VwID0gMSwgCiAgICAgICAgICAgICAgICBjb2xvcj0iWW9ZIEdyb3d0aCIpLCBzaXplID0gMC43NSkgKyAKICBnZW9tX3BvaW50KGFlcyh4ID0gWWVhciwgCiAgICAgICAgICAgICAgICAgeSA9IFlvWV9Hcm93dGhfUHJvZml0ICogc2NhbGUsIAogICAgICAgICAgICAgICAgIGNvbG9yPSJZb1kgR3Jvd3RoIiksIHNpemUgPSAzKSArIAogIGdlb21fcG9pbnQoYWVzKHggPSBZZWFyLCAKICAgICAgICAgICAgICAgICB5ID0gWW9ZX0dyb3d0aF9Qcm9maXQgKiBzY2FsZSwgCiAgICAgICAgICAgICAgICAgY29sb3I9IllvWSBHcm93dGgiKSwgCiAgICAgICAgICAgICBzaGFwZT0yMSwgZmlsbCA9ICJ3aGl0ZSIsIHNpemUgPSAyKSArIAogIGdlb21fdGV4dChhZXMoeCA9IFllYXIsIHkgPSBZb1lfR3Jvd3RoX1Byb2ZpdCAqIHNjYWxlLCAKICAgICAgICAgICAgICAgIGxhYmVsID0gc2NhbGVzOjpwZXJjZW50KFlvWV9Hcm93dGhfUHJvZml0LCBhY2N1cmFjeSA9IDAuMSkpLCAKICAgICAgICAgICAgdmp1c3QgPSAtMS41LCBzaXplID0gMywgY29sb3IgPSAiYmxhY2siKSArCiAgZ2VvbV90ZXh0KGFlcyh4ID0gWWVhciwgeSA9IFByb2ZpdCwgbGFiZWwgPSBzY2FsZXM6OmRvbGxhcihQcm9maXQsIGFjY3VyYWN5ID0gMC4xLCBzY2FsZSA9IDFlLTMsIHN1ZmZpeCA9ICIgSyIpKSwgCiAgICAgICAgICAgICB2anVzdCA9IC0xLjIsIHNpemUgPSA0LCBjb2xvciA9ICJibGFjayIpICsgCiAgc2NhbGVfeV9jb250aW51b3VzKHNlYy5heGlzID0gc2VjX2F4aXModHJhbnMgPSB+Li9zY2FsZSwgbmFtZSA9ICJZb1kgR3Jvd3RoIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbGFiZWxzID0gc2NhbGVzOjpsYWJlbF9wZXJjZW50KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtzID0gc2VxKDAsIDEsIDAuMikpLCAKICAgICAgICAgICAgICAgICAgICAgbGFiZWxzID0gc2NhbGVzOjpsYWJlbF9udW1iZXIoc3VmZml4ID0gIiBLIiwgc2NhbGUgPSAxZS0zKSwKICAgICAgICAgICAgICAgICAgICAgbGltaXRzID0gYygwLCAxMDBlMykpICsKICBzY2FsZV9maWxsX21hbnVhbChuYW1lID0gIiIsIHZhbHVlcz1jKCJUb3RhbCBQcm9maXQiPSIjQUREN0EwIikpICsgCiAgc2NhbGVfY29sb3JfbWFudWFsKG5hbWUgPSAiIiwgdmFsdWVzPWMoIllvWSBHcm93dGgiPSJibGFjayIpKSArCiAgbGFicyh0aXRsZSA9ICJUb3RhbCBwcm9maXQgJiB5ZWFyIG92ZXIgeWVhciAoWW9ZKSBncm93dGggcmF0ZSIsIHggPSAiWWVhciIsIHkgPSAiUHJvZml0LCAkIikgKwogIGd1aWRlcyhjb2xvciA9IGd1aWRlX2xlZ2VuZChvdmVycmlkZS5hZXMgPSBsaXN0KGZpbGwgPSAid2hpdGUiKSksCiAgICAgICAgIGxpbmV0eXBlID0gZ3VpZGVfbGVnZW5kKG92ZXJyaWRlLmFlcyA9IGxpc3QoZmlsbCA9ICJ3aGl0ZSIpKSkgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJib3R0b20iLAogICAgICAgIGxlZ2VuZC5ib3g9Imhvcml6b250YWwiLAogICAgICAgIGxlZ2VuZC5rZXkgPSBlbGVtZW50X3JlY3QoZmlsbD0id2hpdGUiLCBjb2xvcj0id2hpdGUiKSwKICAgICAgICBheGlzLnRpdGxlLnggPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgYXhpcy50ZXh0LnggPSBlbGVtZW50X3RleHQoZmFjZT0iYm9sZCIpKQoKYGBgCgpPdXIgb2JzZXJ2YXRpb25zIGFyZToKCi0gICBUaGUgdG90YWwgYW1vdW50IG9mIHByb2ZpdCBzaG93cyBwZXJtYW5lbnQgWW9ZIGdyb3d0aCBpbiBhYnNvbHV0ZSBudW1iZXJzLgotICAgWW9ZIFByb2ZpdCBncm93dGggZHJvcHBlZCBvbiAxOC41JSBpbiAyMDE3IHZzIHByZXZpb3VzIHllYXIuCgoKIyMgV2hpY2ggYXJlIFNhbGVzIGFuZCBhdmVyYWdlIFByaWNlIHF1YXJ0ZXJseT8KCmBgYCB7ciBzYWxlcy1hdmctcHJpY2UtcGxvdH0KCiMgc2FsZXMgYW5kIGF2ZyBwcmljZSBxdWFydGVybHkKc2FsZXNfcHJpY2UgPC0gT3JkZXJzICU+JQogIG11dGF0ZShZZWFyID0geWVhcihgT3JkZXIgRGF0ZWApLCBRdWFydGVyID0gcXVhcnRlcihgT3JkZXIgRGF0ZWApKSAlPiUKICBncm91cF9ieShZZWFyLCBRdWFydGVyKSAlPiUKICBzdW1tYXJpc2UoU2FsZXMgPSBzdW0oU2FsZXMpLCBRdWFudGl0eSA9IHN1bShRdWFudGl0eSksIFByaWNlID0gU2FsZXMgLyBRdWFudGl0eSwgLmdyb3VwcyA9ICJkcm9wIikgJT4lCiAgdW5ncm91cCgpICU+JQogIHNlbGVjdCgtUXVhbnRpdHkpICU+JQogIG11dGF0ZShZUSA9IHBhc3RlMCgiUSIsIFF1YXJ0ZXIsICInIiwgc3Vic3RyaW5nKGFzLmNoYXJhY3RlcihZZWFyKSxuY2hhcihhcy5jaGFyYWN0ZXIoWWVhcikpLTEpKSwgbiA9IHJvd19udW1iZXIoKSkgJT4lCiAgbXV0YXRlKFlRID0gYXMuZmFjdG9yKFlRKSkgJT4lCiAgbXV0YXRlKFlRID0gZmN0X3Jlb3JkZXIoWVEsIG4pKQoKc2NhbGUgPC0gbWF4KHNhbGVzX3ByaWNlJFNhbGVzKSAvIG1heChzYWxlc19wcmljZSRQcmljZSkgCgpzYWxlc19wcmljZSAlPiUKICBnZ3Bsb3QoKSArCiAgZ2VvbV9iYXIoYWVzKHggPSBZUSwgeSA9IFNhbGVzLCBmaWxsID0gIlNhbGVzIiksIHN0YXQgPSAiaWRlbnRpdHkiLCBzaG93LmxlZ2VuZCA9IFRSVUUpICsKICBnZW9tX2xpbmUoYWVzKHggPSBZUSwgeSA9IFByaWNlICogc2NhbGUsIGdyb3VwID0gMSwgY29sb3I9IkF2Zy4gUHJpY2UiKSwgc2l6ZSA9IDAuNzUpICsgCiAgZ2VvbV9wb2ludChhZXMoeCA9IFlRLCB5ID0gUHJpY2UgKiBzY2FsZSwgY29sb3I9IkF2Zy4gUHJpY2UiKSwgc2l6ZSA9IDIsIHNoYXBlPTE1KSArCiAgZ2VvbV90ZXh0KGFlcyh4ID0gWVEsIHkgPSBQcmljZSAqIHNjYWxlLCBsYWJlbCA9IHNjYWxlczo6ZG9sbGFyKHJvdW5kKFByaWNlLCAxKSksIHZqdXN0ID0gaWZlbHNlKGxhZyhQcmljZSkgPiBQcmljZSAmIGxlYWQoUHJpY2UpID4gUHJpY2UsIDIsIC0xLjUpKSwgc2l6ZSA9IDMpICsKICBzY2FsZV95X2NvbnRpbnVvdXMoc2VjLmF4aXMgPSBzZWNfYXhpcyh0cmFucyA9IH4uL3NjYWxlLCBuYW1lID0gIkF2ZXJhZ2UgUHJpY2UsICQiKSwgbGFiZWxzID0gc2NhbGVzOjpsYWJlbF9udW1iZXIoc3VmZml4ID0gIksiLCBzY2FsZSA9IDFlLTMpLCBsaW1pdHMgPSBjKDAsIDMwMGUzKSkgKwogIGxhYnModGl0bGUgPSAiU2FsZXMgYW5kIFByaWNlIHF1YXJ0ZXJseSBmb3IgYWxsIHRoZSB0aW1lIiwgeCA9ICJRdWFydGVyIiwgeSA9ICJTYWxlcywgJCIpICsKICBzY2FsZV9jb2xvdXJfbWFudWFsKCIiLCB2YWx1ZXM9YygiQXZnLiBQcmljZSIgPSAiYmxhY2siKSkrCiAgc2NhbGVfZmlsbF9tYW51YWwoIiIsIHZhbHVlcz1jKCJTYWxlcyIgPSAiI0FERDdBMCIpKSsKICBnZW9tX3ZsaW5lKGFlcyh4aW50ZXJjZXB0ID0gNC41KSwgbGluZXR5cGUgPSAiZG90dGVkIikgKwogIGdlb21fdmxpbmUoYWVzKHhpbnRlcmNlcHQgPSA4LjUpLCBsaW5ldHlwZSA9ICJkb3R0ZWQiKSArCiAgZ2VvbV92bGluZShhZXMoeGludGVyY2VwdCA9IDEyLjUpLCBsaW5ldHlwZSA9ICJkb3R0ZWQiKSArCiAgZ3VpZGVzKGNvbG9yID0gZ3VpZGVfbGVnZW5kKG92ZXJyaWRlLmFlcyA9IGxpc3QoZmlsbCA9IE5BKSksCiAgICAgICAgIGxpbmV0eXBlID0gZ3VpZGVfbGVnZW5kKG92ZXJyaWRlLmFlcyA9IGxpc3QoZmlsbCA9IE5BKSkpICsKICAgIHRoZW1lKGxlZ2VuZC5rZXk9ZWxlbWVudF9yZWN0KGZpbGwgPSAid2hpdGUiLCBjb2xvcj0id2hpdGUiKSwKICAgICAgICAgIGxlZ2VuZC5ib3g9Imhvcml6b250YWwiLAogICAgICAgICAgbGVnZW5kLnBvc2l0aW9uPSJib3R0b20iKSAgCgpgYGAKCgpgYGB7ciBzYWxlcy1wcmljZS1ieS1zZWdtZW50fQoKbyA8LSBPcmRlcnMgJT4lCiAgbXV0YXRlKFllYXIgPSB5ZWFyKGBPcmRlciBEYXRlYCksIFF1YXJ0ZXIgPSBxdWFydGVyKGBPcmRlciBEYXRlYCkpICU+JQogIGdyb3VwX2J5KFllYXIsIFF1YXJ0ZXIsIFNlZ21lbnQpICU+JQogIHN1bW1hcmlzZShTYWxlcyA9IHN1bShTYWxlcyksIFF1YW50aXR5ID0gc3VtKFF1YW50aXR5KSwgUHJpY2UgPSBTYWxlcyAvIFF1YW50aXR5LCAuZ3JvdXBzID0gImRyb3AiKSAlPiUKICB1bmdyb3VwKCkgJT4lCiAgc2VsZWN0KC1RdWFudGl0eSkgJT4lCiAgbXV0YXRlKFlRID0gcGFzdGUwKCJRIiwgUXVhcnRlciwgIiciLCBzdWJzdHJpbmcoYXMuY2hhcmFjdGVyKFllYXIpLG5jaGFyKGFzLmNoYXJhY3RlcihZZWFyKSktMSkpLCBuID0gcm93X251bWJlcigpKSAlPiUKICBtdXRhdGUoWVEgPSBhcy5mYWN0b3IoWVEpKSAlPiUKICBtdXRhdGUoWVEgPSBmY3RfcmVvcmRlcihZUSwgbikpCgpvICU+JQogIGdncGxvdCgpICsKICBnZW9tX2JhcihhZXMoeCA9IFlRLCB5ID0gU2FsZXMsIGZpbGwgPSAiU2FsZXMiKSwgc3RhdCA9ICJpZGVudGl0eSIsIHNob3cubGVnZW5kID0gVFJVRSkgKwogIGdlb21fbGluZShhZXMoeCA9IFlRLCB5ID0gUHJpY2UgKiBzY2FsZSwgZ3JvdXAgPSBTZWdtZW50LCBjb2xvcj1TZWdtZW50KSwgc2l6ZSA9IDAuNzUpICsgCiAgZ2VvbV9wb2ludChhZXMoeCA9IFlRLCB5ID0gUHJpY2UgKiBzY2FsZSwgY29sb3I9U2VnbWVudCksIHNpemUgPSAxLCBzaGFwZT0xNSkgKyAgCiAgZ2VvbV90ZXh0KGFlcyh4ID0gWVEsIHkgPSBQcmljZSAqIHNjYWxlLCBsYWJlbCA9IHNjYWxlczo6ZG9sbGFyKHJvdW5kKFByaWNlLCAxKSksIHZqdXN0ID0gaWZlbHNlKGxhZyhQcmljZSkgPiBQcmljZSAmIGxlYWQoUHJpY2UpID4gUHJpY2UsIDIsIC0xLjUpKSwgc2l6ZSA9IDIpICsKICBnZW9tX3ZsaW5lKGFlcyh4aW50ZXJjZXB0ID0gNC41KSwgbGluZXR5cGUgPSAiZG90dGVkIikgKwogIGdlb21fdmxpbmUoYWVzKHhpbnRlcmNlcHQgPSA4LjUpLCBsaW5ldHlwZSA9ICJkb3R0ZWQiKSArCiAgZ2VvbV92bGluZShhZXMoeGludGVyY2VwdCA9IDEyLjUpLCBsaW5ldHlwZSA9ICJkb3R0ZWQiKSArCiAgc2NhbGVfeV9jb250aW51b3VzKHNlYy5heGlzID0gc2VjX2F4aXModHJhbnMgPSB+Li9zY2FsZSwgbmFtZSA9ICJBdmVyYWdlIFByaWNlLCAkIiksIGxhYmVscyA9IHNjYWxlczo6bGFiZWxfbnVtYmVyKHN1ZmZpeCA9ICJLIiwgc2NhbGUgPSAxZS0zKSwgbGltaXRzID0gYygwLCA2NTBlMykpICsKICBsYWJzKHRpdGxlID0gIlNhbGVzIGFuZCBQcmljZSBxdWFydGVybHkgZm9yIGFsbCB0aGUgdGltZSIsIHggPSAiUXVhcnRlciIsIHkgPSAiU2FsZXMsICQiKSArCiAgc2NhbGVfZmlsbF9tYW51YWwoIiIsIHZhbHVlcz1jKCJTYWxlcyIgPSAiI0FERDdBMCIpKSsKICBndWlkZXMoY29sb3IgPSBndWlkZV9sZWdlbmQob3ZlcnJpZGUuYWVzID0gbGlzdChmaWxsID0gTkEpKSwKICAgICAgICAgbGluZXR5cGUgPSBndWlkZV9sZWdlbmQob3ZlcnJpZGUuYWVzID0gbGlzdChmaWxsID0gTkEpKSkgKwogICAgdGhlbWUobGVnZW5kLmtleT1lbGVtZW50X3JlY3QoZmlsbCA9ICJ3aGl0ZSIsIGNvbG9yPSJ3aGl0ZSIpLAogICAgICAgICAgbGVnZW5kLnRpdGxlPWVsZW1lbnRfYmxhbmsoKSwKICAgICAgICAgIGxlZ2VuZC5ib3g9Imhvcml6b250YWwiLAogICAgICAgICAgbGVnZW5kLnBvc2l0aW9uPSJib3R0b20iKSAKCmBgYAoKCiMjIFdoYXQgaXMgYXZlcmFnZSBvcmRlciB2YWx1ZSBieSBtb250aD8KCmBgYHtyfQoKT3JkZXJzICU+JQogIGdyb3VwX2J5KGBPcmRlciBJRGApICU+JQogIHN1bW1hcmlzZShTYWxlcyA9IHN1bShTYWxlcyksIGBPcmRlciBEYXRlYCA9IGZpcnN0KGBPcmRlciBEYXRlYCksIFllYXIgPSBmaXJzdCh5ZWFyKGBPcmRlciBEYXRlYCkpKSAlPiUKICB1bmdyb3VwKCkgJT4lCiAgbXV0YXRlKE1vbnRoID0gbW9udGgoYE9yZGVyIERhdGVgKSwgWWVhciA9IGFzLmZhY3RvcihZZWFyKSkgJT4lCiAgZ3JvdXBfYnkoWWVhciwgTW9udGgpICU+JQogIHN1bW1hcmlzZShBdmcuU2FsZXMgPSBtZWFuKFNhbGVzKSkgJT4lCiAgbXV0YXRlKGBNb250aCBOYW1lYCA9IG1vbnRoLm5hbWVbTW9udGhdKSAlPiUKICBtdXRhdGUoYE1vbnRoIE5hbWVgID0gcmVvcmRlcl92YWx1ZShgTW9udGggTmFtZWAsIE1vbnRoLCBGQUxTRSkpICU+JQogIGZpbHRlcihZZWFyICVpbiUgYygyMDE2LCAyMDE3KSkgJT4lCiAgZ2dwbG90KCkgKwogIGdlb21fbGluZShhZXMoeCA9IGBNb250aCBOYW1lYCwgeSA9IEF2Zy5TYWxlcywgY29sb3I9WWVhciwgZ3JvdXAgPSBZZWFyKSwgc2hvdy5sZWdlbmQgPSBUUlVFLCBzaXplPTEpICsKICBnZW9tX3BvaW50KGFlcyh4ID0gYE1vbnRoIE5hbWVgLCB5ID0gaWZlbHNlKFllYXIgPT0gMjAxNywgQXZnLlNhbGVzLCBOQSksIGNvbG9yPVllYXIpLCBzaXplPTIpICsKICBnZW9tX3BvaW50KGFlcyh4ID0gYE1vbnRoIE5hbWVgLCB5ID0gaWZlbHNlKFllYXIgPT0gMjAxNywgQXZnLlNhbGVzLCBOQSksIGNvbG9yPVllYXIpLCBzaGFwZT0yMSwgc2l6ZT0xLCAgZmlsbD0id2hpdGUiKSArCiAgZ2VvbV90ZXh0KGFlcyh4ID0gYE1vbnRoIE5hbWVgLCAKICAgICAgICAgICAgICAgIHkgPSBBdmcuU2FsZXMsIAogICAgICAgICAgICAgICAgbGFiZWwgPSBpZmVsc2UoWWVhciA9PSAyMDE3LCBzY2FsZXM6OmRvbGxhcihBdmcuU2FsZXMsIGFjY3VyYWN5ID0gMC4xKSwgTkEpLCAKICAgICAgICAgICAgICAgIGdyb3VwID0gWWVhciwgCiAgICAgICAgICAgICAgICB2anVzdCA9IGlmZWxzZSghaXMubmEobGFnKEF2Zy5TYWxlcykpICYgIWlzLm5hKGxlYWQoQXZnLlNhbGVzKSkgJiBBdmcuU2FsZXMgPCBsYWcoQXZnLlNhbGVzKSAmIEF2Zy5TYWxlcyA8IGxlYWQoQXZnLlNhbGVzKSwgMiwgLTEuMykpLCBjb2xvcj0iYmxhY2siLCBzaXplID0gMykgKwogIHNjYWxlX3hfZGlzY3JldGUoZ3VpZGUgPSBndWlkZV9heGlzKGFuZ2xlID0gNDUpKSArIAogIHNjYWxlX3lfY29udGludW91cyhsaW1pdHMgPSBjKDAsIDg1MCksIGJyZWFrcyA9IHNlcSgwLCA4NTAsIDEwMCkpICsKICBzY2FsZV9jb2xvcl9tYW51YWwobmFtZSA9ICJZZWFyIiwgdmFsdWVzPWMoIjIwMTYiPSIjRUNFQ0VDIiwgIjIwMTciPSIjNEJBMTVEIikpICsgCiAgbGFicyh0aXRsZSA9ICJBdmVyYWdlIE9yZGVyIFZhbHVlIGJ5IE1vbnRoIiwgeCA9ICJNb250aCIsIHkgPSAiU2FsZXMsICQiKSArCiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gImJvdHRvbSIpCgpgYGAKCiMjIFdoYXQgaXMgYXZlcmFnZSBvcmRlciB2YWx1ZSBieSB3ZWVrPwoKYGBge3J9CgpPcmRlcnMgJT4lCiAgZ3JvdXBfYnkoYE9yZGVyIElEYCkgJT4lCiAgc3VtbWFyaXNlKFNhbGVzID0gc3VtKFNhbGVzKSwgYE9yZGVyIERhdGVgID0gZmlyc3QoYE9yZGVyIERhdGVgKSkgJT4lCiAgdW5ncm91cCgpICU+JQogIG11dGF0ZShXZWVrID0gd2VlayhgT3JkZXIgRGF0ZWApLCBXZWVrID0gYXMuZmFjdG9yKFdlZWspLCBZZWFyID0gYXMuZmFjdG9yKHllYXIoYE9yZGVyIERhdGVgKSkpICU+JQogIGdyb3VwX2J5KFllYXIsIFdlZWspICU+JQogIHN1bW1hcmlzZShBdmcuU2FsZXMgPSBtZWFuKFNhbGVzKSkgJT4lCiAgZmlsdGVyKFllYXIgJWluJSBjKDIwMTYsIDIwMTcpKSAlPiUKICBnZ3Bsb3QoKSArCiAgZ2VvbV9saW5lKGFlcyh4ID0gV2VlaywgeSA9IEF2Zy5TYWxlcywgY29sb3I9WWVhciwgZ3JvdXAgPSBZZWFyKSwgc2hvdy5sZWdlbmQgPSBUUlVFLCBzaXplPTAuNzUpICsKICBnZW9tX3BvaW50KGFlcyh4ID0gV2VlaywgeSA9IGlmZWxzZShZZWFyID09IDIwMTcsIEF2Zy5TYWxlcywgTkEpLCBjb2xvcj1ZZWFyKSwgc2l6ZT0yKSArCiAgZ2VvbV9wb2ludChhZXMoeCA9IFdlZWssIHkgPSBpZmVsc2UoWWVhciA9PSAyMDE3LCBBdmcuU2FsZXMsIE5BKSwgY29sb3I9WWVhciksIHNoYXBlPTIxLCBzaXplPTEsICBmaWxsPSJ3aGl0ZSIpICsKICBnZW9tX3RleHQoYWVzKHggPSBXZWVrLCAKICAgICAgICAgICAgICAgIHkgPSBBdmcuU2FsZXMsIAogICAgICAgICAgICAgICAgbGFiZWwgPSBpZmVsc2UoWWVhciA9PSAyMDE3LCBzY2FsZXM6OmRvbGxhcihBdmcuU2FsZXMsIGFjY3VyYWN5ID0gMC4xKSwgTkEpLCAKICAgICAgICAgICAgICAgIGdyb3VwID0gWWVhciwgCiAgICAgICAgICAgICAgICB2anVzdCA9IGlmZWxzZSghaXMubmEobGFnKEF2Zy5TYWxlcykpICYgIWlzLm5hKGxlYWQoQXZnLlNhbGVzKSkgJiBBdmcuU2FsZXMgPCBsYWcoQXZnLlNhbGVzKSAmIEF2Zy5TYWxlcyA8IGxlYWQoQXZnLlNhbGVzKSwgMiwgLTEuMykpLCBjb2xvcj0iYmxhY2siLCBzaXplID0gMikgKwogIGdlb21fdmxpbmUoeGludGVyY2VwdCA9IHNlcSgxLCA1MiwgNTIvMTIpLCBsaW5ldHlwZSA9ICJkYXNoZWQiLCBzaXplPTAuMjUsIGNvbG9yPSJkYXJrZ3JheSIpICsKICBhbm5vdGF0ZSgidGV4dCIsIHggPSBzZXEoMSwgNTIsIDUyLzEyKSArIDIsIHkgPSAxLCBsYWJlbCA9IG1vbnRoLmFiYlsxOjEyXSwgc2l6ZT0yLCBjb2xvcj0iZGFya2dyYXkiKSArCiAgc2NhbGVfeF9kaXNjcmV0ZShndWlkZSA9IGd1aWRlX2F4aXMoYW5nbGUgPSA0NSkpICsgCiAgc2NhbGVfeV9jb250aW51b3VzKGxpbWl0cyA9IGMoMCwgMTUwMCksIGJyZWFrcyA9IHNlcSgwLCAxNTAwLCAyMDApKSArCiAgc2NhbGVfY29sb3JfbWFudWFsKG5hbWUgPSAiWWVhciIsIHZhbHVlcz1jKCIyMDE2Ij0iI0VDRUNFQyIsICIyMDE3Ij0iIzRCQTE1RCIpKSArIAogIGxhYnModGl0bGUgPSAiQXZlcmFnZSBPcmRlciBWYWx1ZSBieSBXZWVrIiwgeCA9ICJXZWVrIiwgeSA9ICJTYWxlcywgJCIpICsKICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSAiYm90dG9tIikKCmBgYAoKIyMgV2hhdCBpcyBhdmVyYWdlIG9yZGVyIHZhbHVlIGJ5IGRhdGU/CgpgYGB7cn0KCk9yZGVycyAlPiUKICBncm91cF9ieShgT3JkZXIgSURgKSAlPiUKICBzdW1tYXJpc2UoU2FsZXMgPSBzdW0oU2FsZXMpLCBgT3JkZXIgRGF0ZWAgPSBmaXJzdChgT3JkZXIgRGF0ZWApKSAlPiUKICB1bmdyb3VwKCkgJT4lCiAgbXV0YXRlKERheSA9IGRheShgT3JkZXIgRGF0ZWApLCBEYXkgPSBhcy5mYWN0b3IoRGF5KSwgWWVhciA9IGFzLmZhY3Rvcih5ZWFyKGBPcmRlciBEYXRlYCkpKSAlPiUKICBncm91cF9ieShZZWFyLCBEYXkpICU+JQogIHN1bW1hcmlzZShBdmcuU2FsZXMgPSBtZWFuKFNhbGVzKSkgJT4lCiAgZmlsdGVyKFllYXIgJWluJSBjKDIwMTYsIDIwMTcpKSAlPiUKICBnZ3Bsb3QoKSArCiAgZ2VvbV9saW5lKGFlcyh4ID0gRGF5LCB5ID0gQXZnLlNhbGVzLCBjb2xvcj1ZZWFyLCBncm91cCA9IFllYXIpLCBzaG93LmxlZ2VuZCA9IFRSVUUsIHNpemU9MC43NSkgKwogIGdlb21fcG9pbnQoYWVzKHggPSBEYXksIHkgPSBpZmVsc2UoWWVhciA9PSAyMDE3LCBBdmcuU2FsZXMsIE5BKSwgY29sb3I9WWVhciksIHNpemU9MikgKwogIGdlb21fcG9pbnQoYWVzKHggPSBEYXksIHkgPSBpZmVsc2UoWWVhciA9PSAyMDE3LCBBdmcuU2FsZXMsIE5BKSwgY29sb3I9WWVhciksIHNoYXBlPTIxLCBzaXplPTEsICBmaWxsPSJ3aGl0ZSIpICsKICBnZW9tX3RleHQoYWVzKHggPSBEYXksIAogICAgICAgICAgICAgICAgeSA9IEF2Zy5TYWxlcywgCiAgICAgICAgICAgICAgICBsYWJlbCA9IGlmZWxzZShZZWFyID09IDIwMTcsIHNjYWxlczo6ZG9sbGFyKEF2Zy5TYWxlcywgYWNjdXJhY3kgPSAwLjEpLCBOQSksIAogICAgICAgICAgICAgICAgZ3JvdXAgPSBZZWFyLCAKICAgICAgICAgICAgICAgIHZqdXN0ID0gaWZlbHNlKCFpcy5uYShsYWcoQXZnLlNhbGVzKSkgJiAhaXMubmEobGVhZChBdmcuU2FsZXMpKSAmIEF2Zy5TYWxlcyA8IGxhZyhBdmcuU2FsZXMpICYgQXZnLlNhbGVzIDwgbGVhZChBdmcuU2FsZXMpLCAyLCAtMS4zKSksIGNvbG9yPSJibGFjayIsIHNpemUgPSAyKSArCiAgc2NhbGVfeV9jb250aW51b3VzKGxpbWl0cyA9IGMoMCwgMTQwMCksIGJyZWFrcyA9IHNlcSgwLCAxNDAwLCAxMDApKSArCiAgc2NhbGVfY29sb3JfbWFudWFsKG5hbWUgPSAiWWVhciIsIHZhbHVlcz1jKCIyMDE2Ij0iI0VDRUNFQyIsICIyMDE3Ij0iIzRCQTE1RCIpKSArIAogIGxhYnModGl0bGUgPSAiQXZlcmFnZSBPcmRlciBWYWx1ZSBieSBEYXRlIiwgeCA9ICJEYXkiLCB5ID0gIlNhbGVzLCAkIikgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJib3R0b20iKQoKYGBgCgojIyBXaGF0IGlzIGF2ZXJhZ2Ugb3JkZXIgdmFsdWUgYnkgZGF5IG9mIHdlZWs/CgpgYGB7cn0KCk9yZGVycyAlPiUKICBncm91cF9ieShgT3JkZXIgSURgKSAlPiUKICBzdW1tYXJpc2UoU2FsZXMgPSBzdW0oU2FsZXMpLCBgT3JkZXIgRGF0ZWAgPSBmaXJzdChgT3JkZXIgRGF0ZWApKSAlPiUKICB1bmdyb3VwKCkgJT4lCiAgbXV0YXRlKFdkYXkgPSB3ZGF5KGBPcmRlciBEYXRlYCwgd2Vla19zdGFydD0xKSwgCiAgICAgICAgIFllYXIgPSB5ZWFyKGBPcmRlciBEYXRlYCkpICU+JQogIGdyb3VwX2J5KFllYXIsIFdkYXkpICU+JQogIHN1bW1hcmlzZShBdmcuU2FsZXMgPSBtZWFuKFNhbGVzKSkgJT4lCiAgbXV0YXRlKFdlZWtkYXkgPSBjKCJNb25kYXkiLCAiVHVlc2RheSIsICJXZWRuZXNkYXkiLCAiVGh1cnNkYXkiLCAiRnJpZGF5IiwiU2F0dXJkYXkiLCAiU3VuZGF5IilbV2RheV0sIFllYXIgPSBhcy5mYWN0b3IoWWVhcikpICU+JQogIG11dGF0ZShXZWVrZGF5ID0gcmVvcmRlcl92YWx1ZShXZWVrZGF5LCBXZGF5LCBGQUxTRSkpICU+JQogIGZpbHRlcihZZWFyICVpbiUgYygyMDE2LCAyMDE3KSkgJT4lCiAgZ2dwbG90KCkgKwogIGdlb21fbGluZShhZXMoeCA9IFdlZWtkYXksIHkgPSBBdmcuU2FsZXMsIGNvbG9yPVllYXIsIGdyb3VwID0gWWVhciksIHNob3cubGVnZW5kID0gVFJVRSwgc2l6ZSA9IDEpICsKICBnZW9tX3BvaW50KGFlcyh4ID0gV2Vla2RheSwgeSA9IGlmZWxzZShZZWFyID09IDIwMTcsIEF2Zy5TYWxlcywgTkEpLCBjb2xvcj1ZZWFyKSwgc2l6ZT0yKSArCiAgZ2VvbV9wb2ludChhZXMoeCA9IFdlZWtkYXksIHkgPSBpZmVsc2UoWWVhciA9PSAyMDE3LCBBdmcuU2FsZXMsIE5BKSwgY29sb3I9WWVhciksIHNoYXBlPTIxLCBzaXplPTEsIGZpbGw9IndoaXRlIikgKwogIGdlb21fdGV4dChhZXMoeCA9IFdlZWtkYXksIHkgPSBBdmcuU2FsZXMsIGxhYmVsID0gaWZlbHNlKFllYXIgPT0gMjAxNywgc2NhbGVzOjpkb2xsYXIoQXZnLlNhbGVzLCBhY2N1cmFjeSA9IDAuMSksIE5BKSwgdmp1c3QgPSBpZmVsc2UoIWlzLm5hKGxhZyhBdmcuU2FsZXMpKSAmICFpcy5uYShsZWFkKEF2Zy5TYWxlcykpICYgQXZnLlNhbGVzIDwgbGFnKEF2Zy5TYWxlcykgJiBBdmcuU2FsZXMgPCBsZWFkKEF2Zy5TYWxlcyksIDIsIC0xLjMpKSwgc2l6ZSA9IDMpICsKICBzY2FsZV94X2Rpc2NyZXRlKGd1aWRlID0gZ3VpZGVfYXhpcyhhbmdsZSA9IDQ1KSkgKyAKICBzY2FsZV95X2NvbnRpbnVvdXMobGltaXRzID0gYygwLCA3NTApLCBicmVha3MgPSBzZXEoMCwgNzUwLCAxMDApKSArCiAgc2NhbGVfY29sb3JfbWFudWFsKG5hbWUgPSAiWWVhciIsIHZhbHVlcz1jKCIyMDE2Ij0iI0VDRUNFQyIsICIyMDE3Ij0iIzRCQTE1RCIpKSArIAogIGxhYnModGl0bGUgPSAiQXZlcmFnZSBPcmRlciBWYWt1ZSBieSBXZWVrZGF5IiwgeCA9ICJXZWVrZGF5IiwgeSA9ICJBdmVyYWdlIFNhbGVzLCAkIikrCiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gImJvdHRvbSIpCgpgYGAKCgojIyBXaGljaCBDYXRlZ29yeSBhcmUgYmVzdCBzZWxsaW5nIGFuZCBtb3N0IHByb2ZpdGFibGU/CgpgYGB7ciBjYXRlZ29yeS1waXZvdH0KCiMgcGl2b3QgdGFibGUgYnkgY2F0ZWdvcnkKcGl2b3QxIDwtIE9yZGVycyAlPiUKICBncm91cF9ieShDYXRlZ29yeSkgJT4lCiAgc3VtbWFyaXNlKFNhbGVzID0gc3VtKFNhbGVzKSwgUHJvZml0ID0gc3VtKFByb2ZpdCksIFF1YW50aXR5ID0gc3VtKFF1YW50aXR5KSkgJT4lCiAgdW5ncm91cCgpICU+JQogIGFycmFuZ2UoLVNhbGVzKQoKYGBgCgpgYGB7ciB0b3RhbC1zYWxlcy1wcm9maXQtcXVhbnRpdHl9CgojIFRvdGFsIHNhbGVzLCBwcm9maXQgYW5kIHF1YW50aXR5IGZvciBhbGwgdGhlIHRpbWUKcGl2b3QxICU+JQogIHJiaW5kKGRhdGEuZnJhbWUoQ2F0ZWdvcnkgPSAiR3JhbmQgVG90YWwiLCBTYWxlcyA9IHN1bShwaXZvdDEkU2FsZXMpLCBQcm9maXQgPSBzdW0ocGl2b3QxJFByb2ZpdCksIFF1YW50aXR5ID0gc3VtKHBpdm90MSRRdWFudGl0eSkpKSAlPiUKICBtdXRhdGVfYXQoYygyLCAzKSwgfnNjYWxlczo6ZG9sbGFyKC4sIGFjY3VyYWN5ID0gMC4wMSkpICU+JQogIGtibChjb2wubmFtZXMgPSBjKCJDYXRlZ29yeSIsICJTYWxlcyIsICJQcm9maXQiLCAiUXVhbnRpdHkiKSwKICAgICAgICAgICAgIGNhcHRpb24gPSAiVG90YWwgU2FsZXMsIFByb2ZpdCBhbmQgUXVhbnRpdHkgYnkgQ2F0ZWdvcnkgZm9yIGFsbCB0aGUgdGltZS4iLAogICAgZXNjYXBlID0gRiwKICAgIGFsaWduID0gYygibHJyciIpKSAlPiUKcm93X3NwZWMoMCwgYWxpZ24gPSAiYyIpICU+JQprYWJsZV9zdHlsaW5nKGJvb3RzdHJhcF9vcHRpb25zID0gYygic3RyaXBlZCIsICJib3JkZXJlZCIpLCBmdWxsX3dpZHRoID0gVFJVRSkgJT4lCiAgcm93X3NwZWMobnJvdyhwaXZvdDEpICsgMSwgYm9sZCA9IFRSVUUpCgoKYGBgCgpgYGB7ciBncmFuZC10b3RhbC1jYXRlZ29yeSwgZmlnLnNob3c9ImhvbGQiLCBvdXQud2lkdGg9IjUwJSJ9CgojIFRvdGFsIHNhbGVzCnBpdm90MSAlPiUKICBnZ3Bsb3QoYWVzKHggPSBDYXRlZ29yeSwgeSA9IFNhbGVzLCBmaWxsID0gQ2F0ZWdvcnkpKSArCiAgZ2VvbV9jb2woc2hvdy5sZWdlbmQgPSBGQUxTRSkgKwogIGdlb21fdGV4dChhZXMoeCA9IENhdGVnb3J5LCB5ID0gU2FsZXMsIGxhYmVsPXNjYWxlczo6ZG9sbGFyKFNhbGVzLCBhY2N1cmFjeSA9IDAuMSwgc2NhbGUgPSAxZS0zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1ZmZpeD0iSyIpKSwgc2l6ZT00LCB2anVzdD0tMS41KSArCiAgc2NhbGVfeV9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6bGFiZWxfbnVtYmVyKHN1ZmZpeCA9ICJLIiwgc2NhbGUgPSAxZS0zKSwgCiAgICAgICAgICAgICAgICAgICAgIGxpbWl0cz1jKDAsIDkwMGUzKSwKICAgICAgICAgICAgICAgICAgICAgYnJlYWtzID0gc2VxKDAsIDkwMGUzLCAxMDBlMykpICsKICBzY2FsZV9maWxsX2JyZXdlcihwYWxldHRlPSJHcmVlbnMiKSArCiAgbGFicyh0aXRsZSA9ICJUb3RhbCBTYWxlcyIsIHggPSAiQ2F0ZWdvcnkiLCB5ID0gIlNhbGVzLCAkIikgCiAgCiMgdG90YWwgcHJvZml0CnBpdm90MSAlPiUKICBnZ3Bsb3QoYWVzKHggPSBDYXRlZ29yeSwgeSA9IFByb2ZpdCwgZmlsbCA9IENhdGVnb3J5KSkgKwogIGdlb21fY29sKHNob3cubGVnZW5kID0gRkFMU0UpICsKICBnZW9tX3RleHQoYWVzKHggPSBDYXRlZ29yeSwgeSA9IFByb2ZpdCwgbGFiZWw9c2NhbGVzOjpkb2xsYXIoUHJvZml0LCBhY2N1cmFjeSA9IDAuMSwgc2NhbGUgPSAxZS0zLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN1ZmZpeD0iSyIpKSwgc2l6ZT00LCB2anVzdD0tMS41KSArCiAgbGFicyh0aXRsZSA9ICJUb3RhbCBQcm9maXQiLCB4ID0gIkNhdGVnb3J5IiwgeSA9ICJQcm9maXQsICQiKSArCiAgc2NhbGVfZmlsbF9icmV3ZXIocGFsZXR0ZT0iR3JlZW5zIikgKwogIHNjYWxlX3lfY29udGludW91cyhsYWJlbHMgPSBzY2FsZXM6OmxhYmVsX251bWJlcihzdWZmaXggPSAiSyIsIHNjYWxlID0gMWUtMyksCiAgICAgICAgICAgICAgICAgICAgIGxpbWl0cz1jKDAsIDE3NWUzKSwgYnJlYWtzID0gc2VxKDAsIDE3NWUzLCAyNWUzKSkKCiMgdG90YWwgcXVhbnRpdHkKcGl2b3QxICU+JQogIGdncGxvdChhZXMoeCA9IENhdGVnb3J5LCB5ID0gUXVhbnRpdHksIGZpbGwgPSBDYXRlZ29yeSkpICsKICBnZW9tX2NvbChzaG93LmxlZ2VuZCA9IEZBTFNFKSArCiAgc2NhbGVfZmlsbF9icmV3ZXIocGFsZXR0ZT0iR3JlZW5zIikgKwogIGxhYnModGl0bGUgPSAiVG90YWwgUXVhbnRpdHkiLCB4ID0gIkNhdGVnb3J5IiwgeSA9ICJRdWFudGl0eSIpCgpgYGAKCk91ciBvYnNlcnZhdGlvbnMgYXJlOgoKLSAgIFRoZSBiZXN0IHNlbGxpbmcgY2F0ZWdvcnkgaXMgKipUZWNobm9sb2d5KiosIGJ1dCBhbGwgdGhyZWUgY2F0ZWdvcnkgbWFrZSBzaW1pbGFyIGFtb3VudCBvZiBzYWxlcy4KLSAgIFRoZSBtb3N0IHByb2ZpdGFibGUgY2F0ZWdvcnkgaXMgKipUZWNobm9sb2d5KiogdG9vLiBUaGUgbGVhc3QgcHJvZml0YWJsZSBjYXRlZ29yeSBpcyAqKkZ1cm5pdHVyZSoqLgotICAgKipGdXJuaXR1cmUqKiBtYWtlcyBzaW1pbGFyIHF1YW50aXR5IHNvbGQgYXMgKipUZWNobm9sb2d5KiosIGl0IGlzIG1ha2VzIHRoZSBsZWFzdCBwcm9maXQgb2YgYWxsIHRoZSBDYXRlZ29yaWVzLgoKVGhlc2UgcGxvdHMgYXBwZWFyIHRvdGFsIG1ldHJpY3MuIExldCdzIGJ1aWxkIGEgdGFibGUgd2l0aCB5ZWFyIG92ZXIgeWVhciBncm93dGggb2Ygc2FsZXMgYW5kIHByb2ZpdC4KCgojIyBXaGF0IGlzIFlvWSBTYWxlcyBhbmQgUHJvZml0IEdyb3d0aCBieSBDYXRlZ29yeT8KCmBgYHtyIHlveS1jYXRlZ29yeX0KCm9wdGlvbnMoZHBseXIuc3VtbWFyaXNlLmluZm9ybSA9IEZBTFNFKQoKWW9ZIDwtIE9yZGVycyAlPiUKICBtdXRhdGUoWWVhciA9IHllYXIoYE9yZGVyIERhdGVgKSkgJT4lCiAgZ3JvdXBfYnkoQ2F0ZWdvcnksIFllYXIpICU+JQogIHN1bW1hcmlzZShTYWxlcyA9IHJvdW5kKHN1bShTYWxlcyksIDIpLCAKICAgICAgICAgICAgUHJvZml0ID0gcm91bmQoc3VtKFByb2ZpdCksIDIpKSAlPiUKICBtdXRhdGUoWW9ZX0dyb3d0aF9TYWxlcyA9IChTYWxlcyAtIGxhZyhTYWxlcykpL2xhZyhTYWxlcyksCiAgICAgICAgIFlvWV9Hcm93dGhfUHJvZml0ID0gKFByb2ZpdCAtIGxhZyhQcm9maXQpKS9hYnMobGFnKFByb2ZpdCkpKSAKCmBgYAoKYGBge3IgeW95LWNhdGVnb3J5LXBpdm90dGFibGV9CgpZb1lfY2F0IDwtIFlvWSAlPiUKICBwaXZvdF93aWRlcihuYW1lc19mcm9tID0gIlllYXIiLCB2YWx1ZXNfZnJvbSA9IGMoIlNhbGVzIiwgIlByb2ZpdCIsICJZb1lfR3Jvd3RoX1NhbGVzIiwgIllvWV9Hcm93dGhfUHJvZml0IikpCgpzYWxlc19wcm9maXRfY29sdW1ucyA8LSBZb1lfY2F0ICU+JSB1bmdyb3VwKCkgJT4lIHNlbGVjdChzdGFydHNfd2l0aChjKCJTYWxlcyIsICJQcm9maXQiKSkpICU+JSBjb2xuYW1lcygpCnlveV9ncm93dGhfY29sdW1ucyA8LSBZb1lfY2F0ICU+JSB1bmdyb3VwKCkgJT4lIHNlbGVjdChzdGFydHNfd2l0aCgiWW9ZXyIpKSAlPiUgY29sbmFtZXMoKQoKIyB0YWJsZSB2aXoKWW9ZX2NhdCAlPiUgCiAgc2VsZWN0KGFsbF9vZihzYWxlc19wcm9maXRfY29sdW1ucykpICU+JQogIG11dGF0ZV9hdChzYWxlc19wcm9maXRfY29sdW1ucywgfnNjYWxlczo6ZG9sbGFyKC4sIGFjY3VyYWN5ID0gMUwpKSAlPiUKICBrYmwoY29sLm5hbWVzID0gYygiQ2F0ZWdvcnkiLCBhcy5jaGFyYWN0ZXIoMjAxNDoyMDE3KSwgYXMuY2hhcmFjdGVyKDIwMTQ6MjAxNykpLAogICAgICBjYXB0aW9uID0gIlNhbGVzIGFuZCBQcm9maXQgYnkgQ2F0ZWdvcnkiLCBlc2NhcGUgPSBGLCAKICAgICAgYWxpZ24gPSBjKCJsIiwgcmVwKCdyJyx0aW1lcz04KSkpICU+JQogIGthYmxlX3N0eWxpbmcoYm9vdHN0cmFwX29wdGlvbnMgPSBjKCJzdHJpcGVkIiwgImJvcmRlcmVkIiksIGZ1bGxfd2lkdGggPSBUUlVFKSAlPiUKICByb3dfc3BlYygwLCBhbGlnbiA9ICJjIikgJT4lCiAgYWRkX2hlYWRlcl9hYm92ZShoZWFkZXIgPSBjKCIgIiA9IDEsICJTYWxlcyIgPSA0LCAiUHJvZml0IiA9IDQpLCAKICAgICAgICAgICAgICAgICAgIGJvbGQgPSBUUlVFLCBib3JkZXJfbGVmdCA9IFRSVUUsIGJvcmRlcl9yaWdodCA9IFRSVUUpCgpgYGAKCmBgYHtyIHlveS1jYXRlZ29yeS15b3ktcGl2b3R0YWJsZX0KCllvWV9jYXQgJT4lIHNlbGVjdChhbGxfb2YoeW95X2dyb3d0aF9jb2x1bW5zKSkgJT4lIAogIG11dGF0ZV9pZihpcy5udW1lcmljLCB+Y2VsbF9zcGVjKHNjYWxlczo6cGVyY2VudCguLCBhY2N1cmFjeSA9IDAuMSksICJodG1sIiwgY29sb3I9Y2FzZV93aGVuKC4gPCAwIH4gInJlZCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC4gPj0gMCB+ICJncmVlbiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlzLm5hKC4pIH4gImxpZ2h0Z3JheSIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRSVUUgfiAiYmxhY2siKSkpICU+JQprYmwoY29sLm5hbWVzID0gYygiQ3VzdG9tZXIgU2VnbWVudCIsIGFzLmNoYXJhY3RlcigyMDE0OjIwMTcpLCBhcy5jaGFyYWN0ZXIoMjAxNDoyMDE3KSksCiAgICAgICAgICAgICBjYXB0aW9uID0gIlllYXIgb3ZlciB5ZWFyIFNhbGVzIGFuZCBQcm9maXQgZ3Jvd3RoIGJ5IENhdGVnb3J5IiwKICAgIGVzY2FwZSA9IEYsCiAgICBhbGlnbiA9IGMoImwiLCByZXAoJ3InLHRpbWVzPTgpKSkgJT4lCnJvd19zcGVjKDAsIGFsaWduID0gImMiKSAlPiUKa2FibGVfc3R5bGluZyhib290c3RyYXBfb3B0aW9ucyA9IGMoInN0cmlwZWQiLCAiYm9yZGVyZWQiKSwgZnVsbF93aWR0aCA9IFRSVUUpICU+JQphZGRfaGVhZGVyX2Fib3ZlKGhlYWRlciA9IGMoIiIsICJZb1kgU2FsZXMgR3Jvd3RoIiA9IDQsICJZb1kgUHJvZml0IEdyb3d0aCIgPSA0KSwgYm9sZCA9IFRSVUUsIGJvcmRlcl9sZWZ0ID0gVFJVRSwgYm9yZGVyX3JpZ2h0ID0gVFJVRSkKICAKICAKYGBgCgpgYGB7ciB5b3ktc2FsZXMtY2F0ZWdvcnktcGxvdCwgd2FybmluZz1GQUxTRX0KCnNjYWxlIDwtIG1heChZb1kkU2FsZXMpCgpZb1kgJT4lCiAgZ2dwbG90KCkgKwogICBnZW9tX2NvbChhZXMoeD1ZZWFyLCB5PVNhbGVzLCBmaWxsPSJTYWxlcyIpKSArCiAgICBnZW9tX2xpbmUoYWVzKHggPSBZZWFyLCB5ID0gWW9ZX0dyb3d0aF9TYWxlcyAqIHNjYWxlLCBncm91cCA9IENhdGVnb3J5LCBjb2xvcj0iWW9ZIEdyb3d0aCIpLCBzaXplID0gMC43NSkgKyAKICAgIGdlb21fcG9pbnQoYWVzKHggPSBZZWFyLCB5ID0gWW9ZX0dyb3d0aF9TYWxlcyAqIHNjYWxlLCBjb2xvcj0iWW9ZIEdyb3d0aCIpLCBzaXplID0gMykgKyAKICAgIGdlb21fcG9pbnQoYWVzKHggPSBZZWFyLCB5ID0gWW9ZX0dyb3d0aF9TYWxlcyAqIHNjYWxlLCBjb2xvcj0iWW9ZIEdyb3d0aCIpLCBzaGFwZT0yMSwgZmlsbCA9ICJ3aGl0ZSIsIHNpemUgPSAyKSArIAogICAgZ2VvbV90ZXh0KGFlcyh4ID0gWWVhciwgeSA9IFlvWV9Hcm93dGhfU2FsZXMgKiBzY2FsZSwgCiAgICAgICAgICAgICAgICAgIGxhYmVsID0gc2NhbGVzOjpwZXJjZW50KFlvWV9Hcm93dGhfU2FsZXMsIGFjY3VyYWN5PTFMKSwKICAgICAgICAgICAgICAgICAgdmp1c3QgPSBpZmVsc2UoWW9ZX0dyb3d0aF9TYWxlcyA8IDAsIDIsIC0xLjUpKSwgc2l6ZSA9IDMsIGNvbG9yID0gImJsYWNrIikgKwogICBsYWJzKHRpdGxlID0gIllvWSBTYWxlcyBHcm93dGggYnkgQ2F0ZWdvcnkiLCB4ID0gIlllYXIiLCB5ID0gIlNhbGVzLCAkIikgKwogICBzY2FsZV95X2NvbnRpbnVvdXMoc2VjLmF4aXMgPSBzZWNfYXhpcyh0cmFucyA9IH4uL3NjYWxlLCBuYW1lID0gIiIsIGxhYmVscyA9IHNjYWxlczo6bGFiZWxfcGVyY2VudCgpLCBicmVha3MgPSBzZXEoMCwgMSwgMC4yKSksIAogICAgICAgICAgICAgICAgICAgICAgbGFiZWxzID0gc2NhbGVzOjpudW1iZXIoc2VxKDAsIDMwMGUzLCBieT01MGUzKSwgc2NhbGUgPSAxZS0zLCBzdWZmaXggPSAiSyIpLCBsaW1pdHMgPSBjKC01MGUzLCAzMDBlMyksCiAgICAgICAgICAgICAgICAgICAgICBicmVha3MgPSBzZXEoMCwgMzAwZTMsIGJ5PTUwZTMpKSArCiAgc2NhbGVfZmlsbF9tYW51YWwobmFtZSA9ICJZZWFyIiwgdmFsdWVzPWMoIlNhbGVzIj0iI0FERDdBMCIpKSArCiAgc2NhbGVfY29sb3VyX21hbnVhbChuYW1lID0gIiIsIHZhbHVlcz1jKCJZb1kgR3Jvd3RoIj0iYmxhY2siKSkgKwogIGZhY2V0X3dyYXAoLn5DYXRlZ29yeSkgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJib3R0b20iLCBsZWdlbmQudGl0bGUgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgc3RyaXAuYmFja2dyb3VuZCA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBzdHJpcC50ZXh0ID0gZWxlbWVudF90ZXh0KGNvbG9yID0gImJsYWNrIiwgZmFjZSA9ICJib2xkIikpCgpgYGAKCmBgYHtyIHlveS1wcm9maXQtY2F0ZWdvcnktcGxvdCwgd2FybmluZz1GQUxTRX0KCnNjYWxlIDwtIG1heChZb1kkUHJvZml0KQoKWW9ZICU+JQogIGdncGxvdCgpICsKICAgZ2VvbV9jb2woYWVzKHg9WWVhciwgeT1Qcm9maXQsIGZpbGw9IlByb2ZpdCIpKSArCiAgICBnZW9tX2xpbmUoYWVzKHggPSBZZWFyLCB5ID0gWW9ZX0dyb3d0aF9Qcm9maXQgKiBzY2FsZSwgZ3JvdXAgPSBDYXRlZ29yeSwgY29sb3I9IllvWSBHcm93dGgiKSwgc2l6ZSA9IDAuNzUpICsgCiAgICBnZW9tX3BvaW50KGFlcyh4ID0gWWVhciwgeSA9IFlvWV9Hcm93dGhfUHJvZml0ICogc2NhbGUsIGNvbG9yPSJZb1kgR3Jvd3RoIiksIHNpemUgPSAzKSArIAogICAgZ2VvbV9wb2ludChhZXMoeCA9IFllYXIsIHkgPSBZb1lfR3Jvd3RoX1Byb2ZpdCAqIHNjYWxlLCBjb2xvcj0iWW9ZIEdyb3d0aCIpLCBzaGFwZT0yMSwgZmlsbCA9ICJ3aGl0ZSIsIHNpemUgPSAyKSArIAogICAgZ2VvbV90ZXh0KGFlcyh4ID0gWWVhciwgeSA9IFlvWV9Hcm93dGhfUHJvZml0ICogc2NhbGUsIAogICAgICAgICAgICAgICAgICBsYWJlbCA9IHNjYWxlczo6cGVyY2VudChZb1lfR3Jvd3RoX1Byb2ZpdCwgYWNjdXJhY3k9MUwpLAogICAgICAgICAgICAgICAgICB2anVzdCA9IGlmZWxzZShZb1lfR3Jvd3RoX1Byb2ZpdCA8IDAsIDIsIC0xLjUpKSwgc2l6ZSA9IDMsIGNvbG9yID0gImJsYWNrIikgKwogICBsYWJzKHRpdGxlID0gIllvWSBQcm9maXQgR3Jvd3RoIGJ5IENhdGVnb3J5IiwgeCA9ICJZZWFyIiwgeSA9ICJQcm9maXQsICQiKSArCiAgIHNjYWxlX3lfY29udGludW91cyhzZWMuYXhpcyA9IHNlY19heGlzKHRyYW5zID0gfi4vc2NhbGUsIG5hbWUgPSAiIiwgbGFiZWxzID0gc2NhbGVzOjpsYWJlbF9wZXJjZW50KCksIGJyZWFrcyA9IHNlcSgwLCAxLCAwLjIpKSwgCiAgICAgICAgICAgICAgICAgICAgICBsYWJlbHMgPSBzY2FsZXM6Om51bWJlcihzZXEoMCwgODBlMywgYnk9MjVlMyksIHNjYWxlID0gMWUtMywgc3VmZml4ID0gIksiKSwgbGltaXRzID0gYygtNDBlMywgODBlMyksCiAgICAgICAgICAgICAgICAgICAgICBicmVha3MgPSBzZXEoMCwgODBlMywgYnk9MjVlMykpICsKICBzY2FsZV9maWxsX21hbnVhbChuYW1lID0gIlllYXIiLCB2YWx1ZXM9YygiUHJvZml0Ij0iI0FERDdBMCIpKSArCiAgc2NhbGVfY29sb3VyX21hbnVhbChuYW1lID0gIiIsIHZhbHVlcz1jKCJZb1kgR3Jvd3RoIj0iYmxhY2siKSkgKwogIGZhY2V0X3dyYXAoLn5DYXRlZ29yeSkgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJib3R0b20iLCBsZWdlbmQudGl0bGUgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgc3RyaXAuYmFja2dyb3VuZCA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBzdHJpcC50ZXh0ID0gZWxlbWVudF90ZXh0KGNvbG9yID0gImJsYWNrIiwgZmFjZSA9ICJib2xkIikpCgpgYGAKCk91ciBvYnNlcnZhdGlvbnMgYXJlOgoKLSAgIERlc3BpdGUgdGhlICoqRnVybml0dXJlKiogY2F0ZWdvcnkgaGFkIHBlcm1hbmVudCB0aGUgWW9ZIFNhbGVzIGdyb3d0aCB0aGlzIGNhdGVnb3J5IGhhZCBub3QgcHJvZml0IGluICoqMjAxNyoqIGFuZCBsb3NzZXMgYXJlIDU3JS4KLSAgIFNsb3dkb3duIG9mIHRoZSBZb1kgU2FsZXMgZ3Jvd3RoIGFmZmVjdGVkIHRoZSBZb1kgcHJvZml0IGdyb3d0aCBpbiAyMDE3IGZvciAqKk9mZmljZSBTdXBwbGllcyoqIENhdGVnb3J5LgotICAgRHJvcHBpbmcgb2YgdGhlIFlvWSBTYWxlcyBncm93dGggb2YgKipUZWNobm9sb2d5KiogY2F0ZWdvcnkgYWxtb3N0IGluIHR3byB0aW1lcyBpbiAqKjIwMTcqKiBkaWQgbm90IGFmZmVjdCB0aGUgWW9ZIHByb2ZpdCBncm93dGggaW4gdGhpcyBjYXRlZ29yeSwgYW5kIHZpY2UgdmVyc2EgaXQgc2hvd2VkIHRoZSBZb1kgZ3Jvd3RoIG9mIHByb2ZpdCBvbiA4JS4KCgojIyBHZW5lcmFsIG1ldHJpY3MgY2FsY3VsYXRpb24KCgpgYGB7ciBnZW5lcmFsLW1ldHJpY3N9CgojdG90YWwgbWV0cmljcwpnZW5lcmFsX21ldHJpY3MgPC0gT3JkZXJzICU+JQogIG11dGF0ZShZZWFyID0gZmFjdG9yKHllYXIoYE9yZGVyIERhdGVgKSkpICU+JQogIGdyb3VwX2J5KFllYXIpICU+JQogIHN1bW1hcmlzZShTYWxlcyA9IHN1bShTYWxlcyksIAogICAgICAgICAgICBQcm9maXQgPSBzdW0oUHJvZml0KSkgJT4lCiAgYXJyYW5nZShZZWFyKSAlPiUKICBtdXRhdGUoWW9ZX0dyb3d0aF9TYWxlcyA9IChTYWxlcyAtIGxhZyhTYWxlcykpL2xhZyhTYWxlcyksCiAgICAgICAgIFlvWV9Hcm93dGhfUHJvZml0ID0gKFByb2ZpdCAtIGxhZyhQcm9maXQpKS9hYnMobGFnKFByb2ZpdCkpKQoKYGBgCgoKIyMjIFdoYXQgaXMgdGhlIGdyb3NzIHNhbGVzIHJldmVudWU/IHsjcmV2ZW51ZS1yZWZ9CgpgYGB7ciBncm9zcy1zYWxlc30KCiMgZ3Jvc3Mgc2FsZXMKR3Jvc3NfU2FsZXMgPC0gZ2VuZXJhbF9tZXRyaWNzW2dlbmVyYWxfbWV0cmljcyRZZWFyID09ICBsYXRlc3RfeWVhciwgIlNhbGVzIl1bWzFdXQojIyBZb1kgR3Jvd3RoIFNhbGVzCllvWV9Hcm93dGhfU2FsZXMgPC0gZ2VuZXJhbF9tZXRyaWNzW2dlbmVyYWxfbWV0cmljcyRZZWFyID09IGxhdGVzdF95ZWFyLCAiWW9ZX0dyb3d0aF9TYWxlcyJdW1sxXV0KCnBhc3RlKGxhdGVzdF95ZWFyLCAiPiBHcm9zcyBTYWxlczoiLCBzY2FsZXM6OmRvbGxhcihHcm9zc19TYWxlcywgYWNjdXJhY3kgPSAwLjAxKSwgIiwgWW9ZIFNhbGVzIEdyb3d0aDoiLCBzY2FsZXM6OnBlcmNlbnQoWW9ZX0dyb3d0aF9TYWxlcywgYWNjdXJhY3kgPSAwLjEpKQoKYGBgCgoKIyMjIFdoYXQgaXMgdGhlIHRvdGFsIHByb2ZpdD8geyNwcm9maXQtcmVmfQoKYGBge3IgdG90YWwtcHJvZml0fQoKIyBwcm9maXQKcHJvZml0IDwtIGdlbmVyYWxfbWV0cmljc1tnZW5lcmFsX21ldHJpY3MkWWVhciA9PSBsYXRlc3RfeWVhciwgIlByb2ZpdCJdW1sxXV0KIyBZb1kgR3Jvd3RoIFByb2ZpdApZb1lfR3Jvd3RoX1Byb2ZpdCA8LSBnZW5lcmFsX21ldHJpY3NbZ2VuZXJhbF9tZXRyaWNzJFllYXIgPT0gbGF0ZXN0X3llYXIsICJZb1lfR3Jvd3RoX1Byb2ZpdCJdW1sxXV0KCnBhc3RlKGxhdGVzdF95ZWFyLCAiPiBHcm9zcyBQcm9maXQ6Iiwgc2NhbGVzOjpkb2xsYXIocHJvZml0LCBhY2N1cmFjeSA9IDAuMDEpLCAiLCBZb1kgUHJvZml0IEdyb3d0aDoiLCBzY2FsZXM6OnBlcmNlbnQoWW9ZX0dyb3d0aF9Qcm9maXQsIGFjY3VyYWN5ID0gMC4xKSkKCmBgYAoKCiMjIyBXaGF0IGFyZSB0b3RhbCBhbmQgbG9zcyBvcmRlcnMgYW5kIFlvWSBHcm93dGggb2YgaXRzPyB7I29yZGVycy1yZWZ9CgpgYGB7ciB0b3RhbC1sb3NzZXMtb3JkZXJzfQojIHRvdGFsIGxvc3NlcyBvcmRlcnMKdG90YWxfbG9zc2VzX29yZGVycyA8LSAoT3JkZXJzICU+JQogIGdyb3VwX2J5KGBPcmRlciBJRGApICU+JQogIHN1bW1hcmlzZShQcm9maXQgPSBzdW0oUHJvZml0KSkgJT4lCiAgc3VtbWFyaXNlKGxvc3NlcyA9IHNjYWxlczo6cGVyY2VudChuX2Rpc3RpbmN0KGBPcmRlciBJRGBbUHJvZml0IDwgMF0pL24oKSwgYWNjdXJhY3kgPSAwLjEpKSkkbG9zc2VzW1sxXV0KCnBhc3RlKCJUb3RhbCBsb3NzZXMgb3JkZXJzOiIsIHRvdGFsX2xvc3Nlc19vcmRlcnMpCgpgYGAKCgpgYGB7ciBsb3NzZXMtMSwgd2FybmluZz1GQUxTRX0KbG9zcyA8LSBPcmRlcnMgJT4lCiAgbXV0YXRlKFllYXIgPSBhcy5mYWN0b3IoeWVhcihgT3JkZXIgRGF0ZWApKSkgJT4lCiAgZ3JvdXBfYnkoYE9yZGVyIElEYCkgJT4lCiAgc3VtbWFyaXNlKFByb2ZpdCA9IHN1bShQcm9maXQpLCBZZWFyID0gZmlyc3QoWWVhcikpICU+JQogIHVuZ3JvdXAoKSAlPiUKICBncm91cF9ieShZZWFyKSAlPiUKICBzdW1tYXJpc2Uobl9vcmRlcnMgPSBuX2Rpc3RpbmN0KGBPcmRlciBJRGApLCBuX2xvc3NlcyA9IG5fZGlzdGluY3QoYE9yZGVyIElEYFtQcm9maXQgPCAwXSksIHBfbG9zc2VzID0gbl9sb3NzZXMgLyBuX29yZGVycykgJT4lCiAgbXV0YXRlKFlvWV9vcmRlcnM9KG5fb3JkZXJzLWxhZyhuX29yZGVycykpL2xhZyhuX29yZGVycyksIFlvWV9sb3NzZXM9KG5fbG9zc2VzLWxhZyhuX2xvc3NlcykpL2xhZyhuX2xvc3NlcykpCgpgYGAKCmBgYHtyIGxvc3Nlcy0yLCB3YXJuaW5nPUZBTFNFfQoKVG90YWxfT3JkZXJzIDwtIGxvc3NbbG9zcyRZZWFyID09IGxhdGVzdF95ZWFyLCAibl9vcmRlcnMiXVtbMV1dCllvWV9vcmRlcnMgPC0gbG9zc1tsb3NzJFllYXIgPT0gbGF0ZXN0X3llYXIsICJZb1lfb3JkZXJzIl1bWzFdXQpMb3NzZXNfT3JkZXJzIDwtIGxvc3NbbG9zcyRZZWFyID09IGxhdGVzdF95ZWFyLCAibl9sb3NzZXMiXVtbMV1dCllvWV9sb3NzZXMgPC0gbG9zc1tsb3NzJFllYXIgPT0gbGF0ZXN0X3llYXIsICJZb1lfbG9zc2VzIl1bWzFdXQoKcGFzdGUwKGxhdGVzdF95ZWFyLCAiID4gVG90YWwgT3JkZXJzOiAiLCAgVG90YWxfT3JkZXJzLCAiID4gWW9ZIEdyb3d0aDogIiwgCiAgICAgICBzY2FsZXM6OnBlcmNlbnQoWW9ZX29yZGVycywgYWNjdXJhY3kgPSAxTCksICIsIExvc2FibGUgT3JkZXJzOiAiLCAKICAgICAgIExvc3Nlc19PcmRlcnMsICIgPiBZb1kgR3Jvd3RoOiAiLCAKICAgICAgIHNjYWxlczo6cGVyY2VudChZb1lfbG9zc2VzLCBhY2N1cmFjeSA9IDFMKSkKCmBgYAoKYGBge3IgbG9zcy1wbG90LCBmaWcuc2hvdz0iaG9sZCIsIG91dC53aWR0aD0iNTAlIn0Kc2NhbGUxIDwtIG1heChsb3NzJG5fb3JkZXJzKQoKcGxvdDEgPC0gbG9zcyAlPiUKICBnZ3Bsb3QoKSArCiAgZ2VvbV9iYXIoYWVzKHg9WWVhciwgeT1uX29yZGVycywgZmlsbCA9ICIjIG9mIE9yZGVycyIpLCBzdGF0PSJpZGVudGl0eSIpICsKICBnZW9tX2xpbmUoYWVzKHg9WWVhciwgeT1Zb1lfb3JkZXJzKnNjYWxlMSwgZ3JvdXA9MSwgY29sb3IgPSAiWW9ZIEdyb3d0aCIpLCBzaXplPTEpICsgCiAgZ2VvbV9wb2ludChhZXMoeD1ZZWFyLCB5PVlvWV9vcmRlcnMqc2NhbGUxLCBjb2xvciA9ICJZb1kgR3Jvd3RoIiksIHNpemUgPSAzKSArIAogIGdlb21fcG9pbnQoYWVzKHg9WWVhciwgeT1Zb1lfb3JkZXJzKnNjYWxlMSwgY29sb3IgPSAiWW9ZIEdyb3d0aCIpLCBzaGFwZSA9IDIxLCBzaXplID0gMS41LCBmaWxsPSJ3aGl0ZSIpICsgCiAgZ2VvbV90ZXh0KGFlcyh4PVllYXIsIHk9WW9ZX29yZGVycypzY2FsZTEsIGxhYmVsPXNjYWxlczo6cGVyY2VudChZb1lfb3JkZXJzLCBhY2N1cmFjeT0xTCkpLCB2anVzdD0tMS41KSAgKwogIGdlb21fdGV4dChhZXMoeD1ZZWFyLCB5PW5fb3JkZXJzLCBsYWJlbD1uX29yZGVycyksIHZqdXN0PS0xKSAgKwogIHNjYWxlX3lfY29udGludW91cyhicmVha3MgPSBzZXEoMCwgMTkwMCwgMjAwKSwgc2VjLmF4aXMgPSBzZWNfYXhpcyh0cmFucyA9IH4uL3NjYWxlMSwgYnJlYWtzID0gc2VxKDAsIDEsIDAuMiksIGxhYmVscyA9IHNjYWxlczo6bGFiZWxfcGVyY2VudCgpLCBuYW1lID0gIiIpLAogICAgICAgICAgICAgICAgICAgICBsaW1pdHMgPSBjKDAsIDE5MDApKSArCiAgc2NhbGVfZmlsbF9tYW51YWwodmFsdWVzID0gYygiIyBvZiBPcmRlcnMiPSIjQUREN0EwIikpICsKICBzY2FsZV9jb2xvcl9tYW51YWwodmFsdWVzID0gYygiWW9ZIEdyb3d0aCIgPSAiYmxhY2siKSkgKwogIGxhYnModGl0bGU9IllvWSAjIG9mIE9yZGVycyBncm93dGgiLCB5ID0gIlRvdGFsICMgb2YgT3JkZXJzIikgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJib3R0b20iLAogICAgICAgIGxlZ2VuZC50aXRsZSA9IGVsZW1lbnRfYmxhbmsoKSkKCnNjYWxlMiA8LSBtYXgobG9zcyRuX2xvc3NlcykKCnBsb3QyIDwtIGxvc3MgJT4lCiAgZ2dwbG90KCkgKwogIGdlb21fYmFyKGFlcyh4PVllYXIsIHk9bl9sb3NzZXMsIGZpbGwgPSAiIyBvZiBsb3NzIE9yZGVycyIpLCBzdGF0PSJpZGVudGl0eSIpICsgCiAgZ2VvbV9saW5lKGFlcyh4PVllYXIsIHk9WW9ZX2xvc3NlcypzY2FsZTIsIGdyb3VwPTEsIGNvbG9yID0gIllvWSBHcm93dGgiKSwgc2l6ZT0xKSArIAogIGdlb21fcG9pbnQoYWVzKHg9WWVhciwgeT1Zb1lfbG9zc2VzKnNjYWxlMiwgY29sb3IgPSAiWW9ZIEdyb3d0aCIpLCBzaXplID0gMykgKyAKICBnZW9tX3BvaW50KGFlcyh4PVllYXIsIHk9WW9ZX2xvc3NlcypzY2FsZTIsIGNvbG9yID0gIllvWSBHcm93dGgiKSwgc2hhcGUgPSAyMSwgc2l6ZSA9IDEuNSwgZmlsbD0id2hpdGUiKSArIAogIGdlb21fdGV4dChhZXMoeD1ZZWFyLCB5PW5fbG9zc2VzLCBsYWJlbD1uX2xvc3NlcyksIHZqdXN0PS0xKSAgKwogIGdlb21fdGV4dChhZXMoeD1ZZWFyLCB5PVlvWV9sb3NzZXMqc2NhbGUyLCBsYWJlbD1zY2FsZXM6OnBlcmNlbnQoWW9ZX2xvc3NlcywgYWNjdXJhY3k9MUwpKSwgdmp1c3Q9LTEuNSkgKwogIHNjYWxlX3lfY29udGludW91cyhicmVha3MgPSBzZXEoMCwgNDAwLCA1MCksIHNlYy5heGlzID0gc2VjX2F4aXModHJhbnMgPSB+Li9zY2FsZTIsIGJyZWFrcyA9IHNlcSgwLCAxLCAwLjIpLCBsYWJlbHMgPSBzY2FsZXM6OmxhYmVsX3BlcmNlbnQoKSwgbmFtZSA9ICIiKSwKICAgICAgICAgICAgICAgICAgICAgbGltaXRzID0gYygwLCA0MDApKSArCiAgc2NhbGVfZmlsbF9tYW51YWwodmFsdWVzID0gYygiIyBvZiBsb3NzIE9yZGVycyI9IiNBREQ3QTAiKSkgKwogIHNjYWxlX2NvbG9yX21hbnVhbCh2YWx1ZXMgPSBjKCJZb1kgR3Jvd3RoIiA9ICJibGFjayIpKSArCiAgbGFicyh0aXRsZT0iWW9ZICMgb2YgbG9zcyBPcmRlcnMgZ3Jvd3RoIiwgeSA9ICIjIG9mIGxvc3MgT3JkZXJzIikgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJib3R0b20iLAogICAgICAgIGxlZ2VuZC50aXRsZSA9IGVsZW1lbnRfYmxhbmsoKSkKICAKcGxvdDEKcGxvdDIKCmBgYAoKCiMjIFdoaWNoIFN1Yi1DYXRlZ29yeSBhcmUgYmVzdCBzZWxsaW5nIGFuZCBtb3N0IHByb2ZpdGFibGUvbG9zc2FibGU/CgpgYGB7ciBzdWItY2F0ZWdvcnktcGl2b3R9Cgp0b3RhbF9zYWxlc19wcm9maXQgPC0gT3JkZXJzICU+JQogIGdyb3VwX2J5KGBTdWItQ2F0ZWdvcnlgKSAlPiUKICBzdW1tYXJpc2UoU2FsZXMgPSBzdW0oU2FsZXMpLCBQcm9maXQgPSBzdW0oUHJvZml0KSwgUXVhbnRpdHkgPSBzdW0oUXVhbnRpdHkpKSAlPiUKICB1bmdyb3VwKCkgJT4lCiAgYXJyYW5nZSgtU2FsZXMpCgpgYGAKCgpgYGB7ciBwbG90LXN1YmNhdGVncnl9Cgp0b3RhbF9zYWxlc19wcm9maXQgJT4lCiAgZ2dwbG90KGFlcyh4ID0gcmVvcmRlcl92YWx1ZShgU3ViLUNhdGVnb3J5YCwgU2FsZXMsIFRSVUUpLCB5ID0gU2FsZXMpKSArCiAgZ2VvbV9jb2woZmlsbD0iI0FERDdBMCIsIHNob3cubGVnZW5kID0gRkFMU0UpICsKICBnZW9tX3RleHQoYWVzKHggPSBgU3ViLUNhdGVnb3J5YCwgeSA9IFNhbGVzLCBsYWJlbCA9IHNjYWxlczo6ZG9sbGFyKFNhbGVzLCBzY2FsZT0xZS0zLCBzdWZmaXggPSAiSyIsIGFjY3VyYWN5ID0gMC4xKSksIHZqdXN0ID0gLTEuMiwgc2l6ZSA9IDIuMywgY29sb3IgPSAiYmxhY2siKSArCiAgc2NhbGVfeF9kaXNjcmV0ZShndWlkZSA9IGd1aWRlX2F4aXMoYW5nbGUgPSA0NSkpICsgCiAgbGFicyh0aXRsZSA9ICJUb3RhbCBTYWxlcyBieSBTdWItQ2F0ZWdvcnkgZm9yIGFsbCB0aGUgdGltZSIsIHggPSAiU3ViLUNhdGVnb3J5IiwgeSA9ICJTYWxlcywgJCIpICsKICBzY2FsZV95X2NvbnRpbnVvdXMobGFiZWxzID0gc2NhbGVzOjpsYWJlbF9udW1iZXIoc3VmZml4ID0gIksiLCBzY2FsZSA9IDFlLTMpLCBsaW1pdHMgPSBjKDAsIDM1MGUzKSwgYnJlYWtzID0gc2VxKDAsIDM1MGUzLCA1MGUzKSkKCmBgYAoKCmBgYHtyIHN1YmNhdGVnb3J5LXByb2ZpdC1wbG90fQoKdG90YWxfc2FsZXNfcHJvZml0ICU+JQogIGdncGxvdChhZXMoeCA9IHJlb3JkZXJfdmFsdWUoYFN1Yi1DYXRlZ29yeWAsIFByb2ZpdCwgVFJVRSksIHkgPSBQcm9maXQpKSArCiAgZ2VvbV9jb2woYWVzKGZpbGw9aWZlbHNlKFByb2ZpdCA+IDAsICJQcm9maXQiLCAiTG9zcyIpKSwgc2hvdy5sZWdlbmQgPSBUUlVFKSArCiAgc2NhbGVfeF9kaXNjcmV0ZShndWlkZSA9IGd1aWRlX2F4aXMoYW5nbGUgPSA0NSkpICsgCiAgZ2VvbV90ZXh0KGFlcyh4ID0gYFN1Yi1DYXRlZ29yeWAsIHkgPSBQcm9maXQsIAogICAgICAgICAgICAgICAgbGFiZWwgPSBzY2FsZXM6OmRvbGxhcihQcm9maXQsIHNjYWxlPTFlLTMsIHN1ZmZpeCA9ICJLIiwgYWNjdXJhY3kgPSAwLjEpLCAKICAgICAgICAgICAgICAgIHZqdXN0ID0gaWZlbHNlKFByb2ZpdCA+PSAwLCAtMS4yLCAxLjUpKSwgc2l6ZSA9IDIuMywgY29sb3IgPSAiYmxhY2siKSArCiAgbGFicyh0aXRsZSA9ICJUb3RhbCBQcm9maXQgYnkgU3ViLUNhdGVnb3J5IGZvciBhbGwgdGhlIHRpbWUiLCB4ID0gIlN1Yi1DYXRlZ29yeSIsIHkgPSAiUHJvZml0LCAkIikgKwogIHNjYWxlX2ZpbGxfbWFudWFsKG5hbWU9IiIsIHZhbHVlcz1jKCJQcm9maXQiPSIjQUREN0EwIiwgIkxvc3MiPSIjRUU5Nzc5IikpICsKICBzY2FsZV95X2NvbnRpbnVvdXMobGFiZWxzID0gc2NhbGVzOjpsYWJlbF9udW1iZXIoc3VmZml4ID0gIksiLCBzY2FsZSA9IDFlLTMpLCBsaW1pdHMgPSBjKC0yMGUzLCA2MGUzKSkgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJib3R0b20iKQoKYGBgCgoKIyMgV2hhdCBpcyBZb1kgU2FsZXMgYW5kIFByb2ZpdCBHcm93dGggYnkgU3ViLUNhdGVnb3J5PwoKQXJyYW5naW5nIFByb2ZpdCBieSBzdWItY2F0ZWdvcmllcyB3ZSBjYW4gc2VlIHdoaWNoIHRoZSBzdWItY2F0ZWdvcmllcyBtYWtlIGxvc3Nlcy4KTGV0J3Mgc2VlIG9uIHRoZSB5ZWFyLW92ZXIteWVhciBzdWItY2F0ZWdvcmllcyBzYWxlcyBncm93dGggZm9yIHRoZSBsYXN0ZXN0IHllYXIgaW4gdGhlIGRhdGFzZXQgdnMuIGJlZm9yZSBvbmUuCgpgYGB7ciB5b3ktc3ViY2F0ZWdvcnktcGl2b3R9CgpZb1lfc3ViIDwtIE9yZGVycyAlPiUKICBtdXRhdGUoWWVhciA9IHllYXIoYE9yZGVyIERhdGVgKSkgJT4lCiAgZmlsdGVyKFllYXIgJWluJSBjKGxhdGVzdF95ZWFyLTEsIGxhdGVzdF95ZWFyKSkgJT4lCiAgZ3JvdXBfYnkoYFN1Yi1DYXRlZ29yeWAsIFllYXIpICU+JQogIHN1bW1hcmlzZShTYWxlcyA9IHJvdW5kKHN1bShTYWxlcyksIDIpLCAKICAgICAgICAgICAgUHJvZml0ID0gcm91bmQoc3VtKFByb2ZpdCksIDIpKSAlPiUKICBtdXRhdGUoWW9ZX0dyb3d0aF9TYWxlcyA9IChTYWxlcyAtIGxhZyhTYWxlcykpL2xhZyhTYWxlcyksCiAgICAgICAgIFlvWV9Hcm93dGhfUHJvZml0ID0gKFByb2ZpdCAtIGxhZyhQcm9maXQpKS9hYnMobGFnKFByb2ZpdCkpKSAKCmBgYAoKIyMjIyBZb1kgU2FsZXMgR3Jvd3RoCgpgYGB7ciB5b3ktc2FsZXMtZ3Jvd3RoLXN1Yn0KIyBzYWxlcyBwbG90CnNjYWxlIDwtIG1heChZb1lfc3ViJFNhbGVzKQpZb1lfc3ViICU+JQogIG11dGF0ZShTYWxlcyA9IGlmZWxzZShZZWFyID09IDIwMTYsIC1TYWxlcywgU2FsZXMpKSAlPiUKICBnZ3Bsb3QoKSArCiAgIGdlb21fY29sKGFlcyh4PWBTdWItQ2F0ZWdvcnlgLCB5PVNhbGVzLCBmaWxsPWlmZWxzZShZZWFyPT0yMDE2LCAiMjAxNiIsICIyMDE3IikpKSArCiAgICBnZW9tX3BvaW50KGFlcyh4ID0gYFN1Yi1DYXRlZ29yeWAsIHkgPSBpZmVsc2UoWWVhcj09MjAxNiwgTkEsIFlvWV9Hcm93dGhfU2FsZXMgKiBzY2FsZSksCiAgICAgICAgICAgICAgICAgICBjb2xvcj1pZmVsc2UoWW9ZX0dyb3d0aF9TYWxlcyA8IDAsICJEcm9wIiwgIkdyb3d0aCIpKSwgc2hhcGU9MTgsIHNpemUgPSAzLCBzaG93LmxlZ2VuZCA9IEZBTFNFKSArIAogICAgZ2VvbV90ZXh0KGFlcyh4ID0gYFN1Yi1DYXRlZ29yeWAsIHkgPSBpZmVsc2UoWWVhcj09MjAxNiwgTkEsIFlvWV9Hcm93dGhfU2FsZXMgKiBzY2FsZSksIGxhYmVsID0gc2NhbGVzOjpwZXJjZW50KFlvWV9Hcm93dGhfU2FsZXMsIGFjY3VyYWN5ID0gMC4xKSwKICAgICAgICAgICAgICAgICAgdmp1c3QgPSBpZmVsc2UoWW9ZX0dyb3d0aF9TYWxlcyA+IDAsIC0xLjUsIDIuNSkpLCBzaXplID0gMiwgY29sb3IgPSAiYmxhY2siKSArCiAgIGxhYnModGl0bGUgPSAiWW9ZIEdyb3d0aCBTYWxlcyBieSBTdWItQ2F0ZWdvcnkgZm9yIDIwMTcgdnMuIDIwMTYiLCB4ID0gIlN1Yi1DYXRlZ29yeSIsIHkgPSAiU2FsZXMsICQiKSArCiAgIHNjYWxlX3lfY29udGludW91cyhzZWMuYXhpcyA9IHNlY19heGlzKHRyYW5zID0gfi4vc2NhbGUsIG5hbWUgPSAiIiwgbGFiZWxzID0gc2NhbGVzOjpsYWJlbF9wZXJjZW50KCkpLCAKICAgICAgICAgICAgICAgICAgICAgIGxhYmVscyA9IHNjYWxlczo6bnVtYmVyKGMocmV2KHNlcSgwLCAxMDBlMywgYnk9MjBlMykpLCBzZXEoMCwgMTIwZTMsIGJ5PTIwZTMpWy0xXSksIHNjYWxlID0gMWUtMywgc3VmZml4ID0gIksiKSwgbGltaXRzID0gYygtMTAwZTMsIDEyMGUzKSwKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrcyA9IHNlcSgtMTAwZTMsIDEyMGUzLCBieT0yMGUzKSkgKwogIHNjYWxlX2ZpbGxfbWFudWFsKG5hbWUgPSAiU2FsZXMiLCB2YWx1ZXM9YygiMjAxNiI9IiNlY2VjZWMiLCAiMjAxNyI9IiNBREQ3QTAiKSkgKwogIHNjYWxlX2NvbG9yX21hbnVhbChuYW1lID0gIiIsIHZhbHVlcz1jKCJEcm9wIj0icmVkIiwgIkdyb3d0aCI9ImJsYWNrIikpICsKICBzY2FsZV94X2Rpc2NyZXRlKGd1aWRlID0gZ3VpZGVfYXhpcyhhbmdsZSA9IDQ1KSkgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJib3R0b20iKQoKCmBgYAoKIyMjIyBZb1kgUHJvZml0IEdyb3d0aAoKYGBge3IgeW95LXByb2ZpdC1ncm93dGgtc3VifQoKc2NhbGUgPC0gbWF4KFlvWV9zdWIkUHJvZml0KQpZb1lfc3ViICU+JQogIG11dGF0ZShQcm9maXQgPSBpZmVsc2UoWWVhciA9PSAyMDE2LCAtUHJvZml0LCBQcm9maXQpKSAlPiUKICBnZ3Bsb3QoKSArCiAgIGdlb21fY29sKGFlcyh4PWBTdWItQ2F0ZWdvcnlgLCB5PVByb2ZpdCwgZmlsbD1pZmVsc2UoWWVhcj09MjAxNiwgIjIwMTYiLCAiMjAxNyIpKSkgKwogICAgZ2VvbV9wb2ludChhZXMoeCA9IGBTdWItQ2F0ZWdvcnlgLCB5ID0gaWZlbHNlKFllYXI9PTIwMTYsIE5BLCBZb1lfR3Jvd3RoX1Byb2ZpdCAqIHNjYWxlKSwKICAgICAgICAgICAgICAgICAgIGNvbG9yPWlmZWxzZShZb1lfR3Jvd3RoX1Byb2ZpdCA8IDAsICJEcm9wIiwgIkdyb3d0aCIpKSwgc2hhcGUgPSAxOCwgc2l6ZSA9IDMsIHNob3cubGVnZW5kID0gRkFMU0UpICsgCiAgICBnZW9tX3RleHQoYWVzKHggPSBgU3ViLUNhdGVnb3J5YCwgeSA9IGlmZWxzZShZZWFyPT0yMDE2LCBOQSwgWW9ZX0dyb3d0aF9Qcm9maXQgKiBzY2FsZSksIGxhYmVsID0gc2NhbGVzOjpwZXJjZW50KFlvWV9Hcm93dGhfUHJvZml0LCBhY2N1cmFjeSA9IDAuMSksCiAgICAgICAgICAgICAgICAgIHZqdXN0ID0gaWZlbHNlKFlvWV9Hcm93dGhfUHJvZml0ID4gMCwgLTEuNSwgMi41KSksIHNpemUgPSAyLCBjb2xvciA9ICJibGFjayIpICsKICAgbGFicyh0aXRsZSA9ICJZb1kgR3Jvd3RoIFByb2ZpdCBieSBTdWItQ2F0ZWdvcnkgZm9yIDIwMTcgdnMuIDIwMTYiLCB4ID0gIlN1Yi1DYXRlZ29yeSIsIHkgPSAiUHJvZml0LCAkIikgKwogICBzY2FsZV95X2NvbnRpbnVvdXMoc2VjLmF4aXMgPSBzZWNfYXhpcyh0cmFucyA9IH4uL3NjYWxlLCBuYW1lID0gIiIsIGxhYmVscyA9IHNjYWxlczo6bGFiZWxfcGVyY2VudCgpLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtzID0gc2VxKC00LCAxLCAwLjUpKSwgCiAgICAgICAgICAgICAgICAgICAgICBsYWJlbHMgPSBzY2FsZXM6Om51bWJlcihjKHJldihzZXEoMCwgMTAwZTMsIGJ5PTIwZTMpKSwgc2VxKDAsIDQwZTMsIGJ5PTIwZTMpWy0xXSksIHNjYWxlID0gMWUtMywgc3VmZml4ID0gIksiKSwgbGltaXRzID0gYygtMTAwZTMsIDQwZTMpLAogICAgICAgICAgICAgICAgICAgICAgYnJlYWtzID0gc2VxKC0xMDBlMywgNDBlMywgYnk9MjBlMykpICsKICBzY2FsZV9maWxsX21hbnVhbChuYW1lID0gIlByb2ZpdCIsIHZhbHVlcz1jKCIyMDE2Ij0iI2VjZWNlYyIsICIyMDE3Ij0iI0FERDdBMCIpKSAgKwogIHNjYWxlX2NvbG9yX21hbnVhbChuYW1lID0gIiIsIHZhbHVlcz1jKCJEcm9wIj0icmVkIiwgIkdyb3d0aCI9ImJsYWNrIikpICsKICBzY2FsZV94X2Rpc2NyZXRlKGd1aWRlID0gZ3VpZGVfYXhpcyhhbmdsZSA9IDQ1KSkgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJib3R0b20iKQoKYGBgCgojIyBXaGljaCBzdWItY2F0ZWdvcmllcyBkbyBjdXN0b21lcnMgcHJlZmVyIHRvIGJ1eSB0b2dldGhlciBhdCB0aGUgc2FtZSB0aW1lPwoKYGBge3IgY3Jvc3Mtc2VsbGluZ30KCiMgU29ycnksIGJ1dCB0aGlzIGlzIGxvdyBwZXJmb3JtYW5jZSBjb2RlIDotKAojIGNyb3NzLXNlbGxpbmcgYW5hbHlzaXMKcGFpciA8LSBleHBhbmQuZ3JpZCgib25lIj1sZXZlbHMoT3JkZXJzJGBTdWItQ2F0ZWdvcnlgKSwgInR3byI9bGV2ZWxzKE9yZGVycyRgU3ViLUNhdGVnb3J5YCkpCgpwaXZvdCA8LSBPcmRlcnMgJT4lCiAgcGl2b3Rfd2lkZXIobmFtZXNfZnJvbSA9ICJTdWItQ2F0ZWdvcnkiLCB2YWx1ZXNfZnJvbSA9IFF1YW50aXR5KSAlPiUKICBzZWxlY3QoYygiT3JkZXIgSUQiLCBsZXZlbHMoT3JkZXJzJGBTdWItQ2F0ZWdvcnlgKSkpICU+JQogIGdyb3VwX2J5KGBPcmRlciBJRGApICU+JQogIHN1bW1hcml6ZV9hbGwofnN1bSguLCBuYS5ybSA9IFRSVUUpKQoKY291bnQyIDwtIGZ1bmN0aW9uKGEsIGIpewogIGlmKGEgPT0gYil7CiAgICByZXR1cm4oTkEpCiAgfQogIG5yb3cocGl2b3RbcGl2b3RbLGFdID4gMCAmIHBpdm90WyxiXSA+IDAsXSkvbGVuZ3RoKHVuaXF1ZShPcmRlcnMkYE9yZGVyIElEYCkpCn0KCmNvdW50MiA8LSBWZWN0b3JpemUoY291bnQyKQoKcGFpciAlPiUKICBtdXRhdGUob25lPWFzLmNoYXJhY3RlcihvbmUpLCB0d289YXMuY2hhcmFjdGVyKHR3bykpICU+JQogIG11dGF0ZShvcmRlcnM9Y291bnQyKG9uZSwgdHdvKSkgJT4lCiAgZ2dwbG90KCkgKwogIGdlb21fcmFzdGVyKGFlcyh4PW9uZSwgeT10d28sIGZpbGw9b3JkZXJzKSwgKSArCiAgc2NhbGVfZmlsbF9ncmFkaWVudChoaWdoID0gIiNBREQ3QTAiLCAgbG93ID0gIndoaXRlIiwgbmEudmFsdWUgPSAid2hpdGUiKSArCiAgc2NhbGVfeF9kaXNjcmV0ZShndWlkZSA9IGd1aWRlX2F4aXMoYW5nbGUgPSA0NSkpICsKICBnZW9tX3RleHQoYWVzKHg9b25lLCB5PXR3bywgbGFiZWw9c2NhbGVzOjpwZXJjZW50KG9yZGVycywgYWNjdXJhY3kgPSAwLjAxKSksIHNpemUgPSAyKSArCiAgbGFicyh0aXRsZT0iQ3Jvc3Mtc2VsbGluZyBzdWItY2F0ZWdvcmllcyBmb3IgYWxsIHRoZSB0aW1lIiwgCiAgICAgICBzdWJ0aXRsZSA9ICJTdWItY2F0ZWdvcmllcyB3aGljaCBjdXN0b21lcnMgcHJlZmVyZWQgdG8gYnV5IHRvZ2V0aGVyIHBlciBvbmUgb3JkZXIvdHJhbnNhY3Rpb24uIiwKICAgICAgIHg9IlN1Yi1DYXRnZW9yeSIsIHk9IlN1Yi1DYXRnZW9yeSIpICsKICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSAibm9uZSIpCgpgYGAKCgpgYGB7ciBjcm9zcy1zZWxsaW5nLXNlZ21lbnQsICBmaWcuaGVpZ2h0ID0gMTB9CgojIFNvcnJ5LCBidXQgdGhpcyBpcyBsb3cgcGVyZm9ybWFuY2UgY29kZSB0b28gOi0oCiMgY3Jvc3Mtc2VsbGluZyBhbmFseXNpcyBieSBzZWdtZW50CnBhaXJfc2VnIDwtIGV4cGFuZC5ncmlkKCJvbmUiPWxldmVscyhPcmRlcnMkYFN1Yi1DYXRlZ29yeWApLCAidHdvIj1sZXZlbHMoT3JkZXJzJGBTdWItQ2F0ZWdvcnlgKSwgCiAgICAgICAgICAgICAgICAgICAgInNlZ21lbnQiPWxldmVscyhPcmRlcnMkU2VnbWVudCkpCgpwaXZvdF9zZWcgPC0gT3JkZXJzICU+JQogIHBpdm90X3dpZGVyKG5hbWVzX2Zyb20gPSAiU3ViLUNhdGVnb3J5IiwgdmFsdWVzX2Zyb20gPSBRdWFudGl0eSkgJT4lCiAgc2VsZWN0KGMoIk9yZGVyIElEIiwgU2VnbWVudCwgbGV2ZWxzKE9yZGVycyRgU3ViLUNhdGVnb3J5YCkpKSAlPiUKICBncm91cF9ieShgT3JkZXIgSURgLCBTZWdtZW50KSAlPiUKICBzdW1tYXJpemVfYWxsKH5zdW0oLiwgbmEucm0gPSBUUlVFKSkKCmNvdW50Ml9zZWcgPC0gZnVuY3Rpb24oYSwgYiwgc2VnKXsKICBpZihhID09IGIpewogICAgcmV0dXJuKE5BKQogIH0KICBucm93KHBpdm90X3NlZ1twaXZvdF9zZWdbLCJTZWdtZW50Il0gPT0gc2VnICYgcGl2b3Rfc2VnWyxhXSA+IDAgJiBwaXZvdF9zZWdbLGJdID4gMCxdKS9sZW5ndGgodW5pcXVlKE9yZGVyc1tPcmRlcnMkU2VnbWVudCA9PSBzZWcsXSRgT3JkZXIgSURgKSkKfQoKY291bnQyX3NlZyA8LSBWZWN0b3JpemUoY291bnQyX3NlZykKCnBhaXJfc2VnICU+JQogIG11dGF0ZShvbmU9YXMuY2hhcmFjdGVyKG9uZSksIHR3bz1hcy5jaGFyYWN0ZXIodHdvKSwgc2VnbWVudCA9IGFzLmNoYXJhY3RlcihzZWdtZW50KSkgJT4lCiAgbXV0YXRlKG9yZGVycz1jb3VudDJfc2VnKG9uZSwgdHdvLCBzZWdtZW50KSkgJT4lCiAgZ2dwbG90KCkgKwogIGdlb21fcmFzdGVyKGFlcyh4PW9uZSwgeT10d28sIGZpbGw9b3JkZXJzKSwgKSArCiAgc2NhbGVfZmlsbF9ncmFkaWVudChoaWdoID0gIiNBREQ3QTAiLCAgbG93ID0gIndoaXRlIiwgbmEudmFsdWUgPSAid2hpdGUiKSArCiAgc2NhbGVfeF9kaXNjcmV0ZShndWlkZSA9IGd1aWRlX2F4aXMoYW5nbGUgPSA0NSkpICsKICBnZW9tX3RleHQoYWVzKHg9b25lLCB5PXR3bywgbGFiZWw9c2NhbGVzOjpwZXJjZW50KG9yZGVycywgYWNjdXJhY3kgPSAwLjAxKSksIHNpemUgPSAyKSArCiAgbGFicyh0aXRsZT0iQ3Jvc3Mtc2VsbGluZyBzdWItY2F0ZWdvcmllcyBmb3IgYWxsIHRoZSB0aW1lIiwgCiAgICAgICBzdWJ0aXRsZSA9ICJTdWItY2F0ZWdvcmllcyB3aGljaCBjdXN0b21lcnMgcHJlZmVyZWQgdG8gYnV5IHRvZ2V0aGVyIHBlciBvbmUgb3JkZXIvdHJhbnNhY3Rpb24uIiwKICAgICAgIHg9IlN1Yi1DYXRnZW9yeSIsIHk9IlN1Yi1DYXRnZW9yeSIpICsKICB0aGVtZShsZWdlbmQucG9zaXRpb24gPSAibm9uZSIsIHN0cmlwLmJhY2tncm91bmQgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgc3RyaXAudGV4dCA9IGVsZW1lbnRfdGV4dChjb2xvciA9ICJibGFjayIsIGZhY2UgPSAiYm9sZCIpKSArCiAgZmFjZXRfd3JhcCh+c2VnbWVudCwgbmNvbCA9IDEpCgpgYGAKClJvd3MgYW5kIGNvbHVtbnMgY29udGFpbiBhbGwgdGhlIHN1Yi1jYXRlZ29yaWVzIHdpdGhpbiB0aGUgc3RvcmUuIEVhY2ggY2VsbCByZXByZXNlbnRzIHRoZSBwZXJjZW50YWdlIG9mIHRvdGFsIG51bWJlciBvZiBvcmRlcnMgZm9yIGFsbCB0aGUgdGltZSwgYnV5aW5nIGEgcHJvZHVjdCBvZiBzdWItY2F0ZWdvcnkgb24gdGhlIFktYXhpcyB0aGUgY3VzdG9tZXIgYWxzbyBidXlpbmcgYSBwcm9kdWN0cyBvbiB0aGUgWC1heGlzIGluIG9uZSBvcmRlci4KClRoZSByZWRkZXIgdGhlIGNlbGwgYmVjb21lcywgdGhlIGhpZ2hlciB0aGUgbnVtYmVyIG9mIG9yZGVycyBjb250YWluIHRoZSBzYW1lIHN1Yi1jYXRlZ29yeSB0aGF0IGNyb3NzZXMgYnkgcm93IHNlY3Rpb24uCgoKIyMgV2hhdCBpcyBhdmVyYWdlIGJhc2tldCBzaXplIGFuZCB2YWx1ZT8geyNiYXNrZXQtcmVmfQoKYGBge3IgYmFza2V0LW1ldHJpY3MtMX0KCmJhc2tldCA8LSBPcmRlcnMgJT4lCiAgbXV0YXRlKFllYXIgPSB5ZWFyKGBPcmRlciBEYXRlYCkpICU+JQogIGdyb3VwX2J5KGBPcmRlciBJRGAsIFllYXIpICU+JQogIHN1bW1hcmlzZShRdWFudGl0eSA9IHN1bShRdWFudGl0eSksIFNhbGVzID0gc3VtKFNhbGVzKSkgJT4lCiAgdW5ncm91cCgpICU+JQogIGdyb3VwX2J5KFllYXIpICU+JQogIHN1bW1hcmlzZShRdWFudGl0eSA9IHN1bShRdWFudGl0eSksIE9yZGVyX0NvdW50ID0gbigpLCBTYWxlcyA9IHN1bShTYWxlcykpICU+JQogIHVuZ3JvdXAoKSAlPiUKICBtdXRhdGUoQmFza2V0X1ZhbHVlID0gcm91bmQoU2FsZXMgLyBPcmRlcl9Db3VudCwgZGlnaXRzID0gMiksIEJhc2tldF9TaXplID0gcm91bmQoUXVhbnRpdHkgLyBPcmRlcl9Db3VudCwgZGlnaXRzID0gMCksIAogICAgICAgICBZb1lfR3Jvd3RoID0gKFNhbGVzIC0gbGFnKFNhbGVzKSkvbGFnKFNhbGVzKSkgJT4lCiAgc2VsZWN0KC1jKFF1YW50aXR5LCBPcmRlcl9Db3VudCwgU2FsZXMpKQoKYGBgCgpgYGB7ciBiYXNrZXQtbWV0cmljcy0yfQojIGF2ZXJhZ2UgYmFza2V0IHZhbHVlCkJhc2tldF9WYWx1ZSA8LSBiYXNrZXRbYmFza2V0JFllYXIgPT0gbGF0ZXN0X3llYXIsICJCYXNrZXRfVmFsdWUiXVtbMV1dCiMgWW9ZIGdyb3d0aCBiYXNrZXQgdmFsdWUKWW9ZX0Jhc2tldF9WYWx1ZSA8LSBiYXNrZXRbYmFza2V0JFllYXIgPT0gbGF0ZXN0X3llYXIsICJZb1lfR3Jvd3RoIl1bWzFdXQojIGJhc2tlciBzaXplCkJhc2tldF9TaXplIDwtIGJhc2tldFtiYXNrZXQkWWVhciA9PSBsYXRlc3RfeWVhciwgIkJhc2tldF9TaXplIl1bWzFdXQoKcGFzdGUobGF0ZXN0X3llYXIsICI+IEJhc2tldCBWYWx1ZToiLCBzY2FsZXM6OmRvbGxhcihCYXNrZXRfVmFsdWUsIGFjY3VyYWN5ID0gMC4xKSwgIiwgWW9ZIEJhc2tldCBWYWx1ZToiLCBzY2FsZXM6OnBlcmNlbnQoWW9ZX0Jhc2tldF9WYWx1ZSwgYWNjdXJhY3kgPSAwLjEpLCAiIEJhc2tldCBTaXplOiIsIEJhc2tldF9TaXplKQoKYGBgCgoKYGBge3IgeW95LWJhc2tldC10YWJsZS12aXp9CgpiYXNrZXQgJT4lIAogIG11dGF0ZV9hdCgiWW9ZX0dyb3d0aCIsIH5jZWxsX3NwZWMoc2NhbGVzOjpwZXJjZW50KC4sIGFjY3VyYWN5ID0gMC4xKSwgImh0bWwiLCAKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yPWNhc2Vfd2hlbiguIDwgMCB+ICJyZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuID49IDAgfiAiZ3JlZW4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpcy5uYSguKSB+ICJsaWdodGdyYXkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUUlVFIH4gImJsYWNrIikpKSAlPiUKICBtdXRhdGUoQmFza2V0X1ZhbHVlID0gc2NhbGVzOjpkb2xsYXIoQmFza2V0X1ZhbHVlLCBhY2N1cmFjeSA9IDAuMDEpKSAlPiUKICByZWxvY2F0ZShZb1lfR3Jvd3RoLCAuYWZ0ZXIgPSBCYXNrZXRfVmFsdWUpICU+JQogIGtibChjb2wubmFtZXMgPSBjKCJZZWFyIiwgIkF2Zy4gQmFza2V0IFZhbHVlIiwgIllvWSBHcm93dGgiLCAiQmFza2V0IFNpemUiKSwKICAgICAgY2FwdGlvbiA9ICJZb1kgYXZlcmFnZSBiYXNrZXQgdmFsdWUgZ3Jvd3RoIiwKICAgICAgZXNjYXBlID0gRiwKICAgICAgYWxpZ24gPSBjKCJsIiwgcmVwKCdyJyx0aW1lcz0zKSkpICU+JQogIHJvd19zcGVjKDAsIGFsaWduID0gImMiKSAlPiUKICBrYWJsZV9zdHlsaW5nKGJvb3RzdHJhcF9vcHRpb25zID0gYygic3RyaXBlZCIsICJib3JkZXJlZCIpLCBmdWxsX3dpZHRoID0gVFJVRSkKCmBgYAoKIyMgV2hhdCBhcmUgWW9ZIGJhc2tldCB2YWx1ZSBHcm93dGggYW5kIGJhc2tldCBzaXplIGJ5IEN1c3RvbWVyIFNlZ21lbnQ/CgpgYGB7ciB5b3ktYmFza2V0LXBsb3R9CgpiYXNrZXQgPC0gT3JkZXJzICU+JQogIG11dGF0ZShZZWFyID0geWVhcihgT3JkZXIgRGF0ZWApKSAlPiUKICBncm91cF9ieShTZWdtZW50LCBgT3JkZXIgSURgLCBZZWFyKSAlPiUKICBzdW1tYXJpc2UoUXVhbnRpdHkgPSBzdW0oUXVhbnRpdHkpLCBTYWxlcyA9IHN1bShTYWxlcykpICU+JQogIHVuZ3JvdXAoKSAlPiUKICBncm91cF9ieShTZWdtZW50LCBZZWFyKSAlPiUKICBzdW1tYXJpc2UoUXVhbnRpdHkgPSBzdW0oUXVhbnRpdHkpLCBPcmRlcl9Db3VudCA9IG4oKSwgU2FsZXMgPSBzdW0oU2FsZXMpKSAlPiUKICBtdXRhdGUoQmFza2V0X1ZhbHVlID0gcm91bmQoU2FsZXMgLyBPcmRlcl9Db3VudCwgZGlnaXRzID0gMiksIEJhc2tldF9TaXplID0gcm91bmQoUXVhbnRpdHkgLyBPcmRlcl9Db3VudCwgZGlnaXRzID0gMCksIAogICAgICAgICBZb1lfR3Jvd3RoID0gKEJhc2tldF9WYWx1ZSAtIGxhZyhCYXNrZXRfVmFsdWUpKS9sYWcoQmFza2V0X1ZhbHVlKSkgJT4lCiAgc2VsZWN0KC1jKFF1YW50aXR5LCBPcmRlcl9Db3VudCwgU2FsZXMpKQoKc2NhbGUgPC0gbWluKGJhc2tldCRCYXNrZXRfVmFsdWUpIC8gbWF4KGJhc2tldCRCYXNrZXRfU2l6ZSkKeW95X3NjYWxlIDwtIG1heChiYXNrZXQkQmFza2V0X1ZhbHVlKQoKYmFza2V0ICU+JQogIGdncGxvdCgpICsKICBnZW9tX2JhcihhZXMoeCA9IFllYXIsIHkgPSBCYXNrZXRfVmFsdWUsIGZpbGw9IkF2ZXJhZ2UgVmFsdWUiKSwgc3RhdCA9ICJpZGVudGl0eSIpICsKICBnZW9tX2xpbmUoYWVzKHggPSBZZWFyLCB5ID0gWW9ZX0dyb3d0aCAqIHlveV9zY2FsZSwgZ3JvdXAgPSAxLCBjb2xvcj0iWW9ZIEdyb3d0aCIpKSArCiAgZ2VvbV9wb2ludChhZXMoeCA9IFllYXIsIHkgPSBZb1lfR3Jvd3RoICogeW95X3NjYWxlLCBjb2xvcj0iWW9ZIEdyb3d0aCIpLCBzaXplID0gMikgKwogIGdlb21fdGV4dChhZXMoeCA9IFllYXIsIHkgPSBZb1lfR3Jvd3RoICogeW95X3NjYWxlLCBsYWJlbCA9IHNjYWxlczo6cGVyY2VudChZb1lfR3Jvd3RoLCBhY2N1cmFjeSA9IDAuMDEpKSwgdmp1c3QgPSAtMSwgc2l6ZSA9IDMpICsKICBnZW9tX2xpbmUoYWVzKHggPSBZZWFyLCB5ID0gQmFza2V0X1NpemUgKiBzY2FsZSwgZ3JvdXAgPSAxKSwgbGluZXR5cGU9IjE1IikgKwogIGdlb21fcG9pbnQoYWVzKHggPSBZZWFyLCB5ID0gQmFza2V0X1NpemUgKiBzY2FsZSwgc2hhcGU9ICJTaXplIiksIHNpemU9MikgKwogIGdlb21fdGV4dChhZXMoeCA9IFllYXIsIHkgPSBCYXNrZXRfU2l6ZSAqIHNjYWxlLCBsYWJlbCA9IEJhc2tldF9TaXplKSwgdmp1c3QgPSAtMSwgc2l6ZSA9IDMsIGNvbG9yPSJibGFjayIpICsKICBnZW9tX3RleHQoYWVzKHggPSBZZWFyLCB5ID0gQmFza2V0X1ZhbHVlLCBsYWJlbCA9IHNjYWxlczo6ZG9sbGFyKHJvdW5kKEJhc2tldF9WYWx1ZSwgMSkpKSwgdmp1c3QgPSAtMSwgc2l6ZSA9IDIpICsKICAKICBzY2FsZV9jb2xvcl9tYW51YWwodmFsdWVzPWMoIlNpemUiPSJibGFjayIsICJZb1kgR3Jvd3RoIj0iYmxhY2siKSkgKwogIHNjYWxlX3NoYXBlX21hbnVhbCh2YWx1ZXM9YygiU2l6ZSI9MTUpKSArCiAgCiAgc2NhbGVfeV9jb250aW51b3VzKHNlYy5heGlzID0gc2VjX2F4aXModHJhbnMgPSB+Li95b3lfc2NhbGUsIGxhYmVscyA9IHNjYWxlczo6bGFiZWxfcGVyY2VudChhY2N1cmFjeSA9IDFMKSwgbmFtZT0iWW9ZIEdyb3d0aCIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWtzID0gc2VxKDAsIDEsIDAuMikpLCBsaW1pdHMgPSBjKC0yMDAsIDYwMCksIGJyZWFrcyA9IHNlcSgwLCA2MDAsIDEwMCkpICsKICBzY2FsZV9maWxsX21hbnVhbChuYW1lPSIiLCB2YWx1ZXM9YygiQXZlcmFnZSBWYWx1ZSI9IiNBREQ3QTAiKSkgKwogIGxhYnModGl0bGUgPSAiWW9ZIGF2ZXJhZ2UgYmFza2V0IHZhbHVlIGdyb3d0aCBhbmQgYmFza2V0IHNpemUgYnkgU2VnbWVudCIsIHggPSAiWWVhciIsIHkgPSAiQXZlcmFnZSB2YWx1ZSwgJCIpICsKICBndWlkZXMoY29sb3IgPSBndWlkZV9sZWdlbmQob3ZlcnJpZGUuYWVzID0gbGlzdChmaWxsID0gTkEpKSwKICAgICAgICAgbGluZXR5cGUgPSBndWlkZV9sZWdlbmQob3ZlcnJpZGUuYWVzID0gbGlzdChmaWxsID0gTkEpKSkgKwogIHRoZW1lKGxlZ2VuZC5rZXk9ZWxlbWVudF9yZWN0KGZpbGwgPSAid2hpdGUiLCBjb2xvcj0id2hpdGUiKSwKICAgICAgICAgIGxlZ2VuZC50aXRsZT1lbGVtZW50X2JsYW5rKCksCiAgICAgICAgICBsZWdlbmQuYm94PSJob3Jpem9udGFsIiwKICAgICAgICAgIGxlZ2VuZC5wb3NpdGlvbj0iYm90dG9tIiwgc3RyaXAuYmFja2dyb3VuZCA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBzdHJpcC50ZXh0ID0gZWxlbWVudF90ZXh0KGNvbG9yID0gImJsYWNrIiwgZmFjZSA9ICJib2xkIikpICsKICBmYWNldF93cmFwKC5+U2VnbWVudCkKCgpgYGAKCkFzIHdlIGNhbiBzZWUgdGhlIGF2ZXJhZ2UgYmFza2V0IHZhbHVlIHdhcyBkcm9wcGluZyBldmVyeSB5ZWFyIGFuZCBiYXNrZXQgc2l6ZSB3YXMgdG9vLgoKCiMjIFdoYXQgYXJlIG51bWJlciBvZiB0b3RhbCBhbmQgbmV3IGN1c3RvbWVycyBhbmQgWW9ZIGdyb3d0aCBvZiBpdHM/IHsjY3VzdG9tZXJzLXJlZn0KCmBgYHtyIHlveS1jdXN0b21lcnN9CgojIE5ldyBDdXN0b21lcnMKY3VzdCA8LSBPcmRlcnMgJT4lCiAgZ3JvdXBfYnkoYEN1c3RvbWVyIElEYCkgJT4lCiAgc3VtbWFyaXNlKGBGaXJzdCBZZWFyYCA9IHllYXIobWluKGBPcmRlciBEYXRlYCkpKSAlPiUKICB1bmdyb3VwKCkgJT4lCiAgZ3JvdXBfYnkoYEZpcnN0IFllYXJgKSAlPiUKICBzdW1tYXJpc2UoYE5ldyBDdXN0b21lcnNgID0gbigpKSAlPiUKICBpbm5lcl9qb2luKAogICAgIyB0b3RhbCB1bmlxdWUgY3VzdG9tZXJzCiAgICBPcmRlcnMgJT4lCiAgICAgIGdyb3VwX2J5KFllYXIgPSB5ZWFyKGBPcmRlciBEYXRlYCkpICU+JQogICAgICBzdW1tYXJpc2UoYFVuaXF1ZSBDdXN0b21lcnNgID0gbl9kaXN0aW5jdChgQ3VzdG9tZXIgSURgKSksCiAgICBieSA9IGMoIkZpcnN0IFllYXIiID0gIlllYXIiKSkgJT4lCiAgbXV0YXRlKGBZb1kgR3Jvd3RoIFVuaXF1ZWAgPSAoYFVuaXF1ZSBDdXN0b21lcnNgIC0gbGFnKGBVbmlxdWUgQ3VzdG9tZXJzYCkpL2xhZyhgVW5pcXVlIEN1c3RvbWVyc2ApLAogICAgICAgICBgWW9ZIEdyb3d0aCBOZXdgID0gKGBOZXcgQ3VzdG9tZXJzYCAtIGxhZyhgTmV3IEN1c3RvbWVyc2ApKS9sYWcoYE5ldyBDdXN0b21lcnNgKSkgJT4lCiAgcmVsb2NhdGUoYFllYXJgID0gYEZpcnN0IFllYXJgLCBgTmV3IEN1c3RvbWVyc2AsIGBZb1kgR3Jvd3RoIE5ld2AsIGBVbmlxdWUgQ3VzdG9tZXJzYCwgYFlvWSBHcm93dGggVW5pcXVlYCkKCmBgYAoKYGBge3Igc3VtbWFyaXNlLWN1c3RvbWVyc30KCiMgTmV3IGN1c3RvbWVycwpOZXdfQ3VzdG9tZXJzIDwtIGN1c3RbY3VzdCRZZWFyID09IGxhdGVzdF95ZWFyLCAiTmV3IEN1c3RvbWVycyJdW1sxXV0KIyBZb1kgR3Jvd3RoIG9mIG5ldyBjdXN0b21lcnMKWW9ZX0dyb3d0aF9OZXcgPC0gY3VzdFtjdXN0JFllYXIgPT0gbGF0ZXN0X3llYXIsICJZb1kgR3Jvd3RoIE5ldyJdW1sxXV0KIyBVbmlxdWUgY3VzdG9tZXJzClVuaXF1ZV9DdXN0b21lcnMgPC0gY3VzdFtjdXN0JFllYXIgPT0gbGF0ZXN0X3llYXIsICJVbmlxdWUgQ3VzdG9tZXJzIl1bWzFdXQojIFlvWSBHcm93dGggb2YgbmV3IGN1c3RvbWVycwpZb1lfR3Jvd3RoX1VuaXF1ZSA8LSBjdXN0W2N1c3QkWWVhciA9PSBsYXRlc3RfeWVhciwgIllvWSBHcm93dGggVW5pcXVlIl1bWzFdXQoKcGFzdGUobGF0ZXN0X3llYXIsIj4gTmV3IEN1c3RvbWVyczoiLCBOZXdfQ3VzdG9tZXJzLCAiLCBZb1kgR3Jvd3RoIG9mIE5ldyBDdXN0b21lcnM6Iiwgc2NhbGVzOjpwZXJjZW50KFlvWV9Hcm93dGhfTmV3LCBhY2N1cmFjeSA9IDAuMSksIAogICAgICAgICAgICAiIFRvdGFsIEN1c3RvbWVyczoiLCBVbmlxdWVfQ3VzdG9tZXJzLAogICAgICAgICAgICAiLCBZb1kgR3Jvd3RoIG9mIFRvdGFsIEN1c3RvbWVyczoiLCBzY2FsZXM6OnBlcmNlbnQoWW9ZX0dyb3d0aF9VbmlxdWUsIGFjY3VyYWN5ID0gMC4xKSkKCmBgYAoKCmBgYCB7ciBuZXctY3VzdG9tZXJ9CgpjdXN0ICU+JQogIG11dGF0ZV9hdChjKCJZb1kgR3Jvd3RoIE5ldyIsICJZb1kgR3Jvd3RoIFVuaXF1ZSIpLCB+Y2VsbF9zcGVjKHNjYWxlczo6cGVyY2VudCguLCBhY2N1cmFjeSA9IDAuMSksICJodG1sIiwgCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcj1jYXNlX3doZW4oLiA8IDAgfiAicmVkIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLiA+PSAwIH4gImdyZWVuIiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXMubmEoLikgfiAibGlnaHRncmF5IiwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgVFJVRSB+ICJibGFjayIpKSkgJT4lCmtibChjb2wubmFtZXMgPSBjKCJZZWFyIiwgIk5ldyBDdXN0b21lcnMiLCAiWW9ZIE5ldyBHcm93dGgiLCAiVW5pcXVlIEN1c3RvbWVycyIsICJZb1kgVW5pcXVlIEdyb3d0aCIpLAogICAgICAgICAgICAgY2FwdGlvbiA9ICJZb1kgVW5pcXVlIGFuZCBUb3RhbCBDdXN0b21lcnMgZ3Jvd3RoIiwKICAgIGVzY2FwZSA9IEYsCiAgICBhbGlnbiA9IGMoImwiLCByZXAoJ3InLHRpbWVzPTQpKSkgJT4lCnJvd19zcGVjKDAsIGFsaWduID0gImMiKSAlPiUKa2FibGVfc3R5bGluZyhib290c3RyYXBfb3B0aW9ucyA9IGMoInN0cmlwZWQiLCAiYm9yZGVyZWQiKSwgZnVsbF93aWR0aCA9IFRSVUUpCgpgYGAKCgpgYGAge3IgbmV3LXZzLXRvdGFsLWN1c3RvbWVyfQoKc2NhbGUgPC0gbWF4KGN1c3QkYFVuaXF1ZSBDdXN0b21lcnNgKQpjdXN0ICU+JQogIGdncGxvdCgpICsKICBnZW9tX2JhcihhZXMoeCA9IFllYXIsIHkgPSBgVW5pcXVlIEN1c3RvbWVyc2AsIGZpbGw9IlVuaXF1ZSIpLCBzdGF0ID0gImlkZW50aXR5IikgKwogIGdlb21fbGluZShhZXMoeCA9IFllYXIsIHkgPSBgTmV3IEN1c3RvbWVyc2AsIGdyb3VwID0gMSwgY29sb3I9Ik5ldyIpLCBzaXplID0gMSkgKyAKICBnZW9tX3BvaW50KGFlcyh4ID0gWWVhciwgeSA9IGBOZXcgQ3VzdG9tZXJzYCwgY29sb3I9Ik5ldyIpLCBzaGFwZT0xOCwgc2l6ZSA9IDQpICsgCiAgZ2VvbV90ZXh0KGFlcyh4ID0gWWVhciwgeSA9IGBOZXcgQ3VzdG9tZXJzYCwgbGFiZWwgPSBgTmV3IEN1c3RvbWVyc2ApLCB2anVzdCA9IC0xLCBzaXplID0gNSkgKwogIGxhYnModGl0bGUgPSAiTmV3IGN1c3RvbWVycyB2cyB0b3RhbCB1bmlxdWUgY3VzdG9tZXJzIGJ5IFllYXIiLCB4ID0gIlllYXIiLCB5ID0gIlVuaXF1ZSBDdXN0b21lcnMiKSArCiAgc2NhbGVfeV9jb250aW51b3VzKHNlYy5heGlzID0gc2VjX2F4aXModHJhbnMgPSB+LiwgbGFiZWxzID0gTlVMTCkpICsKICBzY2FsZV9maWxsX21hbnVhbChuYW1lID0gIiIsIHZhbHVlcz1jKCJVbmlxdWUiPSIjQUREN0EwIikpICsKICBzY2FsZV9jb2xvcl9tYW51YWwobmFtZSA9ICIiLCB2YWx1ZXM9YygiTmV3Ij0iYmxhY2siKSkgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJib3R0b20iKQogIApgYGAKCiMjIFdoYXQgaXMgQ3VzdG9tZXIgTGlmZXRpbWUgVmFsdWUgKENUVik/CgoKYGBge3IgY3VzdG9tZXItbGlmZXRpbWUtdmFsdWV9CgojIFRvdGFsIFJldmVudWUKdG90YWxfcmV2ZW51ZSA8LSBnZW5lcmFsX21ldHJpY3NbLCBjKCJZZWFyIiwgIlNhbGVzIildCiMgQ3VzdG9tZXIgVmFsdWUKY3VzdF92YWx1ZSA8LSB0b3RhbF9yZXZlbnVlICU+JSAKICBpbm5lcl9qb2luKGN1c3QgJT4lIAogICAgICAgICAgICAgICBtdXRhdGUoWWVhciA9IGZhY3RvcihZZWFyKSksIGJ5ID0gIlllYXIiKSAlPiUgCiAgbXV0YXRlKGN2ID0gU2FsZXMgLyBgVW5pcXVlIEN1c3RvbWVyc2ApCgojIEN1c3RvbWVyIExpZmV0aW1lIFZhbHVlCkNMViA8LSBjdXN0X3ZhbHVlICU+JQogIGlubmVyX2pvaW4oCiAgICBPcmRlcnMgJT4lCiAgICAgIG11dGF0ZShZZWFyID0gYXMuZmFjdG9yKHllYXIoYE9yZGVyIERhdGVgKSkpICU+JQogICAgICBncm91cF9ieShZZWFyLCBgQ3VzdG9tZXIgSURgKSAlPiUKICAgICAgbXV0YXRlKGxhc3RfZGF0ZSA9IGxhc3QoYE9yZGVyIERhdGVgKSkgJT4lCiAgICAgIGxlZnRfam9pbigKICAgICAgICBPcmRlcnMgJT4lCiAgICAgICAgICBncm91cF9ieShgQ3VzdG9tZXIgSURgKSAlPiUKICAgICAgICAgIHN1bW1hcmlzZShmaXJzdF9kYXRlID0gZmlyc3QoYE9yZGVyIERhdGVgLCBvcmRlcl9ieSA9IGBPcmRlciBEYXRlYCkpLAogICAgICAgIGJ5ID0gIkN1c3RvbWVyIElEIgogICAgICApICU+JQogICAgICBncm91cF9ieShZZWFyLCBgQ3VzdG9tZXIgSURgKSAlPiUKICAgICAgc3VtbWFyaXNlKGZpcnN0X2RhdGUgPSBmaXJzdChmaXJzdF9kYXRlKSwgbGFzdF9kYXRlID0gbGFzdChsYXN0X2RhdGUpKSAlPiUKICAgICAgbXV0YXRlKGRheXMgPSBsYXN0X2RhdGUgLSBmaXJzdF9kYXRlKSAlPiUKICAgICAgdW5ncm91cCgpICU+JQogICAgICBncm91cF9ieShZZWFyKSAlPiUKICAgICAgc3VtbWFyaXNlKGRheXNfc3VtID0gc3VtKGRheXMpLCBuID0gbl9kaXN0aW5jdChgQ3VzdG9tZXIgSURgKSwgY2xzID0gdGltZV9sZW5ndGgoZGF5c19zdW0sICJ5ZWFycyIpIC8gbiksCiAgICBieT0iWWVhciIKICApICU+JQogIG11dGF0ZShjbHYgPSBjdiAqIGNscykgJT4lIAogIHNlbGVjdChZZWFyLCBjbHYpICU+JQogIGFycmFuZ2UoWWVhcikgJT4lCiAgbXV0YXRlKFlvWV9Hcm93dGggPSAoY2x2IC0gbGFnKGNsdikpL2xhZyhjbHYpKQoKYGBgCgpgYGB7ciBjbHYtbWV0cmljc30KCiMgTWluaS1kYXNoYm9hcmQgQ0xWIG1ldHJpY3MKQ0xWX20gPC0gQ0xWW0NMViRZZWFyID09IGxhdGVzdF95ZWFyLCAiY2x2Il1bWzFdXQpDTFZfeW95IDwtIENMVltDTFYkWWVhciA9PSBsYXRlc3RfeWVhciwgIllvWV9Hcm93dGgiXVtbMV1dCiAgCmBgYAoKYGBge3IgY2x2LXBsb3R9CgpDTFYgJT4lCiAgZ2dwbG90KCkgKwogIGdlb21fYmFyKGFlcyh4PVllYXIsIHk9Y2x2LCBmaWxsPSJDTFYiKSwgc3RhdD0iaWRlbnRpdHkiKSArCiAgZ2VvbV9saW5lKGFlcyh4PVllYXIsIHk9WW9ZX0dyb3d0aCptaW4oQ0xWJGNsdiksIGdyb3VwPTEsIGNvbG9yPSJZb1kgR3Jvd3RoIikpICsKICBnZW9tX3BvaW50KGFlcyh4PVllYXIsIHk9WW9ZX0dyb3d0aCptaW4oQ0xWJGNsdiksIGNvbG9yPSJZb1kgR3Jvd3RoIiksIHNpemU9MykgKwogIGdlb21fcG9pbnQoYWVzKHg9WWVhciwgeT1Zb1lfR3Jvd3RoKm1pbihDTFYkY2x2KSwgY29sb3I9IllvWSBHcm93dGgiKSwgc2hhcGU9MjEsIHNpemU9MiwgZmlsbD0id2hpdGUiKSArCiAgZ2VvbV90ZXh0KGFlcyh4PVllYXIsIHk9WW9ZX0dyb3d0aCptaW4oQ0xWJGNsdiksIGxhYmVsPXNjYWxlczo6cGVyY2VudChZb1lfR3Jvd3RoLCBhY2N1cmFjeSA9IDFMKSksIHNpemU9Mywgdmp1c3Q9LTEuNSkgKwogIGdlb21fdGV4dChhZXMoeD1ZZWFyLCB5PWNsdiwgbGFiZWw9c2NhbGVzOjpkb2xsYXIoY2x2LCBhY2N1cmFjeSA9IDAuMSkpLCBzaXplPTQsIHZqdXN0PS0xLjUpICsKICBzY2FsZV95X2NvbnRpbnVvdXMobGltaXRzID0gYygwLCAzMjAwKSkgKwogIHNjYWxlX2ZpbGxfbWFudWFsKG5hbWUgPSAiIiwgdmFsdWVzPWMoIkNMViI9IiNBREQ3QTAiKSkgKwogIHNjYWxlX2NvbG9yX21hbnVhbChuYW1lID0gIiIsIHZhbHVlcz1jKCJZb1kgR3Jvd3RoIj0iYmxhY2siKSkgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJib3R0b20iKSArCiAgbGFicyh0aXRsZSA9ICJDdXN0b21lciBMaWZldGltZSBWYWx1ZSIsIHggPSAiWWVhciIsIHkgPSAiQ0xWLCAkIikKCmBgYAoKCiMjIFdoYXQgYXJlIHRvcCBwcm9maXRhYmxlIHByb2R1Y3RzPwoKYGBge3IgdG9wLXByb2R1Y3RzfQpwcm9kdWN0cyA8LSBPcmRlcnMgJT4lCiAgZ3JvdXBfYnkoYFByb2R1Y3QgSURgKSAlPiUKICBzdW1tYXJpc2UoYFByb2R1Y3QgTmFtZWAgPSBmaXJzdChgUHJvZHVjdCBOYW1lYCksCiAgICAgICAgICAgIENhdGVnb3J5ID0gZmlyc3QoQ2F0ZWdvcnkpLAogICAgICAgICAgICBgU3ViLUNhdGVnb3J5YCA9IGZpcnN0KGBTdWItQ2F0ZWdvcnlgKSwKICAgICAgICAgICAgU2FsZXMgPSBzdW0oU2FsZXMpLAogICAgICAgICAgICBQcm9maXQgPSBzdW0oUHJvZml0KSwKICAgICAgICAgICAgUXVhbnRpdHkgPSBzdW0oUXVhbnRpdHkpKSAlPiUKICB1bmdyb3VwKCkgJT4lCiAgYXJyYW5nZSgtUHJvZml0KSAlPiUKICBzZWxlY3QoYFByb2R1Y3QgTmFtZWAsIENhdGVnb3J5LCBgU3ViLUNhdGVnb3J5YCwgU2FsZXMsIFByb2ZpdCwgUXVhbnRpdHkpCgpwcm9kdWN0cyAlPiUKICBoZWFkKDEwKSAlPiUKICBtdXRhdGUoYFByb2R1Y3QgTmFtZWAgPSBhcy5mYWN0b3IoYFByb2R1Y3QgTmFtZWApKSAlPiUKICBtdXRhdGUoYFByb2R1Y3QgTmFtZWAgPSBmY3RfcmVvcmRlcihgUHJvZHVjdCBOYW1lYCwgUHJvZml0KSkgJT4lCiAgZ2dwbG90KCkgKwogIGdlb21fYmFyKGFlcyh4ID0gYFByb2R1Y3QgTmFtZWAsIHkgPSBQcm9maXQsIGZpbGwgPSBDYXRlZ29yeSksIHN0YXQgPSAiaWRlbnRpdHkiKSArCiAgZ2VvbV90ZXh0KGFlcyh4PWBQcm9kdWN0IE5hbWVgLCB5PVByb2ZpdCwgbGFiZWwgPSBzY2FsZXM6OmRvbGxhcihQcm9maXQsIGFjY3VyYWN5ID0gMC4xKSksIHNpemUgPSAzLCBoanVzdCA9IDEuMikgKwogIGxhYnModGl0bGUgPSAiVG9wLTEwIHByb2ZpdGFibGUgcHJvZHVjdHMiLCB4ID0gIlByb2R1Y3QgTmFtZSIsIHkgPSAiUHJvZml0LCAkIikgKwogIHNjYWxlX3hfZGlzY3JldGUobGFiZWxzID0gZnVuY3Rpb24oeCkgc3RyX3RydW5jKHgsIHdpZHRoID0gMjQsIHNpZGUgPSAicmlnaHQiLCBlbGxpcHNpcyA9ICIuLi4iKSkgKwogIHNjYWxlX2ZpbGxfYnJld2VyKHBhbGV0dGU9IkdyZWVucyIpICsKICBjb29yZF9mbGlwKCkgKyAKICB0aGVtZShsZWdlbmQucG9zaXRpb249ImJvdHRvbSIpCgpgYGAKCgojIyBXaG8gYXJlIHRoZSB0b3AgcHJvZml0YWJsZSBjdXN0b21lcnM/CgpgYGB7ciB0b3AtY3VzdG9tZXJzfQpjdXN0b21lcnMgPC0gT3JkZXJzICU+JQogIGdyb3VwX2J5KGBPcmRlciBJRGApICU+JQogIHN1bW1hcmlzZShTYWxlcyA9IHN1bShTYWxlcyksIFByb2ZpdCA9IHN1bShQcm9maXQpLCBTZWdtZW50ID0gZmlyc3QoU2VnbWVudCksIGBDdXN0b21lciBJRGAgPSBmaXJzdChgQ3VzdG9tZXIgSURgKSwgYEN1c3RvbWVyIE5hbWVgID0gZmlyc3QoYEN1c3RvbWVyIE5hbWVgKSkgJT4lCiAgdW5ncm91cCgpICU+JQogIGdyb3VwX2J5KGBDdXN0b21lciBJRGApICU+JQogIHN1bW1hcml6ZShgQ3VzdG9tZXIgTmFtZWAgPSBmaXJzdChgQ3VzdG9tZXIgTmFtZWApLCBTZWdtZW50ID0gZmlyc3QoU2VnbWVudCksIFByb2ZpdCA9IHN1bShQcm9maXQpLCBPcmRlcnMgPSBuKCkpICU+JQogIHVuZ3JvdXAoKSAlPiUKICBhcnJhbmdlKC1Qcm9maXQpICU+JQogIHNlbGVjdCgtYEN1c3RvbWVyIElEYCkgCgpjdXN0b21lcnMgJT4lCiAgaGVhZCgxMCkgJT4lCiAgbXV0YXRlKGBDdXN0b21lciBOYW1lYCA9IGFzLmZhY3RvcihgQ3VzdG9tZXIgTmFtZWApKSAlPiUKICBtdXRhdGUoYEN1c3RvbWVyIE5hbWVgID0gZmN0X3Jlb3JkZXIoYEN1c3RvbWVyIE5hbWVgLCBQcm9maXQpKSAlPiUKICBnZ3Bsb3QoKSArCiAgZ2VvbV9iYXIoYWVzKHggPSBgQ3VzdG9tZXIgTmFtZWAsIHkgPSBQcm9maXQsIGZpbGwgPSBTZWdtZW50KSwgc3RhdCA9ICJpZGVudGl0eSIpICsKICBnZW9tX3RleHQoYWVzKHg9YEN1c3RvbWVyIE5hbWVgLCB5PVByb2ZpdCwgbGFiZWwgPSBzY2FsZXM6OmRvbGxhcihQcm9maXQsIGFjY3VyYWN5ID0gMC4xKSksIGhqdXN0ID0gMS4yKSArCiAgbGFicyh0aXRsZSA9ICJUb3AtMTAgcHJvZml0YWJsZSBjdXN0b21lcnMiLCB4ID0gIkN1c3RvbWVyIE5hbWUiLCB5ID0gIlByb2ZpdCwgJCIpICsKICBzY2FsZV9maWxsX2JyZXdlcihwYWxldHRlPSJHcmVlbnMiKSArCiAgY29vcmRfZmxpcCgpICsgCiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uPSJib3R0b20iKQoKYGBgCgojIyBXaGF0IGlzIHBlcmNlbnRhZ2Ugb2YgUmV2ZW51ZSBmcm9tIG5ldyBidXNpbmVzcz8KCmBgYHtyIG5ldy1iaXotcmV2ZW51ZX0KCm5ld19iaXMgPC0gT3JkZXJzICU+JQogIGdyb3VwX2J5KGBDdXN0b21lciBJRGApICU+JQogIG11dGF0ZShgRmlyc3QgWWVhcmAgPSB5ZWFyKG1pbihgT3JkZXIgRGF0ZWApKSwgWWVhciA9IHllYXIoYE9yZGVyIERhdGVgKSwgTW9udGggPSBtb250aC5uYW1lW21vbnRoKGBPcmRlciBEYXRlYCldKSAlPiUKICB1bmdyb3VwKCkgJT4lCiAgZ3JvdXBfYnkoYFllYXJgLCBNb250aCkgJT4lCiAgc3VtbWFyaXNlKFNhbGVzID0gc3VtKGlmZWxzZShZZWFyID09IGBGaXJzdCBZZWFyYCwgU2FsZXMsIDApKSkgJT4lCiAgaW5uZXJfam9pbigKT3JkZXJzICU+JQogIG11dGF0ZShZZWFyID0geWVhcihgT3JkZXIgRGF0ZWApLCBNb250aCA9IG1vbnRoLm5hbWVbbW9udGgoYE9yZGVyIERhdGVgKV0pICU+JQogIGdyb3VwX2J5KFllYXIsIE1vbnRoKSAlPiUKICBzdW1tYXJpc2UoU2FsZXMgPSBzdW0oU2FsZXMpLCAKICAgICAgICAgICAgUHJvZml0ID0gc3VtKFByb2ZpdCkpLApieSA9IGMoIlllYXIiLCAiTW9udGgiKSkgJT4lCiAgcmVuYW1lKCJOZXcgU2FsZXMiID0gU2FsZXMueCwgIlRvdGFsIFNhbGVzIiA9IFNhbGVzLnkpICU+JQogIG11dGF0ZShZZWFyID0gYXMuZmFjdG9yKFllYXIpLCBNb250aCA9IGFzLmZhY3RvcihNb250aCksIHBlcmNlbnQgPSBgTmV3IFNhbGVzYCAvIGBUb3RhbCBTYWxlc2ApICU+JQogIG11dGF0ZShNb250aCA9IGZjdF9yZW9yZGVyKE1vbnRoLCBtYXRjaChNb250aCwgbW9udGgubmFtZSkpKSAKCmJpeiA8LSBuZXdfYmlzICU+JQogIG11dGF0ZShRdWFydGVyID0gbHVicmlkYXRlOjpxdWFydGVyKG1hdGNoKE1vbnRoLCBtb250aC5uYW1lKSkpICU+JQogIGdyb3VwX2J5KFllYXIsIFF1YXJ0ZXIpICU+JQogIHN1bW1hcmlzZShgTmV3IFNhbGVzYCA9IHN1bShgTmV3IFNhbGVzYCksIGBUb3RhbCBTYWxlc2AgPSBzdW0oYFRvdGFsIFNhbGVzYCkpICU+JQogIG11dGF0ZShwZXJjZW50ID0gYE5ldyBTYWxlc2AgLyBgVG90YWwgU2FsZXNgKSAlPiUKICBtdXRhdGUoWVEgPSBwYXN0ZTAoIlEiLCBRdWFydGVyLCAiJyIsIHN1YnN0cmluZyhhcy5jaGFyYWN0ZXIoWWVhciksbmNoYXIoYXMuY2hhcmFjdGVyKFllYXIpKS0xKSksIG4gPSByb3dfbnVtYmVyKCkpICU+JQogIG11dGF0ZShZUSA9IGFzLmZhY3RvcihZUSkpICU+JQogIG11dGF0ZShZUSA9IHJlb3JkZXJfdmFsdWUoWVEsIG4sIEZBTFNFKSkKICAKc2NhbGUgPC0gKGJpeiAlPiUgZ3JvdXBfYnkoWVEpICU+JSBzdW1tYXJpc2UoYFRvdGFsIFNhbGVzYCA9IHN1bShgVG90YWwgU2FsZXNgKSkgJT4lIHN1bW1hcmlzZShtYXggPSBtYXgoYFRvdGFsIFNhbGVzYCkpKSRtYXgKICAKYml6ICU+JQogIGdncGxvdCgpICsKICBnZW9tX2JhcihhZXMoeCA9IFlRLCB5ID0gYFRvdGFsIFNhbGVzYCwgZmlsbD0iVG90YWwgUmV2ZW51ZSIpLCBzdGF0PSJpZGVudGl0eSIpICsKICBnZW9tX2JhcihhZXMoeCA9IFlRLCB5ID0gYE5ldyBTYWxlc2AsIGZpbGw9Ik5ldyBSZXZlbnVlIiksIHN0YXQ9ImlkZW50aXR5IikgKwogIGdlb21fbGluZShhZXMoeCA9IFlRLCB5ID0gcGVyY2VudCAqc2NhbGUsIGdyb3VwID0gMSksIGNvbG9yID0gImJsYWNrIikgKwogIGdlb21fcG9pbnQoYWVzKHggPSBZUSwgeSA9IHBlcmNlbnQgKnNjYWxlLCBncm91cCA9IDEpLCBjb2xvciA9ICJibGFjayIsIHNpemUgPSAzKSArCiAgZ2VvbV9wb2ludChhZXMoeCA9IFlRLCB5ID0gcGVyY2VudCAqc2NhbGUsIGdyb3VwID0gMSksIHNoYXBlID0gMjEsIHNpemUgPSAxLjUsIGNvbG9yID0gIndoaXRlIiwgZmlsbCA9ICJ3aGl0ZSIpICsKICBnZW9tX3RleHQoYWVzKHggPSBZUSwgeSA9IHBlcmNlbnQgKnNjYWxlLCBncm91cCA9IDEsIGxhYmVsID0gc2NhbGVzOjpwZXJjZW50KHBlcmNlbnQsIGFjY3VyYWN5ID0gMC4xKSksIHNpemUgPSAyLjUsIHZqdXN0ID0gLTEuNSwgY29sb3IgPSAiYmxhY2siKSArCiAgZ2VvbV92bGluZShhZXMoeGludGVyY2VwdCA9IDQuNSksIGxpbmV0eXBlID0gImRvdHRlZCIpICsKICBnZW9tX3ZsaW5lKGFlcyh4aW50ZXJjZXB0ID0gOC41KSwgbGluZXR5cGUgPSAiZG90dGVkIikgKwogIGdlb21fdmxpbmUoYWVzKHhpbnRlcmNlcHQgPSAxMi41KSwgbGluZXR5cGUgPSAiZG90dGVkIikgKwogIGxhYnModGl0bGUgPSAiUGVyY2VudGFnZSBvZiBSZXZlbnVlIEZyb20gTmV3IEJ1c2luZXNzIHZzIFRvdGFsIFJldmVudWUiLCB4ID0gIlF1YXJ0ZXIiLCB5ID0gIlJldmVudWUsICQiKSArCiAgc2NhbGVfeV9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6bGFiZWxfbnVtYmVyKHN1ZmZpeCA9ICIgSyIsIHNjYWxlID0gMWUtMyksIGxpbWl0cyA9IGMoMCwgMzAwZTMpLCBicmVha3MgPSBzZXEoMCwgMzAwZTMsIDI1ZTMpKSArCiAgc2NhbGVfY29sb3VyX21hbnVhbCgiICIsIHZhbHVlcz1jKCJQcmljZSIgPSAiYmxhY2siKSkrCiAgc2NhbGVfZmlsbF9tYW51YWwoIiIsIHZhbHVlcz1jKCJUb3RhbCBSZXZlbnVlIiA9ICIjQUREN0EwIiwgIk5ldyBSZXZlbnVlIiA9ICIjNEJBMTVEIikpKwogIGd1aWRlcyhjb2xvciA9IGd1aWRlX2xlZ2VuZChvdmVycmlkZS5hZXMgPSBsaXN0KGZpbGwgPSBOQSkpLAogICAgICAgICBsaW5ldHlwZSA9IGd1aWRlX2xlZ2VuZChvdmVycmlkZS5hZXMgPSBsaXN0KGZpbGwgPSBOQSkpKSArCiAgICB0aGVtZShsZWdlbmQua2V5PWVsZW1lbnRfcmVjdChmaWxsID0gIndoaXRlIiwgY29sb3I9IndoaXRlIiksCiAgICAgICAgICBsZWdlbmQudGl0bGU9ZWxlbWVudF9ibGFuaygpLAogICAgICAgICAgbGVnZW5kLmJveD0iaG9yaXpvbnRhbCIsCiAgICAgICAgICBsZWdlbmQucG9zaXRpb249ImJvdHRvbSIpICAKCmBgYAoKCiMjIFdoaWNoIGNpdHkvcmVnaW9uL3N0YXRlIGlzIHRoZSBiZXN0IHNlbGxpbmcgYW5kIG1vc3QgcHJvZml0YWJsZT8KCiMjIyBSZWdpb24KCkJlc3Qgc2VsbGluZyBhbmQgbW9zdCBwcm9maXRhYmxlIFJlZ2lvbiBmb3IgYWxsIHRoZSB0aW1lIGluIGFic29sdXRlIG51bWJlcnMuCgpgYGB7ciB0b3RhbC1yZWdpb259CgpPcmRlcnMgJT4lCiAgZ3JvdXBfYnkoUmVnaW9uKSAlPiUKICBzdW1tYXJpc2UoU2FsZXMgPSBzdW0oU2FsZXMpLCAKICAgICAgICAgICAgUHJvZml0ID0gc3VtKFByb2ZpdCkpICU+JQogIHVuZ3JvdXAoKSAlPiUKICBhcnJhbmdlKC1Qcm9maXQpICU+JQogIG11dGF0ZShTYWxlcyA9IHNjYWxlczo6ZG9sbGFyKFNhbGVzLCBhY2N1cmFjeSA9IDAuMDEpLCAKICAgICAgICAgUHJvZml0ID0gc2NhbGVzOjpkb2xsYXIoUHJvZml0LCBhY2N1cmFjeSA9IDAuMDEpKSAlPiUKICBrYmwoY29sLm5hbWVzID0gYygiUmVnaW9uIiwgIlNhbGVzIiwgIlByb2ZpdCIpLAogICAgICBjYXB0aW9uID0gIlRvdGFsIFNhbGVzIGFuZCBQcm9maXQgYnkgUmVnaW9uIGZvciBhbGwgdGhlIHRpbWUiLCAKICAgICAgZXNjYXBlID0gRiwgYWxpZ24gPSAibHJyIikgJT4lCiAgcm93X3NwZWMoMCwgYWxpZ24gPSAiYyIpICU+JQogIGthYmxlX3N0eWxpbmcoYm9vdHN0cmFwX29wdGlvbnMgPSBjKCJzdHJpcGVkIiwgImJvcmRlcmVkIiksIGZ1bGxfd2lkdGggPSBUUlVFKQoKYGBgCgoKYGBge3IgcHJvZml0YWJsZS1yZWdpb24sIGZpZy5zaG93PSJob2xkIiwgb3V0LndpZHRoPSI1MCUifQoKIyBNb3N0IFByb2ZpdGFibGUgcmVnaW9uCnBsb3QxIDwtIE9yZGVycyAlPiUKICBncm91cF9ieShSZWdpb24pICU+JQogIHN1bW1hcmlzZShQcm9maXQgPSBzdW0oUHJvZml0KSkgJT4lCiAgdW5ncm91cCgpICU+JQogIG11dGF0ZShwZXJjID0gUHJvZml0IC8gc3VtKFByb2ZpdCkpICU+JSAKICBhcnJhbmdlKHBlcmMpICU+JQogIGdncGxvdChhZXMoeCA9IDAsIHk9cGVyYywgZmlsbD1SZWdpb24pKSArCiAgZ2VvbV9iYXIoc3RhdD0iaWRlbnRpdHkiKSArCiAgZ2VvbV90ZXh0KGFlcyhsYWJlbD1zY2FsZXM6OnBlcmNlbnQocGVyYykpLAogICAgICAgICAgICBwb3NpdGlvbiA9IHBvc2l0aW9uX3N0YWNrKHZqdXN0ID0gMC41KSkgKwogIHNjYWxlX2ZpbGxfYnJld2VyKHBhbGV0dGU9IkdyZWVucyIpICsKICBsYWJzKHRpdGxlID0gIk1vc3QgUHJvZml0YWJsZSBSZWdpb24gZm9yIGFsbCB0aGUgdGltZSIsIHggPSAiIiwgeSA9ICIiKSArCiAgc2NhbGVfeV9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6bGFiZWxfcGVyY2VudCgpKSArCiAgY29vcmRfcG9sYXIodGhldGEgPSAieSIpICsKICB0aGVtZShsZWdlbmQudGl0bGUgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgYXhpcy50ZXh0ID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgIGF4aXMudGlja3MgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgcGFuZWwuZ3JpZCAgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgcGFuZWwuZ3JpZC5tYWpvciA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBwYW5lbC5ib3JkZXIgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgbGVnZW5kLnBvc2l0aW9uID0gImJvdHRvbSIpCgojIFdoaWNoIHJlZ2lvbiBtYWtlcyBtb3N0IHRvdGFsIGxvc3Nlcz8KcGxvdDIgPC0gT3JkZXJzICU+JQogIGdyb3VwX2J5KGBPcmRlciBJRGApICU+JQogIHN1bW1hcmlzZShQcm9maXQgPSBzdW0oUHJvZml0KSwgUmVnaW9uID0gZmlyc3QoUmVnaW9uKSkgJT4lCiAgZ3JvdXBfYnkoUmVnaW9uKSAlPiUKICBzdW1tYXJpc2UocGVyY19sb3NzZXMgPSBuX2Rpc3RpbmN0KGBPcmRlciBJRGBbUHJvZml0IDwgMF0pL24oKSwKICAgICAgICAgICAgbG9zc2VzX2NvdW50ID0gbl9kaXN0aW5jdChgT3JkZXIgSURgW1Byb2ZpdCA8IDBdKSwKICAgICAgICAgICAgdG90YWxfY291bnQgPSBuKCkpICU+JQogIGdncGxvdChhZXMoeCA9IDAsIHk9cGVyY19sb3NzZXMsIGZpbGw9UmVnaW9uKSkgKwogIGdlb21fYmFyKHN0YXQ9ImlkZW50aXR5IikgKwogIGdlb21fdGV4dChhZXMobGFiZWw9c2NhbGVzOjpwZXJjZW50KHBlcmNfbG9zc2VzKSksCiAgICAgICAgICAgIHBvc2l0aW9uID0gcG9zaXRpb25fc3RhY2sodmp1c3QgPSAwLjUpKSArCiAgc2NhbGVfZmlsbF9icmV3ZXIocGFsZXR0ZT0iR3JlZW5zIikgKwogIGxhYnModGl0bGUgPSAiIyBvZiBMb3NzIG9yZGVycyBieSBSZWdpb24iLCB4ID0gIiIsIHkgPSAiIikgKwogIHNjYWxlX3lfY29udGludW91cyhsYWJlbHMgPSBzY2FsZXM6OmxhYmVsX3BlcmNlbnQoKSkgKwogIGNvb3JkX3BvbGFyKHRoZXRhID0gInkiKSArCiAgdGhlbWUobGVnZW5kLnRpdGxlID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgIGF4aXMudGV4dCA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBheGlzLnRpY2tzID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgIHBhbmVsLmdyaWQgID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgIHBhbmVsLmdyaWQubWFqb3IgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgcGFuZWwuYm9yZGVyID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgIGxlZ2VuZC5wb3NpdGlvbiA9ICJib3R0b20iKQogIApwbG90MQpwbG90MgoKYGBgCgpPdXIgb2JzZXJ2YXRpb25zIGFyZToKKyBUaGUgbW9zdCBwcm9maXRhYmxlICoqUmVnaW9uKiogaXMgV2VzdC4gSXQgaXMgYWxtb3N0IDM4JSBvZiBQcm9maXQuIFRoZSBsZXNzIHByb2ZpdGFibGUgcmVnaW9uIGlzIENlbnRyYWwgUmVnaW9uLgorIFdlc3QgUmVnaW9uIGhhcyBsZXNzIG51bWJlciBvZiBsb3NzIG9yZGVycywgYW5kIENlbnRyYWwgUmVnaW9uIGhhcyB0aGUgbW9zdCBudW1iZXIgb3MgbG9zcyBvcmRlcnMuCisgRWFzdCBSZWdpb24gaGFzIGFsbW9zdCAxLzMgcGFydCBvZiB0b3RhbCBwcm9maXQsIGJ1dCB0aGUgcmVnaW9uIGhhcyBoaWdoIG51bWJlciBvZiBsb3NzIG9yZGVycy4KCiMjIyMgV2hhdCBhcmUgWW9ZIFNhbGVzIGFuZCBQcm9maXQgZ3Jvd3RoIGJ5IFJlZ2lvbj8KCmBgYHtyIHlveS1yZWdpb259CgpZb1lfcmVnIDwtIE9yZGVycyAlPiUKICBtdXRhdGUoWWVhciA9IHllYXIoYE9yZGVyIERhdGVgKSkgJT4lCiAgZ3JvdXBfYnkoUmVnaW9uLCBZZWFyKSAlPiUKICBzdW1tYXJpc2UoU2FsZXMgPSBzdW0oU2FsZXMpLAogICAgICAgICAgICBQcm9maXQgPSBzdW0oUHJvZml0KSkgJT4lCiAgbXV0YXRlKFlvWV9Hcm93dGhfU2FsZXMgPSAoU2FsZXMgLSBsYWcoU2FsZXMpKS9sYWcoU2FsZXMpLAogICAgICAgICBZb1lfR3Jvd3RoX1Byb2ZpdCA9IChQcm9maXQgLSBsYWcoUHJvZml0KSkvYWJzKGxhZyhQcm9maXQpKSkKCnJlZ190YWJsZSA8LSBZb1lfcmVnICU+JQpwaXZvdF93aWRlcihuYW1lc19mcm9tID0gIlllYXIiLCB2YWx1ZXNfZnJvbSA9IGMoIlNhbGVzIiwgIlByb2ZpdCIsICJZb1lfR3Jvd3RoX1NhbGVzIiwgIllvWV9Hcm93dGhfUHJvZml0IikpCgpzYWxlc19jb2x1bW5zIDwtIHJlZ190YWJsZSAlPiUgdW5ncm91cCgpICU+JSBzZWxlY3Qoc3RhcnRzX3dpdGgoIlNhbGVzIikpICU+JSBjb2xuYW1lcygpCnByb2ZpdF9jb2x1bW5zIDwtIHJlZ190YWJsZSAlPiUgdW5ncm91cCgpICU+JSBzZWxlY3Qoc3RhcnRzX3dpdGgoIlByb2ZpdCIpKSAlPiUgY29sbmFtZXMoKQp5b3lfc2FsZXNfY29sdW1ucyA8LSByZWdfdGFibGUgJT4lIHVuZ3JvdXAoKSAlPiUgc2VsZWN0KHN0YXJ0c193aXRoKCJZb1lfR3Jvd3RoX1NhbGVzXyIpKSAlPiUgY29sbmFtZXMoKQp5b3lfcHJvZml0X2NvbHVtbnMgPC0gcmVnX3RhYmxlICU+JSB1bmdyb3VwKCkgJT4lIHNlbGVjdChzdGFydHNfd2l0aCgiWW9ZX0dyb3d0aF9Qcm9maXRfIikpICU+JSBjb2xuYW1lcygpCgpyZWdfdGFibGUgJT4lIHNlbGVjdChzYWxlc19jb2x1bW5zLCBwcm9maXRfY29sdW1ucykgJT4lCiAgbXV0YXRlX2lmKGlzLm51bWVyaWMsIH5zY2FsZXM6OmRvbGxhciguLCBhY2N1cmF0ZSA9IDAuMDEpKSAlPiUKa2JsKGNvbC5uYW1lcyA9IGMoIlJlZ2lvbiIsIGFzLmNoYXJhY3RlcigyMDE0OjIwMTcpLCBhcy5jaGFyYWN0ZXIoMjAxNDoyMDE3KSksCiAgICAgICAgICAgICBjYXB0aW9uID0gIlNhbGVzIGFuZCBQcm9maXQgYnkgUmVnaW9uIiwKICAgIGVzY2FwZSA9IEYsCiAgICBhbGlnbiA9IGMoImwiLCByZXAoJ3InLHRpbWVzPTgpKSkgJT4lCnJvd19zcGVjKDAsIGFsaWduID0gImMiKSAlPiUKa2FibGVfc3R5bGluZyhib290c3RyYXBfb3B0aW9ucyA9IGMoInN0cmlwZWQiLCAiYm9yZGVyZWQiKSwgZnVsbF93aWR0aCA9IFRSVUUpICU+JQphZGRfaGVhZGVyX2Fib3ZlKGhlYWRlciA9IGMoIiIsICJTYWxlcyIgPSA0LCAiUHJvZml0IiA9IDQpLCBib2xkID0gVFJVRSwgYm9yZGVyX2xlZnQgPSBUUlVFLCBib3JkZXJfcmlnaHQgPSBUUlVFKQoKYGBgCgpgYGB7ciB5b3ktcmVnaW9uLXRhYmxlfQoKeW95X2dyb3d0aF9jb2x1bW5zIDwtIHJlZ190YWJsZSAlPiUgdW5ncm91cCgpICU+JSBzZWxlY3Qoc3RhcnRzX3dpdGgoIllvWV8iKSkgJT4lIGNvbG5hbWVzKCkKcmVnX3RhYmxlICU+JSBzZWxlY3QoeW95X2dyb3d0aF9jb2x1bW5zKSAlPiUKICBtdXRhdGVfaWYoaXMubnVtZXJpYywgfmNlbGxfc3BlYyhzY2FsZXM6OnBlcmNlbnQoLiwgYWNjdXJhY3kgPSAwLjEpLCAiaHRtbCIsIGNvbG9yPWNhc2Vfd2hlbiguIDwgMCB+ICJyZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuID49IDAgfiAiZ3JlZW4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpcy5uYSguKSB+ICJsaWdodGdyYXkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUUlVFIH4gImJsYWNrIikpKSAlPiUKa2JsKGNvbC5uYW1lcyA9IGMoIlJlZ2lvbiIsIGFzLmNoYXJhY3RlcigyMDE0OjIwMTcpLCBhcy5jaGFyYWN0ZXIoMjAxNDoyMDE3KSksCiAgICAgICAgICAgICBjYXB0aW9uID0gIlllYXIgb3ZlciB0aGUgeWVhciBTYWxlcyBhbmQgUHJvZml0IGdyb3d0aCBieSBSZWdpb24iLAogICAgZXNjYXBlID0gRiwKICAgIGFsaWduID0gYygibCIsIHJlcCgncicsdGltZXM9OCkpKSAlPiUKcm93X3NwZWMoMCwgYWxpZ24gPSAiYyIpICU+JQprYWJsZV9zdHlsaW5nKGJvb3RzdHJhcF9vcHRpb25zID0gYygic3RyaXBlZCIsICJib3JkZXJlZCIpLCBmdWxsX3dpZHRoID0gVFJVRSkgJT4lCmFkZF9oZWFkZXJfYWJvdmUoaGVhZGVyID0gYygiIiwgIllvWSBTYWxlcyBHcm93dGgiID0gNCwgIllvWSBQcm9maXQgR3Jvd3RoIiA9IDQpLCBib2xkID0gVFJVRSwgYm9yZGVyX2xlZnQgPSBUUlVFLCBib3JkZXJfcmlnaHQgPSBUUlVFKQoKCgpgYGAKCiMjIyMgWW9ZIFNhbGVzIEdyb3d0aAoKYGBge3IgeW95LXNhbGVzLXJlZ2lvbi1wbG90fQoKWW9ZX3JlZyAlPiUKICBnZ3Bsb3QoKSArCiAgZ2VvbV9iYXIoYWVzKHg9WWVhciwgeT1TYWxlcywgZmlsbD1SZWdpb24sIGdyb3VwPVJlZ2lvbiksIHN0YXQ9ImlkZW50aXR5IikgKwogIGdlb21fbGluZShhZXMoeD1ZZWFyLCB5PVlvWV9Hcm93dGhfU2FsZXMqbWF4KFlvWV9yZWckU2FsZXNbWW9ZX3JlZyRZZWFyID09IFllYXJdKSwgZ3JvdXA9UmVnaW9uKSkgKwogIGdlb21fcG9pbnQoYWVzKHg9WWVhciwgeT1Zb1lfR3Jvd3RoX1NhbGVzKm1heChZb1lfcmVnJFNhbGVzW1lvWV9yZWckWWVhciA9PSBZZWFyXSksIGdyb3VwPVJlZ2lvbiksIHNpemUgPSAzKSArCiAgZ2VvbV9wb2ludChhZXMoeD1ZZWFyLCB5PVlvWV9Hcm93dGhfU2FsZXMqbWF4KFlvWV9yZWckU2FsZXNbWW9ZX3JlZyRZZWFyID09IFllYXJdKSwgZ3JvdXA9UmVnaW9uKSwgc2hhcGUgPSAyMSwgc2l6ZSA9IDEuNSwgZmlsbCA9ICJ3aGl0ZSIpICsKICBnZW9tX3RleHQoYWVzKHg9WWVhciwgeT1Zb1lfR3Jvd3RoX1NhbGVzKm1heChZb1lfcmVnJFNhbGVzW1lvWV9yZWckWWVhciA9PSBZZWFyXSksIAogICAgICAgICAgICAgICAgbGFiZWwgPSBzY2FsZXM6OnBlcmNlbnQoWW9ZX0dyb3d0aF9TYWxlcywgYWNjdXJhY3kgPSAwLjEpLCBncm91cD1SZWdpb24pLCB2anVzdD0tMS41KSArCiAgc2NhbGVfeV9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6bGFiZWxfbnVtYmVyKHNjYWxlID0gMWUtMywgc3VmZml4ID0gIiBLIikpICsKICBsYWJzKHRpdGxlID0gIllvWSBTYWxlcyBHcm93dGggYnkgUmVnaW9uIiwgeD0iWWVhciIsIHk9IlNhbGVzLCAkIikgKwogIHNjYWxlX2ZpbGxfYnJld2VyKHBhbGV0dGU9IkdyZWVucyIpICsKICBmYWNldF93cmFwKC5+UmVnaW9uKSArIAogIHRoZW1lKHN0cmlwLmJhY2tncm91bmQgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgc3RyaXAudGV4dCA9IGVsZW1lbnRfdGV4dChjb2xvciA9ICJibGFjayIsIGZhY2UgPSAiYm9sZCIpLAogICAgICAgIGxlZ2VuZC5wb3NpdGlvbiA9ICJub25lIikKCgpgYGAKCiMjIyMgWW9ZIFByb2ZpdCBHcm93dGgKCgpgYGB7ciB5b3ktcHJvZml0LXJlZ2lvbi1wbG90fQoKWW9ZX3JlZyAlPiUKICBnZ3Bsb3QoKSArCiAgZ2VvbV9iYXIoYWVzKHg9WWVhciwgeT1Qcm9maXQsIGZpbGw9UmVnaW9uLCBncm91cD1SZWdpb24pLCBzdGF0PSJpZGVudGl0eSIpICsKICBnZW9tX2xpbmUoYWVzKHg9WWVhciwgeT1Zb1lfR3Jvd3RoX1Byb2ZpdCptYXgoWW9ZX3JlZyRQcm9maXRbWW9ZX3JlZyRZZWFyID09IFllYXJdKSAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmZWxzZShZZWFyID09IDIwMTUgJiBSZWdpb24gPT0gIkNlbnRyYWwiLCAwLjA1LCAxKSwgZ3JvdXA9UmVnaW9uKSkgKwogIGdlb21fcG9pbnQoYWVzKHg9WWVhciwgeT1Zb1lfR3Jvd3RoX1Byb2ZpdCptYXgoWW9ZX3JlZyRQcm9maXRbWW9ZX3JlZyRZZWFyID09IFllYXJdKSAqCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmZWxzZShZZWFyID09IDIwMTUgJiBSZWdpb24gPT0gIkNlbnRyYWwiLCAwLjA1LCAxKSwgZ3JvdXA9UmVnaW9uKSwgc2l6ZSA9IDMpICsKICBnZW9tX3BvaW50KGFlcyh4PVllYXIsIHk9WW9ZX0dyb3d0aF9Qcm9maXQqbWF4KFlvWV9yZWckUHJvZml0W1lvWV9yZWckWWVhciA9PSBZZWFyXSkgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZmVsc2UoWWVhciA9PSAyMDE1ICYgUmVnaW9uID09ICJDZW50cmFsIiwgMC4wNSwgMSksIGdyb3VwPVJlZ2lvbiksIHNoYXBlID0gMjEsIHNpemUgPSAxLjUsIGZpbGwgPSAid2hpdGUiKSArCiAgZ2VvbV90ZXh0KGFlcyh4PVllYXIsIHk9WW9ZX0dyb3d0aF9Qcm9maXQqbWF4KFlvWV9yZWckUHJvZml0W1lvWV9yZWckWWVhciA9PSBZZWFyXSkgKgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZmVsc2UoWWVhciA9PSAyMDE1ICYgUmVnaW9uID09ICJDZW50cmFsIiwgMC4wNSwgMSksIAogICAgICAgICAgICAgICAgbGFiZWwgPSBzY2FsZXM6OnBlcmNlbnQoWW9ZX0dyb3d0aF9Qcm9maXQsIGFjY3VyYWN5ID0gMC4xKSwgZ3JvdXA9UmVnaW9uKSwgdmp1c3Q9LTEuNSkgKwogIHNjYWxlX3lfY29udGludW91cyhsYWJlbHMgPSBzY2FsZXM6OmxhYmVsX251bWJlcihzY2FsZSA9IDFlLTMsIHN1ZmZpeCA9ICIgSyIpLCBsaW1pdHMgPSBjKC0zMGUzLCA3MGUzKSkgKwogIGxhYnModGl0bGUgPSAiWW9ZIFByb2ZpdCBHcm93dGggYnkgUmVnaW9uIiwgeD0iWWVhciIsIHk9IlByb2ZpdCwgJCIpICsKICBzY2FsZV9maWxsX2JyZXdlcihwYWxldHRlPSJHcmVlbnMiKSArCiAgZmFjZXRfd3JhcCguflJlZ2lvbikgKyAKICB0aGVtZShzdHJpcC5iYWNrZ3JvdW5kID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgIHN0cmlwLnRleHQgPSBlbGVtZW50X3RleHQoY29sb3IgPSAiYmxhY2siLCBmYWNlID0gImJvbGQiKSwKICAgICAgICBsZWdlbmQucG9zaXRpb24gPSAibm9uZSIpCgpgYGAKCgojIyMjIFlvWSBMb3NzZXMgT3JkZXJzIEdyb3d0aAoKYGBge3IgeW95LWxvc2FibGUtcmVnaW9uLXBsb3R9Cgpsb3NzZXMgPC0gT3JkZXJzICU+JQogIG11dGF0ZShZZWFyID0gYXMuZmFjdG9yKHllYXIoYE9yZGVyIERhdGVgKSkpICU+JQogIGdyb3VwX2J5KGBPcmRlciBJRGApICU+JQogIHN1bW1hcmlzZShQcm9maXQgPSBzdW0oUHJvZml0KSwgUmVnaW9uID0gZmlyc3QoUmVnaW9uKSwgWWVhciA9IGZpcnN0KFllYXIpKSAlPiUKICB1bmdyb3VwKCkgJT4lCiAgZ3JvdXBfYnkoUmVnaW9uLCBZZWFyKSAlPiUKICBzdW1tYXJpc2UobG9zc2VzID0gbl9kaXN0aW5jdChgT3JkZXIgSURgW1Byb2ZpdCA8IDBdKSkgJT4lCiAgbXV0YXRlKGBZb1kgR3Jvd3RoYCA9IChsb3NzZXMgLSBsYWcobG9zc2VzKSkvbGFnKGxvc3NlcykpIAoKc2NhbGUgPC0gbWF4KGxvc3NlcyRsb3NzZXMpCgpsb3NzZXMgJT4lCiAgZ2dwbG90KCkgKwogIGdlb21fYmFyKGFlcyh4PVllYXIsIHk9bG9zc2VzLCBmaWxsPVJlZ2lvbiwgZ3JvdXA9UmVnaW9uKSwgc3RhdD0iaWRlbnRpdHkiKSArCiAgZ2VvbV9saW5lKGFlcyh4PVllYXIsIHk9YFlvWSBHcm93dGhgICogc2NhbGUsIGdyb3VwPVJlZ2lvbikpICsKICBnZW9tX3BvaW50KGFlcyh4PVllYXIsIHk9YFlvWSBHcm93dGhgICogc2NhbGUsIGdyb3VwPVJlZ2lvbiksIHNpemUgPSAzKSArCiAgZ2VvbV9wb2ludChhZXMoeD1ZZWFyLCB5PWBZb1kgR3Jvd3RoYCAqIHNjYWxlLCBncm91cD1SZWdpb24pLCBzaGFwZSA9IDIxLCBzaXplID0gMS41LCBmaWxsPSJ3aGl0ZSIpICsKICBnZW9tX3RleHQoYWVzKHg9WWVhciwgeT1gWW9ZIEdyb3d0aGAgKiBzY2FsZSwgZ3JvdXA9UmVnaW9uLCBsYWJlbD1zY2FsZXM6OnBlcmNlbnQoYFlvWSBHcm93dGhgLCBhY2N1cmFjeSA9IDAuMSkpLCB2anVzdD0tMS41KSArCiAgc2NhbGVfeV9jb250aW51b3VzKGxpbWl0cyA9IGMoLTE1LCAxNTApLCBicmVha3MgPSBzZXEoMCwgMTUwLCAyNSkpICsKICBsYWJzKHRpdGxlID0gIllvWSAjIG9mIGxvc2FibGUgb3JkZXJzIEdyb3d0aCBieSBSZWdpb24iLCB4PSJZZWFyIiwgeT0iIyBvZiBMb3NhYmxlIE9yZGVycyIpICsKICBzY2FsZV9maWxsX2JyZXdlcihwYWxldHRlPSJHcmVlbnMiKSArCiAgZmFjZXRfd3JhcCguflJlZ2lvbikgKwogIHRoZW1lKHN0cmlwLmJhY2tncm91bmQgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgc3RyaXAudGV4dCA9IGVsZW1lbnRfdGV4dChjb2xvciA9ICJibGFjayIsIGZhY2UgPSAiYm9sZCIpLAogICAgICAgIGxlZ2VuZC5wb3NpdGlvbiA9ICJub25lIikKCmBgYAoKCiMjIyBDaXR5CgoKYGBge3IgY2l0aWVzLWRmfQpkZl9jaXRpZXMgPC0gT3JkZXJzICU+JQogIGdyb3VwX2J5KENpdHkpICU+JQogIHN1bW1hcmlzZShTYWxlcyA9IHN1bShTYWxlcyksIFByb2ZpdCA9IHN1bShQcm9maXQpLCBRdWFudGl0eSA9IHN1bShRdWFudGl0eSkpCgpgYGAKCiMjIyMgV2hhdCBhcmUgdG9wIHByb2ZpdGFibGUgQ2l0aWVzPwoKYGBge3IgdG9wLXByb2YtY2l0aWVzfQoKZGZfY2l0aWVzICU+JQogIGFycmFuZ2UoLVByb2ZpdCkgJT4lCiAgbXV0YXRlKENpdHkgPSByZW9yZGVyX3ZhbHVlKENpdHksIFByb2ZpdCwgRkFMU0UpKSAlPiUKICBoZWFkKDEwKSAlPiUKICBwaXZvdF9sb25nZXIoYyhTYWxlcywgUHJvZml0KSwgbmFtZXNfdG8gPSAiTmFtZSIsIHZhbHVlc190byA9ICJWYWx1ZSIpICU+JQogIGdncGxvdCgpICsKICBnZW9tX2JhcihhZXMoeCA9IENpdHksIHkgPSBWYWx1ZSwgZmlsbD1OYW1lKSwgc3RhdD0iaWRlbnRpdHkiLCBwb3NpdGlvbiA9IHBvc2l0aW9uX2RvZGdlKHdpZHRoID0gMSkpICsKICBnZW9tX3RleHQoYWVzKHg9Q2l0eSwgeT1WYWx1ZSwgbGFiZWwgPSBzY2FsZXM6OmRvbGxhcihWYWx1ZSwgYWNjdXJhY3kgPSAwLjEpLCBncm91cD1OYW1lKSwgc2l6ZT0yLjUsIHBvc2l0aW9uID0gcG9zaXRpb25fZG9kZ2Uod2lkdGggPSAxKSwgaGp1c3QgPSAtMC4xKSArCiAgbGFicyh0aXRsZSA9ICJUb3AgMTAgbW9zdCBwcm9maXRhYmxlIENpdGllcyIsIHggPSAiQ2l0eSIsIHkgPSAiUHJvZml0ICYgU2FsZXMsICQiKSArCiAgc2NhbGVfeV9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6bGFiZWxfbnVtYmVyKHN1ZmZpeCA9ICIgSyIsIHNjYWxlID0gMWUtMyksIGJyZWFrcyA9IHNlcSgwLCAzMDBlMywgYnkgPSA1MGUzKSwgbGltaXRzPWMoMCwgMzAwZTMpKSArCiAgIHNjYWxlX2ZpbGxfbWFudWFsKCIiLCB2YWx1ZXM9YygiU2FsZXMiID0gIiNBREQ3QTAiLCAiUHJvZml0IiA9ICIjNEJBMTVEIikpKwogIGd1aWRlcyhjb2xvciA9IGd1aWRlX2xlZ2VuZChvdmVycmlkZS5hZXMgPSBsaXN0KGZpbGwgPSBOQSkpLAogICAgICAgICBsaW5ldHlwZSA9IGd1aWRlX2xlZ2VuZChvdmVycmlkZS5hZXMgPSBsaXN0KGZpbGwgPSBOQSkpKSArCiAgICB0aGVtZShsZWdlbmQua2V5PWVsZW1lbnRfcmVjdChmaWxsID0gIndoaXRlIiwgY29sb3I9IndoaXRlIiksCiAgICAgICAgICBsZWdlbmQudGl0bGU9ZWxlbWVudF9ibGFuaygpLAogICAgICAgICAgbGVnZW5kLmJveD0iaG9yaXpvbnRhbCIsCiAgICAgICAgICBsZWdlbmQucG9zaXRpb249ImJvdHRvbSIpICsKICBjb29yZF9mbGlwKCkKCmBgYAoKIyMjIyBXaGF0IGFyZSBib3R0b20gcHJvZml0YWJsZSBDaXRpZXM/CgpgYGB7ciBib3R0b20tcHJvZi1jaXRpZXN9CgpkZl9jaXRpZXMgJT4lCiAgYXJyYW5nZShQcm9maXQpICU+JQogIG11dGF0ZShDaXR5ID0gcmVvcmRlcl92YWx1ZShDaXR5LCBQcm9maXQsIEZBTFNFKSkgJT4lCiAgaGVhZCgxMCkgJT4lCiAgcGl2b3RfbG9uZ2VyKGMoU2FsZXMsIFByb2ZpdCksIG5hbWVzX3RvID0gIk5hbWUiLCB2YWx1ZXNfdG8gPSAiVmFsdWUiKSAlPiUKICBnZ3Bsb3QoKSArCiAgZ2VvbV9iYXIoYWVzKHggPSBDaXR5LCB5ID0gVmFsdWUsIGZpbGw9TmFtZSksIHN0YXQ9ImlkZW50aXR5IiwgcG9zaXRpb24gPSBwb3NpdGlvbl9kb2RnZSh3aWR0aCA9IDEpKSArCiAgZ2VvbV90ZXh0KGFlcyh4PUNpdHksIHk9VmFsdWUsIGxhYmVsID0gc2NhbGVzOjpkb2xsYXIoVmFsdWUsIGFjY3VyYWN5ID0gMC4xKSwgZ3JvdXA9TmFtZSwKICAgICAgICAgICAgICAgIGhqdXN0ID0gaWZlbHNlKFZhbHVlIDwgMCwgMS4xLCAtMC4xKSksIHNpemU9Mi41LCBwb3NpdGlvbiA9IHBvc2l0aW9uX2RvZGdlKHdpZHRoID0gMSkpICsKICBsYWJzKHRpdGxlID0gIkJvdHRvbSAxMCBtb3N0IHByb2ZpdGFibGUgQ2l0aWVzIiwgeCA9ICJTdGF0ZSIsIHkgPSAiUHJvZml0ICYgU2FsZXMsICQiKSArCiAgc2NhbGVfeV9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6bGFiZWxfbnVtYmVyKHN1ZmZpeCA9ICIgSyIsIHNjYWxlID0gMWUtMyksIGJyZWFrcyA9IHNlcSgtNTBlMywgMjAwZTMsIGJ5ID0gMjVlMyksIGxpbWl0cz1jKC01MGUzLCAyMDBlMykpICsKICAgc2NhbGVfZmlsbF9tYW51YWwoIiIsIHZhbHVlcz1jKCJTYWxlcyIgPSAiI0FERDdBMCIsICJQcm9maXQiID0gIiM0QkExNUQiKSkrCiAgZ3VpZGVzKGNvbG9yID0gZ3VpZGVfbGVnZW5kKG92ZXJyaWRlLmFlcyA9IGxpc3QoZmlsbCA9IE5BKSksCiAgICAgICAgIGxpbmV0eXBlID0gZ3VpZGVfbGVnZW5kKG92ZXJyaWRlLmFlcyA9IGxpc3QoZmlsbCA9IE5BKSkpICsKICAgIHRoZW1lKGxlZ2VuZC5rZXk9ZWxlbWVudF9yZWN0KGZpbGwgPSAid2hpdGUiLCBjb2xvcj0id2hpdGUiKSwKICAgICAgICAgIGxlZ2VuZC50aXRsZT1lbGVtZW50X2JsYW5rKCksCiAgICAgICAgICBsZWdlbmQuYm94PSJob3Jpem9udGFsIiwKICAgICAgICAgIGxlZ2VuZC5wb3NpdGlvbj0iYm90dG9tIikgKwogIGNvb3JkX2ZsaXAoKQoKYGBgCgoKIyMjIFN0YXRlIAoKYGBge3Igc3RhdGVzLWRmfQoKZGZfc3RhdGVzIDwtIE9yZGVycyAlPiUKICBncm91cF9ieShTdGF0ZSkgJT4lCiAgc3VtbWFyaXNlKFNhbGVzID0gc3VtKFNhbGVzKSwgUHJvZml0ID0gc3VtKFByb2ZpdCksIFF1YW50aXR5ID0gc3VtKFF1YW50aXR5KSkKCmBgYAoKCiMjIyMgV2hhdCBhcmUgdG9wIHByb2ZpdGFibGUgU3RhdGVzPwoKYGBge3IgdG9wLXN0YXRlcy1wbG90fQoKZGZfc3RhdGVzICU+JQogIGFycmFuZ2UoLVByb2ZpdCkgJT4lCiAgbXV0YXRlKFN0YXRlID0gcmVvcmRlcl92YWx1ZShTdGF0ZSwgUHJvZml0LCBGQUxTRSkpICU+JQogIGhlYWQoMTApICU+JQogIHBpdm90X2xvbmdlcihjKFNhbGVzLCBQcm9maXQpLCBuYW1lc190byA9ICJOYW1lIiwgdmFsdWVzX3RvID0gIlZhbHVlIikgJT4lCiAgZ2dwbG90KCkgKwogIGdlb21fYmFyKGFlcyh4ID0gU3RhdGUsIHkgPSBWYWx1ZSwgZmlsbD1OYW1lKSwgc3RhdD0iaWRlbnRpdHkiLCBwb3NpdGlvbiA9IHBvc2l0aW9uX2RvZGdlKHdpZHRoID0gMSkpICsKICBnZW9tX3RleHQoYWVzKHg9U3RhdGUsIHk9VmFsdWUsIGxhYmVsID0gc2NhbGVzOjpkb2xsYXIoVmFsdWUsIGFjY3VyYWN5ID0gMC4xKSwgZ3JvdXA9TmFtZSksIHNpemU9Mi41LCBwb3NpdGlvbiA9IHBvc2l0aW9uX2RvZGdlKHdpZHRoID0gMSksIGhqdXN0ID0gLTAuMSkgKwogIGxhYnModGl0bGUgPSAiVG9wIDEwIG1vc3QgcHJvZml0YWJsZSBTdGF0ZXMiLCB4ID0gIlN0YXRlIiwgeSA9ICJQcm9maXQgJiBTYWxlcywgJCIpICsKICBzY2FsZV95X2NvbnRpbnVvdXMobGFiZWxzID0gc2NhbGVzOjpsYWJlbF9udW1iZXIoc3VmZml4ID0gIiBLIiwgc2NhbGUgPSAxZS0zKSwgYnJlYWtzID0gc2VxKDAsIDUwMGUzLCBieSA9IDUwZTMpLCBsaW1pdHM9YygwLCA1MDBlMykpICsKICAgc2NhbGVfZmlsbF9tYW51YWwoIiIsIHZhbHVlcz1jKCJTYWxlcyIgPSAiI0FERDdBMCIsICJQcm9maXQiID0gIiM0QkExNUQiKSkrCiAgZ3VpZGVzKGNvbG9yID0gZ3VpZGVfbGVnZW5kKG92ZXJyaWRlLmFlcyA9IGxpc3QoZmlsbCA9IE5BKSksCiAgICAgICAgIGxpbmV0eXBlID0gZ3VpZGVfbGVnZW5kKG92ZXJyaWRlLmFlcyA9IGxpc3QoZmlsbCA9IE5BKSkpICsKICAgIHRoZW1lKGxlZ2VuZC5rZXk9ZWxlbWVudF9yZWN0KGZpbGwgPSAid2hpdGUiLCBjb2xvcj0id2hpdGUiKSwKICAgICAgICAgIGxlZ2VuZC50aXRsZT1lbGVtZW50X2JsYW5rKCksCiAgICAgICAgICBsZWdlbmQuYm94PSJob3Jpem9udGFsIiwKICAgICAgICAgIGxlZ2VuZC5wb3NpdGlvbj0iYm90dG9tIikgKwogIGNvb3JkX2ZsaXAoKQpgYGAKCiMjIyMgV2hhdCBhcmUgYm90dG9tIHByb2ZpdGFibGUgU3RhdGVzPwoKYGBge3IgYm90dG9tLXN0YXRlcy1wbG90fQoKZGZfc3RhdGVzICU+JQogIGFycmFuZ2UoUHJvZml0KSAlPiUKICBtdXRhdGUoU3RhdGUgPSByZW9yZGVyX3ZhbHVlKFN0YXRlLCBQcm9maXQsIEZBTFNFKSkgJT4lCiAgaGVhZCgxMCkgJT4lCiAgcGl2b3RfbG9uZ2VyKGMoU2FsZXMsIFByb2ZpdCksIG5hbWVzX3RvID0gIk5hbWUiLCB2YWx1ZXNfdG8gPSAiVmFsdWUiKSAlPiUKICBnZ3Bsb3QoKSArCiAgZ2VvbV9iYXIoYWVzKHggPSBTdGF0ZSwgeSA9IFZhbHVlLCBmaWxsPU5hbWUpLCBzdGF0PSJpZGVudGl0eSIsIHBvc2l0aW9uID0gcG9zaXRpb25fZG9kZ2Uod2lkdGggPSAxKSkgKwogIGdlb21fdGV4dChhZXMoeD1TdGF0ZSwgeT1WYWx1ZSwgbGFiZWwgPSBzY2FsZXM6OmRvbGxhcihWYWx1ZSwgYWNjdXJhY3kgPSAwLjEpLCBncm91cD1OYW1lLAogICAgICAgICAgICAgICAgaGp1c3QgPSBpZmVsc2UoVmFsdWUgPCAwLCAxLjEsIC0wLjEpKSwgc2l6ZT0yLjUsIHBvc2l0aW9uID0gcG9zaXRpb25fZG9kZ2Uod2lkdGggPSAxKSkgKwogIGxhYnModGl0bGUgPSAiQm90dG9tIDEwIG1vc3QgcHJvZml0YWJsZSBTdGF0ZXMiLCB4ID0gIlN0YXRlIiwgeSA9ICJQcm9maXQgJiBTYWxlcywgJCIpICsKICBzY2FsZV95X2NvbnRpbnVvdXMobGFiZWxzID0gc2NhbGVzOjpsYWJlbF9udW1iZXIoc3VmZml4ID0gIiBLIiwgc2NhbGUgPSAxZS0zKSwgYnJlYWtzID0gc2VxKC01MGUzLCAyMDBlMywgYnkgPSAyNWUzKSwgbGltaXRzPWMoLTUwZTMsIDIwMGUzKSkgKwogICBzY2FsZV9maWxsX21hbnVhbCgiIiwgdmFsdWVzPWMoIlNhbGVzIiA9ICIjQUREN0EwIiwgIlByb2ZpdCIgPSAiIzRCQTE1RCIpKSsKICBndWlkZXMoY29sb3IgPSBndWlkZV9sZWdlbmQob3ZlcnJpZGUuYWVzID0gbGlzdChmaWxsID0gTkEpKSwKICAgICAgICAgbGluZXR5cGUgPSBndWlkZV9sZWdlbmQob3ZlcnJpZGUuYWVzID0gbGlzdChmaWxsID0gTkEpKSkgKwogICAgdGhlbWUobGVnZW5kLmtleT1lbGVtZW50X3JlY3QoZmlsbCA9ICJ3aGl0ZSIsIGNvbG9yPSJ3aGl0ZSIpLAogICAgICAgICAgbGVnZW5kLnRpdGxlPWVsZW1lbnRfYmxhbmsoKSwKICAgICAgICAgIGxlZ2VuZC5ib3g9Imhvcml6b250YWwiLAogICAgICAgICAgbGVnZW5kLnBvc2l0aW9uPSJib3R0b20iKSArCiAgY29vcmRfZmxpcCgpCgpgYGAKCiMjIFdoaWNoIGlzIHRoZSBwcmVmZXJyZWQgc2hpcCBtb2RlPwoKYGBge3IgcHJlZmVycmVkLXNoaXAtbW9kZX0KT3JkZXJzICU+JQogIGdyb3VwX2J5KGBTaGlwIE1vZGVgKSAlPiUKICBzdW1tYXJpc2UoY291bnQgPSBuX2Rpc3RpbmN0KGBPcmRlciBJRGApKSAlPiUKICB1bmdyb3VwKCkgJT4lCiAgbXV0YXRlKHBlcmMgPSBjb3VudCAvIHN1bShjb3VudCkpICU+JSAKICBhcnJhbmdlKHBlcmMpICU+JQogIG11dGF0ZShsYWJlbHMgPSBzY2FsZXM6OnBlcmNlbnQocGVyYykpICU+JQpnZ3Bsb3QoYWVzKHg9IiIsIHk9cGVyYywgZmlsbD1gU2hpcCBNb2RlYCkpICsKICBnZW9tX2NvbCgpICsKICBnZW9tX3RleHQoYWVzKGxhYmVsID0gbGFiZWxzKSwKICAgICAgICAgICAgcG9zaXRpb24gPSBwb3NpdGlvbl9zdGFjayh2anVzdCA9IDAuNSkpICsKICBjb29yZF9wb2xhcih0aGV0YSA9ICJ5IikgKwogIGxhYnModGl0bGUgPSAiTW9zdCBwcmVmZXJyZWQgU2hpcCBNb2RlIiwgeCA9ICIiLCB5ID0gIiIpICsKICBzY2FsZV9maWxsX2JyZXdlcihwYWxldHRlPSJHcmVlbnMiKSArCiAgdGhlbWUobGVnZW5kLnRpdGxlID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgIGF4aXMudGV4dCA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBheGlzLnRpY2tzID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgIHBhbmVsLmdyaWQgID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgIHBhbmVsLmdyaWQubWFqb3IgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgcGFuZWwuYm9yZGVyID0gZWxlbWVudF9ibGFuaygpKQoKYGBgCgoKCgojIyBDdXN0b21lciBTZWdtZW50CgpUaGUgcXVlc3Rpb25zIHdlIGFyZSB0cnlpbmcgdG8gYW5zd2VyOgoKKiBXaGF0IHNpemUgb2YgY3VzdG9tZXIgc2VnbWVudHM/CiogV2hpY2ggY3VzdG9tZXIgc2VnbWVudCBpcyB0aGUgYmVzdCBzZWxsaW5nIGZvciBhbGwgdGhlIHRpbWU/CiogV2hpY2ggY3VzdG9tZXIgc2VnbWVudCBpcyB0aGUgbW9zdCBwcm9maXRhYmxlIGZvciBhbGwgdGhlIHRpbWU/CiogV2hhdCBpcyB5ZWFyIG92ZXIgeWVhciBTYWxlcyBncm93dGggb2YgY3VzdG9tZXIgc2VnbWVudHMgZm9yIHRoZSBsYXRlc3QgeWVhcj8KKiBXaGF0IGlzIHllYXIgb3ZlciB5ZWFyIFByb2ZpdCBncm93dGggb2YgY3VzdG9tZXIgc2VnbWVudHMgZm9yIHRoZSBsYXRlc3QgeWVhcj8KKiBXaGljaCBjdXN0b21lciBzZWdtZW50IG1ha2VzIG1vcmUgbG9zc2VzIGZvciBhbGwgdGhlIHRpbWU/CiogV2hhdCBpcyB5ZWFyIG92ZXIgeWVhciBsb3NzZXMgZ3Jvd3RoIG9mIGN1c3RvbWVyIHNlZ21lbnQgZm9yIHRoZSBsYXRlYXN0IHllYXI/CgoKYGBge3IgdG90YWwtcGl2b3R0YWJsZS1zZWdtZW50fQoKIyB0b3RhbCBwaXZvdCB0YWJsZSBieSBzZWdtZW50CnRvdGFsX3Bpdm90dGFibGVfc2VnbWVudCA8LSBPcmRlcnMgJT4lCiAgZ3JvdXBfYnkoYE9yZGVyIElEYCkgJT4lCiAgc3VtbWFyaXNlKFNhbGVzID0gc3VtKFNhbGVzKSwgUHJvZml0ID0gc3VtKFByb2ZpdCksIFNlZ21lbnQgPSBmaXJzdChTZWdtZW50KSwgYEN1c3RvbWVyIElEYCA9IGZpcnN0KGBDdXN0b21lciBJRGApKSAlPiUKICB1bmdyb3VwKCkgJT4lCiAgZ3JvdXBfYnkoU2VnbWVudCkgJT4lCiAgc3VtbWFyaXNlKFNhbGVzID0gc3VtKFNhbGVzKSwgUHJvZml0ID0gc3VtKFByb2ZpdCksIGAjIG9mIE9yZGVyc2AgPSBuX2Rpc3RpbmN0KGBPcmRlciBJRGApLCBgIyBvZiBDdXN0b21lcnNgID0gbl9kaXN0aW5jdChgQ3VzdG9tZXIgSURgKSkgJT4lCiAgdW5ncm91cCgpICU+JQogIGFycmFuZ2UoLVByb2ZpdCkKCmBgYAoKCmBgYHtyIHRvdGFsLXNlZ21lbnQtcGxvdHNtLCBmaWcuc2hvdz0iaG9sZCIsIG91dC53aWR0aD0iNTAlIn0KCiMgdG90YWwgc2FsZXMKdG90YWxfcGl2b3R0YWJsZV9zZWdtZW50ICU+JQogIGdncGxvdChhZXMoeCA9IFNlZ21lbnQsIHkgPSBTYWxlcywgZmlsbCA9IFNlZ21lbnQpKSArCiAgZ2VvbV9jb2woc2hvdy5sZWdlbmQgPSBGQUxTRSkgKwogIGdlb21fdGV4dChhZXMoeCA9IFNlZ21lbnQsIHkgPSBTYWxlcywgbGFiZWwgPSBzY2FsZXM6OmRvbGxhcihTYWxlcywgYWNjdXJhY3kgPSAxTCwgc2NhbGUgPSAxZS0zLCBzdWZmaXggPSAiSyIpKSwgCiAgICAgICAgICAgIHZqdXN0ID0gLTEsIHNpemUgPSA0KSArCiAgc2NhbGVfeV9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6bGFiZWxfbnVtYmVyKGFjY3VyYWN5ID0gMUwsIHNjYWxlID0gMWUtMywgc3VmZml4ID0gIksiKSwgbGltaXRzID0gYygwLCAxMjUwZTMpLCBicmVha3MgPSBzZXEoMCwgMTI1MGUzLCAyNTBlMykpICsKICBzY2FsZV9maWxsX2JyZXdlcihwYWxldHRlPSJHcmVlbnMiKSArCiAgbGFicyh0aXRsZSA9ICJUb3RhbCBTYWxlcyIsIHggPSAiU2VnbWVudCIsIHkgPSAiU2FsZXMsICQiKSAKCiMgdG90YUwgcHJvZml0CnRvdGFsX3Bpdm90dGFibGVfc2VnbWVudCAlPiUKICBnZ3Bsb3QoYWVzKHggPSBTZWdtZW50LCB5ID0gUHJvZml0LCBmaWxsID0gU2VnbWVudCkpICsKICBnZW9tX2NvbChzaG93LmxlZ2VuZCA9IEZBTFNFKSArCiAgZ2VvbV90ZXh0KGFlcyh4ID0gU2VnbWVudCwgeSA9IFByb2ZpdCwgbGFiZWwgPSBzY2FsZXM6OmRvbGxhcihQcm9maXQsIGFjY3VyYWN5ID0gMUwsIHNjYWxlID0gMWUtMywgc3VmZml4ID0gIksiKSksIAogICAgICAgICAgICB2anVzdCA9IC0xLCBzaXplID0gNCkgKwogIHNjYWxlX3lfY29udGludW91cyhsYWJlbHMgPSBzY2FsZXM6OmxhYmVsX251bWJlcihhY2N1cmFjeSA9IDFMLCBzY2FsZSA9IDFlLTMsIHN1ZmZpeCA9ICJLIiksIGxpbWl0cyA9IGMoMCwgMTYwZTMpKSArCiAgc2NhbGVfZmlsbF9icmV3ZXIocGFsZXR0ZT0iR3JlZW5zIikgKwogIGxhYnModGl0bGUgPSAiVG90YWwgUHJvZml0IiwgeCA9ICJTZWdtZW50IiwgeSA9ICJQcm9maXQsICQiKSAKCiMgdG90YWwgIyBvZiBvcmRlcnMKdG90YWxfcGl2b3R0YWJsZV9zZWdtZW50ICU+JQogIGdncGxvdChhZXMoeCA9IFNlZ21lbnQsIHkgPSBgIyBvZiBPcmRlcnNgLCBmaWxsID0gU2VnbWVudCkpICsKICBnZW9tX2NvbChzaG93LmxlZ2VuZCA9IEZBTFNFKSArCiAgZ2VvbV90ZXh0KGFlcyh4ID0gU2VnbWVudCwgeSA9IGAjIG9mIE9yZGVyc2AsIGxhYmVsID0gYCMgb2YgT3JkZXJzYCksIHZqdXN0ID0gLTEsIHNpemUgPSA0KSArCiAgc2NhbGVfeV9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6bGFiZWxfbnVtYmVyKCksIGxpbWl0cyA9IGMoMCwgM2UzKSkgKwogIHNjYWxlX3hfZGlzY3JldGUoZ3VpZGUgPSBndWlkZV9heGlzKGFuZ2xlID0gNDUpKSArIAogIHNjYWxlX2ZpbGxfYnJld2VyKHBhbGV0dGU9IkdyZWVucyIpICsKICBsYWJzKHRpdGxlID0gIlRvdGFsICMgb2YgT3JkZXJzIiwgeCA9ICJTZWdtZW50IiwgeSA9ICIjIG9mIE9yZGVycyIpIAoKYGBgCgoKYGBge3Igdml6LXRvdGFsLXBpdm90dGFibGUtc2VnbWVudH0KCiMgdG90YWwgcGl2b3QgdGFibGUgdml6CnRvdGFsX3Bpdm90dGFibGVfc2VnbWVudCAlPiUKICBtdXRhdGVfYXQoYygyLCAzKSwgfnNjYWxlczo6ZG9sbGFyKC4sIGFjY3VyYWN5ID0gMUwpKSAlPiUKa2JsKGNvbC5uYW1lcyA9IGMoIkN1c3RvbWVyIFNlZ21lbnQiLCAiU2FsZXMiLCAiUHJvZml0IiwgIiMgb2YgT3JkZXJzIiwgIiMgb2YgQ3VzdG9tZXJzIiksCiAgICAgICAgICAgICBjYXB0aW9uID0gIlRvdGFsIG1ldHJpY3MgYnkgQ3VzdG9tZXIgU2VnbWVudCBmb3IgYWxsIHRoZSB0aW1lLiIsCiAgICBlc2NhcGUgPSBGLAogICAgYWxpZ24gPSBjKCJsIiwgcmVwKCdyJyx0aW1lcz00KSkpICU+JQprYWJsZV9zdHlsaW5nKGJvb3RzdHJhcF9vcHRpb25zID0gYygic3RyaXBlZCIsICJib3JkZXJlZCIpLCBmdWxsX3dpZHRoID0gVFJVRSkgJT4lCnJvd19zcGVjKDAsIGFsaWduID0gImMiKQoKYGBgCgoKIyMjIFdoYXQgYXJlIHNpemVzIG9mIEN1c3RvbWVyIFNlZ21lbnRzPwoKYGBge3Igc2VnbWVudC1zaXplbSwgZmlnLnNob3c9ImhvbGQiLCBvdXQud2lkdGg9IjUwJSJ9Cgp0b3RhbF9waXZvdHRhYmxlX3NlZ21lbnQgJT4lCiAgZ2dwbG90KGFlcyh4ID0gMCwgeT1gIyBvZiBDdXN0b21lcnNgLCBmaWxsPVNlZ21lbnQpKSArCiAgZ2VvbV9iYXIoc3RhdD0iaWRlbnRpdHkiKSArCiAgZ2VvbV90ZXh0KGFlcyhsYWJlbD1zY2FsZXM6OnBlcmNlbnQoYCMgb2YgQ3VzdG9tZXJzYC9zdW0oYCMgb2YgQ3VzdG9tZXJzYCksIGFjY3VyYWN5ID0gMC4xKSksCiAgICAgICAgICAgIHBvc2l0aW9uID0gcG9zaXRpb25fc3RhY2sodmp1c3QgPSAwLjUpKSArCiAgc2NhbGVfZmlsbF9icmV3ZXIocGFsZXR0ZT0iR3JlZW5zIikgKwogIGxhYnModGl0bGUgPSAiJSBvZiBUb3RhbCBDdXN0b21lcnMgYnkgU2VnbWVudCIsIHggPSAiIiwgeSA9ICIiKSArCiAgc2NhbGVfeV9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6bGFiZWxfcGVyY2VudCgpKSArCiAgY29vcmRfcG9sYXIodGhldGEgPSAieSIpICsKICB0aGVtZShsZWdlbmQudGl0bGUgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgYXhpcy50ZXh0ID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgIGF4aXMudGlja3MgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgcGFuZWwuZ3JpZCAgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgcGFuZWwuZ3JpZC5tYWpvciA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBwYW5lbC5ib3JkZXIgPSBlbGVtZW50X2JsYW5rKCkpCgp0b3RhbF9waXZvdHRhYmxlX3NlZ21lbnQgJT4lCiAgZ2dwbG90KGFlcyh4ID0gMCwgeT1gIyBvZiBPcmRlcnNgLCBmaWxsPVNlZ21lbnQpKSArCiAgZ2VvbV9iYXIoc3RhdD0iaWRlbnRpdHkiKSArCiAgZ2VvbV90ZXh0KGFlcyhsYWJlbD1zY2FsZXM6OnBlcmNlbnQoYCMgb2YgT3JkZXJzYC9zdW0oYCMgb2YgT3JkZXJzYCksIGFjY3VyYWN5ID0gMC4xKSksCiAgICAgICAgICAgIHBvc2l0aW9uID0gcG9zaXRpb25fc3RhY2sodmp1c3QgPSAwLjUpKSArCiAgc2NhbGVfZmlsbF9icmV3ZXIocGFsZXR0ZT0iR3JlZW5zIikgKwogIGxhYnModGl0bGUgPSAiJSBvZiBUb3RhbCBPcmRlcnMgYnkgU2VnbWVudCIsIHggPSAiIiwgeSA9ICIiKSArCiAgc2NhbGVfeV9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6bGFiZWxfcGVyY2VudCgpKSArCiAgY29vcmRfcG9sYXIodGhldGEgPSAieSIpICsKICB0aGVtZShsZWdlbmQudGl0bGUgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgYXhpcy50ZXh0ID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgIGF4aXMudGlja3MgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgcGFuZWwuZ3JpZCAgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgcGFuZWwuZ3JpZC5tYWpvciA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBwYW5lbC5ib3JkZXIgPSBlbGVtZW50X2JsYW5rKCkpCgpgYGAKCgojIyMgTG9zc2VzCgpgYGB7ciBzZWdtZW50LWxvc3Nlc30KCiMgbG9zc2VzIHNlZ21lbnQKT3JkZXJzICU+JQogIGdyb3VwX2J5KGBPcmRlciBJRGApICU+JQogIHN1bW1hcmlzZShQcm9maXQgPSBzdW0oUHJvZml0KSwgU2VnbWVudCA9IGZpcnN0KFNlZ21lbnQpKSAlPiUKICBncm91cF9ieShTZWdtZW50KSAlPiUKICBzdW1tYXJpc2UocGVyY19sb3NzZXMgPSBuX2Rpc3RpbmN0KGBPcmRlciBJRGBbUHJvZml0IDwgMF0pL24oKSwKICAgICAgICAgICAgbG9zc2VzX2NvdW50ID0gbl9kaXN0aW5jdChgT3JkZXIgSURgW1Byb2ZpdCA8IDBdKSwKICAgICAgICAgICAgdG90YWxfY291bnQgPSBuKCkpICU+JQogIGdncGxvdChhZXMoeCA9IDAsIHk9cGVyY19sb3NzZXMsIGZpbGw9U2VnbWVudCkpICsKICBnZW9tX2JhcihzdGF0PSJpZGVudGl0eSIpICsKICBnZW9tX3RleHQoYWVzKGxhYmVsPXNjYWxlczo6cGVyY2VudChwZXJjX2xvc3NlcykpLAogICAgICAgICAgICBwb3NpdGlvbiA9IHBvc2l0aW9uX3N0YWNrKHZqdXN0ID0gMC41KSkgKwogIHNjYWxlX2ZpbGxfYnJld2VyKHBhbGV0dGU9IkdyZWVucyIpICsKICBsYWJzKHRpdGxlID0gIk51bWJlciBvZiBMb3NhYmxlIE9yZGVycyIsIHggPSAiIiwgeSA9ICIiLAogICAgICAgc3VidGl0bGUgPSBicXVvdGUoIkFsbCB0aGUgQ3VzdG9tZXIgU2VnbWVudHMgaGF2ZSAifmJvbGQoImFsbW9zdCB0aGUgc2FtZSIpfiIgcGVyY2VudGFnZSBvZiBsb3NzYWJsZSBvcmRlcnMuIikpICsKICBzY2FsZV95X2NvbnRpbnVvdXMobGFiZWxzID0gc2NhbGVzOjpsYWJlbF9wZXJjZW50KCkpICsKICBjb29yZF9wb2xhcih0aGV0YSA9ICJ5IikgKwogIHRoZW1lKGxlZ2VuZC50aXRsZSA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBheGlzLnRleHQgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgYXhpcy50aWNrcyA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBwYW5lbC5ncmlkICA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBwYW5lbC5ncmlkLm1ham9yID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgIHBhbmVsLmJvcmRlciA9IGVsZW1lbnRfYmxhbmsoKSkKCmBgYAoKClRoZXNlIHBsb3RzIGFwcGVhciB0b3RhbCBtZXRyaWNzLiBMZXQncyBidWlsZCBhIHRhYmxlIHdpdGggeWVhciBvdmVyIHllYXIgZ3Jvd3RoIG9mIHNhbGVzIGFuZCBwcm9maXQuCgojIyMgV2hhdCBhcmUgWW9ZIEdyb3d0aCBTYWxlcyBhbmQgUHJvZml0IGJ5IEN1c3RvbWVyIFNlZ21lbnQ/CgoKYGBge3IgeW95LXNlZ21lbnR9CgpZb1lfc2VnIDwtIE9yZGVycyAlPiUKICBtdXRhdGUoWWVhciA9IHllYXIoYE9yZGVyIERhdGVgKSkgJT4lCiAgZ3JvdXBfYnkoU2VnbWVudCwgWWVhcikgJT4lCiAgc3VtbWFyaXNlKFNhbGVzID0gcm91bmQoc3VtKFNhbGVzKSwgMiksIAogICAgICAgICAgICBQcm9maXQgPSByb3VuZChzdW0oUHJvZml0KSwgMikpICU+JQogIG11dGF0ZShZb1lfR3Jvd3RoX1NhbGVzID0gKFNhbGVzIC0gbGFnKFNhbGVzKSkvbGFnKFNhbGVzKSwKICAgICAgICAgWW9ZX0dyb3d0aF9Qcm9maXQgPSAoUHJvZml0IC0gbGFnKFByb2ZpdCkpL2FicyhsYWcoUHJvZml0KSkpIAoKWW9ZX3NlZ21lbnQgPC0gWW9ZX3NlZyAlPiUKICBwaXZvdF93aWRlcihuYW1lc19mcm9tID0gIlllYXIiLCB2YWx1ZXNfZnJvbSA9IGMoIlNhbGVzIiwgIlByb2ZpdCIsICJZb1lfR3Jvd3RoX1NhbGVzIiwgIllvWV9Hcm93dGhfUHJvZml0IikpCgpzYWxlc19wcm9maXRfY29sdW1ucyA8LSBZb1lfc2VnbWVudCAlPiUgdW5ncm91cCgpICU+JSBzZWxlY3Qoc3RhcnRzX3dpdGgoYygiU2FsZXMiLCAiUHJvZml0IikpKSAlPiUgY29sbmFtZXMoKQoKYGBgCgpgYGAge3IgeW95LXNlZ21lbnQtdGFibGV9CgpZb1lfc2VnbWVudCAlPiUgCiAgc2VsZWN0KGFsbF9vZihzYWxlc19wcm9maXRfY29sdW1ucykpICU+JQogIG11dGF0ZV9hdChzYWxlc19wcm9maXRfY29sdW1ucywgfnNjYWxlczo6ZG9sbGFyKC4sIGFjY3VyYWN5ID0gMUwpKSAlPiUKa2JsKGNvbC5uYW1lcyA9IGMoIkN1c3RvbWVyIFNlZ21lbnQiLCBhcy5jaGFyYWN0ZXIoMjAxNDoyMDE3KSwgYXMuY2hhcmFjdGVyKDIwMTQ6MjAxNykpLAogICAgICAgICAgICAgY2FwdGlvbiA9ICJTYWxlcyBhbmQgUHJvZml0IGJ5IEN1c3RvbWVyIFNlZ21lbnQiLAogICAgZXNjYXBlID0gRiwKICAgIGFsaWduID0gYygibCIsIHJlcCgncicsdGltZXM9OCkpKSAlPiUKICBrYWJsZV9zdHlsaW5nKGJvb3RzdHJhcF9vcHRpb25zID0gYygic3RyaXBlZCIsICJib3JkZXJlZCIpLCBmdWxsX3dpZHRoID0gVFJVRSkgJT4lCnJvd19zcGVjKDAsIGFsaWduID0gImMiKSAlPiUKYWRkX2hlYWRlcl9hYm92ZShoZWFkZXIgPSBjKCIgIiA9IDEsICJTYWxlcyIgPSA0LCAiUHJvZml0IiA9IDQpLCBib2xkID0gVFJVRSwgYm9yZGVyX2xlZnQgPSBUUlVFLCBib3JkZXJfcmlnaHQgPSBUUlVFKQoKYGBgCgoKYGBge3IgcGl2b3QtdGFibGUtc2VnbWVudH0KCnlveV9ncm93dGhfY29sdW1ucyA8LSBZb1lfc2VnbWVudCAlPiUgdW5ncm91cCgpICU+JSBzZWxlY3Qoc3RhcnRzX3dpdGgoIllvWV8iKSkgJT4lIGNvbG5hbWVzKCkKCllvWV9zZWdtZW50ICU+JSBzZWxlY3QoeW95X2dyb3d0aF9jb2x1bW5zKSAlPiUKICBtdXRhdGVfaWYoaXMubnVtZXJpYywgfmNlbGxfc3BlYyhzY2FsZXM6OnBlcmNlbnQoLiwgYWNjdXJhY3kgPSAwLjEpLCAiaHRtbCIsIGNvbG9yPWNhc2Vfd2hlbiguIDwgMCB+ICJyZWQiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAuID49IDAgfiAiZ3JlZW4iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpcy5uYSguKSB+ICJsaWdodGdyYXkiLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBUUlVFIH4gImJsYWNrIikpKSAlPiUKa2JsKGNvbC5uYW1lcyA9IGMoIkN1c3RvbWVyIFNlZ21lbnQiLCBhcy5jaGFyYWN0ZXIoMjAxNDoyMDE3KSwgYXMuY2hhcmFjdGVyKDIwMTQ6MjAxNykpLAogICAgICAgICAgICAgY2FwdGlvbiA9ICJZZWFyIG92ZXIgdGhlIHllYXIgU2FsZXMgYW5kIFByb2ZpdCBncm93dGggYnkgQ3VzdG9tZXIgU2VnbWVudCIsCiAgICBlc2NhcGUgPSBGLAogICAgYWxpZ24gPSBjKCJsIiwgcmVwKCdyJyx0aW1lcz04KSkpICU+JQpyb3dfc3BlYygwLCBhbGlnbiA9ICJjIikgJT4lCmthYmxlX3N0eWxpbmcoYm9vdHN0cmFwX29wdGlvbnMgPSBjKCJzdHJpcGVkIiwgImJvcmRlcmVkIiksIGZ1bGxfd2lkdGggPSBUUlVFKSAlPiUKYWRkX2hlYWRlcl9hYm92ZShoZWFkZXIgPSBjKCIiLCAiWW9ZIFNhbGVzIEdyb3d0aCIgPSA0LCAiWW9ZIFByb2ZpdCBHcm93dGgiID0gNCksIGJvbGQgPSBUUlVFLCBib3JkZXJfbGVmdCA9IFRSVUUsIGJvcmRlcl9yaWdodCA9IFRSVUUpCgpgYGAKCgpgYGB7ciB5b3ktc2VnbWVudC1wbG90fQoKc2NhbGUgPC0gbWF4KFlvWV9zZWckU2FsZXMpCllvWV9zZWcgJT4lCiAgZ2dwbG90KCkgKwogICBnZW9tX2NvbChhZXMoeD1ZZWFyLCB5PVNhbGVzLCBmaWxsPVNlZ21lbnQpKSArCiAgICBnZW9tX2xpbmUoYWVzKHggPSBZZWFyLCB5ID0gWW9ZX0dyb3d0aF9TYWxlcyAqIG1heChZb1lfc2VnJFNhbGVzW1lvWV9zZWckU2VnbWVudCA9PSBTZWdtZW50XSksIGdyb3VwID0gU2VnbWVudCwgY29sb3I9IllvWSBHcm93dGgiKSwgc2l6ZSA9IDAuNzUpICsgCiAgICBnZW9tX3BvaW50KGFlcyh4ID0gWWVhciwgeSA9IFlvWV9Hcm93dGhfU2FsZXMgKiBtYXgoWW9ZX3NlZyRTYWxlc1tZb1lfc2VnJFNlZ21lbnQgPT0gU2VnbWVudF0pLCBncm91cCA9IFNlZ21lbnQsIGNvbG9yPSJZb1kgR3Jvd3RoIiksIHNpemUgPSAzKSArIAogICAgZ2VvbV9wb2ludChhZXMoeCA9IFllYXIsIHkgPSBZb1lfR3Jvd3RoX1NhbGVzICogbWF4KFlvWV9zZWckU2FsZXNbWW9ZX3NlZyRTZWdtZW50ID09IFNlZ21lbnRdKSwgZ3JvdXAgPSBTZWdtZW50LCBjb2xvcj0iWW9ZIEdyb3d0aCIpLCBzaGFwZT0yMSwgZmlsbCA9ICJ3aGl0ZSIsIHNpemUgPSAyKSArIAogICAgZ2VvbV90ZXh0KGFlcyh4ID0gWWVhciwgeSA9IFlvWV9Hcm93dGhfU2FsZXMgKiBtYXgoWW9ZX3NlZyRTYWxlc1tZb1lfc2VnJFNlZ21lbnQgPT0gU2VnbWVudF0pLCAKICAgICAgICAgICAgICAgICAgbGFiZWwgPSBzY2FsZXM6OnBlcmNlbnQoWW9ZX0dyb3d0aF9TYWxlcywgYWNjdXJhY3k9MC4xKSwKICAgICAgICAgICAgICAgICAgdmp1c3QgPSBpZmVsc2UoWW9ZX0dyb3d0aF9TYWxlcyA8IDAsIDIsIC0xLjUpKSwgc2l6ZSA9IDQsIGNvbG9yID0gImJsYWNrIikgKwogICBsYWJzKHRpdGxlID0gIllvWSBTYWxlcyBHcm93dGggYnkgQ3VzdG9tZXIgU2VnbWVudCIsIHggPSAiQ3VzdG9tZXIgU2VnbWVudCIsIHkgPSAiU2FsZXMsICQiKSArCiAgIHNjYWxlX3lfY29udGludW91cyhzZWMuYXhpcyA9IHNlY19heGlzKHRyYW5zID0gfi4vc2NhbGUsIG5hbWUgPSAiIiwgbGFiZWxzID0gc2NhbGVzOjpsYWJlbF9wZXJjZW50KCksIGJyZWFrcyA9IHNlcSgwLCAxLCAwLjIpKSwgCiAgICAgICAgICAgICAgICAgICAgICBsYWJlbHMgPSBzY2FsZXM6Om51bWJlcihzZXEoMCwgMzUwZTMsIGJ5PTUwZTMpLCBzY2FsZSA9IDFlLTMsIHN1ZmZpeCA9ICJLIiksIGxpbWl0cyA9IGMoLTEwMGUzLCAzNTBlMyksCiAgICAgICAgICAgICAgICAgICAgICBicmVha3MgPSBzZXEoMCwgMzUwZTMsIGJ5PTUwZTMpKSArCiAgc2NhbGVfY29sb3VyX21hbnVhbChuYW1lID0gIiIsIHZhbHVlcz1jKCJZb1kgR3Jvd3RoIj0iYmxhY2siKSkgKwogICAgc2NhbGVfZmlsbF9icmV3ZXIocGFsZXR0ZT0iR3JlZW5zIikgKwogIGZhY2V0X3dyYXAoLn5TZWdtZW50KSArCiAgdGhlbWUobGVnZW5kLnBvc2l0aW9uID0gImJvdHRvbSIsIGxlZ2VuZC50aXRsZSA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBzdHJpcC5iYWNrZ3JvdW5kID0gZWxlbWVudF9ibGFuaygpLAogICAgICAgIHN0cmlwLnRleHQgPSBlbGVtZW50X3RleHQoY29sb3IgPSAiYmxhY2siLCBmYWNlID0gImJvbGQiKSkKCmBgYAoKCmBgYHtyIHlveS1wcm9maXQtc2VnbWVudH0KCnNjYWxlIDwtIG1heChZb1lfc2VnJFByb2ZpdCkKWW9ZX3NlZyAlPiUKICBnZ3Bsb3QoKSArCiAgIGdlb21fY29sKGFlcyh4PVllYXIsIHk9UHJvZml0LCBmaWxsPVNlZ21lbnQpKSArCiAgICBnZW9tX2xpbmUoYWVzKHggPSBZZWFyLCB5ID0gWW9ZX0dyb3d0aF9Qcm9maXQgKiBtYXgoWW9ZX3NlZyRQcm9maXRbWW9ZX3NlZyRTZWdtZW50ID09IFNlZ21lbnRdKSwgZ3JvdXAgPSBTZWdtZW50LCBjb2xvcj0iWW9ZIEdyb3d0aCIpLCBzaXplID0gMC43NSkgKyAKICAgIGdlb21fcG9pbnQoYWVzKHggPSBZZWFyLCB5ID0gWW9ZX0dyb3d0aF9Qcm9maXQgKiBtYXgoWW9ZX3NlZyRQcm9maXRbWW9ZX3NlZyRTZWdtZW50ID09IFNlZ21lbnRdKSwgZ3JvdXAgPSBTZWdtZW50LCBjb2xvcj0iWW9ZIEdyb3d0aCIpLCBzaXplID0gMykgKyAKICAgIGdlb21fcG9pbnQoYWVzKHggPSBZZWFyLCB5ID0gWW9ZX0dyb3d0aF9Qcm9maXQgKiBtYXgoWW9ZX3NlZyRQcm9maXRbWW9ZX3NlZyRTZWdtZW50ID09IFNlZ21lbnRdKSwgZ3JvdXAgPSBTZWdtZW50LCBjb2xvcj0iWW9ZIEdyb3d0aCIpLCBzaGFwZT0yMSwgZmlsbCA9ICJ3aGl0ZSIsIHNpemUgPSAyKSArIAogICAgZ2VvbV90ZXh0KGFlcyh4ID0gWWVhciwgeSA9IFlvWV9Hcm93dGhfUHJvZml0ICogbWF4KFlvWV9zZWckUHJvZml0W1lvWV9zZWckU2VnbWVudCA9PSBTZWdtZW50XSksIAogICAgICAgICAgICAgICAgICBsYWJlbCA9IHNjYWxlczo6cGVyY2VudChZb1lfR3Jvd3RoX1Byb2ZpdCwgYWNjdXJhY3k9MUwpLAogICAgICAgICAgICAgICAgICB2anVzdCA9IGlmZWxzZShZb1lfR3Jvd3RoX1Byb2ZpdCA8IDAsIDIsIC0xLjUpKSwgc2l6ZSA9IDQsIGNvbG9yID0gImJsYWNrIikgKwogICBsYWJzKHRpdGxlID0gIllvWSBQcm9maXQgR3Jvd3RoIGJ5IEN1c3RvbWVyIFNlZ21lbnQiLCB4ID0gIkN1c3RvbWVyIFNlZ21lbnQiLCB5ID0gIlByb2ZpdCwgJCIpICsKICAgc2NhbGVfeV9jb250aW51b3VzKHNlYy5heGlzID0gc2VjX2F4aXModHJhbnMgPSB+Li9zY2FsZSwgbmFtZSA9ICIiLCBsYWJlbHMgPSBzY2FsZXM6OmxhYmVsX3BlcmNlbnQoKSwgYnJlYWtzID0gc2VxKDAsIDEsIDAuMikpLCAKICAgICAgICAgICAgICAgICAgICAgIGxhYmVscyA9IHNjYWxlczo6bnVtYmVyKHNlcSgwLCA1MGUzLCBieT0xMGUzKSwgc2NhbGUgPSAxZS0zLCBzdWZmaXggPSAiSyIpLCBsaW1pdHMgPSBjKC0xMGUzLCA1MGUzKSwKICAgICAgICAgICAgICAgICAgICAgIGJyZWFrcyA9IHNlcSgwLCA1MGUzLCBieT0xMGUzKSkgKwogICAgc2NhbGVfZmlsbF9icmV3ZXIocGFsZXR0ZT0iR3JlZW5zIikgKwogIHNjYWxlX2NvbG91cl9tYW51YWwobmFtZSA9ICIiLCB2YWx1ZXM9YygiWW9ZIEdyb3d0aCI9ImJsYWNrIikpICsKICBmYWNldF93cmFwKC5+U2VnbWVudCkgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbiA9ICJib3R0b20iLCBsZWdlbmQudGl0bGUgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgc3RyaXAuYmFja2dyb3VuZCA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBzdHJpcC50ZXh0ID0gZWxlbWVudF90ZXh0KGNvbG9yID0gImJsYWNrIiwgZmFjZSA9ICJib2xkIikpCgpgYGAKCiMjIENvcnJlbGF0aW9uCgpgYGAge3IgY29ycmVsYXRpb25zfQoKZGYgPC0gZGF0YS5mcmFtZShPcmRlcnMgJT4lIHNlbGVjdF9pZihpcy5udW1lcmljKSkKCiMgY29ycmVsYXRpb25zCmNvcihkZikKCmwgPC0gbGVuZ3RoKHVuaXF1ZShPcmRlcnMkU2VnbWVudCkpCgojIHBsb3QgY29ycmVsYXRpb25zCnBhaXJzKGRmLCAgICAgICAKICAgICAgcGNoID0gMTksIAogICAgICBjb2wgPSBoY2wuY29sb3JzKGwsICJUZW1wcyIpW09yZGVycyRTZWdtZW50XSwKICAgICAgbWFpbiA9ICJDb3JyZWxhdGlvbnMiLCAgIAogICAgICBnYXAgPSAwLCAgICAgCiAgICAgIHJvdzFhdHRvcCA9IEZBTFNFLCAKICAgICAgbGFiZWxzID0gY29sbmFtZXMoZGYpLCAKICAgICAgY2V4LmxhYmVscyA9IDAuOCwgIAogICAgICBmb250LmxhYmVscyA9IDEpIAoKYGBgCgojIyMgSG93IFNhbGVzIGFmZmVjdCBQcm9maXQ/CgpgYGB7ciBzYWxlcy1wcm9maXQtY29ycmVsYXRpb259CgpPcmRlcnMgJT4lCiAgZ2dwbG90KCkgKwogIGdlb21faGxpbmUoeWludGVyY2VwdCA9IDAsIGNvbG9yID0gImRhcmtncmF5Iiwgc2l6ZT0wLjI1KSArCiAgZ2VvbV9wb2ludChhZXMoeD1TYWxlcywgeT1Qcm9maXQpLCBjb2xvcj0iIzRCQTE1RCIsIHNoYXBlPTIxLCBmaWxsPSIjQUREN0EwIiwgYWxwaGE9MC41KSArCiAgc2NhbGVfeF9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6bGFiZWxfbnVtYmVyKHNjYWxlID0gMWUtMywgc3VmZml4ID0gIksiLCBhY2N1cmFjeSA9IDFMKSwKICAgICAgICAgICAgICAgICAgICAgbGltaXRzID0gYygwLCAyNWUzKSwgYnJlYWtzID0gc2VxKDAsIDI1ZTMsIDIuNWUzKSkgKwogIHNjYWxlX3lfY29udGludW91cyhsYWJlbHMgPSBzY2FsZXM6OmxhYmVsX251bWJlcihzY2FsZSA9IDFlLTMsIHN1ZmZpeCA9ICJLIiwgYWNjdXJhY3kgPSAxTCksCiAgICAgICAgICAgICAgICAgICAgIGxpbWl0cyA9IGMoLTdlMywgOWUzKSwgYnJlYWtzID0gc2VxKC03ZTMsIDllMywgMWUzKSkgKwogIGxhYnModGl0bGUgPSAiU2FsZXMgYW5kIFByb2ZpdCBjb3JyZWxhdGlvbiIsIHggPSAiU2FsZXMsICQiLCB5PSJQcm9maXQsICQiKQoKYGBgCgojIyMgSG93IGRpc2NvdW50IGFmZmVjdHMgc2FsZXMgYW5kIHByb2ZpdD8KCmBgYHtyIGRpc2NvdW50LWFmZmVjdH0KCk9yZGVycyAlPiUKICBnZ3Bsb3QoYWVzKHg9RGlzY291bnQsIHk9U2FsZXMpKSArCiAgZ2VvbV9wb2ludChhZXMoY29sb3I9U2VnbWVudCksIGFscGhhPTAuNSwgcG9zaXRpb24gPSBwb3NpdGlvbl9qaXR0ZXIoKSkgKwogIHNjYWxlX3hfY29udGludW91cyhsYWJlbHMgPSBzY2FsZXM6OmxhYmVsX3BlcmNlbnQoKSwgYnJlYWtzID0gc2VxKDAsIDAuOCwgMC4xKSkgKwogIHNjYWxlX3lfY29udGludW91cyhsYWJlbHMgPSBzY2FsZXM6OmxhYmVsX251bWJlcihzY2FsZSA9IDFlLTMsIHN1ZmZpeCA9ICJLIiwgYWNjdXJhY3kgPSAxTCksCiAgICAgICAgICAgICAgICAgICAgIGxpbWl0cyA9IGMoMCwgMjVlMyksIGJyZWFrcyA9IHNlcSgwLCAyNWUzLCA1ZTMpKSArCiAgbGFicyh0aXRsZSA9ICJEaXNjb3VudCBhbmQgU2FsZXMgY29ycmVsYXRpb24gYnkgQ3VzdG9tZXIgU2VnbWVudCIsIHggPSAiRGlzY291bnQiLCB5PSJTYWxlcywgJCIpICsKICB0aGVtZShsZWdlbmQucG9zaXRpb249Im5vbmUiLAogICAgICAgIHN0cmlwLmJhY2tncm91bmQgPSBlbGVtZW50X2JsYW5rKCksCiAgICAgICAgc3RyaXAudGV4dCA9IGVsZW1lbnRfdGV4dChjb2xvciA9ICJibGFjayIsIGZhY2UgPSAiYm9sZCIpKSArCiAgZmFjZXRfd3JhcCh+U2VnbWVudCwgbmNvbCA9IDEpCgpPcmRlcnMgJT4lCiAgZ2dwbG90KGFlcyh4PURpc2NvdW50LCB5PVByb2ZpdCkpICsKICBnZW9tX3BvaW50KGFlcyhjb2xvcj1TZWdtZW50KSwgYWxwaGE9MC41LCBwb3NpdGlvbiA9IHBvc2l0aW9uX2ppdHRlcigpKSArCiAgc2NhbGVfeF9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6bGFiZWxfcGVyY2VudCgpLCBicmVha3MgPSBzZXEoMCwgMC44LCAwLjEpKSArCiAgc2NhbGVfeV9jb250aW51b3VzKGxhYmVscyA9IHNjYWxlczo6bGFiZWxfbnVtYmVyKHNjYWxlID0gMWUtMywgc3VmZml4ID0gIksiLCBhY2N1cmFjeSA9IDFMKSwKICAgICAgICAgICAgICAgICAgICAgbGltaXRzID0gYygtN2UzLCA5ZTMpLCBicmVha3MgPSBzZXEoLTdlMywgOWUzLCAyZTMpKSArCiAgbGFicyh0aXRsZSA9ICJEaXNjb3VudCBhbmQgUHJvZml0IGNvcnJlbGF0aW9uIGJ5IEN1c3RvbWVyIFNlZ21lbnQiLCB4ID0gIkRpc2NvdW50IiwgeT0iUHJvZml0LCAkIikgKwogIHRoZW1lKGxlZ2VuZC5wb3NpdGlvbj0ibm9uZSIsCiAgICAgICAgc3RyaXAuYmFja2dyb3VuZCA9IGVsZW1lbnRfYmxhbmsoKSwKICAgICAgICBzdHJpcC50ZXh0ID0gZWxlbWVudF90ZXh0KGNvbG9yID0gImJsYWNrIiwgZmFjZSA9ICJib2xkIikpICsKICBmYWNldF93cmFwKH5TZWdtZW50LCBuY29sID0gMSkKCmBgYAoKCgo=</div>



</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("index.Rmd");
});
</script>


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
